import{ar as H,r as t,j as e,C as G,a8 as se,B as J,aP as oe,R as ne,ae,a4 as re,d8 as le,aA as F,bC as ie,bD as ce}from"./index-6ab6cade.js";import{T as de}from"./index-90036cc8.js";import me from"./UserFormModal-bb2c865d.js";import{newFormList as ue}from"./Form_Config-5b80f6fa.js";import{u as pe,w as fe}from"./xlsx-964ea548.js";import{columnConfig as he}from"./Table_Column_Config-ad85e5c9.js";import ge from"./TableHeader-384ada35.js";import{C as xe}from"./index-c59d5039.js";import{D as Se}from"./index-33914030.js";import{C as be}from"./index-dcef3aa8.js";import{S as we}from"./index-05e40cca.js";import{P as je}from"./Table-62c78325.js";import"./index-a5098ef4.js";import"./index-d1e96b4a.js";import"./useBubbleLock-0d556991.js";import"./Select-74f8e578.js";import"./List-556d4d6b.js";import"./useShowArrow-628cd2bf.js";import"./useIcons-bfa037c0.js";import"./SinglePicker-9fccad2e.js";import"./customParseFormat-8184abb2.js";import"./index-d2502ba7.js";import"./Image-a10bb0be.js";import"./addEventListener-3a490a20.js";import"./index-d4c25178.js";import"./index-1b2860a7.js";import"./index-0ecd7869.js";import"./zh_CN-f51ae7db.js";import"./styleChecker-b88c47f4.js";import"./Tree-27289865.js";import"./conductUtil-0f9ba3c8.js";import"./index-dc39c46e.js";import"./iconUtil-3c2f21e2.js";import"./useLazyKVMap-56df8c07.js";const ve=()=>{const z=(a,m,d)=>{const u=m.map(p=>Object.keys(p).reduce((h,r)=>{const S=a[r]||r;return h[S]=p[r],h},{})),T=pe.json_to_sheet(u);I(v(T,void 0),`${d}.xlsx`)},I=(a,m)=>{typeof a=="object"&&a instanceof Blob&&(a=URL.createObjectURL(a));var d=document.createElement("a");d.href=a,d.download=m||"";var u;window.MouseEvent?u=new MouseEvent("click"):(u=document.createEvent("MouseEvents"),u.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null)),d.dispatchEvent(u)},v=(a,m)=>{m=m||"sheet1";var d={SheetNames:[m],Sheets:{}};d.Sheets[m]=a;var u={bookType:"xlsx",bookSST:!1,type:"binary"},T=fe(d,u),p=new Blob([h(T)],{type:"application/octet-stream"});function h(r){for(var S=new ArrayBuffer(r.length),y=new Uint8Array(S),b=0;b!=r.length;++b)y[b]=r.charCodeAt(b)&255;return S}return p};return{handleExportAll:z}};const ye=z=>{const{formRef:I,name:v="advanced_search",loading:a,FormListConfig:m=[],rowCount:d=3,FormOnFinish:u,SetIsExpand:T}=z,p=m,[h]=H.useForm(),[r,S]=t.useState(!1),[y,b]=t.useState(!0);function O(l){if(!l)return"";const o=new Date(l),w=o.getMonth()<9?`0${o.getMonth()+1}`:o.getMonth()+1,k=o.getDate()<10?`0${o.getDate()}`:o.getDate();return`${o.getFullYear()}-${w}-${k}`}const K=l=>{const o=h.getFieldsValue();o.startTime&&(o.startTime=O(o.startTime)),o.endTime&&(o.endTime=O(o.endTime)),u&&u(o)},f=l=>{},L=()=>{S(!r),T(!r)},C=t.useMemo(()=>{const l=d||3,o=24/l,w=l===1?1:p.length>=l?l-1:p.length,k=r?p:p.slice(0,w),M=k.map((g,A)=>{const{type:j,label:R,field:B,placeholder:E,list:Q,component:D}=g;let x=null;if(D)x=D;else switch(j){case"INPUT":x=e.jsx(ae,{placeholder:E});break;case"SELECT":x=e.jsx(we,{placeholder:E});break;case"CHECKBOX":x=e.jsx(be,{children:R});break;case"TIME_START":case"TIME_END":x=e.jsx(Se,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:E});break;default:return null}return e.jsx(G,{span:o,children:e.jsx(H.Item,{name:B,label:R,children:x})},A)});let P=[];if(y){const g=k.length%l,A=g===0?l-1:l-g-1,j=Array.from({length:A},(B,E)=>e.jsx(G,{span:o},`blank-${E}`)),R=e.jsx(G,{span:o,style:{textAlign:"right"},children:e.jsx(H.Item,{children:e.jsxs(se,{size:"small",children:[e.jsx(J,{type:"primary",htmlType:"submit",children:"查询"}),e.jsx(J,{onClick:()=>h.resetFields(),children:"重置"}),p.length<l?null:e.jsxs(J,{type:"link",className:"text-[12px]",onClick:L,children:[r?"关闭":"展开"," ",e.jsx(oe,{})]})]})})},"actions");P=[...j,R]}return[...M,...P]},[r,p,d,y]);return e.jsx(xe,{id:"AdvancedSearchForm",size:"small",hoverable:!0,ref:I,children:e.jsx(H,{size:"middle",layout:"horizontal",disabled:a,name:v,form:h,variant:"outlined",onFinish:K,onFinishFailed:f,children:e.jsx(ne,{gutter:24,children:C})})})},at=()=>{var X,q;const{handleExportAll:z}=ve(),[I]=H.useForm();H.useForm();const v=t.useRef(null),a=t.useRef(null),m=t.useRef(null),d=t.useRef(null),[u,T]=t.useState({}),[p,h]=t.useState([]),[r,S]=t.useState({});t.useState({state:"1",type:["1","3"]});const[y,b]=t.useState(!1),[O,K]=t.useState([]),[f,L]=t.useState({page:1,pageSize:10,totalCount:0}),[C,l]=t.useState({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),[o,w]=t.useState(!1),[k,M]=t.useState(""),[P,g]=t.useState(""),[A,j]=t.useState({}),[R,B]=t.useState(0),[E,Q]=t.useState(!1);t.useEffect(()=>{const s=()=>{var $,_,Y,W;const c=(($=a.current)==null?void 0:$.clientHeight)||0,i=((_=v.current)==null?void 0:_.clientHeight)||0,n=((Y=d.current)==null?void 0:Y.clientHeight)||0,V=((W=m.current)==null?void 0:W.clientHeight)||0,U=c-i-n-V;let N=U>200?U:200;B(N)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[E]);async function D(){var U,N,$;b(!0);let{page:s,pageSize:c}=f,i={page:s,pageSize:c,...r};const n=await le(i),V=(N=(U=n==null?void 0:n.data)==null?void 0:U.list)==null?void 0:N.map((_,Y)=>({..._,key:Y+1}));K(V||[]),L({page:s||1,pageSize:c||10,totalCount:(($=n==null?void 0:n.data)==null?void 0:$.total)||0}),b(!1)}t.useEffect(()=>{D()},[f.page,f.pageSize,r]);const x=async(s,c)=>{if(s==="create")w(!0),M("新建用户"),g(s),j({});else if(["edit","detail"].includes(s))w(!0),M(s==="edit"?"编辑用户":"查看详情"),g(s),j(c);else if(s==="delete"){const i=F.loading("正在删除");try{const n=await ie(c._id);n&&(i(),D(),F.success(n.data.message))}catch{i(),F.error("删除失败、请再试一次！")}}else if(s==="moreDelete"){const i=F.loading("正在删除");try{const n=await ce(C.selectedIds||[]);n&&(i(),l({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),D(),F.success(n.data.message))}catch{i(),F.error("删除失败、请再试一次！")}}},Z=()=>{I.getFieldsValue(),M(""),g(""),w(!1),j({}),F.info("待实现")};let ee={selectRowItem:C,header:{address:"地址",birthday:"生日",email:"邮箱",id:"id",interest:"爱好",isMarried:"婚姻状态"},userList:O,handleOperator:x,handleExportAll:z};const te=!0;return(X=a==null?void 0:a.current)==null||X.clientHeight,(q=v.current)==null||q.clientHeight,e.jsxs("div",{className:"h-full flex flex-col overflow-hidden",ref:a,children:[e.jsx(ye,{formRef:v,loading:y,rowCount:3,FormListConfig:ue,FormOnFinish:(s={})=>{const c=Object.fromEntries(Object.entries(s).filter(([i,n])=>n!=null&&!(typeof n=="string"&&n.trim()==="")));S(c||{})},SetIsExpand:Q}),e.jsxs("div",{className:"h-full flex-1  mt-[12px] rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between px-[18px] py-[10px]",ref:d,children:[e.jsx("span",{className:"text-[14px] font-mono",children:e.jsx("b",{children:"用户列表"})}),e.jsx(ge,{...ee})]}),e.jsx(de,{id:"cart-scrollTable",size:"small",loading:y,xScroll:!0,scroll:{x:"max-content",y:R},sticky:{offsetHeader:0},rowSelection:"checkbox",columns:he(te,u,x),updateSelectedItem:(s,c,i)=>{l({selectedRowKeys:s,selectedIds:i&&i.length>0?i:[],selectedRows:c})},updatePage:(s,c)=>{L(i=>({...i,page:s,pageSize:c}))},dataSource:O,pagination:f,selectedRowKeys:C.selectedRowKeys,selectedIds:C.selectedIds,selectedItem:C.selectedItem})]}),e.jsx("div",{className:"flex justify-end rounded-lg px-[20px] pb-[12px] bg-white",ref:m,children:e.jsx(je,{size:"default",showQuickJumper:!0,showSizeChanger:!0,onChange:(s,c)=>{L({...f,page:s,pageSize:c})},current:f.page,pageSize:f.pageSize,pageSizeOptions:[5,10,15,20,50,100,500,1e3],total:f.totalCount,showTotal:()=>`第${f.page}页， 共 ${f.totalCount} 条`})}),e.jsx(re,{width:800,height:800,title:k,open:o,onOk:Z,onCancel:()=>{M(""),g(""),w(!1),j({})},children:e.jsx(me,{form:I,roles:p,userInfo:A,type:P})})]})};export{at as default};
//# sourceMappingURL=index-3016f210.js.map
