import{r as c,j as e,an as j,R as te,B as g,a as T,at as se,au as A,I as le,a4 as z,b6 as ae,c7 as ne,C as O,aE as ie,S as R,aO as re,aL as de,W as oe,b2 as L,$ as ce,V as P,aC as E}from"./.pnpm-e6eae8df.js";import{h as M,P as F}from"./index-479552fe.js";import{T as me}from"./index-ddbf1406.js";import{r as ue}from"./roleManage-ea36f73b.js";import xe from"./UserFormModal-52cf203b.js";const he=n=>M.get(F+"/user/manage/list",n),fe=n=>M.post(F+"/user/manage/create",n),pe=n=>M.post(F+"/user/manage/edit",n);function ge(n=[]){if(!n)return[];let l=[];return n.forEach(a=>{l.push(e.jsx(A.Option,{value:a.id,children:a.name},a.id))}),l}function V(n){if(!n)return"";const l=new Date(n),a=l.getMonth()<9?`0${l.getMonth()+1}`:l.getMonth()+1,r=l.getDate()<10?`0${l.getDate()}`:l.getDate();return`${l.getFullYear()}-${a}-${r}`}function Y(n){const{label:l,field:a,type:r,placeholder:d,width:o,list:m,style:h}=n;switch(r){case"TIME":return[e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:"startTime",label:"开始时间",children:e.jsx(z,{style:o,showTime:!0,placeholder:d,format:"YYYY-MM-DD hh:mm:ss"})},"startTime")}),e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:"endTime",label:"结束时间",children:e.jsx(z,{style:o,showTime:!0,placeholder:d,format:"YYYY-MM-DD hh:mm:ss"})},"endTime")})];case"INPUT":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:a,label:l,style:h,children:e.jsx(le,{type:"text",placeholder:d,style:{width:o}})},a)});case"SELECT":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:a,label:l,style:h,children:e.jsx(A,{style:{width:o},placeholder:d,children:ge(m)})},a)});case"CHECKBOX":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:a,label:l,children:e.jsx(se,{children:l})},a)});default:return null}}function je(n){var u;const{filterSubmit:l,multiForm:a}=n,[r,d]=c.useState(!1),o=c.useCallback(()=>{let s=a.getFieldsValue();s.startTime&&(s.startTime=V(s.startTime)),s.endTime&&(s.endTime=V(s.endTime)),l&&l(s)},[l,a]),m=c.useCallback(()=>{a.resetFields()},[a]),h=()=>{const{formList:s,extendFormList:y}=n;let p=[];if(s&&s.length>0&&(p=s.map(Y)),y&&y.length>0){const I=r?y.map(Y):[];p=[...p,...I]}return p},b=c.useCallback(()=>{d(s=>!s)},[]),f=h();return e.jsx("div",{children:e.jsx(j,{layout:"horizontal",form:a,children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx(te,{style:{width:"calc(100% - 250px)"},children:f.map((s,y)=>s)}),e.jsx("div",{style:{width:200},children:e.jsxs(j.Item,{children:[e.jsx(g,{type:"primary",onClick:o,children:"查询"}),e.jsx(g,{className:"mx-3",onClick:m,children:"重置"}),((u=n.extendFormList)==null?void 0:u.length)>0&&e.jsx("button",{type:"button",onClick:b,children:r?"收起":"展开"})]})})]})})})}const be=[{type:"INPUT",label:"用户名",field:"user_name",placeholder:"请输入用户名",initialValue:"",width:200},{type:"INPUT",label:"联系地址",field:"address",placeholder:"请输入联系地址",initialValue:"",width:200},{type:"SELECT",label:"婚姻状态",field:"isMarried",placeholder:"全部",initialValue:"0",width:200,list:[{id:"0",name:"全部"},{id:"1",name:"未婚"},{id:"2",name:"已婚"}]},{type:"SELECT",label:"性别",field:"sex",placeholder:"全部",initialValue:3,width:200,list:[{id:3,name:"全部"},{id:0,name:"女"},{id:1,name:"男"}]}],ye=[{type:"TIME",width:200},{type:"INPUT",placeholder:"请输入电影名",width:200,label:"电影",field:"movies"},{type:"SELECT",placeholder:"请选择电影",width:200,label:"选择种类",field:"kinds1",name:"key",list:[{id:1,key:"泰坦尼克号"},{id:2,key:"阿凡达"},{id:3,key:"蜘蛛侠"}]}],we=()=>{const n=(r,d,o)=>{const m=d.map(b=>Object.keys(b).reduce((f,u)=>{const s=r[u]||u;return f[s]=b[u],f},{})),h=ae.json_to_sheet(m);l(a(h,void 0),`${o}.xlsx`)},l=(r,d)=>{typeof r=="object"&&r instanceof Blob&&(r=URL.createObjectURL(r));var o=document.createElement("a");o.href=r,o.download=d||"";var m;window.MouseEvent?m=new MouseEvent("click"):(m=document.createEvent("MouseEvents"),m.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null)),o.dispatchEvent(m)},a=(r,d)=>{d=d||"sheet1";var o={SheetNames:[d],Sheets:{}};o.Sheets[d]=r;var m={bookType:"xlsx",bookSST:!1,type:"binary"},h=ne(o,m),b=new Blob([f(h)],{type:"application/octet-stream"});function f(u){for(var s=new ArrayBuffer(u.length),y=new Uint8Array(s),p=0;p!=u.length;++p)y[p]=u.charCodeAt(p)&255;return s}return b};return{handleExportAll:n}},Ce=()=>{const{handleExportAll:n}=we(),[l,a]=c.useState({}),[r,d]=c.useState([]),[o,m]=c.useState(!1),[h,b]=c.useState([]),[f,u]=c.useState({page:1,pageSize:10,totalCount:0}),[s,y]=c.useState({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),[p,I]=c.useState(!1),[B,C]=c.useState(""),[D,v]=c.useState(""),[K,U]=c.useState({}),[N,_]=c.useState({});c.useState({state:"1",type:["1","3"]});const[$]=j.useForm(),[H]=j.useForm(),J=()=>{m(!0),setTimeout(()=>{const{page:t,pageSize:i}=f;let x={page:t,pageSize:i,...N};he(x).then(w=>{m(!1);const k=w.data.list.map((Z,ee)=>({...Z,key:ee}));b(k.splice(0,i)),u({page:w.data.page,pageSize:w.data.page_size,totalCount:w.data.total_count})})},500)},W=()=>{ue().then(t=>{let i=t.data.list;const x=i.reduce((w,k)=>(w[k.id]=k.role_name,w),{});a(x||[]),d(i)})};c.useEffect(()=>{J(),W()},[f.page,f.pageSize]);const X=[{title:"id",dataIndex:"id",width:80,fixed:"left"},{title:"用户名",dataIndex:"username",width:80,fixed:"left"},{title:"性别",dataIndex:"sex",render:t=>t===1?"男":"女"},{title:"状态",dataIndex:"state",render:t=>({1:e.jsx(E,{color:"green",children:"痛苦"}),2:e.jsx(E,{color:"blue",children:"委屈"}),3:e.jsx(E,{color:"orange",children:"迷茫"}),4:e.jsx(E,{color:"red",children:"平淡"}),5:e.jsx(E,{color:"purple",children:"开心"})})[t]},{title:"爱好",dataIndex:"interest",render:t=>({1:"游泳",2:"打篮球",3:"踢足球",4:"跑步",5:"爬山",6:"骑行",7:"桌球",8:"麦霸"})[t]},{title:"婚姻状态",dataIndex:"isMarried",render(t){return t?e.jsx(P,{status:"success",text:"已婚"}):e.jsx(P,{status:"error",text:"未婚"})}},{title:"所属角色",dataIndex:"role_id",render:t=>l[t]},{title:"手机号",render(){let x=(15303663375+"").replace(/(\d{3})\d*(\d{4})/g,"$1***$2");return e.jsx("span",{children:x})}},{title:"身份证号",render(){let x=(231085199811011415n+"").replace(/(\d{3})\d*(\d{4})/g,"$1***********$2");return e.jsx("span",{children:x})}},{title:"联系地址",dataIndex:"address"},{title:"邮箱",dataIndex:"email"},{title:"生日",dataIndex:"birthday"},{title:"早起时间",dataIndex:"time"},{title:"操作",fixed:"right",width:200,render(t){return e.jsxs(R,{children:[e.jsx(g,{size:"small",onClick:()=>{S("detail",t)},children:"详情"}),e.jsx(g,{size:"small",onClick:()=>{S("edit",t)},children:"编辑"}),e.jsx(g,{size:"small",onClick:()=>{S("delete",t)},children:"删除"})]})}}],S=(t,i)=>{t==="create"?(I(!0),C("新建用户"),v(t)):["edit","detail"].includes(t)?(C(t==="edit"?"编辑用户":"查看详情"),v(t),U(i),I(!0)):t==="delete"?L.success(`删除用户成功！ id：${i.id}`):t==="moreDelete"&&L.success(`删除更多用户成功！ id：${JSON.stringify(s.selectedIds)}`)},q=()=>{let t=D,i=$.getFieldsValue();t==="create"?fe(i):pe(i)},G={address:"地址",birthday:"生日",email:"邮箱",id:"id",interest:"爱好",isMarried:"婚姻状态"},Q=e.jsxs("div",{children:[e.jsx(O,{className:"mb20",style:{},children:e.jsx(ie,{defaultActiveKey:"1",items:[{label:"输入框查询",key:"1",children:e.jsx(je,{multiForm:H,formList:be,extendFormList:ye,filterSubmit:(t={})=>{_(t)}})}]})}),e.jsx(O,{className:"mb30",title:"用户列表",extra:e.jsxs(R,{size:"large",children:[e.jsx(g,{size:"middle",onClick:()=>{S("create",null)},children:"新建"}),e.jsx(re,{title:"批量删除",description:"你确定要删除吗？",okText:"确定",cancelText:"取消",onConfirm:()=>{S("moreDelete",null)},children:e.jsx(g,{size:"middle",disabled:s.selectedRowKeys.length<=1,icon:e.jsx(de,{}),children:"批量删除"})}),e.jsx(g,{size:"middle",onClick:()=>{n(G,h,"用户列表")},children:"导出Excel"}),e.jsx(oe,{beforeUpload:t=>(/\.(xlsx|xls)$/.test(t.name.toLowerCase())||L.error("请上传Excel文件（.xlsx 或 .xls）"),!1),children:e.jsx(g,{children:"上传Excel"})})]}),style:{width:"100%"},children:e.jsx(me,{rowSelection:"checkbox",columns:X,dataSource:h,pagination:f,selectedRowKeys:s.selectedRowKeys,selectedIds:s.selectedIds,selectedItem:s.selectedItem,updateSelectedItem:(t,i,x)=>{y({selectedRowKeys:t,selectedIds:x&&x.length>0?x:[],selectedRows:i})},updatePage:(t,i)=>{u(x=>({...x,page:t,pageSize:i}))},loading:o,id:"cart-scrollTable",xScroll:!0})}),e.jsx(ce,{width:800,title:B,open:p,onOk:q,onCancel:()=>{C(""),I(!1),v(""),U({})},children:e.jsx(xe,{roles:r,userInfo:K,type:D,form:$})})]});return e.jsx(e.Fragment,{children:Q})};export{Ce as default};
