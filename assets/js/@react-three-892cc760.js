import{h as I}from"./@babel-c46ce09a.js";import{r as _}from"./react-12b51ca5.js";import{L as se,T as Ke,R as Je,U as Qe,a as Ze,O as et,P as tt,S as Ce,b as ce,N as nt,A as rt,B as ot,M as it,C as at,W as st,c as ct,d as lt,e as ut,V as ft,f as G,g as dt,h as pt,t as vt,i as mt,j as ht,D as V,k as gt}from"./three-61b4c2af.js";import{u as yt}from"./react-use-measure-3cc199c6.js";import{F as _t,u as bt}from"./its-fine-c588097f.js";import{R as wt,c as W}from"./react-reconciler-70247064.js";import{s as Se}from"./scheduler-765c72db.js";import"./react-dom-e71a48dd.js";import{m as Le}from"./react-merge-refs-239dbb3c.js";import{c as Et}from"./zustand-942b6941.js";const Ct="modulepreload",St=function(e,n){return new URL(e,n).href},Pe={},un=function(n,o,a){if(!o||o.length===0)return n();const f=document.getElementsByTagName("link");return Promise.all(o.map(l=>{if(l=St(l,a),l in Pe)return;Pe[l]=!0;const g=l.endsWith(".css"),h=g?'[rel="stylesheet"]':"";if(!!a)for(let t=f.length-1;t>=0;t--){const r=f[t];if(r.href===l&&(!g||r.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":Ct,g||(v.as="script",v.crossOrigin=""),v.href=l,document.head.appendChild(v),g)return new Promise((t,r)=>{v.addEventListener("load",t),v.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>n()).catch(l=>{const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=l,window.dispatchEvent(g),!g.defaultPrevented)throw l})},be={},Pt=e=>void Object.assign(be,e);function Mt(e,n){function o(t,{args:r=[],attach:p,...u},d){let w=`${t[0].toUpperCase()}${t.slice(1)}`,y;if(t==="primitive"){if(u.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const i=u.object;y=$(i,{type:t,root:d,attach:p,primitive:!0})}else{const i=be[w];if(!i)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");y=$(new i(...r),{type:t,root:d,attach:p,memoizedProps:{args:r}})}return y.__r3f.attach===void 0&&(y instanceof ot?y.__r3f.attach="geometry":y instanceof it&&(y.__r3f.attach="material")),w!=="inject"&&fe(y,u),y}function a(t,r){let p=!1;if(r){var u,d;(u=r.__r3f)!=null&&u.attach?ue(t,r,r.__r3f.attach):r.isObject3D&&t.isObject3D&&(t.add(r),p=!0),p||(d=t.__r3f)==null||d.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=t,_e(r),q(r)}}function f(t,r,p){let u=!1;if(r){var d,w;if((d=r.__r3f)!=null&&d.attach)ue(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){r.parent=t,r.dispatchEvent({type:"added"});const y=t.children.filter(c=>c!==r),i=y.indexOf(p);t.children=[...y.slice(0,i),r,...y.slice(i)],u=!0}u||(w=t.__r3f)==null||w.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=t,_e(r),q(r)}}function l(t,r,p=!1){t&&[...t].forEach(u=>g(r,u,p))}function g(t,r,p){if(r){var u,d,w;if(r.__r3f&&(r.__r3f.parent=null),(u=t.__r3f)!=null&&u.objects&&(t.__r3f.objects=t.__r3f.objects.filter(E=>E!==r)),(d=r.__r3f)!=null&&d.attach)je(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){var y;t.remove(r),(y=r.__r3f)!=null&&y.root&&Dt(ie(r),r)}const c=(w=r.__r3f)==null?void 0:w.primitive,m=!c&&(p===void 0?r.dispose!==null:p);if(!c){var i;l((i=r.__r3f)==null?void 0:i.objects,r,m),l(r.children,r,m)}if(delete r.__r3f,m&&r.dispose&&r.type!=="Scene"){const E=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Se.unstable_scheduleCallback(Se.unstable_IdlePriority,E):E()}q(t)}}function h(t,r,p,u){var d;const w=(d=t.__r3f)==null?void 0:d.parent;if(!w)return;const y=o(r,p,t.__r3f.root);if(t.children){for(const i of t.children)i.__r3f&&a(y,i);t.children=t.children.filter(i=>!i.__r3f)}t.__r3f.objects.forEach(i=>a(y,i)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||g(w,t),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),a(w,y),y.raycast&&y.__r3f.eventCount&&ie(y).getState().internal.interaction.push(y),[u,u.alternate].forEach(i=>{i!==null&&(i.stateNode=y,i.ref&&(typeof i.ref=="function"?i.ref(y):i.ref.current=y))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:wt({createInstance:o,removeChild:g,appendChild:a,appendInitialChild:a,insertBefore:f,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,r)=>{if(!r)return;const p=t.getState().scene;p.__r3f&&(p.__r3f.root=t,a(p,r))},removeChildFromContainer:(t,r)=>{r&&g(t.getState().scene,r)},insertInContainerBefore:(t,r,p)=>{if(!r||!p)return;const u=t.getState().scene;u.__r3f&&f(u,r,p)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var r;return!!((r=t==null?void 0:t.__r3f)!=null?r:{}).handlers},prepareUpdate(t,r,p,u){var d;if(((d=t==null?void 0:t.__r3f)!=null?d:{}).primitive&&u.object&&u.object!==t)return[!0];{const{args:y=[],children:i,...c}=u,{args:m=[],children:E,...C}=p;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((x,O)=>x!==m[O]))return[!0];const S=Ne(t,c,C,!0);return S.changes.length?[!1,S]:null}},commitUpdate(t,[r,p],u,d,w,y){r?h(t,u,w,y):fe(t,p)},commitMount(t,r,p,u){var d;const w=(d=t.__r3f)!=null?d:{};t.raycast&&w.handlers&&w.eventCount&&ie(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>$(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var r;const{attach:p,parent:u}=(r=t.__r3f)!=null?r:{};p&&u&&je(u,t,p),t.isObject3D&&(t.visible=!1),q(t)},unhideInstance(t,r){var p;const{attach:u,parent:d}=(p=t.__r3f)!=null?p:{};u&&d&&ue(d,t,u),(t.isObject3D&&r.visible==null||r.visible)&&(t.visible=!0),q(t)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>n?n():W.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&M.fun(performance.now)?performance.now:M.fun(Date.now)?Date.now:()=>0,scheduleTimeout:M.fun(setTimeout)?setTimeout:void 0,cancelTimeout:M.fun(clearTimeout)?clearTimeout:void 0}),applyProps:fe}}var Me,Re;const le=e=>"colorSpace"in e||"outputColorSpace"in e,ze=()=>{var e;return(e=be.ColorManagement)!=null?e:null},Fe=e=>e&&e.isOrthographicCamera,Rt=e=>e&&e.hasOwnProperty("current"),ee=typeof window<"u"&&((Me=window.document)!=null&&Me.createElement||((Re=window.navigator)==null?void 0:Re.product)==="ReactNative")?_.useLayoutEffect:_.useEffect;function Ie(e){const n=_.useRef(e);return ee(()=>void(n.current=e),[e]),n}function xt({set:e}){return ee(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Be extends _.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}}Be.getDerivedStateFromError=()=>({error:!0});const Ue="__default",xe=new Map,Ot=e=>e&&!!e.memoized&&!!e.changes;function He(e){var n;const o=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const J=e=>{var n;return(n=e.__r3f)==null?void 0:n.root.getState()};function ie(e){let n=e.__r3f.root;for(;n.getState().previousRoot;)n=n.getState().previousRoot;return n}const M={obj:e=>e===Object(e)&&!M.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,n,{arrays:o="shallow",objects:a="reference",strict:f=!0}={}){if(typeof e!=typeof n||!!e!=!!n)return!1;if(M.str(e)||M.num(e))return e===n;const l=M.obj(e);if(l&&a==="reference")return e===n;const g=M.arr(e);if(g&&o==="reference")return e===n;if((g||l)&&e===n)return!0;let h;for(h in e)if(!(h in n))return!1;if(l&&o==="shallow"&&a==="shallow"){for(h in f?n:e)if(!M.equ(e[h],n[h],{strict:f,objects:"reference"}))return!1}else for(h in f?n:e)if(e[h]!==n[h])return!1;if(M.und(h)){if(g&&e.length===0&&n.length===0||l&&Object.keys(e).length===0&&Object.keys(n).length===0)return!0;if(e!==n)return!1}return!0}};function jt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const n in e)n.dispose==null||n.dispose(),delete e[n]}function $(e,n){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...n},e}function ye(e,n){let o=e;if(n.includes("-")){const a=n.split("-"),f=a.pop();return o=a.reduce((l,g)=>l[g],e),{target:o,key:f}}else return{target:o,key:n}}const Oe=/-\d+$/;function ue(e,n,o){if(M.str(o)){if(Oe.test(o)){const l=o.replace(Oe,""),{target:g,key:h}=ye(e,l);Array.isArray(g[h])||(g[h]=[])}const{target:a,key:f}=ye(e,o);n.__r3f.previousAttach=a[f],a[f]=n}else n.__r3f.previousAttach=o(e,n)}function je(e,n,o){var a,f;if(M.str(o)){const{target:l,key:g}=ye(e,o),h=n.__r3f.previousAttach;h===void 0?delete l[g]:l[g]=h}else(a=n.__r3f)==null||a.previousAttach==null||a.previousAttach(e,n);(f=n.__r3f)==null||delete f.previousAttach}function Ne(e,{children:n,key:o,ref:a,...f},{children:l,key:g,ref:h,...s}={},v=!1){var t;const r=(t=e==null?void 0:e.__r3f)!=null?t:{},p=Object.entries(f),u=[];if(v){const w=Object.keys(s);for(let y=0;y<w.length;y++)f.hasOwnProperty(w[y])||p.unshift([w[y],Ue+"remove"])}p.forEach(([w,y])=>{var i;if((i=e.__r3f)!=null&&i.primitive&&w==="object"||M.equ(y,s[w]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(w))return u.push([w,y,!0,[]]);let c=[];w.includes("-")&&(c=w.split("-")),u.push([w,y,!1,c]);for(const m in f){const E=f[m];m.startsWith(`${w}-`)&&u.push([m,E,!1,m.split("-")])}});const d={...f};return r.memoizedProps&&r.memoizedProps.args&&(d.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(d.attach=r.memoizedProps.attach),{memoized:d,changes:u}}const At=typeof process<"u"&&!1;function fe(e,n){var o,a,f;const l=(o=e.__r3f)!=null?o:{},g=l.root,h=(a=g==null||g.getState==null?void 0:g.getState())!=null?a:{},{memoized:s,changes:v}=Ot(n)?n:Ne(e,n),t=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let p=0;p<v.length;p++){let[u,d,w,y]=v[p];if(le(e)){const E="srgb",C="srgb-linear";u==="encoding"?(u="colorSpace",d=d===3001?E:C):u==="outputEncoding"&&(u="outputColorSpace",d=d===3001?E:C)}let i=e,c=i[u];if(y.length&&(c=y.reduce((m,E)=>m[E],e),!(c&&c.set))){const[m,...E]=y.reverse();i=E.reverse().reduce((C,S)=>C[S],e),u=m}if(d===Ue+"remove")if(i.constructor){let m=xe.get(i.constructor);m||(m=new i.constructor,xe.set(i.constructor,m)),d=m[u]}else d=0;if(w)d?l.handlers[u]=d:delete l.handlers[u],l.eventCount=Object.keys(l.handlers).length;else if(c&&c.set&&(c.copy||c instanceof se)){if(Array.isArray(d))c.fromArray?c.fromArray(d):c.set(...d);else if(c.copy&&d&&d.constructor&&(At?c.constructor.name===d.constructor.name:c.constructor===d.constructor))c.copy(d);else if(d!==void 0){const m=c instanceof at;!m&&c.setScalar?c.setScalar(d):c instanceof se&&d instanceof se?c.mask=d.mask:c.set(d),!ze()&&!h.linear&&m&&c.convertSRGBToLinear()}}else if(i[u]=d,i[u]instanceof Ke&&i[u].format===Je&&i[u].type===Qe){const m=i[u];le(m)&&le(h.gl)?m.colorSpace=h.gl.outputColorSpace:m.encoding=h.gl.outputEncoding}q(e)}if(l.parent&&e.raycast&&t!==l.eventCount){const p=ie(e).getState().internal,u=p.interaction.indexOf(e);u>-1&&p.interaction.splice(u,1),l.eventCount&&p.interaction.push(e)}return!(v.length===1&&v[0][0]==="onUpdate")&&v.length&&(f=e.__r3f)!=null&&f.parent&&_e(e),e}function q(e){var n,o;const a=(n=e.__r3f)==null||(o=n.root)==null||o.getState==null?void 0:o.getState();a&&a.internal.frames===0&&a.invalidate()}function _e(e){e.onUpdate==null||e.onUpdate(e)}function Tt(e,n){e.manual||(Fe(e)?(e.left=n.width/-2,e.right=n.width/2,e.top=n.height/2,e.bottom=n.height/-2):e.aspect=n.width/n.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function re(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function kt(){var e;const n=typeof self<"u"&&self||typeof window<"u"&&window;if(!n)return W.DefaultEventPriority;switch((e=n.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return W.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return W.ContinuousEventPriority;default:return W.DefaultEventPriority}}function $e(e,n,o,a){const f=o.get(n);f&&(o.delete(n),o.size===0&&(e.delete(a),f.target.releasePointerCapture(a)))}function Dt(e,n){const{internal:o}=e.getState();o.interaction=o.interaction.filter(a=>a!==n),o.initialHits=o.initialHits.filter(a=>a!==n),o.hovered.forEach((a,f)=>{(a.eventObject===n||a.object===n)&&o.hovered.delete(f)}),o.capturedMap.forEach((a,f)=>{$e(o.capturedMap,n,a,f)})}function Lt(e){function n(s){const{internal:v}=e.getState(),t=s.offsetX-v.initialClick[0],r=s.offsetY-v.initialClick[1];return Math.round(Math.sqrt(t*t+r*r))}function o(s){return s.filter(v=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return(r=v.__r3f)==null?void 0:r.handlers["onPointer"+t]}))}function a(s,v){const t=e.getState(),r=new Set,p=[],u=v?v(t.internal.interaction):t.internal.interaction;for(let i=0;i<u.length;i++){const c=J(u[i]);c&&(c.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(s,t);function d(i){const c=J(i);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var m;c.events.compute==null||c.events.compute(s,c,(m=c.previousRoot)==null?void 0:m.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(i,!0):[]}let w=u.flatMap(d).sort((i,c)=>{const m=J(i.object),E=J(c.object);return!m||!E?i.distance-c.distance:E.events.priority-m.events.priority||i.distance-c.distance}).filter(i=>{const c=re(i);return r.has(c)?!1:(r.add(c),!0)});t.events.filter&&(w=t.events.filter(w,t));for(const i of w){let c=i.object;for(;c;){var y;(y=c.__r3f)!=null&&y.eventCount&&p.push({...i,eventObject:c}),c=c.parent}}if("pointerId"in s&&t.internal.capturedMap.has(s.pointerId))for(let i of t.internal.capturedMap.get(s.pointerId).values())r.has(re(i.intersection))||p.push(i.intersection);return p}function f(s,v,t,r){const p=e.getState();if(s.length){const u={stopped:!1};for(const d of s){const w=J(d.object)||p,{raycaster:y,pointer:i,camera:c,internal:m}=w,E=new G(i.x,i.y,0).unproject(c),C=R=>{var b,P;return(b=(P=m.capturedMap.get(R))==null?void 0:P.has(d.eventObject))!=null?b:!1},S=R=>{const b={intersection:d,target:v.target};m.capturedMap.has(R)?m.capturedMap.get(R).set(d.eventObject,b):m.capturedMap.set(R,new Map([[d.eventObject,b]])),v.target.setPointerCapture(R)},x=R=>{const b=m.capturedMap.get(R);b&&$e(m.capturedMap,d.eventObject,b,R)};let O={};for(let R in v){let b=v[R];typeof b!="function"&&(O[R]=b)}let A={...d,...O,pointer:i,intersections:s,stopped:u.stopped,delta:t,unprojectedPoint:E,ray:y.ray,camera:c,stopPropagation(){const R="pointerId"in v&&m.capturedMap.get(v.pointerId);if((!R||R.has(d.eventObject))&&(A.stopped=u.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(b=>b.eventObject===d.eventObject))){const b=s.slice(0,s.indexOf(d));l([...b,d])}},target:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:x},currentTarget:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:x},nativeEvent:v};if(r(A),u.stopped===!0)break}}return s}function l(s){const{internal:v}=e.getState();for(const t of v.hovered.values())if(!s.length||!s.find(r=>r.object===t.object&&r.index===t.index&&r.instanceId===t.instanceId)){const p=t.eventObject.__r3f,u=p==null?void 0:p.handlers;if(v.hovered.delete(re(t)),p!=null&&p.eventCount){const d={...t,intersections:s};u.onPointerOut==null||u.onPointerOut(d),u.onPointerLeave==null||u.onPointerLeave(d)}}}function g(s,v){for(let t=0;t<v.length;t++){const r=v[t].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(s)}}function h(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return v=>{const{internal:t}=e.getState();"pointerId"in v&&t.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(v.pointerId)&&(t.capturedMap.delete(v.pointerId),l([]))})}}return function(t){const{onPointerMissed:r,internal:p}=e.getState();p.lastEvent.current=t;const u=s==="onPointerMove",d=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=a(t,u?o:void 0),i=d?n(t):0;s==="onPointerDown"&&(p.initialClick=[t.offsetX,t.offsetY],p.initialHits=y.map(m=>m.eventObject)),d&&!y.length&&i<=2&&(g(t,p.interaction),r&&r(t)),u&&l(y);function c(m){const E=m.eventObject,C=E.__r3f,S=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(u){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const x=re(m),O=p.hovered.get(x);O?O.stopped&&m.stopPropagation():(p.hovered.set(x,m),S.onPointerOver==null||S.onPointerOver(m),S.onPointerEnter==null||S.onPointerEnter(m))}S.onPointerMove==null||S.onPointerMove(m)}else{const x=S[s];x?(!d||p.initialHits.includes(E))&&(g(t,p.interaction.filter(O=>!p.initialHits.includes(O))),x(m)):d&&p.initialHits.includes(E)&&g(t,p.interaction.filter(O=>!p.initialHits.includes(O)))}}f(y,t,i,c)}}return{handlePointer:h}}const qe=e=>!!(e!=null&&e.render),Ge=_.createContext(null),zt=(e,n)=>{const o=Et((h,s)=>{const v=new G,t=new G,r=new G;function p(i=s().camera,c=t,m=s().size){const{width:E,height:C,top:S,left:x}=m,O=E/C;c instanceof G?r.copy(c):r.set(...c);const A=i.getWorldPosition(v).distanceTo(r);if(Fe(i))return{width:E/i.zoom,height:C/i.zoom,top:S,left:x,factor:1,distance:A,aspect:O};{const R=i.fov*Math.PI/180,b=2*Math.tan(R/2)*A,P=b*(E/C);return{width:P,height:b,top:S,left:x,factor:E/P,distance:A,aspect:O}}}let u;const d=i=>h(c=>({performance:{...c.performance,current:i}})),w=new dt;return{set:h,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(i=1)=>e(s(),i),advance:(i,c)=>n(i,c,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new pt,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const i=s();u&&clearTimeout(u),i.performance.current!==i.performance.min&&d(i.performance.min),u=setTimeout(()=>d(s().performance.max),i.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:i=>h(c=>({...c,events:{...c.events,...i}})),setSize:(i,c,m,E,C)=>{const S=s().camera,x={width:i,height:c,top:E||0,left:C||0,updateStyle:m};h(O=>({size:x,viewport:{...O.viewport,...p(S,t,x)}}))},setDpr:i=>h(c=>{const m=He(i);return{viewport:{...c.viewport,dpr:m,initialDpr:c.viewport.initialDpr||m}}}),setFrameloop:(i="always")=>{const c=s().clock;c.stop(),c.elapsedTime=0,i!=="never"&&(c.start(),c.elapsedTime=0),h(()=>({frameloop:i}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:_.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(i,c,m)=>{const E=s().internal;return E.priority=E.priority+(c>0?1:0),E.subscribers.push({ref:i,priority:c,store:m}),E.subscribers=E.subscribers.sort((C,S)=>C.priority-S.priority),()=>{const C=s().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(c>0?1:0),C.subscribers=C.subscribers.filter(S=>S.ref!==i))}}}}}),a=o.getState();let f=a.size,l=a.viewport.dpr,g=a.camera;return o.subscribe(()=>{const{camera:h,size:s,viewport:v,gl:t,set:r}=o.getState();if(s.width!==f.width||s.height!==f.height||v.dpr!==l){var p;f=s,l=v.dpr,Tt(h,s),t.setPixelRatio(v.dpr);const u=(p=s.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(s.width,s.height,u)}h!==g&&(g=h,r(u=>({viewport:{...u.viewport,...u.viewport.getCurrentViewport(h)}})))}),o.subscribe(h=>e(h)),o};let oe,Ft=new Set,It=new Set,Bt=new Set;function de(e,n){if(e.size)for(const{callback:o}of e.values())o(n)}function Q(e,n){switch(e){case"before":return de(Ft,n);case"after":return de(It,n);case"tail":return de(Bt,n)}}let pe,ve;function me(e,n,o){let a=n.clock.getDelta();for(n.frameloop==="never"&&typeof e=="number"&&(a=e-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=e),pe=n.internal.subscribers,oe=0;oe<pe.length;oe++)ve=pe[oe],ve.ref.current(ve.store.getState(),a,o);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}function Ut(e){let n=!1,o,a,f;function l(s){a=requestAnimationFrame(l),n=!0,o=0,Q("before",s);for(const t of e.values()){var v;f=t.store.getState(),f.internal.active&&(f.frameloop==="always"||f.internal.frames>0)&&!((v=f.gl.xr)!=null&&v.isPresenting)&&(o+=me(s,f))}if(Q("after",s),o===0)return Q("tail",s),n=!1,cancelAnimationFrame(a)}function g(s,v=1){var t;if(!s)return e.forEach(r=>g(r.store.getState()),v);(t=s.gl.xr)!=null&&t.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+v),n||(n=!0,requestAnimationFrame(l)))}function h(s,v=!0,t,r){if(v&&Q("before",s),t)me(s,t,r);else for(const p of e.values())me(s,p.store.getState());v&&Q("after",s)}return{loop:l,invalidate:g,advance:h}}function Ht(){const e=_.useContext(Ge);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function We(e,n=0){const o=Ht(),a=o.getState().internal.subscribe,f=Ie(e);return ee(()=>a(f,n,o),[n,a,o]),null}const X=new Map,{invalidate:Ae,advance:Te}=Ut(X),{reconciler:ae,applyProps:H}=Mt(X,kt),N={objects:"shallow",strict:!1},Nt=(e,n)=>{const o=typeof e=="function"?e(n):e;return qe(o)?o:new st({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...e})};function $t(e,n){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(n){const{width:a,height:f,top:l,left:g,updateStyle:h=o}=n;return{width:a,height:f,top:l,left:g,updateStyle:h}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:a,height:f,top:l,left:g}=e.parentElement.getBoundingClientRect();return{width:a,height:f,top:l,left:g,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function qt(e){const n=X.get(e),o=n==null?void 0:n.fiber,a=n==null?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const f=typeof reportError=="function"?reportError:console.error,l=a||zt(Ae,Te),g=o||ae.createContainer(l,W.ConcurrentRoot,null,!1,null,"",f,null);n||X.set(e,{fiber:g,store:l});let h,s=!1,v;return{configure(t={}){let{gl:r,size:p,scene:u,events:d,onCreated:w,shadows:y=!1,linear:i=!1,flat:c=!1,legacy:m=!1,orthographic:E=!1,frameloop:C="always",dpr:S=[1,2],performance:x,raycaster:O,camera:A,onPointerMissed:R}=t,b=l.getState(),P=b.gl;b.gl||b.set({gl:P=Nt(r,e)});let L=b.raycaster;L||b.set({raycaster:L=new Ze});const{params:Y,...te}=O||{};if(M.equ(te,L,N)||H(L,{...te}),M.equ(Y,L.params,N)||H(L,{params:{...L.params,...Y}}),!b.camera||b.camera===v&&!M.equ(v,A,N)){v=A;const T=A instanceof ct,j=T?A:E?new et(0,0,0,0,.1,1e3):new tt(75,0,.1,1e3);T||(j.position.z=5,A&&H(j,A),!b.camera&&!(A!=null&&A.rotation)&&j.lookAt(0,0,0)),b.set({camera:j}),L.camera=j}if(!b.scene){let T;u instanceof Ce?T=u:(T=new Ce,u&&H(T,u)),b.set({scene:$(T)})}if(!b.xr){var K;const T=(k,Ye)=>{const Ee=l.getState();Ee.frameloop!=="never"&&Te(k,!0,Ee,Ye)},j=()=>{const k=l.getState();k.gl.xr.enabled=k.gl.xr.isPresenting,k.gl.xr.setAnimationLoop(k.gl.xr.isPresenting?T:null),k.gl.xr.isPresenting||Ae(k)},U={connect(){const k=l.getState().gl;k.xr.addEventListener("sessionstart",j),k.xr.addEventListener("sessionend",j)},disconnect(){const k=l.getState().gl;k.xr.removeEventListener("sessionstart",j),k.xr.removeEventListener("sessionend",j)}};typeof((K=P.xr)==null?void 0:K.addEventListener)=="function"&&U.connect(),b.set({xr:U})}if(P.shadowMap){const T=P.shadowMap.enabled,j=P.shadowMap.type;if(P.shadowMap.enabled=!!y,M.boo(y))P.shadowMap.type=ce;else if(M.str(y)){var ne;const U={basic:lt,percentage:ut,soft:ce,variance:ft};P.shadowMap.type=(ne=U[y])!=null?ne:ce}else M.obj(y)&&Object.assign(P.shadowMap,y);(T!==P.shadowMap.enabled||j!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}const z=ze();z&&("enabled"in z?z.enabled=!m:"legacyMode"in z&&(z.legacyMode=m)),H(P,{outputEncoding:i?3e3:3001,toneMapping:c?nt:rt}),b.legacy!==m&&b.set(()=>({legacy:m})),b.linear!==i&&b.set(()=>({linear:i})),b.flat!==c&&b.set(()=>({flat:c})),r&&!M.fun(r)&&!qe(r)&&!M.equ(r,P,N)&&H(P,r),d&&!b.events.handlers&&b.set({events:d(l)});const D=$t(e,p);return M.equ(D,b.size,N)||b.setSize(D.width,D.height,D.updateStyle,D.top,D.left),S&&b.viewport.dpr!==He(S)&&b.setDpr(S),b.frameloop!==C&&b.setFrameloop(C),b.onPointerMissed||b.set({onPointerMissed:R}),x&&!M.equ(x,b.performance,N)&&b.set(T=>({performance:{...T.performance,...x}})),h=w,s=!0,this},render(t){return s||this.configure(),ae.updateContainer(_.createElement(Gt,{store:l,children:t,onCreated:h,rootElement:e}),g,null,()=>{}),l},unmount(){Ve(e)}}}function Gt({store:e,children:n,onCreated:o,rootElement:a}){return ee(()=>{const f=e.getState();f.set(l=>({internal:{...l.internal,active:!0}})),o&&o(f),e.getState().events.connected||f.events.connect==null||f.events.connect(a)},[]),_.createElement(Ge.Provider,{value:e},n)}function Ve(e,n){const o=X.get(e),a=o==null?void 0:o.fiber;if(a){const f=o==null?void 0:o.store.getState();f&&(f.internal.active=!1),ae.updateContainer(null,a,null,()=>{f&&setTimeout(()=>{try{var l,g,h,s;f.events.disconnect==null||f.events.disconnect(),(l=f.gl)==null||(g=l.renderLists)==null||g.dispose==null||g.dispose(),(h=f.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(s=f.gl)!=null&&s.xr&&f.xr.disconnect(),jt(f),X.delete(e),n&&n(e)}catch{}},500)})}}ae.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:_.version});const he={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Wt(e){const{handlePointer:n}=Lt(e);return{priority:1,enabled:!0,compute(o,a,f){a.pointer.set(o.offsetX/a.size.width*2-1,-(o.offsetY/a.size.height)*2+1),a.raycaster.setFromCamera(a.pointer,a.camera)},connected:void 0,handlers:Object.keys(he).reduce((o,a)=>({...o,[a]:n(a)}),{}),update:()=>{var o;const{events:a,internal:f}=e.getState();(o=f.lastEvent)!=null&&o.current&&a.handlers&&a.handlers.onPointerMove(f.lastEvent.current)},connect:o=>{var a;const{set:f,events:l}=e.getState();l.disconnect==null||l.disconnect(),f(g=>({events:{...g.events,connected:o}})),Object.entries((a=l.handlers)!=null?a:[]).forEach(([g,h])=>{const[s,v]=he[g];o.addEventListener(s,h,{passive:v})})},disconnect:()=>{const{set:o,events:a}=e.getState();if(a.connected){var f;Object.entries((f=a.handlers)!=null?f:[]).forEach(([l,g])=>{if(a&&a.connected instanceof HTMLElement){const[h]=he[l];a.connected.removeEventListener(h,g)}}),o(l=>({events:{...l.events,connected:void 0}}))}}}}const Vt=_.forwardRef(function({children:n,fallback:o,resize:a,style:f,gl:l,events:g=Wt,eventSource:h,eventPrefix:s,shadows:v,linear:t,flat:r,legacy:p,orthographic:u,frameloop:d,dpr:w,performance:y,raycaster:i,camera:c,scene:m,onPointerMissed:E,onCreated:C,...S},x){_.useMemo(()=>Pt(vt),[]);const O=bt(),[A,R]=yt({scroll:!0,debounce:{scroll:50,resize:0},...a}),b=_.useRef(null),P=_.useRef(null);_.useImperativeHandle(x,()=>b.current);const L=Ie(E),[Y,te]=_.useState(!1),[K,ne]=_.useState(!1);if(Y)throw Y;if(K)throw K;const z=_.useRef(null);ee(()=>{const B=b.current;R.width>0&&R.height>0&&B&&(z.current||(z.current=qt(B)),z.current.configure({gl:l,events:g,shadows:v,linear:t,flat:r,legacy:p,orthographic:u,frameloop:d,dpr:w,performance:y,raycaster:i,camera:c,scene:m,size:R,onPointerMissed:(...D)=>L.current==null?void 0:L.current(...D),onCreated:D=>{D.events.connect==null||D.events.connect(h?Rt(h)?h.current:h:P.current),s&&D.setEvents({compute:(T,j)=>{const U=T[s+"X"],k=T[s+"Y"];j.pointer.set(U/j.size.width*2-1,-(k/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),C==null||C(D)}}),z.current.render(_.createElement(O,null,_.createElement(Be,{set:ne},_.createElement(_.Suspense,{fallback:_.createElement(xt,{set:te})},n)))))}),_.useEffect(()=>{const B=b.current;if(B)return()=>Ve(B)},[]);const we=h?"none":"auto";return _.createElement("div",I({ref:P,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:we,...f}},S),_.createElement("div",{ref:A,style:{width:"100%",height:"100%"}},_.createElement("canvas",{ref:b,style:{display:"block"}},o)))}),fn=_.forwardRef(function(n,o){return _.createElement(_t,null,_.createElement(Vt,I({},n,{ref:o})))}),Xt=()=>parseInt(mt.replace(/\D+/g,"")),Xe=Xt(),ge=Xe>=154?"opaque_fragment":"output_fragment";class Yt extends ht{constructor(n){super(n),this.onBeforeCompile=(o,a)=>{const{isWebGL2:f}=a.capabilities;o.fragmentShader=o.fragmentShader.replace(`#include <${ge}>`,`
        ${f?`#include <${ge}>`:`#extension GL_OES_standard_derivatives : enable
#include <${ge}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Xe>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const dn=_.forwardRef((e,n)=>{const[o]=_.useState(()=>new Yt(null));return _.createElement("primitive",I({},e,{object:o,ref:n,attach:"material"}))});let F,Z;const Kt=_.createContext(null),ke=new gt,De=new G,Jt=_.forwardRef(({children:e,range:n,limit:o=1e3,...a},f)=>{const l=_.useRef(null),[g,h]=_.useState([]),[[s,v,t]]=_.useState(()=>[new Float32Array(o*3),Float32Array.from({length:o*3},()=>1),Float32Array.from({length:o},()=>1)]);_.useEffect(()=>{l.current.geometry.attributes.position.needsUpdate=!0}),We(()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),ke.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(o,n!==void 0?n:o,g.length),F=0;F<g.length;F++)Z=g[F].current,Z.getWorldPosition(De).applyMatrix4(ke),De.toArray(s,F*3),l.current.geometry.attributes.position.needsUpdate=!0,Z.matrixWorldNeedsUpdate=!0,Z.color.toArray(v,F*3),l.current.geometry.attributes.color.needsUpdate=!0,t.set([Z.size],F),l.current.geometry.attributes.size.needsUpdate=!0});const r=_.useMemo(()=>({getParent:()=>l,subscribe:p=>(h(u=>[...u,p]),()=>h(u=>u.filter(d=>d.current!==p.current)))}),[]);return _.createElement("points",I({userData:{instances:g},matrixAutoUpdate:!1,ref:Le([f,l]),raycast:()=>null},a),_.createElement("bufferGeometry",null,_.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:V}),_.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:V}),_.createElement("bufferAttribute",{attach:"attributes-size",count:t.length,array:t,itemSize:1,usage:V})),_.createElement(Kt.Provider,{value:r},e))}),Qt=_.forwardRef(({children:e,positions:n,colors:o,sizes:a,stride:f=3,...l},g)=>{const h=_.useRef(null);return We(()=>{const s=h.current.geometry.attributes;s.position.needsUpdate=!0,o&&(s.color.needsUpdate=!0),a&&(s.size.needsUpdate=!0)}),_.createElement("points",I({ref:Le([g,h])},l),_.createElement("bufferGeometry",null,_.createElement("bufferAttribute",{attach:"attributes-position",count:n.length/f,array:n,itemSize:f,usage:V}),o&&_.createElement("bufferAttribute",{attach:"attributes-color",count:o.length/f,array:o,itemSize:3,usage:V}),a&&_.createElement("bufferAttribute",{attach:"attributes-size",count:a.length/f,array:a,itemSize:1,usage:V})),e)}),pn=_.forwardRef((e,n)=>e.positions instanceof Float32Array?_.createElement(Qt,I({},e,{ref:n})):_.createElement(Jt,I({},e,{ref:n})));export{fn as C,pn as P,un as _,dn as a,We as u};
