import{R as X}from"./remarkable-615da796.js";import{U as C,w as M,b as y,p as U,a as E,H as m,l as $,c as T,n as j}from"./markmap-common-57ec1c02.js";import{r as F}from"./remarkable-katex-82f68192.js";import{j as O}from"./js-yaml-38530ef5.js";const A=`<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<!--CSS-->
</head>
<body>
<svg id="mindmap"></svg>
<!--JS-->
</body>
</html>
`,B=["d3@7.8.5/dist/d3.min.js","markmap-view@0.15.8/dist/browser/index.js"],v="katex",z=["katex@0.16.8/dist/katex.min.js"].map(t=>y(t)),J=y("webfontloader@1.6.28/webfontloader.js");J.data.defer=!0;const I=["katex@0.16.8/dist/katex.min.css"].map(t=>T(t)),L={versions:{katex:"0.16.8",webfontloader:"1.6.28"},preloadScripts:z,scripts:[{type:"iife",data:{fn:t=>{window.WebFontConfig={custom:{families:["KaTeX_AMS","KaTeX_Caligraphic:n4,n7","KaTeX_Fraktur:n4,n7","KaTeX_Main:n4,n7,i4,i7","KaTeX_Math:i4,i7","KaTeX_Script","KaTeX_SansSerif:n4,n7,i4","KaTeX_Size1","KaTeX_Size2","KaTeX_Size3","KaTeX_Size4","KaTeX_Typewriter"]},active:()=>{t().refreshHook.call()}}},getParams({getMarkmap:t}){return[t]}}},J],styles:I};function W(t,r,s){return t.map(e=>{if(typeof e=="string"&&!e.includes("://")){e.startsWith("npm:")||(e=`npm:${e}`);const n=4+r.length;e.startsWith(`npm:${r}/`)&&(e=`${e.slice(0,n)}@${s}${e.slice(n)}`)}return e})}function b(t,r){return r.type==="script"&&r.data.src?{...r,data:{...r.data,src:t.getFullUrl(r.data.src)}}:r}function N(t,r){return r.type==="stylesheet"&&r.data.href?{...r,data:{...r.data,href:t.getFullUrl(r.data.href)}}:r}function D(t){return{transformer:t,parser:new m,beforeParse:new m,afterParse:new m,htmltag:new m,retransform:new m}}const g={name:v,config:L,transform(t){var r,s,e,n;let a;const i=((s=(r=g.config)==null?void 0:r.preloadScripts)==null?void 0:s.map(l=>b(t.transformer.urlBuilder,l)))||[],d=()=>(a||(a=$(i)),a),o=(l,c)=>{const{katex:f}=window;return f?f.renderToString(l,{displayMode:c,throwOnError:!1}):(d().then(()=>{t.retransform.call()}),l)};let p=j;return t.parser.tap(l=>{l.use(F),l.renderer.rules.katex=(c,f)=>(p(),o(c[f].content,!!c[f].block))}),t.beforeParse.tap((l,c)=>{p=()=>{c.features[v]=!0}}),t.afterParse.tap((l,c)=>{var f;const u=(f=c.frontmatter)==null?void 0:f.markmap;u&&["extraJs","extraCss"].forEach(h=>{var w,S;const k=u[h];k&&(u[h]=W(k,v,((S=(w=g.config)==null?void 0:w.versions)==null?void 0:S.katex)||""))})}),{styles:(e=g.config)==null?void 0:e.styles,scripts:(n=g.config)==null?void 0:n.scripts}}},R="frontmatter",Y={name:R,transform(t){return t.beforeParse.tap((r,s)=>{const{content:e}=s;if(!/^---\r?\n/.test(e))return;const n=/\n---\r?\n/.exec(e);if(!n)return;const a=e.slice(4,n.index);let i;try{i=O.load(a),i!=null&&i.markmap&&(i.markmap=q(i.markmap))}catch{return}s.frontmatter=i,s.content=e.slice(n.index+n[0].length),s.contentLineOffset=e.slice(0,n.index).split(`
`).length+1}),{}}};function q(t){if(t)return["color","extraJs","extraCss"].forEach(r=>{t[r]!=null&&(t[r]=V(t[r]))}),["duration","maxWidth","initialExpandLevel"].forEach(r=>{t[r]!=null&&(t[r]=G(t[r]))}),t}function V(t){let r;return typeof t=="string"?r=[t]:Array.isArray(t)&&(r=t.filter(s=>s&&typeof s=="string")),r!=null&&r.length?r:void 0}function G(t){if(!isNaN(+t))return+t}const Q="npmUrl",Z={name:Q,transform(t){return t.afterParse.tap((r,s)=>{const{frontmatter:e}=s,n=e==null?void 0:e.markmap;n&&["extraJs","extraCss"].forEach(a=>{const i=n[a];i&&(n[a]=i.map(d=>d.startsWith("npm:")?t.transformer.urlBuilder.getFullUrl(d.slice(4)):d))})}),{}}},x="hljs",H=["@highlightjs/cdn-assets@11.8.0/highlight.min.js"].map(t=>y(t)),tt=["@highlightjs/cdn-assets@11.8.0/styles/default.min.css"].map(t=>T(t)),et={versions:{hljs:"11.8.0"},preloadScripts:H,styles:tt},_={name:x,config:et,transform(t){var r,s,e;let n;const a=((s=(r=_.config)==null?void 0:r.preloadScripts)==null?void 0:s.map(o=>b(t.transformer.urlBuilder,o)))||[],i=()=>(n||(n=$(a)),n);let d=j;return t.parser.tap(o=>{o.set({highlight:(p,l)=>{d();const{hljs:c}=window;return c?c.highlightAuto(p,l?[l]:void 0).value:(i().then(()=>{t.retransform.call()}),p)}})}),t.beforeParse.tap((o,p)=>{d=()=>{p.features[x]=!0}}),{styles:(e=_.config)==null?void 0:e.styles}}},rt=[Y,g,_,Z];function K(t){var r,s;if(t.type==="heading")t.children=t.children.filter(e=>e.type!=="paragraph");else if(t.type==="list_item")t.children=t.children.filter(e=>["paragraph","fence"].includes(e.type)?(t.content||(t.content=e.content,t.payload={...t.payload,...e.payload}),!1):!0),((r=t.payload)==null?void 0:r.index)!=null&&(t.content=`${t.payload.index}. ${t.content}`);else if(t.type==="ordered_list"){let e=((s=t.payload)==null?void 0:s.startIndex)??1;t.children.forEach(n=>{n.type==="list_item"&&(n.payload={...n.payload,index:e},e+=1)})}t.children.length>0&&(t.children.forEach(e=>K(e)),t.children.length===1&&!t.children[0].content&&(t.children=t.children[0].children))}function P(t,r=0){t.depth=r,t.children.forEach(s=>{P(s,r+1)})}class lt{constructor(r=rt){this.assetsMap={},this.urlBuilder=new C,this.hooks=D(this),this.plugins=r.map(n=>typeof n=="function"?n():n);const s={};for(const{name:n,transform:a}of this.plugins)s[n]=a(this.hooks);this.assetsMap=s;const e=new X("full",{html:!0,breaks:!0,maxNesting:1/0});e.renderer.rules.htmltag=M(e.renderer.rules.htmltag,(n,...a)=>{const i=n(...a);return this.hooks.htmltag.call({args:a,result:i}),i}),this.md=e,this.hooks.parser.call(e)}buildTree(r){const{md:s}=this,e={type:"root",depth:0,content:"",children:[],payload:{}},n=[e];let a=0;for(const i of r){const d={};i.lines&&(d.lines=i.lines);let o=n[n.length-1];if(i.type.endsWith("_open")){const p=i.type.slice(0,-5);if(p==="heading")for(a=i.hLevel;(o==null?void 0:o.depth)>=a;)n.pop(),o=n[n.length-1];else a=Math.max(a,(o==null?void 0:o.depth)||0)+1,p==="ordered_list"&&(d.startIndex=i.order);const l={type:p,depth:a,payload:d,content:"",children:[]};o.children.push(l),n.push(l)}else if(o){if(i.type===`${o.type}_close`)o.type==="heading"?a=o.depth:(n.pop(),a=0);else if(i.type==="inline"){const p=this.hooks.htmltag.tap(c=>{var f;const u=(f=c.result)==null?void 0:f.match(/^<!--([\s\S]*?)-->$/),h=u==null?void 0:u[1].trim().split(" ");(h==null?void 0:h[0])==="fold"&&(o.payload={...o.payload,fold:["all","recursively"].includes(h[1])?2:1},c.result="")}),l=s.renderer.render([i],s.options,{});p(),o.content=`${o.content||""}${l}`}else if(i.type==="fence"){const p=s.renderer.render([i],s.options,{});o.children.push({type:i.type,depth:a+1,content:p,children:[],payload:d})}}else continue}return e}transform(r){var s;const e={content:r,features:{},contentLineOffset:0};this.hooks.beforeParse.call(this.md,e);const n=this.md.parse(e.content,{});this.hooks.afterParse.call(this.md,e);let a=this.buildTree(n);return K(a),((s=a.children)==null?void 0:s.length)===1&&(a=a.children[0]),P(a),{...e,root:a}}getAssets(r){const s=[],e=[];r??(r=this.plugins.map(n=>n.name));for(const n of r.map(a=>this.assetsMap[a]))n&&(n.styles&&s.push(...n.styles),n.scripts&&e.push(...n.scripts));return{styles:s.map(n=>N(this.urlBuilder,n)),scripts:e.map(n=>b(this.urlBuilder,n))}}getUsedAssets(r){const s=this.plugins.map(e=>e.name).filter(e=>r[e]);return this.getAssets(s)}fillTemplate(r,s,e){e={...e},e.baseJs??(e.baseJs=B.map(l=>this.urlBuilder.getFullUrl(l)).map(l=>y(l)));const{scripts:n,styles:a}=s,i=[...a?U(a):[]],d={getMarkmap:()=>window.markmap,getOptions:e.getOptions,jsonOptions:e.jsonOptions,root:r},o=[...E([...e.baseJs,...n||[],{type:"iife",data:{fn:(l,c,f,u)=>{const h=l();window.mm=h.Markmap.create("svg#mindmap",(c||h.deriveOptions)(u),f)},getParams:({getMarkmap:l,getOptions:c,root:f,jsonOptions:u})=>[l,c,f,u]}}],d)];return A.replace("<!--CSS-->",()=>i.join("")).replace("<!--JS-->",()=>o.join(""))}}export{lt as T};
