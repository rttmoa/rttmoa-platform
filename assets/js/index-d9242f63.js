import{r as a,b3 as se,an as o,j as e,C as R,S as ne,B as O,$ as g,I as w,au as j,b4 as p,a6 as ae}from"./.pnpm-e6eae8df.js";import{T as re}from"./index-ddbf1406.js";import{r as le,a as oe}from"./roleManage-ea36f73b.js";import"./index-479552fe.js";function z(i){if(!i)return"";let r=new Date(Number(i));return r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()}const xe=()=>{const[i,r]=a.useState([]),[I,h]=a.useState([]),[S,b]=a.useState([]),[s,m]=a.useState({}),c=se(t=>t.auth.authMenuList),[d]=o.useForm(),[n]=o.useForm(),[l]=o.useForm(),[C,u]=a.useState(!1),[F,_]=a.useState(!1),[B,E]=a.useState({}),[L,D]=a.useState([]),[M,N]=a.useState(!1),[U,v]=a.useState([]),[K,P]=a.useState([]),[A,H]=a.useState(null),[J,Y]=a.useState({}),$=a.useRef();a.useEffect(()=>{(async function(){le().then(t=>{const f=t.data.list.map((x,y)=>({...x,key:y}));r(f)})})()},[]);const q=[{title:"角色名称",dataIndex:"role_name",align:"center"},{title:"使用状态",dataIndex:"status",align:"center",render:t=>t===1?"启用":"停用"},{title:"授权人",align:"center",dataIndex:"authorize_user_name"},{title:"创建时间",align:"center",dataIndex:"create_time",render:z},{title:"授权时间",align:"center",dataIndex:"authorize_time",render:z}],G=(t,f,x)=>{x?(h(t),b(x),m(f)):(h(t),m(f))},Q=()=>{u(!0)},W=()=>{d.getFieldsValue(),d.resetFields(),u(!1)},X=()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"请选择一个角色"});return}_(!0),E(s),D(s.menus)},Z=()=>{let t=n.getFieldsValue();t.role_id=s.id,t.menus=L,t.authorize_time=Date.now(),n.resetFields(),_(!1)},ee=async()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"未选中任何项目"});return}const t=await oe(s.id),f=[],x=[];if(t.data.length>0){const y=t.data;for(let k=0;k<y.length;k++){const T=y[k],V={key:T.user_id,title:T.user_name,status:T.status};V.status===1&&x.push(V.key),f.push(V)}}v(f),P(x),Y(s),H(!1),N(!0)},te=()=>{s.id,l.resetFields(),N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{extra:e.jsxs(ne,{size:"middle",children:[e.jsx(O,{type:"primary",onClick:Q,children:"创建角色"}),e.jsx(O,{type:s.id?"primary":"default",onClick:X,disabled:!s.id,children:"设置权限"}),e.jsx(O,{type:s.id?"primary":"default",onClick:ee,disabled:!s.id,children:"用户授权"})]}),children:e.jsx(re,{columns:q,dataSource:i,selectedRowKeys:I,selectedIds:S,selectedItem:s,pagination:{},updateSelectedItem:G})}),e.jsx(g,{title:"创建角色",open:C,onOk:W,onCancel:()=>{d.resetFields(),u(!1)},children:e.jsx(ie,{form:d})}),e.jsx(g,{width:600,title:"权限设置",open:F,onOk:Z,onCancel:()=>{n.resetFields(),_(!1)},children:e.jsx(ce,{form:n,detailInfo:B,menuInfo:L||[],patchMenuInfo:t=>{D(t)},menuConfig:c})}),e.jsx(g,{title:"用户授权",width:800,open:M,onOk:te,onCancel:()=>{l.resetFields(),N(!1)},children:e.jsx(de,{form:l,isClose:A,detailUserInfo:J,targetKeys:K,transferData:U,patchUserInfo:t=>{P(t)},ref:$})})]})};function ie({form:i}){const r={labelCol:{span:5},wrapperCol:{span:16}};return e.jsx(e.Fragment,{children:e.jsx(R,{children:e.jsxs(o,{form:i,...r,initialValues:{status:1},children:[e.jsx(o.Item,{label:"角色名称",name:"role_name",children:e.jsx(w,{type:"text",placeholder:"请输入角色名称"})}),e.jsx(o.Item,{label:"状态",name:"status",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"开启"}),e.jsx(j.Option,{value:0,children:"关闭"})]})})]})})})}function ce({form:i,detailInfo:r,menuInfo:I,patchMenuInfo:h,menuConfig:S}){const b=(c,d="")=>{const n=[];return c.btnList.forEach(l=>{n.push(e.jsx(p.TreeNode,{title:l.meta.title,className:"op-role-tree"},d+"-btn-"+l.path))}),n},s=(c,d)=>c.map(n=>{let l=n.path;return n.children?e.jsx(p.TreeNode,{title:n.meta.title,className:"op-role-tree",children:s(n.children)},l):n.btnList?e.jsx(p.TreeNode,{title:n.meta.title,className:"op-role-tree",children:b(n,l)},l):e.jsx(p.TreeNode,{title:n.meta.title},l)}),m={labelCol:{span:4},wrapperCol:{span:16}};return e.jsx(o,{form:i,layout:"horizontal",...m,initialValues:{status2:1,role_name2:r.role_name},children:e.jsxs(R,{children:[e.jsx(o.Item,{label:"角色名称",name:"role_name2",children:e.jsx(w,{disabled:!0,maxLength:8,placeholder:r.role_name})}),e.jsx(o.Item,{label:"状态",name:"status2",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"启用"}),e.jsx(j.Option,{value:0,children:"停用"})]})}),e.jsx(o.Item,{label:"菜单",name:"menu",children:e.jsx(p,{checkable:!0,defaultExpandAll:!0,onCheck:c=>{h(c)},checkedKeys:I||[],children:e.jsx(p.TreeNode,{title:"平台权限",children:s(S)},"platform_all")})})]})})}function de({form:i,isClose:r,detailUserInfo:I,targetKeys:h,transferData:S,patchUserInfo:b,ref:s}){const[m,c]=a.useState(11),d=()=>(c(m+1),m);a.useImperativeHandle(s,()=>({status:m,statusValue:d}));const n=(u,F)=>F.title.indexOf(u)>-1,l=u=>{b(u)},C={labelCol:{span:5},wrapperCol:{span:18}};return e.jsxs(o,{form:i,layout:"horizontal",...C,initialValues:{transfer:h},children:[e.jsx(o.Item,{name:"role_name3",label:"角色名称",children:e.jsx(w,{disabled:!0,maxLength:8,placeholder:I.role_name})}),e.jsx(o.Item,{name:"transfer",label:"选择用户：",children:e.jsx(ae,{listStyle:{width:200,height:400},dataSource:S,showSearch:!0,titles:["待选用户","已选用户"],filterOption:n,targetKeys:h,onChange:l,render:u=>u.title})})]})}export{xe as default};
