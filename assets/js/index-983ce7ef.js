import{r as d,j as e,Q as w,c1 as S,B as c,c2 as b,aX as P,aY as v,bT as C,c3 as I,aJ as O,aK as k,aL as F,aw as D}from"./.pnpm-e6eae8df.js";import{h,P as E,k as R,m as n}from"./index-479552fe.js";import z from"./UpdateForm-b1ea8e0e.js";const B={size:"default",showSizeChanger:!0,defaultPageSize:10},A=t=>h.post(E+"/user/list",t);async function M(t){return h.post("/api/rule",{method:"POST",data:{method:"update",...t||{}}})}async function q(t){return h.post("/api/rule",{method:"POST",data:{method:"post",...t||{}}})}async function U(t){return h.post("/api/rule",{method:"POST",data:{method:"delete",...t||{}}})}const K=async t=>{const i=n.loading("正在添加");try{return await q({...t}),i(),n.success("Added successfully"),!0}catch{return i(),n.error("Adding failed, please try again!"),!1}},L=async t=>{const i=n.loading("Configuring");try{return await M({}),i(),n.success("Configuration is successful"),!0}catch{return i(),n.error("Configuration failed, please try again!"),!1}},W=async t=>{const i=n.loading("正在删除");if(!t)return!0;try{return await U({key:t.map(o=>o.id)}),i(),n.success("Deleted successfully and will refresh soon"),!0}catch{return i(),n.error("Delete failed, please try again"),!1}},X=()=>{const t=d.useRef(),[i,o]=d.useState(!1),[l,p]=d.useState([]),[r,u]=d.useState(),[x,m]=d.useState(!1),[g,f]=d.useState(!1),y=[{title:"用户名",dataIndex:"username",copyable:!0,width:200,render:(a,s)=>e.jsx("a",{onClick:()=>{u(s),m(!0)},children:a})},{title:"性别",dataIndex:"gender",width:150,valueEnum:{1:{text:"男"},2:{text:"女"}}},{title:"年龄",dataIndex:"age",width:150},{title:"状态",dataIndex:"status",hideInForm:!0,valueEnum:{0:{text:"正常",status:"Default"},1:{text:"在线",status:"Processing"},2:{text:"离线",status:"Success"},3:{text:"",status:"Error"}}},{title:"邮箱",dataIndex:"email",hideInSearch:!0},{title:"地址",dataIndex:"address",hideInSearch:!0},{title:"创建时间",key:"createTime",dataIndex:"createTime",valueType:"date",sorter:!0,hideInSearch:!0},{title:"创建时间",dataIndex:"createTime",valueType:"dateRange",hideInTable:!0,search:{transform:a=>({startTime:a[0],endTime:a[1]})}},{title:"操作",key:"option",fixed:"right",width:250,render:(a,s)=>j(s)}],j=a=>[e.jsx(c,{type:"link",size:"small",icon:e.jsx(O,{}),onClick:()=>{u(a),m(!0)},children:"查看"},"view"),e.jsx(c,{type:"link",size:"small",icon:e.jsx(k,{}),children:"编辑"},"edit"),e.jsx(c,{type:"link",size:"small",danger:!0,icon:e.jsx(F,{}),children:"删除"},"delete")],T=()=>[e.jsx(c,{type:"primary",icon:e.jsx(D,{}),onClick:()=>{o(!0)},children:"新建"},"button")];return e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"ant-pro-table-scroll",columns:y,actionRef:t,bordered:!0,cardBordered:!0,scroll:{x:1e3,y:"100%"},request:async a=>{const{data:s}=await A(a);return R(s)},columnsState:{persistenceKey:"use-pro-table-key",persistenceType:"localStorage"},rowKey:"id",search:{labelWidth:"auto"},pagination:B,dateFormatter:"string",headerTitle:"使用 ProTable",toolBarRender:T,rowSelection:{onChange:(a,s)=>{p(s)}}}),(l==null?void 0:l.length)>0&&e.jsxs(S,{extra:e.jsxs("div",{children:["已选择 ",e.jsx("a",{style:{fontWeight:600},children:l.length})," 项   ",e.jsxs("span",{children:["The total number is ",l.reduce((a,s)=>a+s.age,0)," age"]})]}),children:[e.jsx(c,{onClick:async()=>{var a,s;await W(l),p([]),(s=(a=t.current)==null?void 0:a.reloadAndRest)==null||s.call(a)},children:"Batch deletion"}),e.jsx(c,{type:"primary",children:"Batch approval"})]}),e.jsxs(b,{title:"新建",width:"400px",open:i,onOpenChange:o,onFinish:async a=>{await K(a)&&(o(!1),t.current&&t.current.reload())},children:[e.jsx(P,{rules:[{required:!0,message:"Rule name is required"}],width:"md",name:"name"}),e.jsx(v,{width:"md",name:"desc"})]}),e.jsx(z,{onSubmit:async a=>{n.info("成功，，，"),await L()&&(f(!1),u(void 0),t.current&&t.current.reload())},onCancel:()=>{n.info("取消，，，"),f(!1),x||u(void 0)},updateModalOpen:g,values:r||{}}),e.jsx(C,{width:600,open:x,onClose:()=>{u(void 0),m(!1)},closable:!1,children:(r==null?void 0:r.username)&&e.jsx(I,{column:2,title:r==null?void 0:r.username,request:async()=>({data:r||{}}),params:{id:r==null?void 0:r.username},columns:y})})]})};export{X as default};
