import{r as b,b3 as O,j as e,a9 as P,B as F,aw as i,R as z,C as o,aj as K,ax as E,az as D,b1 as U}from"./index-f751f953.js";import{C as k}from"./index-ebc51cb7.js";import{T as G}from"./index-0592541c.js";import"./index-72ce5474.js";import"./index-faeef1e6.js";import"./useBubbleLock-76e3efc3.js";import"./Tree-0072d5c0.js";import"./List-f96a4af3.js";import"./conductUtil-242f4494.js";import"./iconUtil-d0cad765.js";const re=S=>{const{form:m,modalIsVisible:T,setModalIsVisible:q,modalTitle:A,modalType:h,modalUserInfo:a,handleModalSubmit:w}=S,[p,N]=b.useState([]),[V,c]=b.useState([]),[g,d]=b.useState([]);function C(s){return s.map(r=>{var t,l;const n={title:((t=r.meta)==null?void 0:t.title)||"",key:((l=r.meta)==null?void 0:l.key)||""};return Array.isArray(r.children)&&r.children.length>0&&(n.children=C(r.children)),n})}b.useEffect(()=>{O({}).then(s=>{N(C(s.data||[])),h=="create"&&(c([]),d([]),m.setFieldsValue({role_name:"",permission_str:"",level:1,sort:1,status:!1,desc:""})),h=="edit"&&(c([]),d(a.permission_menu),m.setFieldsValue({role_name:a.role_name,permission_str:a.permission_str,level:a.level,sort:a.sort,status:a.status,desc:a.desc}))})},[h,a]);const I=()=>{c([]),d([]),q(!1)},L=()=>{function s(l,x,j=[]){for(const u of l){const f=u.key,y=[...j,f];if(f===x)return y;if(u.children&&u.children.length>0){const v=s(u.children,x,y);if(v)return v}}return null}function r(l,x){const j=new Set;return x.forEach(u=>{const f=s(l,u);f&&f.forEach(y=>j.add(y))}),Array.from(j)}const n=r(p,g),t=m.getFieldsValue();h=="edit"&&(t._id=a._id),t.permission_menu=g,t.menuList=n,w&&w(h,t)},_=s=>{const r=[],n=t=>{t.forEach(l=>{r.push(l.key),l.children&&n(l.children)})};return n(s),r},M=s=>{if(s.target.checked){const n=_(p);c(n)}else c([])},R=s=>{if(s.target.checked){const n=_(p);d(n)}else d([])},B=()=>{m.submit()};return e.jsx(P,{className:"relative",title:A,width:600,open:T,onCancel:I,footer:[e.jsx(F,{danger:!0,loading:!1,onClick:I,children:"取消"}),e.jsx(F,{type:"primary",loading:!1,onClick:B,children:"提交"},"link")],children:e.jsx(i,{className:"mb-[60px] max-h-[600px] overflow-auto",layout:"horizontal",form:m,labelCol:{span:4},wrapperCol:{span:18},onFinish:L,children:e.jsxs(z,{gutter:16,children:[e.jsx(o,{span:24,children:e.jsx(i.Item,{label:"角色名称",name:"role_name",rules:[{required:!0,message:"必填：角色名称"}],children:e.jsx(K,{placeholder:"请输入角色名称"})})}),e.jsx(o,{span:24,children:e.jsx(i.Item,{label:"权限字符",name:"permission_str",rules:[{required:!0,message:"必填：权限字符"}],children:e.jsx(K,{placeholder:"请输入权限字符"})})}),e.jsx(o,{span:24,children:e.jsx(i.Item,{label:"角色级别",name:"level",rules:[{required:!0,message:"必填：角色级别"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(o,{span:24,children:e.jsx(i.Item,{label:"角色顺序",name:"sort",rules:[{required:!0,message:"必填：角色顺序"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(o,{span:24,children:e.jsx(i.Item,{label:"状态",name:"status",rules:[{required:!1}],children:e.jsx(D,{})})}),e.jsx(o,{span:24,children:e.jsxs(i.Item,{label:"菜单权限",name:"permission_menu",rules:[{required:!1,message:"必填：菜单权限"}],children:[e.jsxs("div",{className:"mt-[6px] px-3 w-full flex justify-between",children:[e.jsx("div",{children:e.jsx(k,{onChange:M,children:"展开/折叠"})}),e.jsx("div",{children:e.jsx(k,{onChange:R,children:"全选/全不选"})}),e.jsx("div",{children:e.jsx(k,{defaultChecked:!0,onChange:()=>{},children:"父子联动"})})]}),e.jsx("div",{className:"mt-3 w-full p-3  border-[1px] rounded-lg",children:e.jsx(G,{checkStrictly:!1,showLine:!0,checkable:!0,treeData:p,checkedKeys:g,expandedKeys:V,onExpand:s=>{c(s)},onCheck:s=>{d(s)}})})]})}),e.jsx(o,{span:24,children:e.jsx(i.Item,{label:"角色描述",name:"desc",rules:[{required:!1}],children:e.jsx(U,{rows:3,placeholder:"请输入内容",maxLength:60})})})]})})})};export{re as default};
//# sourceMappingURL=Modal-95674d4c.js.map
