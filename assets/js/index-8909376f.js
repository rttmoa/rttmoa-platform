import{ak as x,al as g,r as n,aa as o,j as e,B as p,M as k,W as w,am as D}from"./index-3e43e27d.js";import{C as L}from"./index-0a51a5c6.js";import{T as M}from"./Table-595e35c4.js";import{S as u}from"./index-9b6f6f20.js";import"./Skeleton-b792f8fd.js";import"./styleChecker-315bb44a.js";import"./List-bb13ac41.js";import"./iconUtil-3b6e5db9.js";import"./conductUtil-e778fc81.js";import"./index-ba24c58e.js";import"./index-8bff4b13.js";import"./index-ba7ba2b4.js";import"./index-f0130851.js";import"./index-002059a1.js";import"./useIcons-a498c6f6.js";const R=s=>x.get(g+`/category/list?parentId=${s}`),P=(s,a)=>x.post(g+"/category/add",{parentId:s,categoryName:a}),W=(s,a)=>x.post(g+"/category/update",{parentId:s,categoryName:a}),oe=()=>{const[s,a]=n.useState(!1),[r,c]=n.useState("0"),[I,y]=n.useState(""),[h,N]=n.useState({}),[j,b]=n.useState([]),[O,f]=n.useState([]),[C,i]=n.useState(0),[S]=o.useForm(),[F]=o.useForm(),d=async t=>{a(!0),t=t||r;const l=await R(t);if(a(!1),l.code===200){let m=l.data.map((A,B)=>({...A,key:B}));t=="0"?b(m):f(m)}else D.error("获取分类列表失败")};n.useEffect(()=>{d("")},[]);const _=[{title:r==="0"?"一级分类名称":"二级分类名称",dataIndex:"name"},{title:"操作",width:300,render:t=>e.jsxs("span",{children:[e.jsx(p,{style:{color:"#fe8281"},type:"link",onClick:()=>{E(t)},children:r==="0"?"修改一级分类":"修改二级分类"}),r==="0"?e.jsx(p,{type:"link",onClick:()=>{V(t)},children:"查看子分类"}):null]})}],E=t=>{N(t),i(2)},V=t=>{c(t._id),y(t.name),d(t._id)},T=()=>{c("0"),y(""),f([])},U=async()=>{const{parentId:t,categoryName:l}=S.getFieldsValue(),m=await P(t,l);i(0),m.code===200&&(t===r?d(t):t==="0"&&d("0"))},v=async()=>{i(0);const t=h._id,{categoryName:l}=F.getFieldsValue();(await W(t,l)).code===200&&d("")};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:r==="0"?"一级分类列表":e.jsxs("span",{children:[e.jsx(p,{onClick:T,type:"link",children:e.jsx("b",{children:"一级分类列表"})}),"->","   ",e.jsx("span",{className:"font-normal font-serif",children:I})]}),extra:e.jsx(p,{type:"primary",onClick:()=>{i(1)},children:"添加分类"}),children:e.jsx(M,{loading:s,columns:_,dataSource:r==="0"?j:O})}),e.jsx(k,{title:"添加分类",open:C===1,onOk:U,onCancel:()=>{i(0)},children:e.jsx($,{categorys:j,parentId:r,form:S})}),e.jsx(k,{title:"修改分类",open:C===2,onOk:v,onCancel:()=>{i(0)},children:e.jsx(q,{categoryName:h.name,form:F})})]})};function $({categorys:s,parentId:a,form:r}){return n.useEffect(()=>()=>{r.resetFields()}),e.jsx(e.Fragment,{children:e.jsxs(o,{form:r,initialValues:{parentId:a},children:[e.jsx(o.Item,{name:"parentId",children:e.jsxs(u,{children:[e.jsx(u.Option,{value:"0",children:"一级分类"}),s.map(c=>e.jsx(u.Option,{value:c._id,children:c.name},c._id))]})}),e.jsx(o.Item,{name:"categoryName",children:e.jsx(w,{placeholder:"请输入分类名称"})})]})})}function q({categoryName:s,form:a}){return n.useEffect(()=>()=>{a.resetFields()}),e.jsx(e.Fragment,{children:e.jsx(o,{form:a,initialValues:{categoryName:s},children:e.jsx(o.Item,{name:"categoryName",children:e.jsx(w,{placeholder:"请输入分类名称"})})})})}export{oe as default};
