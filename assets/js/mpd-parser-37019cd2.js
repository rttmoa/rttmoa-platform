import{r as L,f as Z,d as J}from"./@videojs-dfc8d875.js";import{a as T}from"./global-dfd2e60e.js";import{D as Q}from"./@xmldom-6a8067e2.js";/*! @name mpd-parser @version 1.3.0 @license Apache-2.0 */const w=e=>!!e&&typeof e=="object",E=(...e)=>e.reduce((n,t)=>(typeof t!="object"||Object.keys(t).forEach(r=>{Array.isArray(n[r])&&Array.isArray(t[r])?n[r]=n[r].concat(t[r]):w(n[r])&&w(t[r])?n[r]=E(n[r],t[r]):n[r]=t[r]}),n),{}),q=e=>Object.keys(e).map(n=>e[n]),ee=(e,n)=>{const t=[];for(let r=e;r<n;r++)t.push(r);return t},O=e=>e.reduce((n,t)=>n.concat(t),[]),W=e=>{if(!e.length)return[];const n=[];for(let t=0;t<e.length;t++)n.push(e[t]);return n},te=(e,n)=>e.reduce((t,r,i)=>(r[n]&&t.push(i),t),[]),ne=(e,n)=>q(e.reduce((t,r)=>(r.forEach(i=>{t[n(i)]=i}),t),{}));var R={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",INVALID_NUMBER_OF_CONTENT_STEERING:"INVALID_NUMBER_OF_CONTENT_STEERING",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const _=({baseUrl:e="",source:n="",range:t="",indexRange:r=""})=>{const i={uri:n,resolvedUri:L(e||"",n)};if(t||r){const o=(t||r).split("-");let c=T.BigInt?T.BigInt(o[0]):parseInt(o[0],10),a=T.BigInt?T.BigInt(o[1]):parseInt(o[1],10);c<Number.MAX_SAFE_INTEGER&&typeof c=="bigint"&&(c=Number(c)),a<Number.MAX_SAFE_INTEGER&&typeof a=="bigint"&&(a=Number(a));let u;typeof a=="bigint"||typeof c=="bigint"?u=T.BigInt(a)-T.BigInt(c)+T.BigInt(1):u=a-c+1,typeof u=="bigint"&&u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),i.byterange={length:u,offset:c}}return i},re=e=>{let n;return typeof e.offset=="bigint"||typeof e.length=="bigint"?n=T.BigInt(e.offset)+T.BigInt(e.length)-T.BigInt(1):n=e.offset+e.length-1,`${e.offset}-${n}`},F=e=>(e&&typeof e!="number"&&(e=parseInt(e,10)),isNaN(e)?null:e),ie={static(e){const{duration:n,timescale:t=1,sourceDuration:r,periodDuration:i}=e,s=F(e.endNumber),o=n/t;return typeof s=="number"?{start:0,end:s}:typeof i=="number"?{start:0,end:i/o}:{start:0,end:r/o}},dynamic(e){const{NOW:n,clientOffset:t,availabilityStartTime:r,timescale:i=1,duration:s,periodStart:o=0,minimumUpdatePeriod:c=0,timeShiftBufferDepth:a=1/0}=e,u=F(e.endNumber),m=(n+t)/1e3,d=r+o,h=m+c-d,l=Math.ceil(h*i/s),g=Math.floor((m-d-a)*i/s),I=Math.floor((m-d)*i/s);return{start:Math.max(0,g),end:typeof u=="number"?u:Math.min(l,I)}}},se=e=>n=>{const{duration:t,timescale:r=1,periodStart:i,startNumber:s=1}=e;return{number:s+n,duration:t/r,timeline:i,time:n*t}},C=e=>{const{type:n,duration:t,timescale:r=1,periodDuration:i,sourceDuration:s}=e,{start:o,end:c}=ie[n](e),a=ee(o,c).map(se(e));if(n==="static"){const u=a.length-1,m=typeof i=="number"?i:s;a[u].duration=m-t/r*u}return a},Y=e=>{const{baseUrl:n,initialization:t={},sourceDuration:r,indexRange:i="",periodStart:s,presentationTime:o,number:c=0,duration:a}=e;if(!n)throw new Error(R.NO_BASE_URL);const u=_({baseUrl:n,source:t.sourceURL,range:t.range}),m=_({baseUrl:n,source:n,indexRange:i});if(m.map=u,a){const d=C(e);d.length&&(m.duration=d[0].duration,m.timeline=d[0].timeline)}else r&&(m.duration=r,m.timeline=s);return m.presentationTime=o||s,m.number=c,[m]},oe=(e,n,t)=>{const r=e.sidx.map?e.sidx.map:null,i=e.sidx.duration,s=e.timeline||0,o=e.sidx.byterange,c=o.offset+o.length,a=n.timescale,u=n.references.filter(I=>I.referenceType!==1),m=[],d=e.endList?"static":"dynamic",p=e.sidx.timeline;let h=p,l=e.mediaSequence||0,g;typeof n.firstOffset=="bigint"?g=T.BigInt(c)+n.firstOffset:g=c+n.firstOffset;for(let I=0;I<u.length;I++){const D=n.references[I],N=D.referencedSize,U=D.subsegmentDuration;let b;typeof g=="bigint"?b=g+T.BigInt(N)-T.BigInt(1):b=g+N-1;const k=`${g}-${b}`,x=Y({baseUrl:t,timescale:a,timeline:s,periodStart:p,presentationTime:h,number:l,duration:U,sourceDuration:i,indexRange:k,type:d})[0];r&&(x.map=r),m.push(x),typeof g=="bigint"?g+=T.BigInt(N):g+=N,h+=U/a,l++}return e.segments=m,e},ae=["AUDIO","SUBTITLES"],ce=1/60,X=e=>ne(e,({timeline:n})=>n).sort((n,t)=>n.timeline>t.timeline?1:-1),ue=(e,n)=>{for(let t=0;t<e.length;t++)if(e[t].attributes.NAME===n)return e[t];return null},G=e=>{let n=[];return Z(e,ae,(t,r,i,s)=>{n=n.concat(t.playlists||[])}),n},V=({playlist:e,mediaSequence:n})=>{e.mediaSequence=n,e.segments.forEach((t,r)=>{t.number=e.mediaSequence+r})},me=({oldPlaylists:e,newPlaylists:n,timelineStarts:t})=>{n.forEach(r=>{r.discontinuitySequence=t.findIndex(function({timeline:a}){return a===r.timeline});const i=ue(e,r.attributes.NAME);if(!i||r.sidx)return;const s=r.segments[0],o=i.segments.findIndex(function(a){return Math.abs(a.presentationTime-s.presentationTime)<ce});if(o===-1){V({playlist:r,mediaSequence:i.mediaSequence+i.segments.length}),r.segments[0].discontinuity=!0,r.discontinuityStarts.unshift(0),(!i.segments.length&&r.timeline>i.timeline||i.segments.length&&r.timeline>i.segments[i.segments.length-1].timeline)&&r.discontinuitySequence--;return}i.segments[o].discontinuity&&!s.discontinuity&&(s.discontinuity=!0,r.discontinuityStarts.unshift(0),r.discontinuitySequence--),V({playlist:r,mediaSequence:i.segments[o].number})})},de=({oldManifest:e,newManifest:n})=>{const t=e.playlists.concat(G(e)),r=n.playlists.concat(G(n));return n.timelineStarts=X([e.timelineStarts,n.timelineStarts]),me({oldPlaylists:t,newPlaylists:r,timelineStarts:n.timelineStarts}),n},le=e=>e&&e.uri+"-"+re(e.byterange),M=e=>{const n=e.reduce(function(r,i){return r[i.attributes.baseUrl]||(r[i.attributes.baseUrl]=[]),r[i.attributes.baseUrl].push(i),r},{});let t=[];return Object.values(n).forEach(r=>{const i=q(r.reduce((s,o)=>{const c=o.attributes.id+(o.attributes.lang||"");return s[c]?(o.segments&&(o.segments[0]&&(o.segments[0].discontinuity=!0),s[c].segments.push(...o.segments)),o.attributes.contentProtection&&(s[c].attributes.contentProtection=o.attributes.contentProtection)):(s[c]=o,s[c].attributes.timelineStarts=[]),s[c].attributes.timelineStarts.push({start:o.attributes.periodStart,timeline:o.attributes.periodStart}),s},{}));t=t.concat(i)}),t.map(r=>(r.discontinuityStarts=te(r.segments||[],"discontinuity"),r))},B=(e,n)=>{const t=le(e.sidx),r=t&&n[t]&&n[t].sidx;return r&&oe(e,r,e.sidx.resolvedUri),e},fe=(e,n={})=>{if(!Object.keys(n).length)return e;for(const t in e)e[t]=B(e[t],n);return e},ge=({attributes:e,segments:n,sidx:t,mediaSequence:r,discontinuitySequence:i,discontinuityStarts:s},o)=>{const c={attributes:{NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs,"PROGRAM-ID":1},uri:"",endList:e.type==="static",timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuitySequence:i,discontinuityStarts:s,timelineStarts:e.timelineStarts,mediaSequence:r,segments:n};return e.contentProtection&&(c.contentProtection=e.contentProtection),e.serviceLocation&&(c.attributes.serviceLocation=e.serviceLocation),t&&(c.sidx=t),o&&(c.attributes.AUDIO="audio",c.attributes.SUBTITLES="subs"),c},pe=({attributes:e,segments:n,mediaSequence:t,discontinuityStarts:r,discontinuitySequence:i})=>{typeof n>"u"&&(n=[{uri:e.baseUrl,timeline:e.periodStart,resolvedUri:e.baseUrl||"",duration:e.sourceDuration,number:0}],e.duration=e.sourceDuration);const s={NAME:e.id,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1};e.codecs&&(s.CODECS=e.codecs);const o={attributes:s,uri:"",endList:e.type==="static",timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,timelineStarts:e.timelineStarts,discontinuityStarts:r,discontinuitySequence:i,mediaSequence:t,segments:n};return e.serviceLocation&&(o.attributes.serviceLocation=e.serviceLocation),o},Se=(e,n={},t=!1)=>{let r;const i=e.reduce((s,o)=>{const c=o.attributes.role&&o.attributes.role.value||"",a=o.attributes.lang||"";let u=o.attributes.label||"main";if(a&&!o.attributes.label){const d=c?` (${c})`:"";u=`${o.attributes.lang}${d}`}s[u]||(s[u]={language:a,autoselect:!0,default:c==="main",playlists:[],uri:""});const m=B(ge(o,t),n);return s[u].playlists.push(m),typeof r>"u"&&c==="main"&&(r=o,r.default=!0),s},{});if(!r){const s=Object.keys(i)[0];i[s].default=!0}return i},he=(e,n={})=>e.reduce((t,r)=>{const i=r.attributes.label||r.attributes.lang||"text";return t[i]||(t[i]={language:i,default:!1,autoselect:!1,playlists:[],uri:""}),t[i].playlists.push(B(pe(r),n)),t},{}),Ie=e=>e.reduce((n,t)=>(t&&t.forEach(r=>{const{channel:i,language:s}=r;n[s]={autoselect:!1,default:!1,instreamId:i,language:s},r.hasOwnProperty("aspectRatio")&&(n[s].aspectRatio=r.aspectRatio),r.hasOwnProperty("easyReader")&&(n[s].easyReader=r.easyReader),r.hasOwnProperty("3D")&&(n[s]["3D"]=r["3D"])}),n),{}),Ee=({attributes:e,segments:n,sidx:t,discontinuityStarts:r})=>{const i={attributes:{NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1},uri:"",endList:e.type==="static",timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuityStarts:r,timelineStarts:e.timelineStarts,segments:n};return e.frameRate&&(i.attributes["FRAME-RATE"]=e.frameRate),e.contentProtection&&(i.contentProtection=e.contentProtection),e.serviceLocation&&(i.attributes.serviceLocation=e.serviceLocation),t&&(i.sidx=t),i},Te=({attributes:e})=>e.mimeType==="video/mp4"||e.mimeType==="video/webm"||e.contentType==="video",Ne=({attributes:e})=>e.mimeType==="audio/mp4"||e.mimeType==="audio/webm"||e.contentType==="audio",De=({attributes:e})=>e.mimeType==="text/vtt"||e.contentType==="text",Ue=(e,n)=>{e.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=n.findIndex(function({timeline:r}){return r===t.timeline}),t.segments&&t.segments.forEach((r,i)=>{r.number=i})})},z=e=>e?Object.keys(e).reduce((n,t)=>{const r=e[t];return n.concat(r.playlists)},[]):[],be=({dashPlaylists:e,locations:n,contentSteering:t,sidxMapping:r={},previousManifest:i,eventStream:s})=>{if(!e.length)return{};const{sourceDuration:o,type:c,suggestedPresentationDelay:a,minimumUpdatePeriod:u}=e[0].attributes,m=M(e.filter(Te)).map(Ee),d=M(e.filter(Ne)),p=M(e.filter(De)),h=e.map(b=>b.attributes.captionServices).filter(Boolean),l={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:o,playlists:fe(m,r)};u>=0&&(l.minimumUpdatePeriod=u*1e3),n&&(l.locations=n),t&&(l.contentSteering=t),c==="dynamic"&&(l.suggestedPresentationDelay=a),s&&s.length>0&&(l.eventStream=s);const g=l.playlists.length===0,I=d.length?Se(d,r,g):null,D=p.length?he(p,r):null,N=m.concat(z(I),z(D)),U=N.map(({timelineStarts:b})=>b);return l.timelineStarts=X(U),Ue(N,l.timelineStarts),I&&(l.mediaGroups.AUDIO.audio=I),D&&(l.mediaGroups.SUBTITLES.subs=D),h.length&&(l.mediaGroups["CLOSED-CAPTIONS"].cc=Ie(h)),i?de({oldManifest:i,newManifest:l}):l},ye=(e,n,t)=>{const{NOW:r,clientOffset:i,availabilityStartTime:s,timescale:o=1,periodStart:c=0,minimumUpdatePeriod:a=0}=e,u=(r+i)/1e3,m=s+c,p=u+a-m;return Math.ceil((p*o-n)/t)},j=(e,n)=>{const{type:t,minimumUpdatePeriod:r=0,media:i="",sourceDuration:s,timescale:o=1,startNumber:c=1,periodStart:a}=e,u=[];let m=-1;for(let d=0;d<n.length;d++){const p=n[d],h=p.d,l=p.r||0,g=p.t||0;m<0&&(m=g),g&&g>m&&(m=g);let I;if(l<0){const U=d+1;U===n.length?t==="dynamic"&&r>0&&i.indexOf("$Number$")>0?I=ye(e,m,h):I=(s*o-m)/h:I=(n[U].t-m)/h}else I=l+1;const D=c+u.length+I;let N=c+u.length;for(;N<D;)u.push({number:N,duration:h/o,time:m,timeline:a}),m+=h,N++}return u},Oe=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Re=e=>(n,t,r,i)=>{if(n==="$$")return"$";if(typeof e[t]>"u")return n;const s=""+e[t];return t==="RepresentationID"||(r?i=parseInt(i,10):i=1,s.length>=i)?s:`${new Array(i-s.length+1).join("0")}${s}`},$=(e,n)=>e.replace(Oe,Re(n)),_e=(e,n)=>!e.duration&&!n?[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}]:e.duration?C(e):j(e,n),Pe=(e,n)=>{const t={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:r={sourceURL:"",range:""}}=e,i=_({baseUrl:e.baseUrl,source:$(r.sourceURL,t),range:r.range});return _e(e,n).map(o=>{t.Number=o.number,t.Time=o.time;const c=$(e.media||"",t),a=e.timescale||1,u=e.presentationTimeOffset||0,m=e.periodStart+(o.time-u)/a;return{uri:c,timeline:o.timeline,duration:o.duration,resolvedUri:L(e.baseUrl||"",c),map:i,number:o.number,presentationTime:m}})},Ae=(e,n)=>{const{baseUrl:t,initialization:r={}}=e,i=_({baseUrl:t,source:r.sourceURL,range:r.range}),s=_({baseUrl:t,source:n.media,range:n.mediaRange});return s.map=i,s},Me=(e,n)=>{const{duration:t,segmentUrls:r=[],periodStart:i}=e;if(!t&&!n||t&&n)throw new Error(R.SEGMENT_TIME_UNSPECIFIED);const s=r.map(a=>Ae(e,a));let o;return t&&(o=C(e)),n&&(o=j(e,n)),o.map((a,u)=>{if(s[u]){const m=s[u],d=e.timescale||1,p=e.presentationTimeOffset||0;return m.timeline=a.timeline,m.duration=a.duration,m.number=a.number,m.presentationTime=i+(a.time-p)/d,m}}).filter(a=>a)},Le=({attributes:e,segmentInfo:n})=>{let t,r;n.template?(r=Pe,t=E(e,n.template)):n.base?(r=Y,t=E(e,n.base)):n.list&&(r=Me,t=E(e,n.list));const i={attributes:e};if(!r)return i;const s=r(t,n.segmentTimeline);if(t.duration){const{duration:o,timescale:c=1}=t;t.duration=o/c}else s.length?t.duration=s.reduce((o,c)=>Math.max(o,Math.ceil(c.duration)),0):t.duration=0;return i.attributes=t,i.segments=s,n.base&&t.indexRange&&(i.sidx=s[0],i.segments=[]),i},Ce=e=>e.map(Le),f=(e,n)=>W(e.childNodes).filter(({tagName:t})=>t===n),P=e=>e.textContent.trim(),Be=e=>parseFloat(e.split("/").reduce((n,t)=>n/t)),y=e=>{const c=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!c)return 0;const[a,u,m,d,p,h]=c.slice(1);return parseFloat(a||0)*31536e3+parseFloat(u||0)*2592e3+parseFloat(m||0)*86400+parseFloat(d||0)*3600+parseFloat(p||0)*60+parseFloat(h||0)},ve=e=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),Date.parse(e)),H={mediaPresentationDuration(e){return y(e)},availabilityStartTime(e){return ve(e)/1e3},minimumUpdatePeriod(e){return y(e)},suggestedPresentationDelay(e){return y(e)},type(e){return e},timeShiftBufferDepth(e){return y(e)},start(e){return y(e)},width(e){return parseInt(e,10)},height(e){return parseInt(e,10)},bandwidth(e){return parseInt(e,10)},frameRate(e){return Be(e)},startNumber(e){return parseInt(e,10)},timescale(e){return parseInt(e,10)},presentationTimeOffset(e){return parseInt(e,10)},duration(e){const n=parseInt(e,10);return isNaN(n)?y(e):n},d(e){return parseInt(e,10)},t(e){return parseInt(e,10)},r(e){return parseInt(e,10)},presentationTime(e){return parseInt(e,10)},DEFAULT(e){return e}},S=e=>e&&e.attributes?W(e.attributes).reduce((n,t)=>{const r=H[t.name]||H.DEFAULT;return n[t.name]=r(t.value),n},{}):{},xe={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},A=(e,n)=>n.length?O(e.map(function(t){return n.map(function(r){const i=P(r),s=L(t.baseUrl,i),o=E(S(r),{baseUrl:s});return s!==i&&!o.serviceLocation&&t.serviceLocation&&(o.serviceLocation=t.serviceLocation),o})})):e,v=e=>{const n=f(e,"SegmentTemplate")[0],t=f(e,"SegmentList")[0],r=t&&f(t,"SegmentURL").map(d=>E({tag:"SegmentURL"},S(d))),i=f(e,"SegmentBase")[0],s=t||n,o=s&&f(s,"SegmentTimeline")[0],c=t||i||n,a=c&&f(c,"Initialization")[0],u=n&&S(n);u&&a?u.initialization=a&&S(a):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const m={template:u,segmentTimeline:o&&f(o,"S").map(d=>S(d)),list:t&&E(S(t),{segmentUrls:r,initialization:S(a)}),base:i&&E(S(i),{initialization:S(a)})};return Object.keys(m).forEach(d=>{m[d]||delete m[d]}),m},we=(e,n,t)=>r=>{const i=f(r,"BaseURL"),s=A(n,i),o=E(e,S(r)),c=v(r);return s.map(a=>({segmentInfo:E(t,c),attributes:E(o,a)}))},Fe=e=>e.reduce((n,t)=>{const r=S(t);r.schemeIdUri&&(r.schemeIdUri=r.schemeIdUri.toLowerCase());const i=xe[r.schemeIdUri];if(i){n[i]={attributes:r};const s=f(t,"cenc:pssh")[0];if(s){const o=P(s);n[i].pssh=o&&J(o)}}return n},{}),Ge=e=>{if(e.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof e.value!="string"?[]:e.value.split(";")).map(t=>{let r,i;return i=t,/^CC\d=/.test(t)?[r,i]=t.split("="):/^CC\d$/.test(t)&&(r=t),{channel:r,language:i}});if(e.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof e.value!="string"?[]:e.value.split(";")).map(t=>{const r={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[i,s=""]=t.split("=");r.channel=i,r.language=t,s.split(",").forEach(o=>{const[c,a]=o.split(":");c==="lang"?r.language=a:c==="er"?r.easyReader=Number(a):c==="war"?r.aspectRatio=Number(a):c==="3D"&&(r["3D"]=Number(a))})}else r.language=t;return r.channel&&(r.channel="SERVICE"+r.channel),r})},Ve=e=>O(f(e.node,"EventStream").map(n=>{const t=S(n),r=t.schemeIdUri;return f(n,"Event").map(i=>{const s=S(i),o=s.presentationTime||0,c=t.timescale||1,a=s.duration||0,u=o/c+e.attributes.start;return{schemeIdUri:r,value:t.value,id:s.id,start:u,end:u+a/c,messageData:P(i)||s.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),ze=(e,n,t)=>r=>{const i=S(r),s=A(n,f(r,"BaseURL")),o=f(r,"Role")[0],c={role:S(o)};let a=E(e,i,c);const u=f(r,"Accessibility")[0],m=Ge(S(u));m&&(a=E(a,{captionServices:m}));const d=f(r,"Label")[0];if(d&&d.childNodes.length){const I=d.childNodes[0].nodeValue.trim();a=E(a,{label:I})}const p=Fe(f(r,"ContentProtection"));Object.keys(p).length&&(a=E(a,{contentProtection:p}));const h=v(r),l=f(r,"Representation"),g=E(t,h);return O(l.map(we(a,s,g)))},$e=(e,n)=>(t,r)=>{const i=A(n,f(t.node,"BaseURL")),s=E(e,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(s.periodDuration=t.attributes.duration);const o=f(t.node,"AdaptationSet"),c=v(t.node);return O(o.map(ze(s,i,c)))},He=(e,n)=>{if(e.length>1&&n({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!e.length)return null;const t=E({serverURL:P(e[0])},S(e[0]));return t.queryBeforeStart=t.queryBeforeStart==="true",t},qe=({attributes:e,priorPeriodAttributes:n,mpdType:t})=>typeof e.start=="number"?e.start:n&&typeof n.start=="number"&&typeof n.duration=="number"?n.start+n.duration:!n&&t==="static"?0:null,We=(e,n={})=>{const{manifestUri:t="",NOW:r=Date.now(),clientOffset:i=0,eventHandler:s=function(){}}=n,o=f(e,"Period");if(!o.length)throw new Error(R.INVALID_NUMBER_OF_PERIOD);const c=f(e,"Location"),a=S(e),u=A([{baseUrl:t}],f(e,"BaseURL")),m=f(e,"ContentSteering");a.type=a.type||"static",a.sourceDuration=a.mediaPresentationDuration||0,a.NOW=r,a.clientOffset=i,c.length&&(a.locations=c.map(P));const d=[];return o.forEach((p,h)=>{const l=S(p),g=d[h-1];l.start=qe({attributes:l,priorPeriodAttributes:g?g.attributes:null,mpdType:a.type}),d.push({node:p,attributes:l})}),{locations:a.locations,contentSteeringInfo:He(m,s),representationInfo:O(d.map($e(a,u))),eventStream:O(d.map(Ve))}},K=e=>{if(e==="")throw new Error(R.DASH_EMPTY_MANIFEST);const n=new Q;let t,r;try{t=n.parseFromString(e,"application/xml"),r=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(R.DASH_INVALID_XML);return r},Ye=e=>{const n=f(e,"UTCTiming")[0];if(!n)return null;const t=S(n);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(R.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},Ze=(e,n={})=>{const t=We(K(e),n),r=Ce(t.representationInfo);return be({dashPlaylists:r,locations:t.locations,contentSteering:t.contentSteeringInfo,sidxMapping:n.sidxMapping,previousManifest:n.previousManifest,eventStream:t.eventStream})},Je=e=>Ye(K(e));export{Ze as a,oe as b,le as g,Je as p};
