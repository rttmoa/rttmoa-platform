import{r as n,ay as se,a9 as o,j as e,N as re,B as O,M as g,X as R}from"./index-27069029.js";import{T as ne}from"./index-fbfdde05.js";import{r as ae,a as le}from"./roleManage-1d03b01a.js";import{C as w}from"./index-0ed61a77.js";import{S as j}from"./index-1c2b87a6.js";import{T as x}from"./index-c7a6d802.js";import{T as oe}from"./index-5fa40f0b.js";import"./___vite-browser-external_commonjs-proxy-b80c5597.js";import"./Table-778951e0.js";import"./index-f5e989dc.js";import"./zh_CN-b8e4881f.js";import"./styleChecker-3c9c7d8a.js";import"./List-3450d2b7.js";import"./Tree-409ac648.js";import"./conductUtil-6ae751c6.js";import"./index-4c31189a.js";import"./index-8d525821.js";import"./index-04342e75.js";import"./index-01f37548.js";import"./Skeleton-2867eeca.js";import"./Select-91793026.js";import"./useIcons-4fdad9d1.js";import"./iconUtil-3fadc6e3.js";import"./transButton-dd8aeafb.js";function M(i){if(!i)return"";let a=new Date(Number(i));return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}const Pe=()=>{const[i,a]=n.useState([]),[S,p]=n.useState([]),[I,b]=n.useState([]),[s,m]=n.useState({}),c=se(t=>t.auth.authMenuList),[d]=o.useForm(),[r]=o.useForm(),[l]=o.useForm(),[C,u]=n.useState(!1),[F,_]=n.useState(!1),[z,B]=n.useState({}),[L,D]=n.useState([]),[E,N]=n.useState(!1),[U,v]=n.useState([]),[K,P]=n.useState([]),[A,H]=n.useState(null),[J,X]=n.useState({}),Y=n.useRef();n.useEffect(()=>{(async function(){ae().then(t=>{const f=t.data.list.map((h,y)=>({...h,key:y}));a(f)})})()},[]);const q=[{title:"角色名称",dataIndex:"role_name",align:"center"},{title:"使用状态",dataIndex:"status",align:"center",render:t=>t===1?"启用":"停用"},{title:"授权人",align:"center",dataIndex:"authorize_user_name"},{title:"创建时间",align:"center",dataIndex:"create_time",render:M},{title:"授权时间",align:"center",dataIndex:"authorize_time",render:M}],G=(t,f,h)=>{h?(p(t),b(h),m(f)):(p(t),m(f))},Q=()=>{u(!0)},W=()=>{d.getFieldsValue(),d.resetFields(),u(!1)},Z=()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"请选择一个角色"});return}_(!0),B(s),D(s.menus)},$=()=>{let t=r.getFieldsValue();t.role_id=s.id,t.menus=L,t.authorize_time=Date.now(),r.resetFields(),_(!1)},ee=async()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"未选中任何项目"});return}const t=await le(s.id),f=[],h=[];if(t.data.length>0){const y=t.data;for(let T=0;T<y.length;T++){const k=y[T],V={key:k.user_id,title:k.user_name,status:k.status};V.status===1&&h.push(V.key),f.push(V)}}v(f),P(h),X(s),H(!1),N(!0)},te=()=>{s.id,l.resetFields(),N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{extra:e.jsxs(re,{size:"middle",children:[e.jsx(O,{type:"primary",onClick:Q,children:"创建角色"}),e.jsx(O,{type:s.id?"primary":"default",onClick:Z,disabled:!s.id,children:"设置权限"}),e.jsx(O,{type:s.id?"primary":"default",onClick:ee,disabled:!s.id,children:"用户授权"})]}),children:e.jsx(ne,{columns:q,dataSource:i,selectedRowKeys:S,selectedIds:I,selectedItem:s,pagination:{},updateSelectedItem:G})}),e.jsx(g,{title:"创建角色",open:C,onOk:W,onCancel:()=>{d.resetFields(),u(!1)},children:e.jsx(ie,{form:d})}),e.jsx(g,{width:600,title:"权限设置",open:F,onOk:$,onCancel:()=>{r.resetFields(),_(!1)},children:e.jsx(ce,{form:r,detailInfo:z,menuInfo:L||[],patchMenuInfo:t=>{D(t)},menuConfig:c})}),e.jsx(g,{title:"用户授权",width:800,open:E,onOk:te,onCancel:()=>{l.resetFields(),N(!1)},children:e.jsx(de,{form:l,isClose:A,detailUserInfo:J,targetKeys:K,transferData:U,patchUserInfo:t=>{P(t)},ref:Y})})]})};function ie({form:i}){const a={labelCol:{span:5},wrapperCol:{span:16}};return e.jsx(e.Fragment,{children:e.jsx(w,{children:e.jsxs(o,{form:i,...a,initialValues:{status:1},children:[e.jsx(o.Item,{label:"角色名称",name:"role_name",children:e.jsx(R,{type:"text",placeholder:"请输入角色名称"})}),e.jsx(o.Item,{label:"状态",name:"status",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"开启"}),e.jsx(j.Option,{value:0,children:"关闭"})]})})]})})})}function ce({form:i,detailInfo:a,menuInfo:S,patchMenuInfo:p,menuConfig:I}){const b=(c,d="")=>{const r=[];return c.btnList.forEach(l=>{r.push(e.jsx(x.TreeNode,{title:l.meta.title,className:"op-role-tree"},d+"-btn-"+l.path))}),r},s=(c,d)=>c.map(r=>{let l=r.path;return r.children?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:s(r.children)},l):r.btnList?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:b(r,l)},l):e.jsx(x.TreeNode,{title:r.meta.title},l)}),m={labelCol:{span:4},wrapperCol:{span:16}};return e.jsx(o,{form:i,layout:"horizontal",...m,initialValues:{status2:1,role_name2:a.role_name},children:e.jsxs(w,{children:[e.jsx(o.Item,{label:"角色名称",name:"role_name2",children:e.jsx(R,{disabled:!0,maxLength:8,placeholder:a.role_name})}),e.jsx(o.Item,{label:"状态",name:"status2",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"启用"}),e.jsx(j.Option,{value:0,children:"停用"})]})}),e.jsx(o.Item,{label:"菜单",name:"menu",children:e.jsx(x,{checkable:!0,defaultExpandAll:!0,onCheck:c=>{p(c)},checkedKeys:S||[],children:e.jsx(x.TreeNode,{title:"平台权限",children:s(I)},"platform_all")})})]})})}function de({form:i,isClose:a,detailUserInfo:S,targetKeys:p,transferData:I,patchUserInfo:b,ref:s}){const[m,c]=n.useState(11),d=()=>(c(m+1),m);n.useImperativeHandle(s,()=>({status:m,statusValue:d}));const r=(u,F)=>F.title.indexOf(u)>-1,l=u=>{b(u)},C={labelCol:{span:5},wrapperCol:{span:18}};return e.jsxs(o,{form:i,layout:"horizontal",...C,initialValues:{transfer:p},children:[e.jsx(o.Item,{name:"role_name3",label:"角色名称",children:e.jsx(R,{disabled:!0,maxLength:8,placeholder:S.role_name})}),e.jsx(o.Item,{name:"transfer",label:"选择用户：",children:e.jsx(oe,{listStyle:{width:200,height:400},dataSource:I,showSearch:!0,titles:["待选用户","已选用户"],filterOption:r,targetKeys:p,onChange:l,render:u=>u.title})})]})}export{Pe as default};
