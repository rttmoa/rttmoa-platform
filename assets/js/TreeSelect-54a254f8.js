import{r,O as A,c0 as te,bt as Ot,I as mt,b$ as Ze,M as Pt,bo as Ct,dK as vt,K as B,du as Ht,bp as ye,N as St,J as ht}from"./index-6ab6cade.js";import{u as At,b as Rt,B as Ft}from"./Select-74f8e578.js";import{h as it,c as $t}from"./conductUtil-0f9ba3c8.js";import{_ as Wt}from"./createForOfIteratorHelper-2ec8257d.js";import{U as jt,T as Ut}from"./Tree-27289865.js";const Bt=function(e){var t=r.useRef({valueLabels:new Map});return r.useMemo(function(){var l=t.current.valueLabels,i=new Map,o=e.map(function(c){var n=c.value,a=c.label,u=a??l.get(n);return i.set(n,u),A(A({},c),{},{label:u})});return t.current.valueLabels=i,[o]},[e])};var Gt=function(t,l,i,o){return r.useMemo(function(){var c=function(w){return w.map(function(N){var M=N.value;return M})},n=c(t),a=c(l),u=n.filter(function(T){return!o[T]}),g=n,v=a;if(i){var K=it(n,!0,o);g=K.checkedKeys,v=K.halfCheckedKeys}return[Array.from(new Set([].concat(te(u),te(g)))),v]},[t,l,i,o])},Jt=function(t){return Array.isArray(t)?t:t!==void 0?[t]:[]},Yt=function(t){var l=t||{},i=l.label,o=l.value,c=l.children;return{_title:i?[i]:["title","label"],value:o||"value",key:o||"value",children:c||"children"}},ut=function(t){return!t||t.disabled||t.disableCheckbox||t.checkable===!1},qt=function(t,l){var i=[],o=function c(n){n.forEach(function(a){var u=a[l.children];u&&(i.push(a[l.value]),c(u))})};return o(t),i},pt=function(t){return t==null};const zt=function(e,t){return r.useMemo(function(){var l=$t(e,{fieldNames:t,initWrapper:function(o){return A(A({},o),{},{valueEntities:new Map})},processEntity:function(o,c){var n=o.node[t.value];c.valueEntities.set(n,o)}});return l},[e,t])};var bt=function(){return null},Qt=["children","value"];function xt(e){return Ot(e).map(function(t){if(!r.isValidElement(t)||!t.type)return null;var l=t,i=l.key,o=l.props,c=o.children,n=o.value,a=mt(o,Qt),u=A({key:i,value:n},a),g=xt(c);return g.length&&(u.children=g),u}).filter(function(t){return t})}function ot(e){if(!e)return e;var t=A({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return Ze(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function Xt(e,t,l,i,o,c){var n=null,a=null;function u(){function g(v){var K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v.map(function(w,N){var M="".concat(K,"-").concat(N),I=w[c.value],j=l.includes(I),re=g(w[c.children]||[],M,j),z=r.createElement(bt,w,re.map(function(R){return R.node}));if(t===I&&(n=z),j){var ce={pos:M,node:z,children:re};return T||a.push(ce),ce}return null}).filter(function(w){return w})}a||(a=[],g(i),a.sort(function(v,K){var T=v.node.props.value,w=K.node.props.value,N=l.indexOf(T),M=l.indexOf(w);return N-M}))}Object.defineProperty(e,"triggerNode",{get:function(){return Ze(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),u(),n}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return Ze(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),u(),o?a:a.map(function(v){var K=v.node;return K})}})}var Zt=function(t,l,i){var o=i.fieldNames,c=i.treeNodeFilterProp,n=i.filterTreeNode,a=o.children;return r.useMemo(function(){if(!l||n===!1)return t;var u=typeof n=="function"?n:function(v,K){return String(K[c]).toUpperCase().includes(l.toUpperCase())},g=function v(K){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return K.reduce(function(w,N){var M=N[a],I=T||u(l,ot(N)),j=v(M||[],I);return(I||j.length)&&w.push(A(A({},N),{},Pt({isLeaf:void 0},a,j))),w},[])};return g(t)},[t,l,a,c,n])};function gt(e){var t=r.useRef();t.current=e;var l=r.useCallback(function(){return t.current.apply(t,arguments)},[]);return l}function er(e,t){var l=t.id,i=t.pId,o=t.rootPId,c=new Map,n=[];return e.forEach(function(a){var u=a[l],g=A(A({},a),{},{key:a.key||u});c.set(u,g)}),c.forEach(function(a){var u=a[i],g=c.get(u);g?(g.children=g.children||[],g.children.push(a)):(u===o||o===null)&&n.push(a)}),n}function tr(e,t,l){return r.useMemo(function(){if(e){if(l){var i=A({id:"id",pId:"pId",rootPId:null},Ct(l)==="object"?l:{});return er(e,i)}return e}return xt(t)},[t,l,e])}var Et=r.createContext(null),kt=r.createContext(null),rr={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},nr=function(t,l){var i=At(),o=i.prefixCls,c=i.multiple,n=i.searchValue,a=i.toggleOpen,u=i.open,g=i.notFoundContent,v=r.useContext(kt),K=v.virtual,T=v.listHeight,w=v.listItemHeight,N=v.listItemScrollOffset,M=v.treeData,I=v.fieldNames,j=v.onSelect,re=v.dropdownMatchSelectWidth,z=v.treeExpandAction,ce=v.treeTitleRender,R=v.onPopupScroll,_=v.leftMaxCount,Ie=v.leafCountOnly,Q=v.valueEntities,b=r.useContext(Et),ne=b.checkable,V=b.checkedKeys,Ke=b.halfCheckedKeys,ae=b.treeExpandedKeys,_e=b.treeDefaultExpandAll,Te=b.treeDefaultExpandedKeys,me=b.onTreeExpand,Me=b.treeIcon,Le=b.showTreeIcon,Ne=b.switcherIcon,Ve=b.treeLine,Oe=b.treeNodeFilterProp,Pe=b.loadData,Ce=b.treeLoadedKeys,He=b.treeMotion,Ae=b.onTreeLoad,Re=b.keyEntities,le=r.useRef(),ie=vt(function(){return M},[u,M],function(h,s){return s[0]&&h[1]!==s[1]}),Fe=r.useMemo(function(){return ne?{checked:V,halfChecked:Ke}:null},[ne,V,Ke]);r.useEffect(function(){if(u&&!c&&V.length){var h;(h=le.current)===null||h===void 0||h.scrollTo({key:V[0]})}},[u]);var de=function(s){s.preventDefault()},se=function(s,D){var S=D.node;ne&&ut(S)||(j(S.key,{selected:!V.includes(S.key)}),c||a(!1))},$e=r.useState(Te),Se=B($e,2),fe=Se[0],We=Se[1],Y=r.useState(null),be=B(Y,2),je=be[0],Ue=be[1],ue=r.useMemo(function(){return ae?te(ae):n?je:fe},[fe,je,ae,n]),ve=function(s){We(s),Ue(s),me&&me(s)},xe=String(n).toLowerCase(),F=function(s){return xe?String(s[Oe]).toLowerCase().includes(xe):!1};r.useEffect(function(){n&&Ue(qt(M,I))},[n]);var tt=r.useState(function(){return new Map}),Ee=B(tt,2),G=Ee[0],rt=Ee[1];r.useEffect(function(){_&&rt(new Map)},[_]);function q(h){var s=h[I.value];if(!G.has(s)){var D=Q.get(s),S=(D.children||[]).length===0;if(S)G.set(s,!1);else{var x=D.children.filter(function(P){return!P.node.disabled&&!P.node.disableCheckbox&&!V.includes(P.node[I.value])}),W=x.length;G.set(s,W>_)}}return G.get(s)}var k=Ht(function(h){var s=h[I.value];return V.includes(s)||_===null?!1:_<=0?!0:Ie&&_?q(h):!1}),nt=function h(s){var D=Wt(s),S;try{for(D.s();!(S=D.n()).done;){var x=S.value;if(!(x.disabled||x.selectable===!1)){if(n){if(F(x))return x}else return x;if(x[I.children]){var W=h(x[I.children]);if(W)return W}}}}catch(P){D.e(P)}finally{D.f()}return null},Be=r.useState(null),ke=B(Be,2),he=ke[0],Ge=ke[1],$=Re[he];r.useEffect(function(){if(u){var h=null,s=function(){var S=nt(ie);return S?S[I.value]:null};!c&&V.length&&!n?h=V[0]:h=s(),Ge(h)}},[u,n]),r.useImperativeHandle(l,function(){var h;return{scrollTo:(h=le.current)===null||h===void 0?void 0:h.scrollTo,onKeyDown:function(D){var S,x=D.which;switch(x){case ye.UP:case ye.DOWN:case ye.LEFT:case ye.RIGHT:(S=le.current)===null||S===void 0||S.onKeyDown(D);break;case ye.ENTER:{if($){var W=k($.node),P=($==null?void 0:$.node)||{},Ye=P.selectable,X=P.value,qe=P.disabled;Ye!==!1&&!qe&&!W&&se(null,{node:{key:he},selected:!V.includes(X)})}break}case ye.ESC:a(!1)}},onKeyUp:function(){}}});var Je=vt(function(){return!n},[n,ae||fe],function(h,s){var D=B(h,1),S=D[0],x=B(s,2),W=x[0],P=x[1];return S!==W&&!!(W||P)}),L=Je?Pe:null;if(ie.length===0)return r.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:de},g);var O={fieldNames:I};return Ce&&(O.loadedKeys=Ce),ue&&(O.expandedKeys=ue),r.createElement("div",{onMouseDown:de},$&&u&&r.createElement("span",{style:rr,"aria-live":"assertive"},$.node.value),r.createElement(jt.Provider,{value:{nodeDisabled:k}},r.createElement(Ut,St({ref:le,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:ie,height:T,itemHeight:w,itemScrollOffset:N,virtual:K!==!1&&re!==!1,multiple:c,icon:Me,showIcon:Le,switcherIcon:Ne,showLine:Ve,loadData:L,motion:He,activeKey:he,checkable:ne,checkStrictly:!0,checkedKeys:Fe,selectedKeys:ne?[]:V,defaultExpandAll:_e,titleRender:ce},O,{onActiveChange:Ge,onSelect:se,onCheck:se,onExpand:ve,onLoad:Ae,filterTreeNode:F,expandAction:z,onScroll:R}))))},ar=r.forwardRef(nr),Dt="SHOW_ALL",wt="SHOW_PARENT",ct="SHOW_CHILD";function yt(e,t,l,i){var o=new Set(e);return t===ct?e.filter(function(c){var n=l[c];return!n||!n.children||!n.children.some(function(a){var u=a.node;return o.has(u[i.value])})||!n.children.every(function(a){var u=a.node;return ut(u)||o.has(u[i.value])})}):t===wt?e.filter(function(c){var n=l[c],a=n?n.parent:null;return!a||ut(a.node)||!o.has(a.key)}):e}var lr=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];function ir(e){return!e||Ct(e)!=="object"}var ur=r.forwardRef(function(e,t){var l=e.id,i=e.prefixCls,o=i===void 0?"rc-tree-select":i,c=e.value,n=e.defaultValue,a=e.onChange,u=e.onSelect,g=e.onDeselect,v=e.searchValue,K=e.inputValue,T=e.onSearch,w=e.autoClearSearchValue,N=w===void 0?!0:w,M=e.filterTreeNode,I=e.treeNodeFilterProp,j=I===void 0?"value":I,re=e.showCheckedStrategy,z=e.treeNodeLabelProp,ce=e.multiple,R=e.treeCheckable,_=e.treeCheckStrictly,Ie=e.labelInValue,Q=e.maxCount,b=e.fieldNames,ne=e.treeDataSimpleMode,V=e.treeData,Ke=e.children,ae=e.loadData,_e=e.treeLoadedKeys,Te=e.onTreeLoad,me=e.treeDefaultExpandAll,Me=e.treeExpandedKeys,Le=e.treeDefaultExpandedKeys,Ne=e.onTreeExpand,Ve=e.treeExpandAction,Oe=e.virtual,Pe=e.listHeight,Ce=Pe===void 0?200:Pe,He=e.listItemHeight,Ae=He===void 0?20:He,Re=e.listItemScrollOffset,le=Re===void 0?0:Re,ie=e.onDropdownVisibleChange,Fe=e.dropdownMatchSelectWidth,de=Fe===void 0?!0:Fe,se=e.treeLine,$e=e.treeIcon,Se=e.showTreeIcon,fe=e.switcherIcon,We=e.treeMotion,Y=e.treeTitleRender,be=e.onPopupScroll,je=mt(e,lr),Ue=Rt(l),ue=R&&!_,ve=R||_,xe=_||Ie,F=ve||ce,tt=ht(n,{value:c}),Ee=B(tt,2),G=Ee[0],rt=Ee[1],q=r.useMemo(function(){return R?re||ct:Dt},[re,R]),k=r.useMemo(function(){return Yt(b)},[JSON.stringify(b)]),nt=ht("",{value:v!==void 0?v:K,postState:function(d){return d||""}}),Be=B(nt,2),ke=Be[0],he=Be[1],Ge=function(d){he(d),T==null||T(d)},$=tr(V,Ke,ne),Je=zt($,k),L=Je.keyEntities,O=Je.valueEntities,h=r.useCallback(function(f){var d=[],p=[];return f.forEach(function(y){O.has(y)?p.push(y):d.push(y)}),{missingRawValues:d,existRawValues:p}},[O]),s=Zt($,ke,{fieldNames:k,treeNodeFilterProp:j,filterTreeNode:M}),D=r.useCallback(function(f){if(f){if(z)return f[z];for(var d=k._title,p=0;p<d.length;p+=1){var y=f[d[p]];if(y!==void 0)return y}}},[k,z]),S=r.useCallback(function(f){var d=Jt(f);return d.map(function(p){return ir(p)?{value:p}:p})},[]),x=r.useCallback(function(f){var d=S(f);return d.map(function(p){var y=p.label,U=p.value,E=p.halfChecked,m,C=O.get(U);if(C){var H;y=Y?Y(C.node):(H=y)!==null&&H!==void 0?H:D(C.node),m=C.node.disabled}else if(y===void 0){var Z=S(G).find(function(De){return De.value===U});y=Z.label}return{label:y,value:U,halfChecked:E,disabled:m}})},[O,D,S,G]),W=r.useMemo(function(){return S(G===null?[]:G)},[S,G]),P=r.useMemo(function(){var f=[],d=[];return W.forEach(function(p){p.halfChecked?d.push(p):f.push(p)}),[f,d]},[W]),Ye=B(P,2),X=Ye[0],qe=Ye[1],dt=r.useMemo(function(){return X.map(function(f){return f.value})},[X]),It=Gt(X,qe,ue,L),st=B(It,2),pe=st[0],ze=st[1],Kt=r.useMemo(function(){var f=yt(pe,q,L,k),d=f.map(function(E){var m,C;return(m=(C=L[E])===null||C===void 0||(C=C.node)===null||C===void 0?void 0:C[k.value])!==null&&m!==void 0?m:E}),p=d.map(function(E){var m=X.find(function(H){return H.value===E}),C=Ie?m==null?void 0:m.label:Y==null?void 0:Y(m);return{value:E,label:C}}),y=x(p),U=y[0];return!F&&U&&pt(U.value)&&pt(U.label)?[]:y.map(function(E){var m;return A(A({},E),{},{label:(m=E.label)!==null&&m!==void 0?m:E.value})})},[k,F,pe,X,x,q,L]),_t=Bt(Kt),Tt=B(_t,1),at=Tt[0],ft=r.useMemo(function(){return F&&(q==="SHOW_CHILD"||_||!R)?Q:null},[Q,F,_,q,R]),Qe=gt(function(f,d,p){var y=yt(f,q,L,k);if(!(ft&&y.length>ft)){var U=x(f);if(rt(U),N&&he(""),a){var E=f;ue&&(E=y.map(function(J){var ee=O.get(J);return ee?ee.node[k.value]:J}));var m=d||{triggerValue:void 0,selected:void 0},C=m.triggerValue,H=m.selected,Z=E;if(_){var De=qe.filter(function(J){return!E.includes(J.value)});Z=[].concat(te(Z),te(De))}var we=x(Z),oe={preValue:X,triggerValue:C},ge=!0;(_||p==="selection"&&!H)&&(ge=!1),Xt(oe,C,f,$,ge,k),ve?oe.checked=H:oe.selected=H;var Xe=xe?we:we.map(function(J){return J.value});a(F?Xe:Xe[0],xe?null:we.map(function(J){return J.label}),oe)}}}),lt=r.useCallback(function(f,d){var p,y=d.selected,U=d.source,E=L[f],m=E==null?void 0:E.node,C=(p=m==null?void 0:m[k.value])!==null&&p!==void 0?p:f;if(!F)Qe([C],{selected:!0,triggerValue:C},"option");else{var H=y?[].concat(te(dt),[C]):pe.filter(function(ee){return ee!==C});if(ue){var Z=h(H),De=Z.missingRawValues,we=Z.existRawValues,oe=we.map(function(ee){return O.get(ee).key}),ge;if(y){var Xe=it(oe,!0,L);ge=Xe.checkedKeys}else{var J=it(oe,{checked:!1,halfCheckedKeys:ze},L);ge=J.checkedKeys}H=[].concat(te(De),te(ge.map(function(ee){return L[ee].node[k.value]})))}Qe(H,{selected:y,triggerValue:C},U||"option")}y||!F?u==null||u(C,ot(m)):g==null||g(C,ot(m))},[h,O,L,k,F,dt,Qe,ue,u,g,pe,ze,Q]),Mt=r.useCallback(function(f){if(ie){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return Ze(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ie(f,d)}},[ie]),Lt=gt(function(f,d){var p=f.map(function(y){return y.value});if(d.type==="clear"){Qe(p,{},"selection");return}d.values.length&&lt(d.values[0].value,{selected:!1,source:"selection"})}),Nt=r.useMemo(function(){return{virtual:Oe,dropdownMatchSelectWidth:de,listHeight:Ce,listItemHeight:Ae,listItemScrollOffset:le,treeData:s,fieldNames:k,onSelect:lt,treeExpandAction:Ve,treeTitleRender:Y,onPopupScroll:be,leftMaxCount:Q===void 0?null:Q-at.length,leafCountOnly:q==="SHOW_CHILD"&&!_&&!!R,valueEntities:O}},[Oe,de,Ce,Ae,le,s,k,lt,Ve,Y,be,Q,at.length,q,_,R,O]),Vt=r.useMemo(function(){return{checkable:ve,loadData:ae,treeLoadedKeys:_e,onTreeLoad:Te,checkedKeys:pe,halfCheckedKeys:ze,treeDefaultExpandAll:me,treeExpandedKeys:Me,treeDefaultExpandedKeys:Le,onTreeExpand:Ne,treeIcon:$e,treeMotion:We,showTreeIcon:Se,switcherIcon:fe,treeLine:se,treeNodeFilterProp:j,keyEntities:L}},[ve,ae,_e,Te,pe,ze,me,Me,Le,Ne,$e,We,Se,fe,se,j,L]);return r.createElement(kt.Provider,{value:Nt},r.createElement(Et.Provider,{value:Vt},r.createElement(Ft,St({ref:t},je,{id:Ue,prefixCls:o,mode:F?"multiple":void 0,displayValues:at,onDisplayValuesChange:Lt,searchValue:ke,onSearch:Ge,OptionList:ar,emptyOptions:!$.length,onDropdownVisibleChange:Mt,dropdownMatchSelectWidth:de}))))}),et=ur;et.TreeNode=bt;et.SHOW_ALL=Dt;et.SHOW_PARENT=wt;et.SHOW_CHILD=ct;export{et as G,Dt as S,bt as T,wt as a,ct as b};
//# sourceMappingURL=TreeSelect-54a254f8.js.map
