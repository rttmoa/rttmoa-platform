{"version":3,"file":"index-6ba4fa2b.js","sources":["../../../node_modules/@react-three/drei/core/PointMaterial.js","../../../node_modules/@react-three/drei/core/Points.js","../../../src/views/feat/three/index.tsx"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport { version } from '../helpers/constants.js';\n\nconst opaque_fragment = version >= 154 ? 'opaque_fragment' : 'output_fragment';\nclass PointMaterialImpl extends THREE.PointsMaterial {\n  constructor(props) {\n    super(props);\n    this.onBeforeCompile = (shader, renderer) => {\n      const {\n        isWebGL2\n      } = renderer.capabilities;\n      shader.fragmentShader = shader.fragmentShader.replace(`#include <${opaque_fragment}>`, `\n        ${!isWebGL2 ? `#extension GL_OES_standard_derivatives : enable\\n#include <${opaque_fragment}>` : `#include <${opaque_fragment}>`}\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      #include <tonemapping_fragment>\n      #include <${version >= 154 ? 'colorspace_fragment' : 'encodings_fragment'}>\n      `);\n    };\n  }\n}\nconst PointMaterial = /* @__PURE__ */React.forwardRef((props, ref) => {\n  const [material] = React.useState(() => new PointMaterialImpl(null));\n  return /*#__PURE__*/React.createElement(\"primitive\", _extends({}, props, {\n    object: material,\n    ref: ref,\n    attach: \"material\"\n  }));\n});\n\nexport { PointMaterial, PointMaterialImpl };\n","import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport { extend, useFrame } from '@react-three/fiber';\nimport mergeRefs from 'react-merge-refs';\n\nconst _inverseMatrix = /* @__PURE__ */new THREE.Matrix4();\nconst _ray = /* @__PURE__ */new THREE.Ray();\nconst _sphere = /* @__PURE__ */new THREE.Sphere();\nconst _position = /* @__PURE__ */new THREE.Vector3();\nclass PositionPoint extends THREE.Group {\n  constructor() {\n    super();\n    this.size = 0;\n    this.color = new THREE.Color('white');\n    this.instance = {\n      current: undefined\n    };\n    this.instanceKey = {\n      current: undefined\n    };\n  }\n\n  // This will allow the virtual instance have bounds\n  get geometry() {\n    var _this$instance$curren;\n    return (_this$instance$curren = this.instance.current) == null ? void 0 : _this$instance$curren.geometry;\n  }\n  raycast(raycaster, intersects) {\n    var _raycaster$params$Poi, _raycaster$params$Poi2;\n    const parent = this.instance.current;\n    if (!parent || !parent.geometry) return;\n    const instanceId = parent.userData.instances.indexOf(this.instanceKey);\n    // If the instance wasn't found or exceeds the parents draw range, bail out\n    if (instanceId === -1 || instanceId > parent.geometry.drawRange.count) return;\n    const threshold = (_raycaster$params$Poi = (_raycaster$params$Poi2 = raycaster.params.Points) == null ? void 0 : _raycaster$params$Poi2.threshold) !== null && _raycaster$params$Poi !== void 0 ? _raycaster$params$Poi : 1;\n    _sphere.set(this.getWorldPosition(_position), threshold);\n    if (raycaster.ray.intersectsSphere(_sphere) === false) return;\n    _inverseMatrix.copy(parent.matrixWorld).invert();\n    _ray.copy(raycaster.ray).applyMatrix4(_inverseMatrix);\n    const localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\n    const localThresholdSq = localThreshold * localThreshold;\n    const rayPointDistanceSq = _ray.distanceSqToPoint(this.position);\n    if (rayPointDistanceSq < localThresholdSq) {\n      const intersectPoint = new THREE.Vector3();\n      _ray.closestPointToPoint(this.position, intersectPoint);\n      intersectPoint.applyMatrix4(this.matrixWorld);\n      const distance = raycaster.ray.origin.distanceTo(intersectPoint);\n      if (distance < raycaster.near || distance > raycaster.far) return;\n      intersects.push({\n        distance: distance,\n        distanceToRay: Math.sqrt(rayPointDistanceSq),\n        point: intersectPoint,\n        index: instanceId,\n        face: null,\n        object: this\n      });\n    }\n  }\n}\nlet i, positionRef;\nconst context = /* @__PURE__ */React.createContext(null);\nconst parentMatrix = /* @__PURE__ */new THREE.Matrix4();\nconst position = /* @__PURE__ */new THREE.Vector3();\n\n/**\n * Instance implementation, relies on react + context to update the attributes based on the children of this component\n */\nconst PointsInstances = /* @__PURE__ */React.forwardRef(({\n  children,\n  range,\n  limit = 1000,\n  ...props\n}, ref) => {\n  const parentRef = React.useRef(null);\n  const [refs, setRefs] = React.useState([]);\n  const [[positions, colors, sizes]] = React.useState(() => [new Float32Array(limit * 3), Float32Array.from({\n    length: limit * 3\n  }, () => 1), Float32Array.from({\n    length: limit\n  }, () => 1)]);\n  React.useEffect(() => {\n    // We might be a frame too late? 🤷‍♂️\n    parentRef.current.geometry.attributes.position.needsUpdate = true;\n  });\n  useFrame(() => {\n    parentRef.current.updateMatrix();\n    parentRef.current.updateMatrixWorld();\n    parentMatrix.copy(parentRef.current.matrixWorld).invert();\n    parentRef.current.geometry.drawRange.count = Math.min(limit, range !== undefined ? range : limit, refs.length);\n    for (i = 0; i < refs.length; i++) {\n      positionRef = refs[i].current;\n      positionRef.getWorldPosition(position).applyMatrix4(parentMatrix);\n      position.toArray(positions, i * 3);\n      parentRef.current.geometry.attributes.position.needsUpdate = true;\n      positionRef.matrixWorldNeedsUpdate = true;\n      positionRef.color.toArray(colors, i * 3);\n      parentRef.current.geometry.attributes.color.needsUpdate = true;\n      sizes.set([positionRef.size], i);\n      parentRef.current.geometry.attributes.size.needsUpdate = true;\n    }\n  });\n  const api = React.useMemo(() => ({\n    getParent: () => parentRef,\n    subscribe: ref => {\n      setRefs(refs => [...refs, ref]);\n      return () => setRefs(refs => refs.filter(item => item.current !== ref.current));\n    }\n  }), []);\n  return /*#__PURE__*/React.createElement(\"points\", _extends({\n    userData: {\n      instances: refs\n    },\n    matrixAutoUpdate: false,\n    ref: mergeRefs([ref, parentRef]),\n    raycast: () => null\n  }, props), /*#__PURE__*/React.createElement(\"bufferGeometry\", null, /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-position\",\n    count: positions.length / 3,\n    array: positions,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-color\",\n    count: colors.length / 3,\n    array: colors,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-size\",\n    count: sizes.length,\n    array: sizes,\n    itemSize: 1,\n    usage: THREE.DynamicDrawUsage\n  })), /*#__PURE__*/React.createElement(context.Provider, {\n    value: api\n  }, children));\n});\nconst Point = /* @__PURE__ */React.forwardRef(({\n  children,\n  ...props\n}, ref) => {\n  React.useMemo(() => extend({\n    PositionPoint\n  }), []);\n  const group = React.useRef();\n  const {\n    subscribe,\n    getParent\n  } = React.useContext(context);\n  React.useLayoutEffect(() => subscribe(group), []);\n  return /*#__PURE__*/React.createElement(\"positionPoint\", _extends({\n    instance: getParent(),\n    instanceKey: group,\n    ref: mergeRefs([ref, group])\n  }, props), children);\n});\n\n/**\n * Buffer implementation, relies on complete buffers of the correct number, leaves it to the user to update them\n */\n\nconst PointsBuffer = /* @__PURE__ */React.forwardRef(({\n  children,\n  positions,\n  colors,\n  sizes,\n  stride = 3,\n  ...props\n}, forwardedRef) => {\n  const pointsRef = React.useRef(null);\n  useFrame(() => {\n    const attr = pointsRef.current.geometry.attributes;\n    attr.position.needsUpdate = true;\n    if (colors) attr.color.needsUpdate = true;\n    if (sizes) attr.size.needsUpdate = true;\n  });\n  return /*#__PURE__*/React.createElement(\"points\", _extends({\n    ref: mergeRefs([forwardedRef, pointsRef])\n  }, props), /*#__PURE__*/React.createElement(\"bufferGeometry\", null, /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-position\",\n    count: positions.length / stride,\n    array: positions,\n    itemSize: stride,\n    usage: THREE.DynamicDrawUsage\n  }), colors && /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-color\",\n    count: colors.length / stride,\n    array: colors,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), sizes && /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-size\",\n    count: sizes.length / stride,\n    array: sizes,\n    itemSize: 1,\n    usage: THREE.DynamicDrawUsage\n  })), children);\n});\nconst Points = /* @__PURE__ */React.forwardRef((props, forwardedRef) => {\n  if (props.positions instanceof Float32Array) {\n    return /*#__PURE__*/React.createElement(PointsBuffer, _extends({}, props, {\n      ref: forwardedRef\n    }));\n  } else return /*#__PURE__*/React.createElement(PointsInstances, _extends({}, props, {\n    ref: forwardedRef\n  }));\n});\n\nexport { Point, Points, PointsBuffer, PositionPoint };\n","import React, { useRef, useState } from 'react';\r\nimport { Canvas, useFrame } from '@react-three/fiber';\r\nimport { Points, PointMaterial } from '@react-three/drei';\r\nimport * as random from 'maath/random/dist/maath-random.cjs';\r\nimport './index.less';\r\n\r\nexport default function Threejs() {\r\n\treturn (\r\n\t\t<div className='root'>\r\n\t\t\t<h2 className='title'>React Three Fiber</h2>\r\n\t\t\t<Canvas camera={{ position: [0, 0, 1] }}>\r\n\t\t\t\t<Stars />\r\n\t\t\t</Canvas>\r\n\t\t</div>\r\n\t);\r\n}\r\n// 替代 maath 的 inSphere\r\nfunction inSphere(array: Float32Array, radius: number = 1.0): Float32Array {\r\n\tlet i = 0;\r\n\twhile (i < array.length) {\r\n\t\tlet x = Math.random() * 2 - 1;\r\n\t\tlet y = Math.random() * 2 - 1;\r\n\t\tlet z = Math.random() * 2 - 1;\r\n\t\tif (x * x + y * y + z * z <= 1) {\r\n\t\t\tarray[i++] = x * radius;\r\n\t\t\tarray[i++] = y * radius;\r\n\t\t\tarray[i++] = z * radius;\r\n\t\t}\r\n\t}\r\n\treturn array;\r\n}\r\nfunction Stars(props: any) {\r\n\t// const ref: any = useRef(null); // Error\r\n\tconst ref: any = useRef({ rotation: { x: 0, y: 0, z: 0 } });\r\n\tconst [sphere] = useState(() => inSphere(new Float32Array(5000), 1.5));\r\n\tuseFrame((state: any, delta: number) => {\r\n\t\tref.current.rotation.x -= delta / 10;\r\n\t\tref.current.rotation.y -= delta / 15;\r\n\t\tref.current.rotation.z -= 0;\r\n\t});\r\n\treturn (\r\n\t\t<group>\r\n\t\t\t<Points ref={ref} positions={sphere} stride={3} frustumCulled={false} {...props}>\r\n\t\t\t\t<PointMaterial transparent color='#ffa0e0' size={0.005} sizeAttenuation={true} depthWrite={false} />\r\n\t\t\t</Points>\r\n\t\t</group>\r\n\t);\r\n}\r\n"],"names":["opaque_fragment","version","PointMaterialImpl","THREE.PointsMaterial","props","shader","renderer","isWebGL2","PointMaterial","React.forwardRef","ref","material","React.useState","React.createElement","_extends","i","positionRef","context","React.createContext","parentMatrix","THREE.Matrix4","position","THREE.Vector3","PointsInstances","children","range","limit","parentRef","React.useRef","refs","setRefs","positions","colors","sizes","React.useEffect","useFrame","api","React.useMemo","item","mergeRefs","THREE.DynamicDrawUsage","PointsBuffer","stride","forwardedRef","pointsRef","attr","Points","Threejs","jsxs","jsx","Canvas","Stars","inSphere","array","radius","x","y","z","useRef","sphere","useState","state","delta"],"mappings":"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","x_google_ignoreList":[0,1]}