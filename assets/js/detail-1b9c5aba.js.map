{"version":3,"file":"detail-1b9c5aba.js","sources":["../../../src/views/module/product/detail.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Form, Card, Input, Button, message, Upload, UploadFile, FormInstance } from \"antd\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { UploadChangeParam } from \"antd/es/upload\";\nimport defaultImg from \"@/assets/images/defaultImg.jpg\";\nimport { productList } from \"@/api/modules/module/product\";\nimport BraftEditorText from \"./component/braftEditorText\";\n// import RichBraftEditor from \"./component/rich-text-editor\";\nimport PicturesWall from \"./component/pictures-wall\";\n\nconst serverUrl = \"http://localhost:3009\";\n\nconst Edit = () => {\n\tconst navigate = useNavigate();\n\tconst location = useLocation();\n\tconst id = location.search.split(\"=\")[1];\n\n\t// const [id, setId] = useState(\"\")\n\tconst [product, setproduct] = useState<any>({}); // 产品信息\n\tconst [imageUrl, setImageUrl] = useState<any>([]);\n\tconst [loading, setLoading] = useState(false);\n\n\t// 初始化的时候执行\n\tuseEffect(() => {\n\t\tif (id) {\n\t\t\tproductList(1, 5).then((res: any) => {\n\t\t\t\tconst result = res.data.list.filter((value: any) => value._id === id);\n\t\t\t\tconsole.log(result);\n\t\t\t\tsetproduct(result[0]);\n\t\t\t\tsetImageUrl([result[0].coverImg]);\n\t\t\t});\n\t\t}\n\t}, []);\n\tconsole.log(imageUrl);\n\t// 图片上传\n\tconst handleChange = (info: UploadChangeParam<UploadFile<any>>) => {\n\t\t// console.log(info);return;\n\t\tif (info.file.status === \"uploading\") {\n\t\t\tsetLoading(true);\n\t\t\treturn;\n\t\t}\n\t\tif (info.file.status === \"done\") {\n\t\t\t// 上传成功\n\t\t\t// Get this url from response in real world.\n\t\t\tsetLoading(false);\n\t\t\t// console.log(info);\n\t\t\tsetImageUrl(info.file.response.info);\n\t\t}\n\t};\n\n\tconst onFinish = (values: any) => {\n\t\t// editorState.toHTML()获取当前富文本的内容\n\t\t// console.log(editorState.toHTML());\n\t\tconsole.log(values); // {name: 'zhangsan', price: '444'}\n\n\t\t// e.preventDefault()\n\t\t// props.form.validateFieldsAndScroll((err, values) => {}\n\n\t\t// ? 判断是编辑 还是新建，做对应的操作\n\t\t// if (id) {\n\t\t//   modifyOne(id, {\n\t\t//     ...values,\n\t\t//     coverImg: imageUrl,\n\t\t//     content: editorState.toHTML()\n\t\t//   });\n\t\t// } else {\n\t\t//   createApi({\n\t\t//     ...values,\n\t\t//     coverImg: imageUrl,\n\t\t//     content: editorState.toHTML()\n\t\t//   })\n\t\t//     .then(res => {\n\t\t//       navigate(\"/list/curd/product\");\n\t\t//       setCurrentData({});\n\t\t//       setImageUrl(\"\");\n\t\t//       setLoading(false);\n\t\t//       setEditorState(\"\");\n\t\t//     })\n\t\t//     .catch(err => { console.log(err); });\n\t\t// }\n\t};\n\n\tif (id) {\n\t\tif (JSON.stringify(product) === \"{}\") return;\n\t}\n\tconst layout = {\n\t\tlabelCol: { span: 2 },\n\t\twrapperCol: { span: 12 }\n\t};\n\treturn (\n\t\t<Card\n\t\t\ttitle={id ? \"商品编辑\" : \"商品添加\"}\n\t\t\textra={\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tnavigate(\"/module/product\");\n\t\t\t\t\t}}>\n\t\t\t\t\t返回\n\t\t\t\t</Button>\n\t\t\t}>\n\t\t\t<Form\n\t\t\t\t{...layout}\n\t\t\t\tname=\"control-hooks\"\n\t\t\t\tonFinish={onFinish}\n\t\t\t\tinitialValues={{\n\t\t\t\t\tname: product.name,\n\t\t\t\t\tprice: product.price,\n\t\t\t\t\tdesc: product.desc\n\t\t\t\t}}>\n\t\t\t\t<Form.Item name=\"name\" label=\"商品名字\" rules={[{ required: true, message: \"请输入商品名字\" }]}>\n\t\t\t\t\t<Input placeholder=\"请输入商品名字\" />\n\t\t\t\t</Form.Item>\n\t\t\t\t<Form.Item name=\"desc\" label=\"商品描述\" rules={[{ required: true, message: \"请输入商品描述信息\" }]}>\n\t\t\t\t\t<Input.TextArea placeholder=\"请输入商品描述信息\" />\n\t\t\t\t</Form.Item>\n\t\t\t\t<Form.Item\n\t\t\t\t\tname=\"price\"\n\t\t\t\t\tlabel=\"商品价格\"\n\t\t\t\t\trules={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tmessage: \"请输入商品价格\",\n\t\t\t\t\t\t\tvalidator(rule, value, callback) {\n\t\t\t\t\t\t\t\tconsole.log(value, typeof value);\n\t\t\t\t\t\t\t\tvalue * 1 > 0 ? callback() : callback(\"商品价格必须大于 0\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}>\n\t\t\t\t\t<Input placeholder=\"请输入商品价格\" addonAfter=\"元\" />\n\t\t\t\t</Form.Item>\n\n\t\t\t\t<Form.Item label=\"商品图片\">\n\t\t\t\t\t<PicturesWall images={imageUrl} ref={null} />\n\t\t\t\t</Form.Item>\n\n\t\t\t\t<Form.Item label=\"商品详情: \" name=\"detail\">\n\t\t\t\t\t{/* <BraftEditorText /> */}\n\t\t\t\t\t{/* <RichBraftEditor detail=\"初值\" ref={null} /> */}\n\t\t\t\t</Form.Item>\n\t\t\t\t<Form.Item wrapperCol={{ offset: 2 }}>\n\t\t\t\t\t<Button htmlType=\"submit\" type=\"primary\">\n\t\t\t\t\t\t保存\n\t\t\t\t\t</Button>\n\t\t\t\t</Form.Item>\n\t\t\t</Form>\n\t\t</Card>\n\t);\n};\nexport default Edit;\n"],"names":["Edit","navigate","useNavigate","id","useLocation","product","setproduct","useState","imageUrl","setImageUrl","useEffect","productList","res","result","value","onFinish","values","layout","jsx","Card","Button","jsxs","Form","Input","rule","callback","PicturesWall"],"mappings":"+OAYA,MAAMA,EAAO,IAAM,CAClB,MAAMC,EAAWC,IAEXC,EADWC,IACG,OAAO,MAAM,GAAG,EAAE,CAAC,EAGjC,CAACC,EAASC,CAAU,EAAIC,EAAA,SAAc,CAAE,CAAA,EACxC,CAACC,EAAUC,CAAW,EAAIF,EAAA,SAAc,CAAE,CAAA,EAClBA,EAAAA,SAAS,EAAK,EAG5CG,EAAAA,UAAU,IAAM,CACXP,GACHQ,EAAY,EAAG,CAAC,EAAE,KAAMC,GAAa,CAC9B,MAAAC,EAASD,EAAI,KAAK,KAAK,OAAQE,GAAeA,EAAM,MAAQX,CAAE,EAEzDG,EAAAO,EAAO,CAAC,CAAC,EACpBJ,EAAY,CAACI,EAAO,CAAC,EAAE,QAAQ,CAAC,CAAA,CAChC,CAEH,EAAG,CAAE,CAAA,EAkBC,MAAAE,EAAYC,GAAgB,CAGf,EA6BnB,GAAIb,GACC,KAAK,UAAUE,CAAO,IAAM,KAAM,OAEvC,MAAMY,EAAS,CACd,SAAU,CAAE,KAAM,CAAE,EACpB,WAAY,CAAE,KAAM,EAAG,CAAA,EAGvB,OAAAC,EAAA,IAACC,EAAA,CACA,MAAOhB,EAAK,OAAS,OACrB,MACCe,EAAA,IAACE,EAAA,CACA,QAAS,IAAM,CACdnB,EAAS,iBAAiB,CAC3B,EAAG,SAAA,IAAA,CAEJ,EAED,SAAAoB,EAAA,KAACC,EAAA,CACC,GAAGL,EACJ,KAAK,gBACL,SAAAF,EACA,cAAe,CACd,KAAMV,EAAQ,KACd,MAAOA,EAAQ,MACf,KAAMA,EAAQ,IACf,EACA,SAAA,CAACa,MAAAI,EAAK,KAAL,CAAU,KAAK,OAAO,MAAM,OAAO,MAAO,CAAC,CAAE,SAAU,GAAM,QAAS,UAAW,EACjF,eAACC,EAAM,CAAA,YAAY,SAAU,CAAA,EAC9B,EACAL,EAAAA,IAACI,EAAK,KAAL,CAAU,KAAK,OAAO,MAAM,OAAO,MAAO,CAAC,CAAE,SAAU,GAAM,QAAS,WAAa,CAAA,EACnF,SAAAJ,MAACK,EAAM,SAAN,CAAe,YAAY,WAAY,CAAA,EACzC,EACAL,EAAA,IAACI,EAAK,KAAL,CACA,KAAK,QACL,MAAM,OACN,MAAO,CACN,CACC,SAAU,GACV,QAAS,UACT,UAAUE,EAAMV,EAAOW,EAAU,CAEhCX,EAAQ,EAAI,EAAIW,EAAS,EAAIA,EAAS,YAAY,CACnD,CACD,CACD,EACA,SAACP,EAAA,IAAAK,EAAA,CAAM,YAAY,UAAU,WAAW,IAAI,CAAA,CAC7C,EAECL,EAAA,IAAAI,EAAK,KAAL,CAAU,MAAM,OAChB,SAACJ,EAAAA,IAAAQ,EAAA,CAAa,OAAQlB,EAAU,IAAK,IAAA,CAAM,CAC5C,CAAA,QAECc,EAAK,KAAL,CAAU,MAAM,SAAS,KAAK,SAG/B,QACCA,EAAK,KAAL,CAAU,WAAY,CAAE,OAAQ,CAChC,EAAA,SAAAJ,EAAAA,IAACE,GAAO,SAAS,SAAS,KAAK,UAAU,aAEzC,CAAA,EACD,CAAA,CAAA,CACD,CAAA,CAAA,CAGH"}