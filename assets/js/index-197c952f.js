import{r as s,aD as i,aC as le,bY as Me,j as a,z as ke,br as ce,bs as E,bj as Q,aq as me,d as L,bZ as De,aE as Y,aF as we,bX as ae,B as Z,bW as Ae,G as ie,a7 as Ie,R as J,C as W,b_ as _e}from"./index-4c9f8422.js";import{a as $e,P as Be,u as We}from"./index-83355eff.js";import{B as Ee,c as Le,u as K,m as Ne}from"./BaseForm-e35f517b.js";import{S as ue}from"./index-39ba02ec.js";var ze=["onFinish","step","formRef","title","stepProps"];function Te(o){var c=s.useRef(),r=s.useContext(fe),f=s.useContext(de),p=i(i({},o),f),P=p.onFinish,x=p.step,t=p.formRef;p.title,p.stepProps;var d=le(p,ze);return Me(!d.submitter,"StepForm 不包含提交按钮，请在 StepsForm 上"),s.useImperativeHandle(t,function(){return c.current},[t==null?void 0:t.current]),s.useEffect(function(){if(p.name||p.step){var R=(p.name||p.step).toString();return r==null||r.regForm(R,p),function(){r==null||r.unRegForm(R)}}},[]),r&&r!==null&&r!==void 0&&r.formArrayRef&&(r.formArrayRef.current[x||0]=c),a.jsx(Ee,i({formRef:c,onFinish:function(){var R=ce(E().mark(function b(h){var S;return E().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(d.name&&(r==null||r.onFormFinish(d.name,h)),!P){F.next=9;break}return r==null||r.setLoading(!0),F.next=5,P==null?void 0:P(h);case 5:return S=F.sent,S&&(r==null||r.next()),r==null||r.setLoading(!1),F.abrupt("return");case 9:r!=null&&r.lastStep||r==null||r.next();case 10:case"end":return F.stop()}},b)}));return function(b){return R.apply(this,arguments)}}(),onInit:function(b,h){var S;c.current=h,r&&r!==null&&r!==void 0&&r.formArrayRef&&(r.formArrayRef.current[x||0]=c),d==null||(S=d.onInit)===null||S===void 0||S.call(d,b,h)},layout:"vertical"},ke(d,["layoutType","columns"])))}var He=function(c){return Q({},c.componentCls,{"&-container":{width:"max-content",minWidth:"420px",maxWidth:"100%",margin:"auto"},"&-steps-container":Q({maxWidth:"1160px",margin:"auto"},"".concat(c.antCls,"-steps-vertical"),{height:"100%"}),"&-step":{display:"none",marginBlockStart:"32px","&-active":{display:"block"},"> form":{maxWidth:"100%"}}})};function Ge(o){return $e("StepsForm",function(c){var r=i(i({},c),{},{componentCls:".".concat(o)});return[He(r)]})}var Ve=["current","onCurrentChange","submitter","stepsFormRender","stepsRender","stepFormRender","stepsProps","onFinish","formProps","containerStyle","formRef","formMapRef","layoutRender"],fe=L.createContext(void 0),qe={horizontal:function(c){var r=c.stepsDom,f=c.formDom;return a.jsxs(a.Fragment,{children:[a.jsx(J,{gutter:{xs:8,sm:16,md:24},children:a.jsx(W,{span:24,children:r})}),a.jsx(J,{gutter:{xs:8,sm:16,md:24},children:a.jsx(W,{span:24,children:f})})]})},vertical:function(c){var r=c.stepsDom,f=c.formDom;return a.jsxs(J,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24},children:[a.jsx(W,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12,children:L.cloneElement(r,{style:{height:"100%"}})}),a.jsx(W,{children:a.jsx("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"},children:f})})]})}},de=L.createContext(null);function Oe(o){var c=s.useContext(De.ConfigContext),r=c.getPrefixCls,f=r("pro-steps-form"),p=Ge(f),P=p.wrapSSR,x=p.hashId;o.current,o.onCurrentChange;var t=o.submitter,d=o.stepsFormRender,R=o.stepsRender,b=o.stepFormRender,h=o.stepsProps,S=o.onFinish,N=o.formProps,F=o.containerStyle,pe=o.formRef,he=o.formMapRef,k=o.layoutRender,ge=le(o,Ve),z=s.useRef(new Map),C=s.useRef(new Map),y=s.useRef([]),xe=s.useState([]),U=Y(xe,2),g=U[0],ee=U[1],Se=s.useState(!1),re=Y(Se,2),D=re[0],I=re[1],j=We(),Fe=we(0,{value:o.current,onChange:o.onCurrentChange}),te=Y(Fe,2),m=te[0],_=te[1],T=s.useMemo(function(){return qe[(h==null?void 0:h.direction)||"horizontal"]},[h==null?void 0:h.direction]),H=s.useMemo(function(){return m===g.length-1},[g.length,m]),Re=s.useCallback(function(e,n){C.current.has(e)||ee(function(l){return[].concat(ae(l),[e])}),C.current.set(e,n)},[]),ye=s.useCallback(function(e){ee(function(n){return n.filter(function(l){return l!==e})}),C.current.delete(e),z.current.delete(e)},[]);s.useImperativeHandle(he,function(){return y.current},[y.current]),s.useImperativeHandle(pe,function(){var e;return(e=y.current[m||0])===null||e===void 0?void 0:e.current},[m,y.current]);var be=s.useCallback(function(){var e=ce(E().mark(function n(l,u){var A,B;return E().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(z.current.set(l,u),!(!H||!S)){v.next=3;break}return v.abrupt("return");case 3:return I(!0),A=Ne.apply(void 0,[{}].concat(ae(Array.from(z.current.values())))),v.prev=5,v.next=8,S(A);case 8:B=v.sent,B&&(_(0),y.current.forEach(function(je){var X;return(X=je.current)===null||X===void 0?void 0:X.resetFields()})),v.next=15;break;case 12:v.prev=12,v.t0=v.catch(5),v.t0;case 15:return v.prev=15,I(!1),v.finish(15);case 18:case"end":return v.stop()}},n,null,[[5,12,15,18]])}));return function(n,l){return e.apply(this,arguments)}}(),[H,S,I,_]),G=s.useMemo(function(){var e=Le(_e,"4.24.0")>-1,n=e?{items:g.map(function(l){var u=C.current.get(l);return i({key:l,title:u==null?void 0:u.title},u==null?void 0:u.stepProps)})}:{};return a.jsx("div",{className:"".concat(f,"-steps-container ").concat(x).trim(),style:{maxWidth:Math.min(g.length*320,1160)},children:a.jsx(ue,i(i(i({},h),n),{},{current:m,onChange:void 0,children:!e&&g.map(function(l){var u=C.current.get(l);return a.jsx(ue.Step,i({title:u==null?void 0:u.title},u==null?void 0:u.stepProps),l)})}))})},[g,x,f,m,h]),M=K(function(){var e,n=y.current[m];(e=n.current)===null||e===void 0||e.submit()}),$=K(function(){m<1||_(m-1)}),V=s.useMemo(function(){return t!==!1&&a.jsx(Z,i(i({type:"primary",loading:D},t==null?void 0:t.submitButtonProps),{},{onClick:function(){var n;t==null||(n=t.onSubmit)===null||n===void 0||n.call(t),M()},children:j.getMessage("stepsForm.next","下一步")}),"next")},[j,D,M,t]),q=s.useMemo(function(){return t!==!1&&a.jsx(Z,i(i({},t==null?void 0:t.resetButtonProps),{},{onClick:function(){var n;$(),t==null||(n=t.onReset)===null||n===void 0||n.call(t)},children:j.getMessage("stepsForm.prev","上一步")}),"pre")},[j,$,t]),O=s.useMemo(function(){return t!==!1&&a.jsx(Z,i(i({type:"primary",loading:D},t==null?void 0:t.submitButtonProps),{},{onClick:function(){var n;t==null||(n=t.onSubmit)===null||n===void 0||n.call(t),M()},children:j.getMessage("stepsForm.submit","提交")}),"submit")},[j,D,M,t]),Ce=K(function(){m>g.length-2||_(m+1)}),w=s.useMemo(function(){var e=[],n=m||0;if(n<1?g.length===1?e.push(O):e.push(V):n+1===g.length?e.push(q,O):e.push(q,V),e=e.filter(L.isValidElement),t&&t.render){var l,u={form:(l=y.current[m])===null||l===void 0?void 0:l.current,onSubmit:M,step:m,onPre:$};return t.render(u,e)}return t&&(t==null?void 0:t.render)===!1?null:e},[g.length,V,M,q,$,m,O,t]),ne=s.useMemo(function(){return Ae(o.children).map(function(e,n){var l=e.props,u=l.name||"".concat(n),A=m===n,B=A?{contentRender:b,submitter:!1}:{};return a.jsx("div",{className:ie("".concat(f,"-step"),x,Q({},"".concat(f,"-step-active"),A)),children:a.jsx(de.Provider,{value:i(i(i(i({},B),N),l),{},{name:u,step:n}),children:e})},u)})},[N,x,f,o.children,m,b]),oe=s.useMemo(function(){return R?R(g.map(function(e){var n;return{key:e,title:(n=C.current.get(e))===null||n===void 0?void 0:n.title}}),G):G},[g,G,R]),se=s.useMemo(function(){return a.jsxs("div",{className:"".concat(f,"-container ").concat(x).trim(),style:F,children:[ne,d?null:a.jsx(Ie,{children:w})]})},[F,ne,x,f,d,w]),Pe=s.useMemo(function(){var e={stepsDom:oe,formDom:se};return d?d(k?k(e):T(e),w):k?k(e):T(e)},[oe,se,T,d,w,k]);return P(a.jsx("div",{className:ie(f,x),children:a.jsx(me.Provider,i(i({},ge),{},{children:a.jsx(fe.Provider,{value:{loading:D,setLoading:I,regForm:Re,keyArray:g,next:Ce,formArrayRef:y,formMapRef:C,lastStep:H,unRegForm:ye,onFormFinish:be},children:Pe})}))}))}function ve(o){return a.jsx(Be,{needDeps:!0,children:a.jsx(Oe,i({},o))})}ve.StepForm=Te;ve.useForm=me.useForm;export{ve as S};
//# sourceMappingURL=index-197c952f.js.map
