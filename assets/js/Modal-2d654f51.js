import{r as b,b6 as O,j as e,aa as P,B as F,ax as o,R as z,C as c,ak as K,ay as E,aA as D,b4 as U}from"./index-113fc74b.js";import{C as g}from"./index-0e665a55.js";import{T as G}from"./index-e9919bb2.js";import"./index-c0237b1c.js";import"./index-b96fcc2a.js";import"./useBubbleLock-1d80bc36.js";import"./Tree-3563fbcf.js";import"./List-8daded26.js";import"./conductUtil-ec1c0eb4.js";import"./iconUtil-1cf5f036.js";const re=S=>{const{form:p,modalIsVisible:T,setModalIsVisible:A,modalTitle:q,modalType:a,modalUserInfo:t,handleModalSubmit:C}=S,[x,N]=b.useState([]),[L,u]=b.useState([]),[k,m]=b.useState([]);function w(s){return s.map(r=>{var i,l;const n={title:((i=r.meta)==null?void 0:i.title)||"",key:((l=r.meta)==null?void 0:l.key)||""};return Array.isArray(r.children)&&r.children.length>0&&(n.children=w(r.children)),n})}b.useEffect(()=>{O({}).then(s=>{N(w(s.data||[])),u([]),m(a=="create"?"":t.permission_menu),p.setFieldsValue({role_name:a=="create"?"":t.role_name,permission_str:a=="create"?"":t.permission_str,level:a=="create"?1:t.level,sort:a=="create"?1:t.sort,status:a=="create"?!1:t.status,desc:a=="create"?"":t.desc})})},[a,t]);const I=()=>{u([]),m([]),A(!1)},M=()=>{function s(l,f,j=[]){for(const d of l){const h=d.key,y=[...j,h];if(h===f)return y;if(d.children&&d.children.length>0){const _=s(d.children,f,y);if(_)return _}}return null}function r(l,f){const j=new Set;return f.forEach(d=>{const h=s(l,d);h&&h.forEach(y=>j.add(y))}),Array.from(j)}const n=r(x,k),i=p.getFieldsValue();a=="edit"&&(i._id=t._id),i.permission_menu=k,i.menuList=n,C&&C(a,i)},v=s=>{const r=[],n=i=>{i.forEach(l=>{r.push(l.key),l.children&&n(l.children)})};return n(s),r},V=s=>{if(s.target.checked){const n=v(x);u(n)}else u([])},R=s=>{if(s.target.checked){const n=v(x);m(n)}else m([])},B=()=>{p.submit()};return e.jsx(P,{className:"relative",title:q,width:600,open:T,onCancel:I,footer:[e.jsx(F,{danger:!0,loading:!1,onClick:I,children:"取消"}),e.jsx(F,{type:"primary",loading:!1,onClick:B,children:"提交"},"link")],children:e.jsx(o,{className:"mb-[60px] max-h-[600px] overflow-auto",layout:"horizontal",form:p,labelCol:{span:4},wrapperCol:{span:18},onFinish:M,children:e.jsxs(z,{gutter:16,children:[e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色名称",name:"role_name",rules:[{required:!0,message:"必填：角色名称"}],children:e.jsx(K,{placeholder:"请输入角色名称"})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"权限字符",name:"permission_str",rules:[{required:!0,message:"必填：权限字符"}],children:e.jsx(K,{placeholder:"请输入权限字符"})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色级别",name:"level",rules:[{required:!0,message:"必填：角色级别"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色顺序",name:"sort",rules:[{required:!0,message:"必填：角色顺序"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"状态",name:"status",rules:[{required:!1}],children:e.jsx(D,{})})}),e.jsx(c,{span:24,children:e.jsxs(o.Item,{label:"菜单分配",name:"permission_menu",rules:[{required:!1,message:"必填：菜单权限"}],children:[e.jsxs("div",{className:"mt-[6px] px-3 w-full flex justify-between",children:[e.jsx("div",{children:e.jsx(g,{onChange:V,children:"展开/折叠"})}),e.jsx("div",{children:e.jsx(g,{onChange:R,children:"全选/全不选"})}),e.jsx("div",{children:e.jsx(g,{defaultChecked:!0,onChange:()=>{},children:"父子联动"})})]}),e.jsx("div",{className:"mt-3 w-full p-3  border-[1px] rounded-lg",children:e.jsx(G,{checkStrictly:!1,showLine:!0,checkable:!0,treeData:x,checkedKeys:k,expandedKeys:L,onExpand:s=>{u(s)},onCheck:s=>{m(s)}})})]})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色描述",name:"desc",rules:[{required:!1}],children:e.jsx(U,{rows:3,placeholder:"请输入内容",maxLength:60})})})]})})})};export{re as default};
//# sourceMappingURL=Modal-2d654f51.js.map
