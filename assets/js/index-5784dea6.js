import{r as e,bk as p,j as c}from"./index-ce305ae4.js";import{P as v,v as z,u as y,m as M,D as f,M as w,V as j,C as P}from"./constants-13c91d7e.js";const x=z>=154?"opaque_fragment":"output_fragment";class F extends v{constructor(r){super(r),this.onBeforeCompile=(t,s)=>{const{isWebGL2:o}=s.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${x}>`,`
        ${o?`#include <${x}>`:`#extension GL_OES_standard_derivatives : enable
#include <${x}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${z>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const U=e.forwardRef((a,r)=>{const[t]=e.useState(()=>new F(null));return e.createElement("primitive",p({},a,{object:t,ref:r,attach:"material"}))});let u,d;const C=e.createContext(null),A=new w,S=new j,W=e.forwardRef(({children:a,range:r,limit:t=1e3,...s},o)=>{const n=e.useRef(null),[l,m]=e.useState([]),[[i,g,h]]=e.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);e.useEffect(()=>{n.current.geometry.attributes.position.needsUpdate=!0}),y(()=>{for(n.current.updateMatrix(),n.current.updateMatrixWorld(),A.copy(n.current.matrixWorld).invert(),n.current.geometry.drawRange.count=Math.min(t,r!==void 0?r:t,l.length),u=0;u<l.length;u++)d=l[u].current,d.getWorldPosition(S).applyMatrix4(A),S.toArray(i,u*3),n.current.geometry.attributes.position.needsUpdate=!0,d.matrixWorldNeedsUpdate=!0,d.color.toArray(g,u*3),n.current.geometry.attributes.color.needsUpdate=!0,h.set([d.size],u),n.current.geometry.attributes.size.needsUpdate=!0});const R=e.useMemo(()=>({getParent:()=>n,subscribe:E=>(m(b=>[...b,E]),()=>m(b=>b.filter(_=>_.current!==E.current)))}),[]);return e.createElement("points",p({userData:{instances:l},matrixAutoUpdate:!1,ref:M([o,n]),raycast:()=>null},s),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:i.length/3,array:i,itemSize:3,usage:f}),e.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:f}),e.createElement("bufferAttribute",{attach:"attributes-size",count:h.length,array:h,itemSize:1,usage:f})),e.createElement(C.Provider,{value:R},a))}),$=e.forwardRef(({children:a,positions:r,colors:t,sizes:s,stride:o=3,...n},l)=>{const m=e.useRef(null);return y(()=>{const i=m.current.geometry.attributes;i.position.needsUpdate=!0,t&&(i.color.needsUpdate=!0),s&&(i.size.needsUpdate=!0)}),e.createElement("points",p({ref:M([l,m])},n),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:r.length/o,array:r,itemSize:o,usage:f}),t&&e.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/o,array:t,itemSize:3,usage:f}),s&&e.createElement("bufferAttribute",{attach:"attributes-size",count:s.length/o,array:s,itemSize:1,usage:f})),a)}),D=e.forwardRef((a,r)=>a.positions instanceof Float32Array?e.createElement($,p({},a,{ref:r})):e.createElement(W,p({},a,{ref:r})));function B(){return c.jsxs("div",{className:"root",children:[c.jsx("h2",{className:"title",children:"React Three Fiber"}),c.jsx(P,{camera:{position:[0,0,1]},children:c.jsx(k,{})})]})}function G(a,r=1){let t=0;for(;t<a.length;){let s=Math.random()*2-1,o=Math.random()*2-1,n=Math.random()*2-1;s*s+o*o+n*n<=1&&(a[t++]=s*r,a[t++]=o*r,a[t++]=n*r)}return a}function k(a){const r=e.useRef({rotation:{x:0,y:0,z:0}}),[t]=e.useState(()=>G(new Float32Array(5e3),1.5));return y((s,o)=>{r.current.rotation.x-=o/10,r.current.rotation.y-=o/15,r.current.rotation.z-=0}),c.jsx("group",{children:c.jsx(D,{ref:r,positions:t,stride:3,frustumCulled:!1,...a,children:c.jsx(U,{transparent:!0,color:"#ffa0e0",size:.005,sizeAttenuation:!0,depthWrite:!1})})})}export{B as default};
//# sourceMappingURL=index-5784dea6.js.map
