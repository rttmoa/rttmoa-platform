import{r,t as A,br as te,ba as Pt,i as mt,bq as Xe,p as Ot,aY as Ct,c_ as vt,n as B,cF as Ht,aZ as ye,q as St,k as ht}from"./index-4a9fd3ee.js";import{u as At,b as Rt,B as Ft}from"./Select-e3655e44.js";import{h as it,c as $t}from"./conductUtil-e33340cb.js";import{_ as Wt}from"./createForOfIteratorHelper-c3ee8562.js";import{U as jt,T as Ut}from"./Tree-06fea204.js";const Bt=function(e){var t=r.useRef({valueLabels:new Map});return r.useMemo(function(){var l=t.current.valueLabels,i=new Map,o=e.map(function(c){var a=c.value,n=c.label,u=n??l.get(a);return i.set(a,u),A(A({},c),{},{label:u})});return t.current.valueLabels=i,[o]},[e])};var Gt=function(t,l,i,o){return r.useMemo(function(){var c=function(w){return w.map(function(N){var M=N.value;return M})},a=c(t),n=c(l),u=a.filter(function(T){return!o[T]}),g=a,v=n;if(i){var _=it(a,!0,o);g=_.checkedKeys,v=_.halfCheckedKeys}return[Array.from(new Set([].concat(te(u),te(g)))),v]},[t,l,i,o])},qt=function(t){return Array.isArray(t)?t:t!==void 0?[t]:[]},Yt=function(t){var l=t||{},i=l.label,o=l.value,c=l.children;return{_title:i?[i]:["title","label"],value:o||"value",key:o||"value",children:c||"children"}},ut=function(t){return!t||t.disabled||t.disableCheckbox||t.checkable===!1},Jt=function(t,l){var i=[],o=function c(a){a.forEach(function(n){var u=n[l.children];u&&(i.push(n[l.value]),c(u))})};return o(t),i},pt=function(t){return t==null};const Zt=function(e,t){return r.useMemo(function(){var l=$t(e,{fieldNames:t,initWrapper:function(o){return A(A({},o),{},{valueEntities:new Map})},processEntity:function(o,c){var a=o.node[t.value];c.valueEntities.set(a,o)}});return l},[e,t])};var bt=function(){return null},zt=["children","value"];function xt(e){return Pt(e).map(function(t){if(!r.isValidElement(t)||!t.type)return null;var l=t,i=l.key,o=l.props,c=o.children,a=o.value,n=mt(o,zt),u=A({key:i,value:a},n),g=xt(c);return g.length&&(u.children=g),u}).filter(function(t){return t})}function ot(e){if(!e)return e;var t=A({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return Xe(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function Qt(e,t,l,i,o,c){var a=null,n=null;function u(){function g(v){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v.map(function(w,N){var M="".concat(_,"-").concat(N),I=w[c.value],j=l.includes(I),re=g(w[c.children]||[],M,j),Z=r.createElement(bt,w,re.map(function(R){return R.node}));if(t===I&&(a=Z),j){var ce={pos:M,node:Z,children:re};return T||n.push(ce),ce}return null}).filter(function(w){return w})}n||(n=[],g(i),n.sort(function(v,_){var T=v.node.props.value,w=_.node.props.value,N=l.indexOf(T),M=l.indexOf(w);return N-M}))}Object.defineProperty(e,"triggerNode",{get:function(){return Xe(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),u(),a}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return Xe(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),u(),o?n:n.map(function(v){var _=v.node;return _})}})}var Xt=function(t,l,i){var o=i.fieldNames,c=i.treeNodeFilterProp,a=i.filterTreeNode,n=o.children;return r.useMemo(function(){if(!l||a===!1)return t;var u=typeof a=="function"?a:function(v,_){return String(_[c]).toUpperCase().includes(l.toUpperCase())},g=function v(_){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return _.reduce(function(w,N){var M=N[n],I=T||u(l,ot(N)),j=v(M||[],I);return(I||j.length)&&w.push(A(A({},N),{},Ot({isLeaf:void 0},n,j))),w},[])};return g(t)},[t,l,n,c,a])};function gt(e){var t=r.useRef();t.current=e;var l=r.useCallback(function(){return t.current.apply(t,arguments)},[]);return l}function er(e,t){var l=t.id,i=t.pId,o=t.rootPId,c=new Map,a=[];return e.forEach(function(n){var u=n[l],g=A(A({},n),{},{key:n.key||u});c.set(u,g)}),c.forEach(function(n){var u=n[i],g=c.get(u);g?(g.children=g.children||[],g.children.push(n)):(u===o||o===null)&&a.push(n)}),a}function tr(e,t,l){return r.useMemo(function(){if(e){if(l){var i=A({id:"id",pId:"pId",rootPId:null},Ct(l)==="object"?l:{});return er(e,i)}return e}return xt(t)},[t,l,e])}var Et=r.createContext(null),kt=r.createContext(null),rr={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},ar=function(t,l){var i=At(),o=i.prefixCls,c=i.multiple,a=i.searchValue,n=i.toggleOpen,u=i.open,g=i.notFoundContent,v=r.useContext(kt),_=v.virtual,T=v.listHeight,w=v.listItemHeight,N=v.listItemScrollOffset,M=v.treeData,I=v.fieldNames,j=v.onSelect,re=v.dropdownMatchSelectWidth,Z=v.treeExpandAction,ce=v.treeTitleRender,R=v.onPopupScroll,K=v.leftMaxCount,Ie=v.leafCountOnly,z=v.valueEntities,b=r.useContext(Et),ae=b.checkable,V=b.checkedKeys,_e=b.halfCheckedKeys,ne=b.treeExpandedKeys,Ke=b.treeDefaultExpandAll,Te=b.treeDefaultExpandedKeys,me=b.onTreeExpand,Me=b.treeIcon,Le=b.showTreeIcon,Ne=b.switcherIcon,Ve=b.treeLine,Pe=b.treeNodeFilterProp,Oe=b.loadData,Ce=b.treeLoadedKeys,He=b.treeMotion,Ae=b.onTreeLoad,Re=b.keyEntities,le=r.useRef(),ie=vt(function(){return M},[u,M],function(h,s){return s[0]&&h[1]!==s[1]}),Fe=r.useMemo(function(){return ae?{checked:V,halfChecked:_e}:null},[ae,V,_e]);r.useEffect(function(){if(u&&!c&&V.length){var h;(h=le.current)===null||h===void 0||h.scrollTo({key:V[0]})}},[u]);var de=function(s){s.preventDefault()},se=function(s,D){var S=D.node;ae&&ut(S)||(j(S.key,{selected:!V.includes(S.key)}),c||n(!1))},$e=r.useState(Te),Se=B($e,2),fe=Se[0],We=Se[1],Y=r.useState(null),be=B(Y,2),je=be[0],Ue=be[1],ue=r.useMemo(function(){return ne?te(ne):a?je:fe},[fe,je,ne,a]),ve=function(s){We(s),Ue(s),me&&me(s)},xe=String(a).toLowerCase(),F=function(s){return xe?String(s[Pe]).toLowerCase().includes(xe):!1};r.useEffect(function(){a&&Ue(Jt(M,I))},[a]);var tt=r.useState(function(){return new Map}),Ee=B(tt,2),G=Ee[0],rt=Ee[1];r.useEffect(function(){K&&rt(new Map)},[K]);function J(h){var s=h[I.value];if(!G.has(s)){var D=z.get(s),S=(D.children||[]).length===0;if(S)G.set(s,!1);else{var x=D.children.filter(function(O){return!O.node.disabled&&!O.node.disableCheckbox&&!V.includes(O.node[I.value])}),W=x.length;G.set(s,W>K)}}return G.get(s)}var k=Ht(function(h){var s=h[I.value];return V.includes(s)||K===null?!1:K<=0?!0:Ie&&K?J(h):!1}),at=function h(s){var D=Wt(s),S;try{for(D.s();!(S=D.n()).done;){var x=S.value;if(!(x.disabled||x.selectable===!1)){if(a){if(F(x))return x}else return x;if(x[I.children]){var W=h(x[I.children]);if(W)return W}}}}catch(O){D.e(O)}finally{D.f()}return null},Be=r.useState(null),ke=B(Be,2),he=ke[0],Ge=ke[1],$=Re[he];r.useEffect(function(){if(u){var h=null,s=function(){var S=at(ie);return S?S[I.value]:null};!c&&V.length&&!a?h=V[0]:h=s(),Ge(h)}},[u,a]),r.useImperativeHandle(l,function(){var h;return{scrollTo:(h=le.current)===null||h===void 0?void 0:h.scrollTo,onKeyDown:function(D){var S,x=D.which;switch(x){case ye.UP:case ye.DOWN:case ye.LEFT:case ye.RIGHT:(S=le.current)===null||S===void 0||S.onKeyDown(D);break;case ye.ENTER:{if($){var W=k($.node),O=($==null?void 0:$.node)||{},Ye=O.selectable,Q=O.value,Je=O.disabled;Ye!==!1&&!Je&&!W&&se(null,{node:{key:he},selected:!V.includes(Q)})}break}case ye.ESC:n(!1)}},onKeyUp:function(){}}});var qe=vt(function(){return!a},[a,ne||fe],function(h,s){var D=B(h,1),S=D[0],x=B(s,2),W=x[0],O=x[1];return S!==W&&!!(W||O)}),L=qe?Oe:null;if(ie.length===0)return r.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:de},g);var P={fieldNames:I};return Ce&&(P.loadedKeys=Ce),ue&&(P.expandedKeys=ue),r.createElement("div",{onMouseDown:de},$&&u&&r.createElement("span",{style:rr,"aria-live":"assertive"},$.node.value),r.createElement(jt.Provider,{value:{nodeDisabled:k}},r.createElement(Ut,St({ref:le,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:ie,height:T,itemHeight:w,itemScrollOffset:N,virtual:_!==!1&&re!==!1,multiple:c,icon:Me,showIcon:Le,switcherIcon:Ne,showLine:Ve,loadData:L,motion:He,activeKey:he,checkable:ae,checkStrictly:!0,checkedKeys:Fe,selectedKeys:ae?[]:V,defaultExpandAll:Ke,titleRender:ce},P,{onActiveChange:Ge,onSelect:se,onCheck:se,onExpand:ve,onLoad:Ae,filterTreeNode:F,expandAction:Z,onScroll:R}))))},nr=r.forwardRef(ar),Dt="SHOW_ALL",wt="SHOW_PARENT",ct="SHOW_CHILD";function yt(e,t,l,i){var o=new Set(e);return t===ct?e.filter(function(c){var a=l[c];return!a||!a.children||!a.children.some(function(n){var u=n.node;return o.has(u[i.value])})||!a.children.every(function(n){var u=n.node;return ut(u)||o.has(u[i.value])})}):t===wt?e.filter(function(c){var a=l[c],n=a?a.parent:null;return!n||ut(n.node)||!o.has(n.key)}):e}var lr=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];function ir(e){return!e||Ct(e)!=="object"}var ur=r.forwardRef(function(e,t){var l=e.id,i=e.prefixCls,o=i===void 0?"rc-tree-select":i,c=e.value,a=e.defaultValue,n=e.onChange,u=e.onSelect,g=e.onDeselect,v=e.searchValue,_=e.inputValue,T=e.onSearch,w=e.autoClearSearchValue,N=w===void 0?!0:w,M=e.filterTreeNode,I=e.treeNodeFilterProp,j=I===void 0?"value":I,re=e.showCheckedStrategy,Z=e.treeNodeLabelProp,ce=e.multiple,R=e.treeCheckable,K=e.treeCheckStrictly,Ie=e.labelInValue,z=e.maxCount,b=e.fieldNames,ae=e.treeDataSimpleMode,V=e.treeData,_e=e.children,ne=e.loadData,Ke=e.treeLoadedKeys,Te=e.onTreeLoad,me=e.treeDefaultExpandAll,Me=e.treeExpandedKeys,Le=e.treeDefaultExpandedKeys,Ne=e.onTreeExpand,Ve=e.treeExpandAction,Pe=e.virtual,Oe=e.listHeight,Ce=Oe===void 0?200:Oe,He=e.listItemHeight,Ae=He===void 0?20:He,Re=e.listItemScrollOffset,le=Re===void 0?0:Re,ie=e.onDropdownVisibleChange,Fe=e.dropdownMatchSelectWidth,de=Fe===void 0?!0:Fe,se=e.treeLine,$e=e.treeIcon,Se=e.showTreeIcon,fe=e.switcherIcon,We=e.treeMotion,Y=e.treeTitleRender,be=e.onPopupScroll,je=mt(e,lr),Ue=Rt(l),ue=R&&!K,ve=R||K,xe=K||Ie,F=ve||ce,tt=ht(a,{value:c}),Ee=B(tt,2),G=Ee[0],rt=Ee[1],J=r.useMemo(function(){return R?re||ct:Dt},[re,R]),k=r.useMemo(function(){return Yt(b)},[JSON.stringify(b)]),at=ht("",{value:v!==void 0?v:_,postState:function(d){return d||""}}),Be=B(at,2),ke=Be[0],he=Be[1],Ge=function(d){he(d),T==null||T(d)},$=tr(V,_e,ae),qe=Zt($,k),L=qe.keyEntities,P=qe.valueEntities,h=r.useCallback(function(f){var d=[],p=[];return f.forEach(function(y){P.has(y)?p.push(y):d.push(y)}),{missingRawValues:d,existRawValues:p}},[P]),s=Xt($,ke,{fieldNames:k,treeNodeFilterProp:j,filterTreeNode:M}),D=r.useCallback(function(f){if(f){if(Z)return f[Z];for(var d=k._title,p=0;p<d.length;p+=1){var y=f[d[p]];if(y!==void 0)return y}}},[k,Z]),S=r.useCallback(function(f){var d=qt(f);return d.map(function(p){return ir(p)?{value:p}:p})},[]),x=r.useCallback(function(f){var d=S(f);return d.map(function(p){var y=p.label,U=p.value,E=p.halfChecked,m,C=P.get(U);if(C){var H;y=Y?Y(C.node):(H=y)!==null&&H!==void 0?H:D(C.node),m=C.node.disabled}else if(y===void 0){var X=S(G).find(function(De){return De.value===U});y=X.label}return{label:y,value:U,halfChecked:E,disabled:m}})},[P,D,S,G]),W=r.useMemo(function(){return S(G===null?[]:G)},[S,G]),O=r.useMemo(function(){var f=[],d=[];return W.forEach(function(p){p.halfChecked?d.push(p):f.push(p)}),[f,d]},[W]),Ye=B(O,2),Q=Ye[0],Je=Ye[1],dt=r.useMemo(function(){return Q.map(function(f){return f.value})},[Q]),It=Gt(Q,Je,ue,L),st=B(It,2),pe=st[0],Ze=st[1],_t=r.useMemo(function(){var f=yt(pe,J,L,k),d=f.map(function(E){var m,C;return(m=(C=L[E])===null||C===void 0||(C=C.node)===null||C===void 0?void 0:C[k.value])!==null&&m!==void 0?m:E}),p=d.map(function(E){var m=Q.find(function(H){return H.value===E}),C=Ie?m==null?void 0:m.label:Y==null?void 0:Y(m);return{value:E,label:C}}),y=x(p),U=y[0];return!F&&U&&pt(U.value)&&pt(U.label)?[]:y.map(function(E){var m;return A(A({},E),{},{label:(m=E.label)!==null&&m!==void 0?m:E.value})})},[k,F,pe,Q,x,J,L]),Kt=Bt(_t),Tt=B(Kt,1),nt=Tt[0],ft=r.useMemo(function(){return F&&(J==="SHOW_CHILD"||K||!R)?z:null},[z,F,K,J,R]),ze=gt(function(f,d,p){var y=yt(f,J,L,k);if(!(ft&&y.length>ft)){var U=x(f);if(rt(U),N&&he(""),n){var E=f;ue&&(E=y.map(function(q){var ee=P.get(q);return ee?ee.node[k.value]:q}));var m=d||{triggerValue:void 0,selected:void 0},C=m.triggerValue,H=m.selected,X=E;if(K){var De=Je.filter(function(q){return!E.includes(q.value)});X=[].concat(te(X),te(De))}var we=x(X),oe={preValue:Q,triggerValue:C},ge=!0;(K||p==="selection"&&!H)&&(ge=!1),Qt(oe,C,f,$,ge,k),ve?oe.checked=H:oe.selected=H;var Qe=xe?we:we.map(function(q){return q.value});n(F?Qe:Qe[0],xe?null:we.map(function(q){return q.label}),oe)}}}),lt=r.useCallback(function(f,d){var p,y=d.selected,U=d.source,E=L[f],m=E==null?void 0:E.node,C=(p=m==null?void 0:m[k.value])!==null&&p!==void 0?p:f;if(!F)ze([C],{selected:!0,triggerValue:C},"option");else{var H=y?[].concat(te(dt),[C]):pe.filter(function(ee){return ee!==C});if(ue){var X=h(H),De=X.missingRawValues,we=X.existRawValues,oe=we.map(function(ee){return P.get(ee).key}),ge;if(y){var Qe=it(oe,!0,L);ge=Qe.checkedKeys}else{var q=it(oe,{checked:!1,halfCheckedKeys:Ze},L);ge=q.checkedKeys}H=[].concat(te(De),te(ge.map(function(ee){return L[ee].node[k.value]})))}ze(H,{selected:y,triggerValue:C},U||"option")}y||!F?u==null||u(C,ot(m)):g==null||g(C,ot(m))},[h,P,L,k,F,dt,ze,ue,u,g,pe,Ze,z]),Mt=r.useCallback(function(f){if(ie){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return Xe(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ie(f,d)}},[ie]),Lt=gt(function(f,d){var p=f.map(function(y){return y.value});if(d.type==="clear"){ze(p,{},"selection");return}d.values.length&&lt(d.values[0].value,{selected:!1,source:"selection"})}),Nt=r.useMemo(function(){return{virtual:Pe,dropdownMatchSelectWidth:de,listHeight:Ce,listItemHeight:Ae,listItemScrollOffset:le,treeData:s,fieldNames:k,onSelect:lt,treeExpandAction:Ve,treeTitleRender:Y,onPopupScroll:be,leftMaxCount:z===void 0?null:z-nt.length,leafCountOnly:J==="SHOW_CHILD"&&!K&&!!R,valueEntities:P}},[Pe,de,Ce,Ae,le,s,k,lt,Ve,Y,be,z,nt.length,J,K,R,P]),Vt=r.useMemo(function(){return{checkable:ve,loadData:ne,treeLoadedKeys:Ke,onTreeLoad:Te,checkedKeys:pe,halfCheckedKeys:Ze,treeDefaultExpandAll:me,treeExpandedKeys:Me,treeDefaultExpandedKeys:Le,onTreeExpand:Ne,treeIcon:$e,treeMotion:We,showTreeIcon:Se,switcherIcon:fe,treeLine:se,treeNodeFilterProp:j,keyEntities:L}},[ve,ne,Ke,Te,pe,Ze,me,Me,Le,Ne,$e,We,Se,fe,se,j,L]);return r.createElement(kt.Provider,{value:Nt},r.createElement(Et.Provider,{value:Vt},r.createElement(Ft,St({ref:t},je,{id:Ue,prefixCls:o,mode:F?"multiple":void 0,displayValues:nt,onDisplayValuesChange:Lt,searchValue:ke,onSearch:Ge,OptionList:nr,emptyOptions:!$.length,onDropdownVisibleChange:Mt,dropdownMatchSelectWidth:de}))))}),et=ur;et.TreeNode=bt;et.SHOW_ALL=Dt;et.SHOW_PARENT=wt;et.SHOW_CHILD=ct;export{et as G,Dt as S,bt as T,wt as a,ct as b};
