{"version":3,"file":"index-e9f5fb52.js","sources":["../../../src/views/module/product/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Button, Card, Popconfirm, Table, TableColumnsType, message, Image } from 'antd';\nimport { useNavigate } from 'react-router-dom';\nimport defaultImg from '@/assets/images/defaultImg.jpg';\nimport { productList } from '@/api/modules/module/product';\n\nexport interface listProps {\n\tlist?: any;\n\ttotal?: number;\n\tpage?: number;\n\tpageSize?: number;\n}\n\n// coverImg: \"http://localhost:3009/uploads/20230406/1680794476636.jpg\"\nexport const serverUrl = 'http://localhost:3009';\n\nconst List = () => {\n\tconst navigate = useNavigate();\n\tconst [loading, setLoading] = useState(false);\n\tconst [searchName, setsearchName] = useState('');\n\tconst [searchType, setsearchType] = useState('productName');\n\tconst [data, setData] = useState<listProps>({ list: [], total: 0, page: 1, pageSize: 5 });\n\tconst { list, total, page, pageSize } = data;\n\n\t// 发送请求 | 通过redux去处理\n\tconst loadData = async (page: number, pageSize: number) => {\n\t\tsetData({ page: page });\n\t\tsetLoading(true);\n\t\tlet result: any;\n\t\tif (searchName) {\n\t\t\tresult = await productList(page, pageSize, searchName, searchType);\n\t\t} else {\n\t\t\tresult = await productList(page, pageSize);\n\t\t}\n\t\tif (result.code == 200) {\n\t\t\tsetLoading(false);\n\t\t\tsetData(result.data);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tloadData(page!, pageSize!);\n\t}, []);\n\n\tconst columns: TableColumnsType = [\n\t\t{\n\t\t\ttitle: '序号',\n\t\t\tkey: '_id',\n\t\t\twidth: 80,\n\t\t\talign: 'center',\n\t\t\trender: (text: any, record: any, index: number): any => index + 1,\n\t\t},\n\t\t{\n\t\t\ttitle: '商品名称',\n\t\t\tdataIndex: 'name',\n\t\t},\n\t\t{\n\t\t\ttitle: '主图',\n\t\t\tdataIndex: 'coverImg',\n\t\t\trender: (txt: any, record: any) => (\n\t\t\t\t// <Image src={record.coverImg ? serverUrl + record.coverImg : defaultImg} alt={record.name} style={{ width: 60 }} />\n\t\t\t\t<Image src={record.coverImg} alt={record.name} style={{ width: 60 }} />\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\ttitle: '价格',\n\t\t\tdataIndex: 'price',\n\t\t\trender(price) {\n\t\t\t\treturn `￥${price}`;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttitle: '是否在售',\n\t\t\tdataIndex: 'onSale',\n\t\t\trender: (txt: any, record: any) => (record.onSale ? '在售' : '已下架'),\n\t\t},\n\t\t{\n\t\t\ttitle: '商品描述',\n\t\t\tdataIndex: 'desc',\n\t\t},\n\t\t{\n\t\t\ttitle: '操作',\n\t\t\trender: (txt: any, record: any, index: any) => {\n\t\t\t\treturn (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype='primary'\n\t\t\t\t\t\t\tsize='small'\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tnavigate(`/module/product/detail?id=${record._id}`);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t修改\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Popconfirm\n\t\t\t\t\t\t\ttitle='确定删除此项'\n\t\t\t\t\t\t\tonCancel={() => {\n\t\t\t\t\t\t\t\tconsole.log('用户取消删除');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonConfirm={() => {\n\t\t\t\t\t\t\t\t// todo 此处调用api接口进行删除\n\t\t\t\t\t\t\t\t// delOne(record._id).then(res => {\n\t\t\t\t\t\t\t\t//   loadData();\n\t\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t\t\tmessage.info(`删除： _id=${record._id}`);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button type='dashed' size='small' style={{ margin: '0 1rem' }}>\n\t\t\t\t\t\t\t\t删除\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</Popconfirm>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tsize='small'\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t// modifyOne(record._id, { onSale: !record.onSale }).then(res => {\n\t\t\t\t\t\t\t\t//   重新拿参数去请求：页码，请求参数，信息去请求\n\t\t\t\t\t\t\t\t//   loadData(page!, pageSize!);\n\t\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t\t\tmessage.info(`修改在售： _id=${record._id}`);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{record.onSale ? '下架' : '上架'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t];\n\n\treturn (\n\t\t<div>\n\t\t\t<Card\n\t\t\t\ttitle='商品列表'\n\t\t\t\textra={\n\t\t\t\t\t<Button\n\t\t\t\t\t\ttype='primary'\n\t\t\t\t\t\tsize='small'\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tnavigate('/module/product/detail');\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t新增\n\t\t\t\t\t</Button>\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t<Table\n\t\t\t\t\tbordered\n\t\t\t\t\trowKey='_id'\n\t\t\t\t\tloading={loading}\n\t\t\t\t\trowClassName={(record: any) => (record?.onSale ? '' : 'bg-red')}\n\t\t\t\t\tcolumns={columns}\n\t\t\t\t\tdataSource={list}\n\t\t\t\t\tpagination={{\n\t\t\t\t\t\tcurrent: page, // 当前页数\n\t\t\t\t\t\ttotal, // 数据总数\n\t\t\t\t\t\tdefaultPageSize: pageSize, // 默认的每页条数\n\t\t\t\t\t\tshowSizeChanger: true,\n\t\t\t\t\t\tpageSizeOptions: ['3', '5', '10', '15'],\n\t\t\t\t\t\tshowQuickJumper: true,\n\t\t\t\t\t\tonChange: loadData, // 页码改变的回调，参数是改变后的页码及每页条数\n\t\t\t\t\t\tonShowSizeChange: (current, size) => {\n\t\t\t\t\t\t\t// console.log('pageSize 变化的回调', current, size);\n\t\t\t\t\t\t\tsetData({ pageSize: size });\n\t\t\t\t\t\t\tloadData(page!, size);\n\t\t\t\t\t\t},\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</Card>\n\t\t</div>\n\t);\n};\n\nexport default List;\n"],"names":["serverUrl","List","navigate","useNavigate","loading","setLoading","useState","searchName","setsearchName","searchType","setsearchType","data","setData","list","total","page","pageSize","loadData","result","productList","useEffect","columns","text","record","index","txt","jsx","Image","price","Button","Popconfirm","message","Card","Table","current","size"],"mappings":"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"}