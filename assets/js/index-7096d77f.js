import{r as n,b3 as se,ar as o,j as e,a8 as re,B as O,a4 as g,ae as R}from"./index-6ab6cade.js";import{T as ne}from"./index-90036cc8.js";import{r as ae,a as le}from"./roleManage-538a4fe2.js";import{C as w}from"./index-c59d5039.js";import{S as j}from"./index-05e40cca.js";import{T as x}from"./index-dc39c46e.js";import{T as oe}from"./index-1982df72.js";import"./Table-62c78325.js";import"./index-0ecd7869.js";import"./zh_CN-f51ae7db.js";import"./styleChecker-b88c47f4.js";import"./addEventListener-3a490a20.js";import"./List-556d4d6b.js";import"./Tree-27289865.js";import"./conductUtil-0f9ba3c8.js";import"./index-dcef3aa8.js";import"./index-d1e96b4a.js";import"./index-1b2860a7.js";import"./useBubbleLock-0d556991.js";import"./index-a5098ef4.js";import"./useShowArrow-628cd2bf.js";import"./useIcons-bfa037c0.js";import"./useLazyKVMap-56df8c07.js";import"./Select-74f8e578.js";import"./iconUtil-3c2f21e2.js";function z(i){if(!i)return"";let a=new Date(Number(i));return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}const ze=()=>{const[i,a]=n.useState([]),[S,p]=n.useState([]),[I,b]=n.useState([]),[s,m]=n.useState({}),c=se(t=>t.auth.authMenuList),[d]=o.useForm(),[r]=o.useForm(),[l]=o.useForm(),[C,u]=n.useState(!1),[F,_]=n.useState(!1),[B,E]=n.useState({}),[L,D]=n.useState([]),[M,T]=n.useState(!1),[U,v]=n.useState([]),[K,P]=n.useState([]),[A,H]=n.useState(null),[J,Y]=n.useState({}),q=n.useRef();n.useEffect(()=>{(async function(){ae().then(t=>{const f=t.data.list.map((h,y)=>({...h,key:y}));a(f)})})()},[]);const G=[{title:"角色名称",dataIndex:"role_name",align:"center"},{title:"使用状态",dataIndex:"status",align:"center",render:t=>t===1?"启用":"停用"},{title:"授权人",align:"center",dataIndex:"authorize_user_name"},{title:"创建时间",align:"center",dataIndex:"create_time",render:z},{title:"授权时间",align:"center",dataIndex:"authorize_time",render:z}],Q=(t,f,h)=>{h?(p(t),b(h),m(f)):(p(t),m(f))},W=()=>{u(!0)},X=()=>{d.getFieldsValue(),d.resetFields(),u(!1)},Z=()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"请选择一个角色"});return}_(!0),E(s),D(s.menus)},$=()=>{let t=r.getFieldsValue();t.role_id=s.id,t.menus=L,t.authorize_time=Date.now(),r.resetFields(),_(!1)},ee=async()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"未选中任何项目"});return}const t=await le(s.id),f=[],h=[];if(t.data.length>0){const y=t.data;for(let N=0;N<y.length;N++){const k=y[N],V={key:k.user_id,title:k.user_name,status:k.status};V.status===1&&h.push(V.key),f.push(V)}}v(f),P(h),Y(s),H(!1),T(!0)},te=()=>{s.id,l.resetFields(),T(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{extra:e.jsxs(re,{size:"middle",children:[e.jsx(O,{type:"primary",onClick:W,children:"创建角色"}),e.jsx(O,{type:s.id?"primary":"default",onClick:Z,disabled:!s.id,children:"设置权限"}),e.jsx(O,{type:s.id?"primary":"default",onClick:ee,disabled:!s.id,children:"用户授权"})]}),children:e.jsx(ne,{columns:G,dataSource:i,selectedRowKeys:S,selectedIds:I,selectedItem:s,pagination:{},updateSelectedItem:Q})}),e.jsx(g,{title:"创建角色",open:C,onOk:X,onCancel:()=>{d.resetFields(),u(!1)},children:e.jsx(ie,{form:d})}),e.jsx(g,{width:600,title:"权限设置",open:F,onOk:$,onCancel:()=>{r.resetFields(),_(!1)},children:e.jsx(ce,{form:r,detailInfo:B,menuInfo:L||[],patchMenuInfo:t=>{D(t)},menuConfig:c})}),e.jsx(g,{title:"用户授权",width:800,open:M,onOk:te,onCancel:()=>{l.resetFields(),T(!1)},children:e.jsx(de,{form:l,isClose:A,detailUserInfo:J,targetKeys:K,transferData:U,patchUserInfo:t=>{P(t)},ref:q})})]})};function ie({form:i}){const a={labelCol:{span:5},wrapperCol:{span:16}};return e.jsx(e.Fragment,{children:e.jsx(w,{children:e.jsxs(o,{form:i,...a,initialValues:{status:1},children:[e.jsx(o.Item,{label:"角色名称",name:"role_name",children:e.jsx(R,{type:"text",placeholder:"请输入角色名称"})}),e.jsx(o.Item,{label:"状态",name:"status",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"开启"}),e.jsx(j.Option,{value:0,children:"关闭"})]})})]})})})}function ce({form:i,detailInfo:a,menuInfo:S,patchMenuInfo:p,menuConfig:I}){const b=(c,d="")=>{const r=[];return c.btnList.forEach(l=>{r.push(e.jsx(x.TreeNode,{title:l.meta.title,className:"op-role-tree"},d+"-btn-"+l.path))}),r},s=(c,d)=>c.map(r=>{let l=r.path;return r.children?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:s(r.children)},l):r.btnList?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:b(r,l)},l):e.jsx(x.TreeNode,{title:r.meta.title},l)}),m={labelCol:{span:4},wrapperCol:{span:16}};return e.jsx(o,{form:i,layout:"horizontal",...m,initialValues:{status2:1,role_name2:a.role_name},children:e.jsxs(w,{children:[e.jsx(o.Item,{label:"角色名称",name:"role_name2",children:e.jsx(R,{disabled:!0,maxLength:8,placeholder:a.role_name})}),e.jsx(o.Item,{label:"状态",name:"status2",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"启用"}),e.jsx(j.Option,{value:0,children:"停用"})]})}),e.jsx(o.Item,{label:"菜单",name:"menu",children:e.jsx(x,{checkable:!0,defaultExpandAll:!0,onCheck:c=>{p(c)},checkedKeys:S||[],children:e.jsx(x.TreeNode,{title:"平台权限",children:s(I)},"platform_all")})})]})})}function de({form:i,isClose:a,detailUserInfo:S,targetKeys:p,transferData:I,patchUserInfo:b,ref:s}){const[m,c]=n.useState(11),d=()=>(c(m+1),m);n.useImperativeHandle(s,()=>({status:m,statusValue:d}));const r=(u,F)=>F.title.indexOf(u)>-1,l=u=>{b(u)},C={labelCol:{span:5},wrapperCol:{span:18}};return e.jsxs(o,{form:i,layout:"horizontal",...C,initialValues:{transfer:p},children:[e.jsx(o.Item,{name:"role_name3",label:"角色名称",children:e.jsx(R,{disabled:!0,maxLength:8,placeholder:S.role_name})}),e.jsx(o.Item,{name:"transfer",label:"选择用户：",children:e.jsx(oe,{listStyle:{width:200,height:400},dataSource:I,showSearch:!0,titles:["待选用户","已选用户"],filterOption:r,targetKeys:p,onChange:l,render:u=>u.title})})]})}export{ze as default};
//# sourceMappingURL=index-7096d77f.js.map
