import{d9 as we,da as Se,cW as Re,M as Y,db as Ee,cV as Ce,j as P,bu as Ke,a as Ie,O as c,I as q,ar as re,bw as H,r as k,K as U,cg as Te,aE as xe,$ as ae,J as te,by as W,bz as F,cf as Me,aA as oe,dc as Pe,bx as ee,c0 as ue,bo as Ne}from"./index-6ab6cade.js";import{e as Fe,u as $e,g as Ae}from"./index-9157520c.js";import{a as Le,c as je,u as ke}from"./index-cc70f193.js";import{T as De}from"./index-2b2ee2d9.js";import{r as _e,u as z,P as de,b as Oe,m as Ve}from"./BaseForm-16c08f45.js";import{u as Be}from"./useLazyKVMap-56df8c07.js";import{P as ze}from"./index-d4c25178.js";var fr=function(e){we(a,e);var r=Se(a);function a(){var d;Re(this,a);for(var h=arguments.length,y=new Array(h),u=0;u<h;u++)y[u]=arguments[u];return d=r.call.apply(r,[this].concat(y)),Y(Ee(d),"state",{hasError:!1,errorInfo:""}),d}return Ce(a,[{key:"componentDidCatch",value:function(h,y){}},{key:"render",value:function(){return this.state.hasError?P.jsx(Ke,{status:"error",title:"Something went wrong.",extra:this.state.errorInfo}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(h){return{hasError:!0,errorInfo:h.message}}}]),a}(Ie.Component),Je=function(r){var a="".concat(r.antCls,"-progress-bg");return Y({},r.componentCls,{"&-multiple":{paddingBlockStart:6,paddingBlockEnd:12,paddingInline:8},"&-progress":{"&-success":Y({},a,{backgroundColor:r.colorSuccess}),"&-error":Y({},a,{backgroundColor:r.colorError}),"&-warning":Y({},a,{backgroundColor:r.colorWarning})},"&-rule":{display:"flex",alignItems:"center","&-icon":{"&-default":{display:"flex",alignItems:"center",justifyContent:"center",width:"14px",height:"22px","&-circle":{width:"6px",height:"6px",backgroundColor:r.colorTextSecondary,borderRadius:"4px"}},"&-loading":{color:r.colorPrimary},"&-error":{color:r.colorError},"&-success":{color:r.colorSuccess}},"&-text":{color:r.colorText}}})};function We(e){return Le("InlineErrorFormItem",function(r){var a=c(c({},r),{},{componentCls:".".concat(e)});return[Je(a)]})}var Ge=["rules","name","children","popoverProps"],Ue=["errorType","rules","name","popoverProps","children"],se={marginBlockStart:-5,marginBlockEnd:-5,marginInlineStart:0,marginInlineEnd:0},He=function(r){var a=r.inputProps,d=r.input,h=r.extra,y=r.errorList,u=r.popoverProps,T=k.useState(!1),I=U(T,2),g=I[0],w=I[1],N=k.useState([]),A=U(N,2),L=A[0],K=A[1],x=k.useContext(Te.ConfigContext),S=x.getPrefixCls,s=S(),m=je(),o=We("".concat(s,"-form-item-with-help")),p=o.wrapSSR,_=o.hashId;k.useEffect(function(){a.validateStatus!=="validating"&&K(a.errors)},[a.errors,a.validateStatus]);var O=Fe(L.length<1?!1:g,function($){$!==g&&w($)}),B=a.validateStatus==="validating";return P.jsx(xe,c(c(c({trigger:(u==null?void 0:u.trigger)||["click"],placement:(u==null?void 0:u.placement)||"topLeft"},O),{},{getPopupContainer:u==null?void 0:u.getPopupContainer,getTooltipContainer:u==null?void 0:u.getTooltipContainer,content:p(P.jsx("div",{className:"".concat(s,"-form-item ").concat(_," ").concat(m.hashId).trim(),style:{margin:0,padding:0},children:P.jsxs("div",{className:"".concat(s,"-form-item-with-help ").concat(_," ").concat(m.hashId).trim(),children:[B?P.jsx(ae,{}):null,y]})}))},u),{},{children:P.jsxs(P.Fragment,{children:[d,h]})}),"popover")},Xe=function(r){var a=r.rules,d=r.name,h=r.children,y=r.popoverProps,u=q(r,Ge);return P.jsx(re.Item,c(c({name:d,rules:a,hasFeedback:!1,shouldUpdate:function(I,g){if(I===g)return!1;var w=[d].flat(1);w.length>1&&w.pop();try{return JSON.stringify(H(I,w))!==JSON.stringify(H(g,w))}catch{return!0}},_internalItemRender:{mark:"pro_table_render",render:function(I,g){return P.jsx(He,c({inputProps:I,popoverProps:y},g))}}},u),{},{style:c(c({},se),u==null?void 0:u.style),children:h}))},gr=function(r){var a=r.errorType,d=r.rules,h=r.name,y=r.popoverProps,u=r.children,T=q(r,Ue);return h&&d!==null&&d!==void 0&&d.length&&a==="popover"?P.jsx(Xe,c(c({name:h,rules:d,popoverProps:y},T),{},{children:u})):P.jsx(re.Item,c(c({rules:d,shouldUpdate:h?function(I,g){if(I===g)return!1;var w=[h].flat(1);w.length>1&&w.pop();try{return JSON.stringify(H(I,w))!==JSON.stringify(H(g,w))}catch{return!0}}:void 0},T),{},{style:c(c({},se),T.style),name:h,children:u}))},Ye=function(r){var a;return!!(r!=null&&(a=r.valueType)!==null&&a!==void 0&&a.toString().startsWith("date")||(r==null?void 0:r.valueType)==="select"||r!=null&&r.valueEnum)},qe=function(r){var a;return((a=r.ellipsis)===null||a===void 0?void 0:a.showTitle)===!1?!1:r.ellipsis},mr=function(r,a,d){if(a.copyable||a.ellipsis){var h=a.copyable&&d?{text:d,tooltips:["",""]}:void 0,y=Ye(a),u=qe(a)&&d?{tooltip:(a==null?void 0:a.tooltip)!==!1&&y?P.jsx("div",{className:"pro-table-tooltip-text",children:r}):d}:!1;return P.jsx(De.Text,{style:{width:"100%",margin:0,padding:0},title:"",copyable:h,ellipsis:u,children:r})}return r},hr=function(r,a,d){return a===void 0?r:_e(r,a,d)},Qe=["map_row_parentKey"],Ze=["map_row_parentKey","map_row_key"],er=["map_row_key"],ne=function(r){return(oe.warn||oe.warning)(r)},V=function(r){return Array.isArray(r)?r.join(","):r};function Z(e,r){var a,d=e.getRowKey,h=e.row,y=e.data,u=e.childrenColumnName,T=u===void 0?"children":u,I=(a=V(e.key))===null||a===void 0?void 0:a.toString(),g=new Map;function w(A,L,K){A.forEach(function(x,S){var s=(K||0)*10+S,m=d(x,s).toString();x&&Ne(x)==="object"&&T in x&&w(x[T]||[],m,s);var o=c(c({},x),{},{map_row_key:m,children:void 0,map_row_parentKey:L});delete o.children,L||delete o.map_row_parentKey,g.set(m,o)})}r==="top"&&g.set(I,c(c({},g.get(I)),h)),w(y),r==="update"&&g.set(I,c(c({},g.get(I)),h)),r==="delete"&&g.delete(I);var N=function(L){var K=new Map,x=[],S=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;L.forEach(function(o){if(o.map_row_parentKey&&!o.map_row_key){var p=o.map_row_parentKey,_=q(o,Qe);if(K.has(p)||K.set(p,[]),m){var O;(O=K.get(p))===null||O===void 0||O.push(_)}}})};return S(r==="top"),L.forEach(function(s){if(s.map_row_parentKey&&s.map_row_key){var m,o=s.map_row_parentKey,p=s.map_row_key,_=q(s,Ze);K.has(p)&&(_[T]=K.get(p)),K.has(o)||K.set(o,[]),(m=K.get(o))===null||m===void 0||m.push(_)}}),S(r==="update"),L.forEach(function(s){if(!s.map_row_parentKey){var m=s.map_row_key,o=q(s,er);if(m&&K.has(m)){var p=c(c({},o),{},Y({},T,K.get(m)));x.push(p);return}x.push(o)}}),x};return N(g)}function rr(e,r){var a=e.recordKey,d=e.onSave,h=e.row,y=e.children,u=e.newLineConfig,T=e.editorType,I=e.tableName,g=k.useContext(de),w=re.useFormInstance(),N=te(!1),A=U(N,2),L=A[0],K=A[1],x=z(W(F().mark(function S(){var s,m,o,p,_,O,B,$,Q;return F().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.prev=0,m=T==="Map",o=[I,Array.isArray(a)?a[0]:a].map(function(X){return X==null?void 0:X.toString()}).flat(1).filter(Boolean),K(!0),D.next=6,w.validateFields(o,{recursive:!0});case 6:return p=(g==null||(s=g.getFieldFormatValue)===null||s===void 0?void 0:s.call(g,o))||w.getFieldValue(o),Array.isArray(a)&&a.length>1&&(_=Pe(a),O=_.slice(1),B=H(p,O),ee(p,O,B)),$=m?ee({},o,p):p,D.next=11,d==null?void 0:d(a,Ve({},h,$),h,u);case 11:return Q=D.sent,K(!1),D.abrupt("return",Q);case 16:throw D.prev=16,D.t0=D.catch(0),D.t0,K(!1),D.t0;case 21:case"end":return D.stop()}},S,null,[[0,16]])})));return k.useImperativeHandle(r,function(){return{save:x}},[x]),P.jsxs("a",{onClick:function(){var S=W(F().mark(function s(m){return F().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return m.stopPropagation(),m.preventDefault(),p.prev=2,p.next=5,x();case 5:p.next=9;break;case 7:p.prev=7,p.t0=p.catch(2);case 9:case"end":return p.stop()}},s,null,[[2,7]])}));return function(s){return S.apply(this,arguments)}}(),children:[L?P.jsx(ae,{style:{marginInlineEnd:8}}):null,y||"保存"]},"save")}var nr=function(r){var a=r.recordKey,d=r.onDelete,h=r.preEditRowRef,y=r.row,u=r.children,T=r.deletePopconfirmMessage,I=te(function(){return!1}),g=U(I,2),w=g[0],N=g[1],A=z(W(F().mark(function L(){var K;return F().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,N(!0),S.next=4,d==null?void 0:d(a,y);case 4:return K=S.sent,N(!1),S.abrupt("return",K);case 9:return S.prev=9,S.t0=S.catch(0),S.t0,N(!1),S.abrupt("return",null);case 14:return S.prev=14,h&&(h.current=null),S.finish(14);case 17:case"end":return S.stop()}},L,null,[[0,9,14,17]])})));return u!==!1?P.jsx(ze,{title:T,onConfirm:function(){return A()},children:P.jsxs("a",{children:[w?P.jsx(ae,{style:{marginInlineEnd:8}}):null,u||"删除"]})},"delete"):null},ar=function(r){var a=r.recordKey,d=r.tableName,h=r.newLineConfig,y=r.editorType,u=r.onCancel,T=r.cancelEditable,I=r.row,g=r.cancelText,w=r.preEditRowRef,N=k.useContext(de),A=re.useFormInstance();return P.jsx("a",{onClick:function(){var L=W(F().mark(function K(x){var S,s,m,o,p,_,O;return F().wrap(function($){for(;;)switch($.prev=$.next){case 0:return x.stopPropagation(),x.preventDefault(),s=y==="Map",m=[d,a].flat(1).filter(Boolean),o=(N==null||(S=N.getFieldFormatValue)===null||S===void 0?void 0:S.call(N,m))||(A==null?void 0:A.getFieldValue(m)),p=s?ee({},m,o):o,$.next=8,u==null?void 0:u(a,p,I,h);case 8:return _=$.sent,$.next=11,T(a);case 11:if((w==null?void 0:w.current)===null){$.next=15;break}A.setFieldsValue(ee({},m,w==null?void 0:w.current)),$.next=17;break;case 15:return $.next=17,(O=r.onDelete)===null||O===void 0?void 0:O.call(r,a,I);case 17:return w&&(w.current=null),$.abrupt("return",_);case 19:case"end":return $.stop()}},K)}));return function(K){return L.apply(this,arguments)}}(),children:g||"取消"},"cancel")};function tr(e,r){var a=r.recordKey,d=r.newLineConfig,h=r.saveText,y=r.deleteText,u=k.forwardRef(rr),T=k.createRef();return{save:P.jsx(u,c(c({},r),{},{row:e,ref:T,children:h}),"save"+a),saveRef:T,delete:(d==null?void 0:d.options.recordKey)!==a?P.jsx(nr,c(c({},r),{},{row:e,children:y}),"delete"+a):void 0,cancel:P.jsx(ar,c(c({},r),{},{row:e}),"cancel"+a)}}function yr(e){var r=ke(),a=k.useRef(null),d=k.useState(void 0),h=U(d,2),y=h[0],u=h[1],T=function(){var n=new Map,t=function i(l,E){l==null||l.forEach(function(C,b){var R,v=E==null?b.toString():E+"_"+b.toString();n.set(v,V(e.getRowKey(C,-1))),n.set((R=V(e.getRowKey(C,-1)))===null||R===void 0?void 0:R.toString(),v),e.childrenColumnName&&C!==null&&C!==void 0&&C[e.childrenColumnName]&&i(C[e.childrenColumnName],v)})};return t(e.dataSource),n},I=k.useMemo(function(){return T()},[]),g=k.useRef(I),w=k.useRef(void 0);$e(function(){g.current=T()},[e.dataSource]),w.current=y;var N=e.type||"single",A=Be(e.dataSource,"children",e.getRowKey),L=U(A,1),K=L[0],x=te([],{value:e.editableKeys,onChange:e.onChange?function(f){var n,t,i;e==null||(n=e.onChange)===null||n===void 0||n.call(e,(t=f==null?void 0:f.filter(function(l){return l!==void 0}))!==null&&t!==void 0?t:[],(i=f==null?void 0:f.map(function(l){return K(l)}).filter(function(l){return l!==void 0}))!==null&&i!==void 0?i:[])}:void 0}),S=U(x,2),s=S[0],m=S[1],o=k.useMemo(function(){var f=N==="single"?s==null?void 0:s.slice(0,1):s;return new Set(f)},[(s||[]).join(","),N]),p=Oe(s),_=z(function(f){var n,t,i,l,E=(n=e.getRowKey(f,f.index))===null||n===void 0||(t=n.toString)===null||t===void 0?void 0:t.call(n),C=(i=e.getRowKey(f,-1))===null||i===void 0||(l=i.toString)===null||l===void 0?void 0:l.call(i),b=s==null?void 0:s.map(function(j){return j==null?void 0:j.toString()}),R=(p==null?void 0:p.map(function(j){return j==null?void 0:j.toString()}))||[],v=e.tableName&&!!(R!=null&&R.includes(C))||!!(R!=null&&R.includes(E));return{recordKey:C,isEditable:e.tableName&&(b==null?void 0:b.includes(C))||(b==null?void 0:b.includes(E)),preIsEditable:v}}),O=z(function(f,n){var t,i;return o.size>0&&N==="single"&&e.onlyOneLineEditorAlertMessage!==!1?(ne(e.onlyOneLineEditorAlertMessage||r.getMessage("editableTable.onlyOneLineEditor","只能同时编辑一行")),!1):(o.add(f),m(Array.from(o)),a.current=(t=n??((i=e.dataSource)===null||i===void 0?void 0:i.find(function(l,E){return e.getRowKey(l,E)===f})))!==null&&t!==void 0?t:null,!0)}),B=z(function(){var f=W(F().mark(function n(t,i){var l,E;return F().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(l=V(t).toString(),E=g.current.get(l),!(!o.has(l)&&E&&(i??!0)&&e.tableName)){b.next=5;break}return B(E,!1),b.abrupt("return");case 5:return y&&y.options.recordKey===t&&u(void 0),o.delete(l),o.delete(V(t)),m(Array.from(o)),b.abrupt("return",!0);case 10:case"end":return b.stop()}},n)}));return function(n,t){return f.apply(this,arguments)}}()),$=Ae(W(F().mark(function f(){var n,t,i,l,E=arguments;return F().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:for(t=E.length,i=new Array(t),l=0;l<t;l++)i[l]=E[l];(n=e.onValuesChange)===null||n===void 0||n.call.apply(n,[e].concat(i));case 2:case"end":return b.stop()}},f)})),64),Q=z(function(f,n){var t;if(e.onValuesChange){var i=e.dataSource;s==null||s.forEach(function(R){if((y==null?void 0:y.options.recordKey)!==R){var v=R.toString(),j=H(n,[e.tableName||"",v].flat(1).filter(function(M){return M||M===0}));j&&(i=Z({data:i,getRowKey:e.getRowKey,row:j,key:v,childrenColumnName:e.childrenColumnName||"children"},"update"))}});var l=f,E=(t=Object.keys(l||{}).pop())===null||t===void 0?void 0:t.toString(),C=c(c({},y==null?void 0:y.defaultValue),H(n,[e.tableName||"",E.toString()].flat(1).filter(function(R){return R||R===0}))),b=g.current.has(V(E))?i.find(function(R,v){var j,M=(j=e.getRowKey(R,v))===null||j===void 0?void 0:j.toString();return M===E}):C;$.run(b||C,i)}}),G=k.useRef(new Map);k.useEffect(function(){G.current.forEach(function(f,n){o.has(n)||G.current.delete(n)})},[G,o]);var D=z(function(){var f=W(F().mark(function n(t,i){var l,E,C,b;return F().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=V(t),E=g.current.get(t.toString()),!(!o.has(l)&&E&&(i??!0)&&e.tableName)){v.next=6;break}return v.next=5,D(E,!1);case 5:return v.abrupt("return",v.sent);case 6:return C=G.current.get(l)||G.current.get(l.toString()),v.prev=7,v.next=10,C==null||(b=C.current)===null||b===void 0?void 0:b.save();case 10:v.next=15;break;case 12:return v.prev=12,v.t0=v.catch(7),v.abrupt("return",!1);case 15:return o.delete(l),o.delete(l.toString()),m(Array.from(o)),v.abrupt("return",!0);case 19:case"end":return v.stop()}},n,null,[[7,12]])}));return function(n,t){return f.apply(this,arguments)}}()),X=z(function(f,n){if(n!=null&&n.parentKey&&!g.current.has(V(n==null?void 0:n.parentKey).toString()))return console.warn("can't find record by key",n==null?void 0:n.parentKey),!1;if(w.current&&e.onlyAddOneLineAlertMessage!==!1)return ne(e.onlyAddOneLineAlertMessage||r.getMessage("editableTable.onlyAddOneLine","只能新增一行")),!1;if(o.size>0&&N==="single"&&e.onlyOneLineEditorAlertMessage!==!1)return ne(e.onlyOneLineEditorAlertMessage||r.getMessage("editableTable.onlyOneLineEditor","只能同时编辑一行")),!1;var t=e.getRowKey(f,-1);if(!t&&t!==0)throw Me(!!t,`请设置 recordCreatorProps.record 并返回一个唯一的key  
  https://procomponents.ant.design/components/editable-table#editable-%E6%96%B0%E5%BB%BA%E8%A1%8C`),new Error("请设置 recordCreatorProps.record 并返回一个唯一的key");if(o.add(t),m(Array.from(o)),(n==null?void 0:n.newRecordType)==="dataSource"||e.tableName){var i,l={data:e.dataSource,getRowKey:e.getRowKey,row:c(c({},f),{},{map_row_parentKey:n!=null&&n.parentKey?(i=V(n==null?void 0:n.parentKey))===null||i===void 0?void 0:i.toString():void 0}),key:t,childrenColumnName:e.childrenColumnName||"children"};e.setDataSource(Z(l,(n==null?void 0:n.position)==="top"?"top":"update"))}else u({defaultValue:f,options:c(c({},n),{},{recordKey:t})});return!0}),ce=(e==null?void 0:e.saveText)||r.getMessage("editableTable.action.save","保存"),ve=(e==null?void 0:e.deleteText)||r.getMessage("editableTable.action.delete","删除"),fe=(e==null?void 0:e.cancelText)||r.getMessage("editableTable.action.cancel","取消"),ge=z(function(){var f=W(F().mark(function n(t,i,l,E){var C,b,R,v,j,M,ie;return F().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,e==null||(C=e.onSave)===null||C===void 0?void 0:C.call(e,t,i,l,E);case 2:return v=J.sent,J.next=5,B(t);case 5:if(j=E||w.current||{},M=j.options,!(!(M!=null&&M.parentKey)&&(M==null?void 0:M.recordKey)===t)){J.next=9;break}return(M==null?void 0:M.position)==="top"?e.setDataSource([i].concat(ue(e.dataSource))):e.setDataSource([].concat(ue(e.dataSource),[i])),J.abrupt("return",v);case 9:return ie={data:e.dataSource,getRowKey:e.getRowKey,row:M?c(c({},i),{},{map_row_parentKey:(b=V((R=M==null?void 0:M.parentKey)!==null&&R!==void 0?R:""))===null||b===void 0?void 0:b.toString()}):i,key:t,childrenColumnName:e.childrenColumnName||"children"},e.setDataSource(Z(ie,(M==null?void 0:M.position)==="top"?"top":"update")),J.next=13,B(t);case 13:return J.abrupt("return",v);case 14:case"end":return J.stop()}},n)}));return function(n,t,i,l){return f.apply(this,arguments)}}()),me=z(function(){var f=W(F().mark(function n(t,i){var l,E,C;return F().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return E={data:e.dataSource,getRowKey:e.getRowKey,row:i,key:t,childrenColumnName:e.childrenColumnName||"children"},R.next=3,e==null||(l=e.onDelete)===null||l===void 0?void 0:l.call(e,t,i);case 3:return C=R.sent,R.next=6,B(t,!1);case 6:return e.setDataSource(Z(E,"delete")),R.abrupt("return",C);case 8:case"end":return R.stop()}},n)}));return function(n,t){return f.apply(this,arguments)}}()),he=z(function(){var f=W(F().mark(function n(t,i,l,E){var C,b;return F().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,e==null||(C=e.onCancel)===null||C===void 0?void 0:C.call(e,t,i,l,E);case 2:return b=v.sent,v.abrupt("return",b);case 4:case"end":return v.stop()}},n)}));return function(n,t,i,l){return f.apply(this,arguments)}}()),le=e.actionRender&&typeof e.actionRender=="function",ye=le?e.actionRender:function(){},pe=z(ye),be=function(n){var t=e.getRowKey(n,n.index),i={saveText:ce,cancelText:fe,deleteText:ve,addEditRecord:X,recordKey:t,cancelEditable:B,index:n.index,tableName:e.tableName,newLineConfig:y,onCancel:he,onDelete:me,onSave:ge,editableKeys:s,setEditableRowKeys:m,preEditRowRef:a,deletePopconfirmMessage:e.deletePopconfirmMessage||"".concat(r.getMessage("deleteThisLine","删除此项"),"?")},l=tr(n,i);return e.tableName?G.current.set(g.current.get(V(t))||V(t),l.saveRef):G.current.set(V(t),l.saveRef),le?pe(n,i,{save:l.save,delete:l.delete,cancel:l.cancel}):[l.save,l.delete,l.cancel]};return{editableKeys:s,setEditableRowKeys:m,isEditable:_,actionRender:be,startEditable:O,cancelEditable:B,addEditRecord:X,saveEditable:D,newLineRecord:y,preEditableKeys:p,onValuesChange:Q,getRealIndex:e.getRealIndex}}export{fr as E,gr as I,hr as a,tr as d,Z as e,mr as g,V as r,yr as u};
//# sourceMappingURL=index-e570e6a7.js.map
