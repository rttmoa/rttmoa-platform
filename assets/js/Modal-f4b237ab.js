import{r as b,b3 as O,j as e,a3 as P,B as F,aq as o,R as z,C as c,ad as K,ar as E,at as D,b1 as U}from"./index-ce305ae4.js";import{C as k}from"./index-b008b159.js";import{T as G}from"./index-6f6fbe1d.js";import"./useBubbleLock-e08e9380.js";import"./index-a32ed1a8.js";import"./iconUtil-3566758d.js";import"./List-56c9e8f2.js";import"./conductUtil-aed6114a.js";const ee=S=>{const{form:x,modalIsVisible:T,setModalIsVisible:q,modalTitle:A,modalType:a,modalUserInfo:t,handleModalSubmit:C}=S,[p,L]=b.useState([]),[M,u]=b.useState([]),[g,h]=b.useState([]);function w(s){return s.map(r=>{var i,l;const n={title:((i=r.meta)==null?void 0:i.title)||"",key:((l=r.meta)==null?void 0:l.key)||""};return Array.isArray(r.children)&&r.children.length>0&&(n.children=w(r.children)),n})}b.useEffect(()=>{O({}).then(s=>{L(w(s.data||[])),u([]),h(a=="create"?"":t.permission_menu),x.setFieldsValue({role_name:a=="create"?"":t.role_name,permission_str:a=="create"?"":t.permission_str,level:a=="create"?1:t.level,sort:a=="create"?1:t.sort,status:a=="create"?!1:t.status,desc:a=="create"?"":t.desc})})},[a,t]);const I=()=>{u([]),h([]),q(!1)},N=()=>{function s(l,f,j=[]){for(const d of l){const m=d.key,y=[...j,m];if(m===f)return y;if(d.children&&d.children.length>0){const v=s(d.children,f,y);if(v)return v}}return null}function r(l,f){const j=new Set;return f.forEach(d=>{const m=s(l,d);m&&m.forEach(y=>j.add(y))}),Array.from(j)}const n=r(p,g),i=x.getFieldsValue();a=="edit"&&(i._id=t._id),i.permission_menu=g,i.menuList=n,C&&C(a,i)},_=s=>{const r=[],n=i=>{i.forEach(l=>{r.push(l.key),l.children&&n(l.children)})};return n(s),r},V=s=>{if(s.target.checked){const n=_(p);u(n)}else u([])},R=s=>{if(s.target.checked){const n=_(p);h(n)}else h([])},B=()=>{x.submit()};return e.jsx(P,{title:A,width:600,open:T,onCancel:I,footer:[e.jsx(F,{danger:!0,loading:!1,onClick:I,children:"取消"}),e.jsx(F,{type:"primary",loading:!1,onClick:B,children:"提交"},"link")],children:e.jsx(o,{className:"mt-[40px] mb-[100px] px-[20px] max-h-[500px] overflow-auto",layout:"horizontal",form:x,labelCol:{span:4},wrapperCol:{span:18},onFinish:N,children:e.jsxs(z,{gutter:16,children:[e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色名称",name:"role_name",rules:[{required:!0,message:"必填：角色名称"}],children:e.jsx(K,{placeholder:"请输入角色名称"})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"权限字符",name:"permission_str",rules:[{required:!0,message:"必填：权限字符"}],children:e.jsx(K,{placeholder:"请输入权限字符"})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色级别",name:"level",rules:[{required:!0,message:"必填：角色级别"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色顺序",name:"sort",rules:[{required:!0,message:"必填：角色顺序"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"状态",name:"status",rules:[{required:!1}],children:e.jsx(D,{})})}),e.jsx(c,{span:24,children:e.jsxs(o.Item,{label:"菜单分配",name:"permission_menu",rules:[{required:!1,message:"必填：菜单权限"}],children:[e.jsxs("div",{className:"mt-[6px] px-3 w-full flex justify-between",children:[e.jsx("div",{children:e.jsx(k,{onChange:V,children:"展开/折叠"})}),e.jsx("div",{children:e.jsx(k,{onChange:R,children:"全选/全不选"})}),e.jsx("div",{children:e.jsx(k,{defaultChecked:!0,onChange:()=>{},children:"父子联动"})})]}),e.jsx("div",{className:"mt-3 w-full p-3  border-[1px] rounded-lg",children:e.jsx(G,{checkStrictly:!1,showLine:!0,checkable:!0,treeData:p,checkedKeys:g,expandedKeys:M,onExpand:s=>{u(s)},onCheck:s=>{h(s)}})})]})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色描述",name:"desc",rules:[{required:!1}],children:e.jsx(U,{rows:3,placeholder:"请输入内容",maxLength:60})})})]})})})};export{ee as default};
//# sourceMappingURL=Modal-f4b237ab.js.map
