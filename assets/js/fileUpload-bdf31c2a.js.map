{"version":3,"file":"fileUpload-bdf31c2a.js","sources":["../../../src/views/feat/demo/components/fileUpload.tsx"],"sourcesContent":["/* eslint-disable prettier/prettier */\r\nimport { message } from '@/hooks/useMessage'\r\nimport { LoadingOutlined, StarOutlined, UploadOutlined } from '@ant-design/icons'\r\nimport { Button, Card, Modal, Upload } from 'antd'\r\nimport type { RcFile, UploadFile, UploadProps } from 'antd/es/upload/interface'\r\nimport React, { useState } from 'react'\r\n\r\nlet defaultFileList: any = [\r\n\t{\r\n\t\tuid: '1',\r\n\t\tname: 'xxx.png',\r\n\t\tstatus: 'uploading',\r\n\t\turl: 'http://www.baidu.com/xxx.png',\r\n\t\tpercent: 33,\r\n\t},\r\n\t{\r\n\t\tuid: '2',\r\n\t\tname: 'yyy.png',\r\n\t\tstatus: 'done',\r\n\t\turl: '\thttps://designer.mocky.io/static/media/chi-hang-leong-hehYcAGhbmY-unsplash.6914f9ac.jpg',\r\n\t},\r\n\t{\r\n\t\tuid: '3',\r\n\t\tname: 'zzz.png',\r\n\t\tstatus: 'error',\r\n\t\tresponse: 'Server Error 500', // custom error message to show\r\n\t\turl: '\thttps://designer.mocky.io/static/media/chi-hang-leong-hehYcAGhbmY-unsplash.6914f9ac.jpg',\r\n\t},\r\n]\r\nlet getBase64 = (file: RcFile): Promise<string> => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.readAsDataURL(file)\r\n\t\treader.onload = () => resolve(reader.result as string)\r\n\t\treader.onerror = error => reject(error)\r\n\t})\r\n}\r\nconst FileUpload: React.FC = () => {\r\n\tconst [previewOpen, setPreviewOpen] = useState(false)\r\n\tconst [previewImage, setPreviewImage] = useState('')\r\n\tconst [previewTitle, setPreviewTitle] = useState('')\r\n\tconst [fileList, setFileList] = useState<UploadFile[]>(defaultFileList)\r\n\tconst [loading, setLoading] = useState<boolean>(false)\r\n\t// upload: https://ant.design/components/upload-cn\r\n\tconst uploadProps: UploadProps = {\r\n\t\tfileList: fileList,\r\n\t\tname: 'file',\r\n\t\taction: 'https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188',\r\n\t\theaders: {\r\n\t\t\tauthorization: 'authorization-text',\r\n\t\t},\r\n\t\tonChange(info) {\r\n\t\t\tsetFileList(info.fileList)\r\n\t\t\tif (info.file.status == 'uploading') {\r\n\t\t\t\tsetLoading(true)\r\n\t\t\t\t// console.log(\"a\", info.file, info.fileList);\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (info.file.status === 'done') {\r\n\t\t\t\tsetLoading(false)\r\n\t\t\t\tmessage.success(`${info.file.name} file uploaded successfully`)\r\n\t\t\t} else if (info.file.status === 'error') {\r\n\t\t\t\tsetLoading(false)\r\n\t\t\t\tmessage.error(`${info.file.name} file upload failed.`)\r\n\t\t\t}\r\n\t\t},\r\n\t\tonRemove(file) {\r\n\t\t\tconst index = fileList.indexOf(file)\r\n\t\t\tconst newFileList = fileList.slice(index)\r\n\t\t\tnewFileList.splice(index, 1)\r\n\t\t\tsetFileList(newFileList)\r\n\t\t},\r\n\t\t// 上传前校验 & 上传前转换文件\r\n\t\tbeforeUpload(file: RcFile, FileList) {\r\n\t\t\tconst isJpgOrPng = file.type === 'image/jpg' || file.type === 'image/png'\r\n\t\t\tif (!isJpgOrPng) {\r\n\t\t\t\tconsole.log('仅接收传递的 jpg|png')\r\n\t\t\t}\r\n\t\t\tconst isLt2M = file.size / 1024 / 1024 < 2\r\n\t\t\tif (!isLt2M) {\r\n\t\t\t\tconsole.log('上传的文件必须小于 2M')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (file.type.includes('image')) {\r\n\t\t\t\treturn new Promise((resolve: any) => {\r\n\t\t\t\t\tconst reader = new FileReader()\r\n\t\t\t\t\treader.readAsDataURL(file)\r\n\t\t\t\t\treader.onload = () => {\r\n\t\t\t\t\t\tconst img = document.createElement('img')\r\n\t\t\t\t\t\timg.src = reader.result as string\r\n\t\t\t\t\t\timg.onload = () => {\r\n\t\t\t\t\t\t\tconst canvas = document.createElement('canvas')\r\n\t\t\t\t\t\t\tcanvas.width = img.naturalWidth\r\n\t\t\t\t\t\t\tcanvas.height = img.naturalHeight\r\n\t\t\t\t\t\t\tconst ctx = canvas.getContext('2d')!\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, 0)\r\n\t\t\t\t\t\t\tctx.fillStyle = 'red'\r\n\t\t\t\t\t\t\tctx.textBaseline = 'middle'\r\n\t\t\t\t\t\t\tctx.font = '33px Arial'\r\n\t\t\t\t\t\t\tctx.fillText('Watermark', 20, 20)\r\n\t\t\t\t\t\t\tcanvas.toBlob(result => resolve(result as any))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\treturn true // 任何都可以\r\n\t\t\t// return isJpgOrPng && isLt2M; // 为图片&文件大小\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\tstrokeColor: {\r\n\t\t\t\t'0%': '#108ee9',\r\n\t\t\t\t'100%': '#87d068',\r\n\t\t\t},\r\n\t\t\tsize: 3,\r\n\t\t\tformat: (percent: number | undefined): any => percent && `${parseFloat(percent.toFixed(2))}%`,\r\n\t\t},\r\n\t\tmultiple: true,\r\n\t\tmaxCount: 15,\r\n\t\tlistType: 'picture-card', // 'picture-circle'\r\n\t\t// 自定义交互图标, 使用 showUploadList 设置列表交互图标。\r\n\t\tshowUploadList: {\r\n\t\t\t// showDownloadIcon: true,\r\n\t\t\t// downloadIcon: \"Download\",\r\n\t\t\tshowRemoveIcon: true,\r\n\t\t\tremoveIcon: <StarOutlined onClick={e => console.log(e, 'custom removeIcon event')} />,\r\n\t\t},\r\n\t\tonPreview: async function (file: UploadFile) {\r\n\t\t\tif (!file.url && !file.preview) {\r\n\t\t\t\tfile.preview = await getBase64(file.originFileObj as RcFile)\r\n\t\t\t}\r\n\t\t\tsetPreviewImage(file.url || (file.preview as string))\r\n\t\t\tsetPreviewOpen(true)\r\n\t\t\tsetPreviewTitle(file.name || file.url!.substring(file.url!.lastIndexOf('/') + 1))\r\n\t\t},\r\n\t}\r\n\tconst handleCancel = () => setPreviewOpen(false)\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div>\r\n\t\t\t\t<h3>\r\n\t\t\t\t\t<b>文件上传</b>\r\n\t\t\t\t</h3>\r\n\t\t\t\t<Upload {...uploadProps}>\r\n\t\t\t\t\t<Button icon={loading ? <LoadingOutlined /> : <UploadOutlined />}></Button>\r\n\t\t\t\t</Upload>\r\n\t\t\t\t<Modal open={previewOpen} title={previewTitle} footer={null} onCancel={handleCancel}>\r\n\t\t\t\t\t<img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\r\n\t\t\t\t</Modal>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default FileUpload\r\n"],"names":["defaultFileList","getBase64","file","resolve","reject","reader","error","FileUpload","previewOpen","setPreviewOpen","useState","previewImage","setPreviewImage","previewTitle","setPreviewTitle","fileList","setFileList","loading","setLoading","uploadProps","info","message","index","newFileList","FileList","img","canvas","ctx","result","percent","StarOutlined","handleCancel","jsx","Fragment","Upload","Button","LoadingOutlined","UploadOutlined","Modal"],"mappings":"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"}