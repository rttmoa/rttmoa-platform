var j=Object.defineProperty;var d=(n,i,t)=>i in n?j(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t;var o=(n,i,t)=>(d(n,typeof i!="symbol"?i+"":i,t),t);import{b as u,b7 as c,j as e}from"./.pnpm-e6eae8df.js";import l from"./icon-svg-724e7192.js";import"./iconfont-873c24b7.js";class f extends u.Component{constructor(t){super(t);o(this,"this");o(this,"axios");this.state={val:"",html:"",link:"",linkMask:!1},c.setOptions({renderer:new c.Renderer,gfm:!0,breaks:!0,pedantic:!1})}componentWillMount(){this.setState({val:this.props.value||""},()=>{this.renderHtml()})}async insertImg(t){let s=new FormData,a="";s.append("img",t.target.files[0]);try{a=(await this.axios({method:"post",url:"http://localhost:3000/markdown_upload_img",data:s})).data.img}catch{}let r=`![图片描述](${a})`;this.setCursorPosition(this.refs.text,r,6)}insertLink(){this.setState({linkMask:!1},()=>{let t=`[链接描述](${this.state.link})`;this.setCursorPosition(this.refs.text,t,5)})}insertCode(){let t="\n```\n\n```";this.setCursorPosition(this.refs.text,t,t.length-4)}setCursorPosition(t,s,a){var r=0;t.selectionStart&&(r=t.selectionStart),this.insertAtCursor(t,s),t.focus(),t.setSelectionRange(t.value.length,r+(a||s.length)),this.setState({val:t.value})}insertAtCursor(t,s){let a;if(!a.selection)if(t.selectionStart||t.selectionStart=="0"){let r=Number(t.selectionStart),h=t.selectionEnd,x=t.scrollTop;t.value=t.value.substring(0,r)+s+t.value.substring(h,t.value.length),x>0&&(t.scrollTop=x),t.focus(),t.selectionStart=r+s.length,t.selectionEnd=r+s.length}else t.value+=s,t.focus()}handleInput(t){this.setState({val:t},()=>{this.renderHtml()})}renderHtml(){this.setState({html:c(this.state.val)},()=>{let{val:t,html:s}=this.state;this.props.callback&&this.props.callback({markdown:t,html:s})})}render(){return e.jsxs("div",{id:"markdowm",children:[e.jsx("div",{className:"md-title",children:e.jsxs("ul",{className:"cf",style:{display:"flex",alignItems:"center",fontWeight:600},children:[e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"****",2)},children:e.jsx("a",{href:"javascript:;",title:"粗体",children:e.jsx(l,{iconName:"bold"})})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"**",1)},children:e.jsx("a",{href:"javascript:;",title:"斜体",children:e.jsx(l,{iconName:"italic"})})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"# ",2)},children:e.jsx("a",{href:"javascript:;",title:"h1",children:"h1"})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"## ",3)},children:e.jsx("a",{href:"javascript:;",title:"h2",children:"h2"})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"### ",4)},children:e.jsx("a",{href:"javascript:;",title:"h3",children:"h3"})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"#### ",5)},children:e.jsx("a",{href:"javascript:;",title:"h4",children:"h4"})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"##### ",6)},children:e.jsx("a",{href:"javascript:;",title:"h5",children:"h5"})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"##### ",7)},children:e.jsx("a",{href:"javascript:;",title:"h6",children:"h6"})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"~~~~",2)},children:e.jsx("a",{href:"javascript:;",title:"中划线",children:e.jsx(l,{iconName:"strikethrough"})})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"> ",2)},children:e.jsx("a",{href:"javascript:;",title:"引用",children:e.jsx(l,{iconName:"quote"})})}),e.jsxs("li",{children:[e.jsx("a",{href:"javascript:;",title:"图片",children:e.jsx(l,{iconName:"image"})}),e.jsx("input",{type:"file",className:"uploadFile"})]}),e.jsx("li",{onClick:t=>{this.setState({linkMask:!0})},children:e.jsx("a",{href:"javascript:;",title:"链接",children:e.jsx(l,{iconName:"link"})})}),e.jsx("li",{onClick:this.insertCode.bind(this),children:e.jsx("a",{href:"javascript:;",title:"代码块",children:e.jsx(l,{iconName:"code"})})}),e.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"---",2)},children:e.jsx("a",{href:"javascript:;",title:"分割线",children:e.jsx(l,{iconName:"758bianjiqi_fengexian"})})})]})}),e.jsx("textarea",{ref:"text",value:this.state.val,onChange:t=>{this.handleInput(t.target.value)}}),e.jsx("div",{className:"render fmt",dangerouslySetInnerHTML:{__html:this.state.html}}),e.jsx("div",{className:"mask",style:{display:this.state.linkMask?"block":"none"},children:e.jsxs("div",{className:"link-text",children:[e.jsx("input",{type:"text",ref:"link"}),e.jsx("button",{onClick:this.insertLink.bind(this),children:"确定"})]})})]})}}const m=f;export{m as default};
