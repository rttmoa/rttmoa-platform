{"version":3,"file":"index-09bf75af.js","sources":["../../../src/views/module/product/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { Button, Card, Popconfirm, Table, TableColumnsType, message, Image } from 'antd'\r\nimport { useNavigate } from 'react-router-dom'\r\nimport defaultImg from '@/assets/images/defaultImg.jpg'\r\nimport { productList } from '@/api/modules/module/product'\r\n\r\nexport interface listProps {\r\n\tlist?: any\r\n\ttotal?: number\r\n\tpage?: number\r\n\tpageSize?: number\r\n}\r\n\r\n// coverImg: \"http://localhost:3009/uploads/20230406/1680794476636.jpg\"\r\nexport const serverUrl = 'http://localhost:3009'\r\n\r\nconst List = () => {\r\n\tconst navigate = useNavigate()\r\n\tconst [loading, setLoading] = useState(false)\r\n\tconst [searchName, setsearchName] = useState('')\r\n\tconst [searchType, setsearchType] = useState('productName')\r\n\tconst [data, setData] = useState<listProps>({ list: [], total: 0, page: 1, pageSize: 5 })\r\n\tconst { list, total, page, pageSize } = data\r\n\r\n\t// 发送请求 | 通过redux去处理\r\n\tconst loadData = async (page: number, pageSize: number) => {\r\n\t\tsetData({ page: page })\r\n\t\tsetLoading(true)\r\n\t\tlet result: any\r\n\t\tif (searchName) {\r\n\t\t\tresult = await productList(page, pageSize, searchName, searchType)\r\n\t\t} else {\r\n\t\t\tresult = await productList(page, pageSize)\r\n\t\t}\r\n\t\tif (result.code == 200) {\r\n\t\t\tsetLoading(false)\r\n\t\t\tsetData(result.data)\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tloadData(page!, pageSize!)\r\n\t}, [])\r\n\r\n\tconst columns: TableColumnsType = [\r\n\t\t{\r\n\t\t\ttitle: '序号',\r\n\t\t\tkey: '_id',\r\n\t\t\twidth: 80,\r\n\t\t\talign: 'center',\r\n\t\t\trender: (text: any, record: any, index: number): any => index + 1,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '商品名称',\r\n\t\t\tdataIndex: 'name',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '主图',\r\n\t\t\tdataIndex: 'coverImg',\r\n\t\t\trender: (txt: any, record: any) => (\r\n\t\t\t\t// <Image src={record.coverImg ? serverUrl + record.coverImg : defaultImg} alt={record.name} style={{ width: 60 }} />\r\n\t\t\t\t<Image src={record.coverImg} alt={record.name} style={{ width: 60 }} />\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '价格',\r\n\t\t\tdataIndex: 'price',\r\n\t\t\trender(price) {\r\n\t\t\t\treturn `￥${price}`\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '是否在售',\r\n\t\t\tdataIndex: 'onSale',\r\n\t\t\trender: (txt: any, record: any) => (record.onSale ? '在售' : '已下架'),\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '商品描述',\r\n\t\t\tdataIndex: 'desc',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '操作',\r\n\t\t\trender: (txt: any, record: any, index: any) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tnavigate(`/module/product/detail?id=${record._id}`)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t修改\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Popconfirm\r\n\t\t\t\t\t\t\ttitle=\"确定删除此项\"\r\n\t\t\t\t\t\t\tonCancel={() => {\r\n\t\t\t\t\t\t\t\tconsole.log('用户取消删除')\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tonConfirm={() => {\r\n\t\t\t\t\t\t\t\t// todo 此处调用api接口进行删除\r\n\t\t\t\t\t\t\t\t// delOne(record._id).then(res => {\r\n\t\t\t\t\t\t\t\t//   loadData();\r\n\t\t\t\t\t\t\t\t// });\r\n\t\t\t\t\t\t\t\tmessage.info(`删除： _id=${record._id}`)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t<Button type=\"dashed\" size=\"small\" style={{ margin: '0 1rem' }}>\r\n\t\t\t\t\t\t\t\t删除\r\n\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t</Popconfirm>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t// modifyOne(record._id, { onSale: !record.onSale }).then(res => {\r\n\t\t\t\t\t\t\t\t//   重新拿参数去请求：页码，请求参数，信息去请求\r\n\t\t\t\t\t\t\t\t//   loadData(page!, pageSize!);\r\n\t\t\t\t\t\t\t\t// });\r\n\t\t\t\t\t\t\t\tmessage.info(`修改在售： _id=${record._id}`)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t{record.onSale ? '下架' : '上架'}\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t},\r\n\t]\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<Card\r\n\t\t\t\ttitle=\"商品列表\"\r\n\t\t\t\textra={\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tnavigate('/module/product/detail')\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t新增\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}>\r\n\t\t\t\t<Table\r\n\t\t\t\t\tbordered\r\n\t\t\t\t\trowKey=\"_id\"\r\n\t\t\t\t\tloading={loading}\r\n\t\t\t\t\trowClassName={(record: any) => (record?.onSale ? '' : 'bg-red')}\r\n\t\t\t\t\tcolumns={columns}\r\n\t\t\t\t\tdataSource={list}\r\n\t\t\t\t\tpagination={{\r\n\t\t\t\t\t\tcurrent: page, // 当前页数\r\n\t\t\t\t\t\ttotal, // 数据总数\r\n\t\t\t\t\t\tdefaultPageSize: pageSize, // 默认的每页条数\r\n\t\t\t\t\t\tshowSizeChanger: true,\r\n\t\t\t\t\t\tpageSizeOptions: ['3', '5', '10', '15'],\r\n\t\t\t\t\t\tshowQuickJumper: true,\r\n\t\t\t\t\t\tonChange: loadData, // 页码改变的回调，参数是改变后的页码及每页条数\r\n\t\t\t\t\t\tonShowSizeChange: (current, size) => {\r\n\t\t\t\t\t\t\t// console.log('pageSize 变化的回调', current, size);\r\n\t\t\t\t\t\t\tsetData({ pageSize: size })\r\n\t\t\t\t\t\t\tloadData(page!, size)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t</Card>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default List\r\n"],"names":["serverUrl","List","navigate","useNavigate","loading","setLoading","useState","searchName","setsearchName","searchType","setsearchType","data","setData","list","total","page","pageSize","loadData","result","productList","useEffect","columns","text","record","index","txt","jsx","Image","price","Button","Popconfirm","message","Card","Table","current","size"],"mappings":"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"}