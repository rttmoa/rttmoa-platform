import{r as n,as as se,a9 as o,j as e,Q as re,B as O,M as g,V as R}from"./index-962a12c9.js";import{T as ne}from"./index-25c26135.js";import{r as ae,a as le}from"./roleManage-4678e06a.js";import{C as w}from"./index-a05e097f.js";import{S as j}from"./index-1d0f5cbe.js";import{T as x}from"./index-d793a3cd.js";import{T as oe}from"./index-60f55e26.js";import"./___vite-browser-external_commonjs-proxy-bd1626b9.js";import"./Table-73fd2c50.js";import"./styleChecker-7d49b54b.js";import"./List-2f4b4b55.js";import"./iconUtil-09ff0a50.js";import"./conductUtil-2222ea8b.js";import"./index-a3fbcd85.js";import"./index-3e5c7df9.js";import"./index-44bd719f.js";import"./index-e1e7c8ac.js";import"./Skeleton-81ef34db.js";import"./useIcons-bf0027ac.js";import"./transButton-661dbf36.js";function M(i){if(!i)return"";let a=new Date(Number(i));return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}const Re=()=>{const[i,a]=n.useState([]),[S,f]=n.useState([]),[I,b]=n.useState([]),[s,m]=n.useState({}),c=se(t=>t.auth.authMenuList),[d]=o.useForm(),[r]=o.useForm(),[l]=o.useForm(),[C,u]=n.useState(!1),[F,_]=n.useState(!1),[z,B]=n.useState({}),[L,D]=n.useState([]),[E,T]=n.useState(!1),[U,v]=n.useState([]),[K,P]=n.useState([]),[A,H]=n.useState(null),[J,Q]=n.useState({}),Y=n.useRef();n.useEffect(()=>{(async function(){ae().then(t=>{const h=t.data.list.map((p,y)=>({...p,key:y}));a(h)})})()},[]);const q=[{title:"角色名称",dataIndex:"role_name",align:"center"},{title:"使用状态",dataIndex:"status",align:"center",render:t=>t===1?"启用":"停用"},{title:"授权人",align:"center",dataIndex:"authorize_user_name"},{title:"创建时间",align:"center",dataIndex:"create_time",render:M},{title:"授权时间",align:"center",dataIndex:"authorize_time",render:M}],G=(t,h,p)=>{p?(f(t),b(p),m(h)):(f(t),m(h))},W=()=>{u(!0)},X=()=>{d.getFieldsValue(),d.resetFields(),u(!1)},Z=()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"请选择一个角色"});return}_(!0),B(s),D(s.menus)},$=()=>{let t=r.getFieldsValue();t.role_id=s.id,t.menus=L,t.authorize_time=Date.now(),r.resetFields(),_(!1)},ee=async()=>{if(JSON.stringify(s)=="{}"){g.info({title:"信息",content:"未选中任何项目"});return}const t=await le(s.id),h=[],p=[];if(t.data.length>0){const y=t.data;for(let N=0;N<y.length;N++){const V=y[N],k={key:V.user_id,title:V.user_name,status:V.status};k.status===1&&p.push(k.key),h.push(k)}}v(h),P(p),Q(s),H(!1),T(!0)},te=()=>{s.id,l.resetFields(),T(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{extra:e.jsxs(re,{size:"middle",children:[e.jsx(O,{type:"primary",onClick:W,children:"创建角色"}),e.jsx(O,{type:s.id?"primary":"default",onClick:Z,disabled:!s.id,children:"设置权限"}),e.jsx(O,{type:s.id?"primary":"default",onClick:ee,disabled:!s.id,children:"用户授权"})]}),children:e.jsx(ne,{columns:q,dataSource:i,selectedRowKeys:S,selectedIds:I,selectedItem:s,pagination:{},updateSelectedItem:G})}),e.jsx(g,{title:"创建角色",open:C,onOk:X,onCancel:()=>{d.resetFields(),u(!1)},children:e.jsx(ie,{form:d})}),e.jsx(g,{width:600,title:"权限设置",open:F,onOk:$,onCancel:()=>{r.resetFields(),_(!1)},children:e.jsx(ce,{form:r,detailInfo:z,menuInfo:L||[],patchMenuInfo:t=>{D(t)},menuConfig:c})}),e.jsx(g,{title:"用户授权",width:800,open:E,onOk:te,onCancel:()=>{l.resetFields(),T(!1)},children:e.jsx(de,{form:l,isClose:A,detailUserInfo:J,targetKeys:K,transferData:U,patchUserInfo:t=>{P(t)},ref:Y})})]})};function ie({form:i}){const a={labelCol:{span:5},wrapperCol:{span:16}};return e.jsx(e.Fragment,{children:e.jsx(w,{children:e.jsxs(o,{form:i,...a,initialValues:{status:1},children:[e.jsx(o.Item,{label:"角色名称",name:"role_name",children:e.jsx(R,{type:"text",placeholder:"请输入角色名称"})}),e.jsx(o.Item,{label:"状态",name:"status",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"开启"}),e.jsx(j.Option,{value:0,children:"关闭"})]})})]})})})}function ce({form:i,detailInfo:a,menuInfo:S,patchMenuInfo:f,menuConfig:I}){const b=(c,d="")=>{const r=[];return c.btnList.forEach(l=>{r.push(e.jsx(x.TreeNode,{title:l.meta.title,className:"op-role-tree"},d+"-btn-"+l.path))}),r},s=(c,d)=>c.map(r=>{let l=r.path;return r.children?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:s(r.children)},l):r.btnList?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:b(r,l)},l):e.jsx(x.TreeNode,{title:r.meta.title},l)}),m={labelCol:{span:4},wrapperCol:{span:16}};return e.jsx(o,{form:i,layout:"horizontal",...m,initialValues:{status2:1,role_name2:a.role_name},children:e.jsxs(w,{children:[e.jsx(o.Item,{label:"角色名称",name:"role_name2",children:e.jsx(R,{disabled:!0,maxLength:8,placeholder:a.role_name})}),e.jsx(o.Item,{label:"状态",name:"status2",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"启用"}),e.jsx(j.Option,{value:0,children:"停用"})]})}),e.jsx(o.Item,{label:"菜单",name:"menu",children:e.jsx(x,{checkable:!0,defaultExpandAll:!0,onCheck:c=>{f(c)},checkedKeys:S||[],children:e.jsx(x.TreeNode,{title:"平台权限",children:s(I)},"platform_all")})})]})})}function de({form:i,isClose:a,detailUserInfo:S,targetKeys:f,transferData:I,patchUserInfo:b,ref:s}){const[m,c]=n.useState(11),d=()=>(c(m+1),m);n.useImperativeHandle(s,()=>({status:m,statusValue:d}));const r=(u,F)=>F.title.indexOf(u)>-1,l=u=>{b(u)},C={labelCol:{span:5},wrapperCol:{span:18}};return e.jsxs(o,{form:i,layout:"horizontal",...C,initialValues:{transfer:f},children:[e.jsx(o.Item,{name:"role_name3",label:"角色名称",children:e.jsx(R,{disabled:!0,maxLength:8,placeholder:S.role_name})}),e.jsx(o.Item,{name:"transfer",label:"选择用户：",children:e.jsx(oe,{listStyle:{width:200,height:400},dataSource:I,showSearch:!0,titles:["待选用户","已选用户"],filterOption:r,targetKeys:f,onChange:l,render:u=>u.title})})]})}export{Re as default};
