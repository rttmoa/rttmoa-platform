{"version":3,"file":"index-0c366ef6.js","sources":["../../../src/api/modules/module/category.ts","../../../src/views/module/category/index.tsx"],"sourcesContent":["import http from \"@/api\";\nimport { PORT1 } from \"@/api/config/servicePort\";\n\n// 功能模块 > 获取分类列表\nexport const categoryList = (parentId: string) => {\n  return http.get(PORT1 + `/category/list?parentId=${parentId}`);\n  // return http.get(PORT1 + `/category/list`, {parentId});\n};\n\n// 添加分类\nexport const categoryAdd = (parentId: string, categoryName: string) => {\n  return http.post(PORT1 + `/category/add`, { parentId, categoryName });\n};\n\n// 更新分类\nexport const categoryUpdate = (parentId: string, categoryName: string) => {\n  return http.post(PORT1 + `/category/update`, { parentId, categoryName });\n};\n","import { categoryAdd, categoryList, categoryUpdate } from \"@/api/modules/module/category\";\nimport { Icon } from \"@/components/Icon\";\nimport { Button, Card, Form, Input, Modal, Select, Table, message } from \"antd\";\nimport React, { useEffect, useState } from \"react\";\n\nconst Category = () => {\n  const [loading, setLoading] = useState(false);\n  const [parentID, setparentID] = useState<string>(\"0\");\n  const [parentName, setparentName] = useState(\"\");\n  const [categoryObj, setcategoryObj] = useState<any>({});\n  const [categorys, setcategorys] = useState([]);\n  const [subCategorys, setsubCategorys] = useState([]);\n  const [showStatus, setshowStatus] = useState(0);\n\n  const [form_ins] = Form.useForm();\n  const [form_up] = Form.useForm();\n\n  // ! 异步获取一级/二级分类列表显示\n  const getCategorys = async (parentId: string) => {\n    setLoading(true);\n    parentId = parentId || parentID;\n    const res: any = await categoryList(parentId);\n    setLoading(false);\n    console.log(\"结果：\", res);\n    if (res.code === 200) {\n      let categorys: any = res.data.map((item: any, idn: any) => ({ ...item, key: idn }));\n      console.log(parentId);\n      if (parentId == \"0\") {\n        setcategorys(categorys);\n      } else {\n        setsubCategorys(categorys);\n      }\n    } else {\n      message.error(\"获取分类列表失败\");\n    }\n  };\n  useEffect(() => {\n    getCategorys(\"\");\n  }, []);\n\n  const column = [\n    {\n      title: parentID === \"0\" ? \"一级分类名称\" : \"二级分类名称\",\n      dataIndex: \"name\" // 显示数据对应的属性名\n    },\n    {\n      title: \"操作\",\n      width: 300,\n      render: (category: any) => {\n        return (\n          <span>\n            <Button\n              style={{ color: \"#fe8281\" }}\n              type=\"link\"\n              onClick={() => {\n                showUpdate(category);\n              }}\n            >\n              {parentID === \"0\" ? \"修改一级分类\" : \"修改二级分类\"}\n            </Button>\n            {parentID === \"0\" ? (\n              <Button\n                type=\"link\"\n                onClick={() => {\n                  showSubCategorys(category);\n                }}\n              >\n                查看子分类\n              </Button>\n            ) : null}\n          </span>\n        );\n      }\n    }\n  ];\n\n  // 修改分类按钮 > 开启弹窗\n  const showUpdate = (category: any) => {\n    setcategoryObj(category);\n    setshowStatus(2);\n  };\n  // 查看子分类按钮 > 显示子分类列表\n  const showSubCategorys = (category: any) => {\n    setparentID(category._id);\n    setparentName(category.name);\n    // console.log(category.name, category._id);\n    getCategorys(category._id);\n  };\n\n  // 显示指定一级分类列表\n  const shwoCategorys = () => {\n    setparentID(\"0\");\n    setparentName(\"\");\n    setsubCategorys([]);\n  };\n\n  // 添加分类\n  const addCategory = async () => {\n    const { parentId, categoryName } = form_ins.getFieldsValue();\n    console.log(parentId, categoryName); // 5e130ec7e31bb727e4b0e34c Vivo\n    const res = await categoryAdd(parentId, categoryName);\n    setshowStatus(0);\n    if (res.code === 200) {\n      // 添加的分类就是当前分类列表下的分类\n      if (parentId === parentID) {\n        // 重新获取当前分类列表显示\n        getCategorys(parentId);\n      } else if (parentId === \"0\") {\n        // 在二级分类列表下添加一级分类, 重新获取一级分类列表, 但不需要显示一级列表\n        getCategorys(\"0\");\n      }\n    }\n  };\n  // 更新分类\n  const updateCategory = async () => {\n    // 1. 隐藏确定框\n    setshowStatus(0);\n\n    // 2.准备数据\n    const categoryId = categoryObj._id;\n    const { categoryName } = form_up.getFieldsValue();\n\n    // 3. 发请求更新分类\n    const res = await categoryUpdate(categoryId, categoryName);\n    if (res.code === 200) {\n      // 4. 重新显示列表\n      getCategorys(\"\");\n    }\n  };\n  return (\n    <>\n      <Card\n        title={\n          parentID === \"0\" ? (\n            \"一级分类列表\"\n          ) : (\n            <span>\n              <Button onClick={shwoCategorys} type=\"link\">\n                <b>一级分类列表</b>\n              </Button>\n              {/* <Icon name=\"arrow-right\" /> */}\n              {\"->\"}&nbsp;&nbsp;&nbsp;\n              <span className=\"font-normal font-serif\">{parentName}</span>\n            </span>\n          )\n        }\n        extra={\n          <Button\n            type=\"primary\"\n            onClick={() => {\n              setshowStatus(1);\n            }}\n          >\n            {/* <Icon name=\"plus\" /> */}\n            添加分类\n          </Button>\n        }\n      >\n        <Table loading={loading} columns={column} dataSource={parentID === \"0\" ? categorys : subCategorys} />\n      </Card>\n      <Modal\n        title=\"添加分类\"\n        open={showStatus === 1}\n        onOk={addCategory}\n        onCancel={() => {\n          setshowStatus(0);\n        }}\n      >\n        <AddForm categorys={categorys} parentId={parentID} form={form_ins} />\n      </Modal>\n      <Modal\n        title=\"修改分类\"\n        open={showStatus === 2}\n        onOk={updateCategory}\n        onCancel={() => {\n          setshowStatus(0);\n        }}\n      >\n        <UpdateForm categoryName={categoryObj.name} form={form_up} />\n      </Modal>\n    </>\n  );\n};\n\nfunction AddForm({ categorys, parentId, form }: any) {\n  useEffect(() => {\n    return () => {\n      form.resetFields();\n    };\n  });\n  return (\n    <>\n      <Form form={form} initialValues={{ parentId: parentId }}>\n        <Form.Item name=\"parentId\">\n          <Select>\n            <Select.Option value={\"0\"}>一级分类</Select.Option>\n            {categorys.map((item: any) => {\n              return (\n                <Select.Option key={item._id} value={item._id}>\n                  {item.name}\n                </Select.Option>\n              );\n            })}\n          </Select>\n        </Form.Item>\n        <Form.Item name=\"categoryName\">\n          <Input placeholder=\"请输入分类名称\" />\n        </Form.Item>\n      </Form>\n    </>\n  );\n}\n\nfunction UpdateForm({ categoryName, form }: any) {\n  useEffect(() => {\n    return () => {\n      form.resetFields();\n    };\n  });\n  return (\n    <>\n      <Form form={form} initialValues={{ categoryName: categoryName }}>\n        <Form.Item name=\"categoryName\">\n          <Input placeholder=\"请输入分类名称\" />\n        </Form.Item>\n      </Form>\n    </>\n  );\n}\n\nexport default Category;\n"],"names":["categoryList","parentId","http","get","PORT1","categoryAdd","categoryName","post","categoryUpdate","Category","loading","setLoading","useState","parentID","setparentID","parentName","setparentName","categoryObj","setcategoryObj","categorys","setcategorys","subCategorys","setsubCategorys","showStatus","setshowStatus","form_ins","Form","form_up","getCategorys","res","item","idn","message","useEffect","column","category","jsx","Button","showUpdate","showSubCategorys","shwoCategorys","addCategory","updateCategory","categoryId","jsxs","Fragment","Card","Table","Modal","AddForm","UpdateForm","form","Select","Input"],"mappings":"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"}