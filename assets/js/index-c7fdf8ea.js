import{r,an as o,j as e,C as L,B as m,a7 as P,$ as k,au as p,I,b2 as R}from"./.pnpm-e6eae8df.js";import{h as x,P as g}from"./index-479552fe.js";const T=s=>x.get(g+`/category/list?parentId=${s}`),$=(s,a)=>x.post(g+"/category/add",{parentId:s,categoryName:a}),M=(s,a)=>x.post(g+"/category/update",{parentId:s,categoryName:a}),J=()=>{const[s,a]=r.useState(!1),[n,c]=r.useState("0"),[w,h]=r.useState(""),[y,b]=r.useState({}),[j,N]=r.useState([]),[O,f]=r.useState([]),[C,l]=r.useState(0),[F]=o.useForm(),[S]=o.useForm(),d=async t=>{a(!0),t=t||n;const i=await T(t);if(a(!1),i.code===200){let u=i.data.map((B,D)=>({...B,key:D}));t=="0"?N(u):f(u)}else R.error("获取分类列表失败")};r.useEffect(()=>{d("")},[]);const _=[{title:n==="0"?"一级分类名称":"二级分类名称",dataIndex:"name"},{title:"操作",width:300,render:t=>e.jsxs("span",{children:[e.jsx(m,{style:{color:"#fe8281"},type:"link",onClick:()=>{E(t)},children:n==="0"?"修改一级分类":"修改二级分类"}),n==="0"?e.jsx(m,{type:"link",onClick:()=>{V(t)},children:"查看子分类"}):null]})}],E=t=>{b(t),l(2)},V=t=>{c(t._id),h(t.name),d(t._id)},U=()=>{c("0"),h(""),f([])},v=async()=>{const{parentId:t,categoryName:i}=F.getFieldsValue(),u=await $(t,i);l(0),u.code===200&&(t===n?d(t):t==="0"&&d("0"))},A=async()=>{l(0);const t=y._id,{categoryName:i}=S.getFieldsValue();(await M(t,i)).code===200&&d("")};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:n==="0"?"一级分类列表":e.jsxs("span",{children:[e.jsx(m,{onClick:U,type:"link",children:e.jsx("b",{children:"一级分类列表"})}),"->","   ",e.jsx("span",{className:"font-normal font-serif",children:w})]}),extra:e.jsx(m,{type:"primary",onClick:()=>{l(1)},children:"添加分类"}),children:e.jsx(P,{loading:s,columns:_,dataSource:n==="0"?j:O})}),e.jsx(k,{title:"添加分类",open:C===1,onOk:v,onCancel:()=>{l(0)},children:e.jsx(q,{categorys:j,parentId:n,form:F})}),e.jsx(k,{title:"修改分类",open:C===2,onOk:A,onCancel:()=>{l(0)},children:e.jsx(z,{categoryName:y.name,form:S})})]})};function q({categorys:s,parentId:a,form:n}){return r.useEffect(()=>()=>{n.resetFields()}),e.jsx(e.Fragment,{children:e.jsxs(o,{form:n,initialValues:{parentId:a},children:[e.jsx(o.Item,{name:"parentId",children:e.jsxs(p,{children:[e.jsx(p.Option,{value:"0",children:"一级分类"}),s.map(c=>e.jsx(p.Option,{value:c._id,children:c.name},c._id))]})}),e.jsx(o.Item,{name:"categoryName",children:e.jsx(I,{placeholder:"请输入分类名称"})})]})})}function z({categoryName:s,form:a}){return r.useEffect(()=>()=>{a.resetFields()}),e.jsx(e.Fragment,{children:e.jsx(o,{form:a,initialValues:{categoryName:s},children:e.jsx(o.Item,{name:"categoryName",children:e.jsx(I,{placeholder:"请输入分类名称"})})})})}export{J as default};
