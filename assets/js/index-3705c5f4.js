var m=Object.defineProperty;var x=(l,s,t)=>s in l?m(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t;var h=(l,s,t)=>(x(l,typeof s!="symbol"?s+"":s,t),t);import{a as j,j as i}from"./react-12b51ca5.js";import{m as c}from"./marked-da5dbf02.js";import o from"./icon-svg-6ed06c57.js";import"./iconfont-873c24b7.js";import"./@ant-design-63539318.js";import"./rc-util-8976b5fa.js";import"./react-dom-e71a48dd.js";import"./@babel-c46ce09a.js";import"./classnames-3ded05b8.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-5c9960e4.js";import"./@umijs-02c6bdf5.js";import"./swr-1237c4b3.js";import"./use-sync-external-store-ad55a9d4.js";import"./@dnd-kit-908a095e.js";import"./antd-e2492052.js";import"./rc-motion-25d44171.js";import"./rc-notification-3ca02e51.js";import"./rc-overflow-7fc9dc70.js";import"./rc-picker-d202c760.js";import"./dayjs-6d610299.js";import"./@rc-component-60bdd203.js";import"./@ctrl-bad846bd.js";import"./rc-tabs-f080ce12.js";import"./rc-dropdown-1fd4539e.js";import"./rc-menu-c99c3faa.js";import"./rc-cascader-238c5b8d.js";import"./rc-select-8e380119.js";import"./rc-virtual-list-5b0902fa.js";import"./rc-tree-898f7873.js";import"./rc-input-number-f64f90f1.js";import"./rc-input-3682369a.js";import"./rc-collapse-3e02f0e2.js";import"./rc-drawer-9ef263c4.js";import"./rc-field-form-e46b50c8.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-582d6ca4.js";import"./compute-scroll-into-view-e3f0ecc2.js";import"./rc-image-3cfe7923.js";import"./rc-dialog-8eb1683d.js";import"./rc-mentions-9823f19c.js";import"./rc-textarea-b098f88a.js";import"./rc-tooltip-01b6b839.js";import"./qrcode.react-e22f0a27.js";import"./rc-rate-2d3465a8.js";import"./rc-segmented-6536d122.js";import"./rc-slider-e91f05e6.js";import"./rc-steps-f39c48c2.js";import"./rc-switch-8d316ace.js";import"./rc-table-a211065a.js";import"./rc-checkbox-ae7b2d99.js";import"./throttle-debounce-87e7e444.js";import"./rc-pagination-334fefa5.js";import"./rc-tree-select-5a273e06.js";import"./copy-to-clipboard-47a2b094.js";import"./toggle-selection-93f4ad84.js";import"./rc-upload-71d17dfe.js";import"./rc-progress-a416f280.js";import"./omit.js-929edb61.js";import"./lodash.merge-9922d51b.js";import"./safe-stable-stringify-023075f7.js";import"./@chenshuai2144-5a33ccd2.js";import"./reactcss-f166c0a9.js";import"./lodash-40f09dbd.js";import"./tinycolor2-ea5bcbb6.js";import"./lodash.tonumber-b59040d8.js";import"./@emotion-70f0a3ab.js";import"./stylis-d04dd720.js";class d extends j.Component{constructor(t){super(t);h(this,"this");h(this,"axios");this.state={val:"",html:"",link:"",linkMask:!1},c.setOptions({renderer:new c.Renderer,gfm:!0,breaks:!0,pedantic:!1})}componentWillMount(){this.setState({val:this.props.value||""},()=>{this.renderHtml()})}async insertImg(t){let e=new FormData,n="";e.append("img",t.target.files[0]);try{n=(await this.axios({method:"post",url:"http://localhost:3000/markdown_upload_img",data:e})).data.img}catch{}let r=`![图片描述](${n})`;this.setCursorPosition(this.refs.text,r,6)}insertLink(){this.setState({linkMask:!1},()=>{let t=`[链接描述](${this.state.link})`;this.setCursorPosition(this.refs.text,t,5)})}insertCode(){let t="\n```\n\n```";this.setCursorPosition(this.refs.text,t,t.length-4)}setCursorPosition(t,e,n){var r=0;t.selectionStart&&(r=t.selectionStart),this.insertAtCursor(t,e),t.focus(),t.setSelectionRange(t.value.length,r+(n||e.length)),this.setState({val:t.value})}insertAtCursor(t,e){let n;if(!n.selection)if(t.selectionStart||t.selectionStart=="0"){let r=Number(t.selectionStart),a=t.selectionEnd,p=t.scrollTop;t.value=t.value.substring(0,r)+e+t.value.substring(a,t.value.length),p>0&&(t.scrollTop=p),t.focus(),t.selectionStart=r+e.length,t.selectionEnd=r+e.length}else t.value+=e,t.focus()}handleInput(t){this.setState({val:t},()=>{this.renderHtml()})}renderHtml(){this.setState({html:c(this.state.val)},()=>{let{val:t,html:e}=this.state;this.props.callback&&this.props.callback({markdown:t,html:e})})}render(){return i.jsxs("div",{id:"markdowm",children:[i.jsx("div",{className:"md-title",children:i.jsxs("ul",{className:"cf",style:{display:"flex",alignItems:"center",fontWeight:600},children:[i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"****",2)},children:i.jsx("a",{href:"javascript:;",title:"粗体",children:i.jsx(o,{iconName:"bold"})})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"**",1)},children:i.jsx("a",{href:"javascript:;",title:"斜体",children:i.jsx(o,{iconName:"italic"})})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"# ",2)},children:i.jsx("a",{href:"javascript:;",title:"h1",children:"h1"})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"## ",3)},children:i.jsx("a",{href:"javascript:;",title:"h2",children:"h2"})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"### ",4)},children:i.jsx("a",{href:"javascript:;",title:"h3",children:"h3"})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"#### ",5)},children:i.jsx("a",{href:"javascript:;",title:"h4",children:"h4"})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"##### ",6)},children:i.jsx("a",{href:"javascript:;",title:"h5",children:"h5"})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"##### ",7)},children:i.jsx("a",{href:"javascript:;",title:"h6",children:"h6"})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"~~~~",2)},children:i.jsx("a",{href:"javascript:;",title:"中划线",children:i.jsx(o,{iconName:"strikethrough"})})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"> ",2)},children:i.jsx("a",{href:"javascript:;",title:"引用",children:i.jsx(o,{iconName:"quote"})})}),i.jsxs("li",{children:[i.jsx("a",{href:"javascript:;",title:"图片",children:i.jsx(o,{iconName:"image"})}),i.jsx("input",{type:"file",className:"uploadFile"})]}),i.jsx("li",{onClick:t=>{this.setState({linkMask:!0})},children:i.jsx("a",{href:"javascript:;",title:"链接",children:i.jsx(o,{iconName:"link"})})}),i.jsx("li",{onClick:this.insertCode.bind(this),children:i.jsx("a",{href:"javascript:;",title:"代码块",children:i.jsx(o,{iconName:"code"})})}),i.jsx("li",{onClick:t=>{this.setCursorPosition(this.refs.text,"---",2)},children:i.jsx("a",{href:"javascript:;",title:"分割线",children:i.jsx(o,{iconName:"758bianjiqi_fengexian"})})})]})}),i.jsx("textarea",{ref:"text",value:this.state.val,onChange:t=>{this.handleInput(t.target.value)}}),i.jsx("div",{className:"render fmt",dangerouslySetInnerHTML:{__html:this.state.html}}),i.jsx("div",{className:"mask",style:{display:this.state.linkMask?"block":"none"},children:i.jsxs("div",{className:"link-text",children:[i.jsx("input",{type:"text",ref:"link"}),i.jsx("button",{onClick:this.insertLink.bind(this),children:"确定"})]})})]})}}const Ht=d;export{Ht as default};
