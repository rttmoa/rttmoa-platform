function F(t,e){let i;if(e===void 0)for(const s of t)s!=null&&(i<s||i===void 0&&s>=s)&&(i=s);else{let s=-1;for(let f of t)(f=e(f,++s,t))!=null&&(i<f||i===void 0&&f>=f)&&(i=f)}return i}function X(t,e){let i;if(e===void 0)for(const s of t)s!=null&&(i>s||i===void 0&&s>=s)&&(i=s);else{let s=-1;for(let f of t)(f=e(f,++s,t))!=null&&(i>f||i===void 0&&f>=f)&&(i=f)}return i}function P(t,e){let i=0;if(e===void 0)for(let s of t)(s=+s)&&(i+=s);else{let s=-1;for(let f of t)(f=+e(f,++s,t))&&(i+=f)}return i}function st(t){return t.target.depth}function wt(t){return t.depth}function vt(t,e){return e-1-t.height}function ut(t,e){return t.sourceLinks.length?t.depth:e-1}function Mt(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?X(t.sourceLinks,st)-1:0}function E(t){return function(){return t}}function G(t,e){return j(t.source,e.source)||t.index-e.index}function J(t,e){return j(t.target,e.target)||t.index-e.index}function j(t,e){return t.y0-e.y0}function q(t){return t.value}function ft(t){return t.index}function ct(t){return t.nodes}function lt(t){return t.links}function K(t,e){const i=t.get(e);if(!i)throw new Error("missing: "+e);return i}function O({nodes:t}){for(const e of t){let i=e.y0,s=i;for(const f of e.sourceLinks)f.y0=i+f.width/2,i+=f.width;for(const f of e.targetLinks)f.y1=s+f.width/2,s+=f.width}}function Tt(){let t=0,e=0,i=1,s=1,f=24,k=8,a,h=ft,y=ut,p,m,x=ct,_=lt,L=6;function d(){const n={nodes:x.apply(null,arguments),links:_.apply(null,arguments)};return H(n),B(n),N(n),A(n),tt(n),O(n),n}d.update=function(n){return O(n),n},d.nodeId=function(n){return arguments.length?(h=typeof n=="function"?n:E(n),d):h},d.nodeAlign=function(n){return arguments.length?(y=typeof n=="function"?n:E(n),d):y},d.nodeSort=function(n){return arguments.length?(p=n,d):p},d.nodeWidth=function(n){return arguments.length?(f=+n,d):f},d.nodePadding=function(n){return arguments.length?(k=a=+n,d):k},d.nodes=function(n){return arguments.length?(x=typeof n=="function"?n:E(n),d):x},d.links=function(n){return arguments.length?(_=typeof n=="function"?n:E(n),d):_},d.linkSort=function(n){return arguments.length?(m=n,d):m},d.size=function(n){return arguments.length?(t=e=0,i=+n[0],s=+n[1],d):[i-t,s-e]},d.extent=function(n){return arguments.length?(t=+n[0][0],i=+n[1][0],e=+n[0][1],s=+n[1][1],d):[[t,e],[i,s]]},d.iterations=function(n){return arguments.length?(L=+n,d):L};function H({nodes:n,links:c}){for(const[u,o]of n.entries())o.index=u,o.sourceLinks=[],o.targetLinks=[];const r=new Map(n.map((u,o)=>[h(u,o,n),u]));for(const[u,o]of c.entries()){o.index=u;let{source:l,target:g}=o;typeof l!="object"&&(l=o.source=K(r,l)),typeof g!="object"&&(g=o.target=K(r,g)),l.sourceLinks.push(o),g.targetLinks.push(o)}if(m!=null)for(const{sourceLinks:u,targetLinks:o}of n)u.sort(m),o.sort(m)}function B({nodes:n}){for(const c of n)c.value=c.fixedValue===void 0?Math.max(P(c.sourceLinks,q),P(c.targetLinks,q)):c.fixedValue}function N({nodes:n}){const c=n.length;let r=new Set(n),u=new Set,o=0;for(;r.size;){for(const l of r){l.depth=o;for(const{target:g}of l.sourceLinks)u.add(g)}if(++o>c)throw new Error("circular link");r=u,u=new Set}}function A({nodes:n}){const c=n.length;let r=new Set(n),u=new Set,o=0;for(;r.size;){for(const l of r){l.height=o;for(const{source:g}of l.targetLinks)u.add(g)}if(++o>c)throw new Error("circular link");r=u,u=new Set}}function M({nodes:n}){const c=F(n,o=>o.depth)+1,r=(i-t-f)/(c-1),u=new Array(c);for(const o of n){const l=Math.max(0,Math.min(c-1,Math.floor(y.call(null,o,c))));o.layer=l,o.x0=t+l*r,o.x1=o.x0+f,u[l]?u[l].push(o):u[l]=[o]}if(p)for(const o of u)o.sort(p);return u}function C(n){const c=X(n,r=>(s-e-(r.length-1)*a)/P(r,q));for(const r of n){let u=e;for(const o of r){o.y0=u,o.y1=u+o.value*c,u=o.y1+a;for(const l of o.sourceLinks)l.width=l.value*c}u=(s-u+a)/(r.length+1);for(let o=0;o<r.length;++o){const l=r[o];l.y0+=u*(o+1),l.y1+=u*(o+1)}ot(r)}}function tt(n){const c=M(n);a=Math.min(k,(s-e)/(F(c,r=>r.length)-1)),C(c);for(let r=0;r<L;++r){const u=Math.pow(.99,r),o=Math.max(1-u,(r+1)/L);et(c,u,o),nt(c,u,o)}}function nt(n,c,r){for(let u=1,o=n.length;u<o;++u){const l=n[u];for(const g of l){let T=0,w=0;for(const{source:b,value:I}of g.targetLinks){let z=I*(g.layer-b.layer);T+=it(b,g)*z,w+=z}if(!(w>0))continue;let S=(T/w-g.y0)*c;g.y0+=S,g.y1+=S,W(g)}p===void 0&&l.sort(j),R(l,r)}}function et(n,c,r){for(let u=n.length,o=u-2;o>=0;--o){const l=n[o];for(const g of l){let T=0,w=0;for(const{target:b,value:I}of g.sourceLinks){let z=I*(b.layer-g.layer);T+=rt(g,b)*z,w+=z}if(!(w>0))continue;let S=(T/w-g.y0)*c;g.y0+=S,g.y1+=S,W(g)}p===void 0&&l.sort(j),R(l,r)}}function R(n,c){const r=n.length>>1,u=n[r];Q(n,u.y0-a,r-1,c),Z(n,u.y1+a,r+1,c),Q(n,s,n.length-1,c),Z(n,e,0,c)}function Z(n,c,r,u){for(;r<n.length;++r){const o=n[r],l=(c-o.y0)*u;l>1e-6&&(o.y0+=l,o.y1+=l),c=o.y1+a}}function Q(n,c,r,u){for(;r>=0;--r){const o=n[r],l=(o.y1-c)*u;l>1e-6&&(o.y0-=l,o.y1-=l),c=o.y0-a}}function W({sourceLinks:n,targetLinks:c}){if(m===void 0){for(const{source:{sourceLinks:r}}of c)r.sort(J);for(const{target:{targetLinks:r}}of n)r.sort(G)}}function ot(n){if(m===void 0)for(const{sourceLinks:c,targetLinks:r}of n)c.sort(J),r.sort(G)}function it(n,c){let r=n.y0-(n.sourceLinks.length-1)*a/2;for(const{target:u,width:o}of n.sourceLinks){if(u===c)break;r+=o+a}for(const{source:u,width:o}of c.targetLinks){if(u===n)break;r-=o}return r}function rt(n,c){let r=c.y0-(c.targetLinks.length-1)*a/2;for(const{source:u,width:o}of c.targetLinks){if(u===n)break;r+=o+a}for(const{target:u,width:o}of n.sourceLinks){if(u===c)break;r-=o}return r}return d}var V=Math.PI,$=2*V,v=1e-6,at=$-v;function D(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Y(){return new D}D.prototype=Y.prototype={constructor:D,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,i,s){this._+="Q"+ +t+","+ +e+","+(this._x1=+i)+","+(this._y1=+s)},bezierCurveTo:function(t,e,i,s,f,k){this._+="C"+ +t+","+ +e+","+ +i+","+ +s+","+(this._x1=+f)+","+(this._y1=+k)},arcTo:function(t,e,i,s,f){t=+t,e=+e,i=+i,s=+s,f=+f;var k=this._x1,a=this._y1,h=i-t,y=s-e,p=k-t,m=a-e,x=p*p+m*m;if(f<0)throw new Error("negative radius: "+f);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(x>v)if(!(Math.abs(m*h-y*p)>v)||!f)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var _=i-k,L=s-a,d=h*h+y*y,H=_*_+L*L,B=Math.sqrt(d),N=Math.sqrt(x),A=f*Math.tan((V-Math.acos((d+x-H)/(2*B*N)))/2),M=A/N,C=A/B;Math.abs(M-1)>v&&(this._+="L"+(t+M*p)+","+(e+M*m)),this._+="A"+f+","+f+",0,0,"+ +(m*_>p*L)+","+(this._x1=t+C*h)+","+(this._y1=e+C*y)}},arc:function(t,e,i,s,f,k){t=+t,e=+e,i=+i,k=!!k;var a=i*Math.cos(s),h=i*Math.sin(s),y=t+a,p=e+h,m=1^k,x=k?s-f:f-s;if(i<0)throw new Error("negative radius: "+i);this._x1===null?this._+="M"+y+","+p:(Math.abs(this._x1-y)>v||Math.abs(this._y1-p)>v)&&(this._+="L"+y+","+p),i&&(x<0&&(x=x%$+$),x>at?this._+="A"+i+","+i+",0,1,"+m+","+(t-a)+","+(e-h)+"A"+i+","+i+",0,1,"+m+","+(this._x1=y)+","+(this._y1=p):x>v&&(this._+="A"+i+","+i+",0,"+ +(x>=V)+","+m+","+(this._x1=t+i*Math.cos(f))+","+(this._y1=e+i*Math.sin(f))))},rect:function(t,e,i,s){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +i+"v"+ +s+"h"+-i+"Z"},toString:function(){return this._}};function U(t){return function(){return t}}function ht(t){return t[0]}function dt(t){return t[1]}var gt=Array.prototype.slice;function yt(t){return t.source}function kt(t){return t.target}function pt(t){var e=yt,i=kt,s=ht,f=dt,k=null;function a(){var h,y=gt.call(arguments),p=e.apply(this,y),m=i.apply(this,y);if(k||(k=h=Y()),t(k,+s.apply(this,(y[0]=p,y)),+f.apply(this,y),+s.apply(this,(y[0]=m,y)),+f.apply(this,y)),h)return k=null,h+""||null}return a.source=function(h){return arguments.length?(e=h,a):e},a.target=function(h){return arguments.length?(i=h,a):i},a.x=function(h){return arguments.length?(s=typeof h=="function"?h:U(+h),a):s},a.y=function(h){return arguments.length?(f=typeof h=="function"?h:U(+h),a):f},a.context=function(h){return arguments.length?(k=h??null,a):k},a}function mt(t,e,i,s,f){t.moveTo(e,i),t.bezierCurveTo(e=(e+s)/2,i,e,f,s,f)}function xt(){return pt(mt)}function Lt(t){return[t.source.x1,t.y0]}function _t(t){return[t.target.x0,t.y1]}function St(){return xt().source(Lt).target(_t)}export{Tt as S,Mt as c,ut as j,wt as l,vt as r,St as s};
