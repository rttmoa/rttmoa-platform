import{ax as x,r as i,j as e,bW as y,bX as Z,ak as ee,B as g,c,bY as v}from"./index-113fc74b.js";import{a as I}from"./roleManage-e8b2b779.js";import{c as te,d as se,e as le,g as ie,h as ae}from"./userManage2-60a52dbc.js";import oe from"./treeList-dfa35071.js";import ne from"./tableList-80662331.js";import re from"./addPolice-78b6fe6a.js";import de from"./selectRole-6350864c.js";import{P as z}from"./index-bda54c8e.js";import"./index-e9919bb2.js";import"./Tree-3563fbcf.js";import"./List-8daded26.js";import"./conductUtil-ec1c0eb4.js";import"./iconUtil-1cf5f036.js";import"./index-b96fcc2a.js";import"./Table-8c30211f.js";import"./index-9b1d98d0.js";import"./styleChecker-ab7f2164.js";import"./addEventListener-96eadba0.js";import"./useMultipleSelect-ebde533a.js";import"./Pagination-b9ef814f.js";import"./zh_CN-f51ae7db.js";import"./index-b494d425.js";import"./Select-8f23d9ed.js";import"./useShowArrow-13591fe1.js";import"./useIcons-e7e876d7.js";import"./index-0e665a55.js";import"./index-c0237b1c.js";import"./useBubbleLock-1d80bc36.js";import"./index-f62b1770.js";import"./useLazyKVMap-e86d9680.js";import"./index-7df010ed.js";const ce=x.Item,{Content:pe,Sider:ue}=y,He=()=>{const[C]=x.useForm(),[A]=x.useForm(),[U,S]=i.useState(""),[r,m]=i.useState({PoliceAddVisible:!1,moduletype:"",moduletitle:""}),[N,b]=i.useState(""),[R,f]=i.useState(!1),[D,h]=i.useState(!1),[V,L]=i.useState(!1),[p,me]=i.useState({view:!0,freeze:!0,delete:!0,edit:!0,add:!0}),[a,n]=i.useState({keyword:"",pageSize:10,pageNo:1,deptCode:""}),[F,T]=i.useState({list:[],loading:!1}),[d,E]=i.useState({list:[],loading:!1}),[P,K]=i.useState({list:[],loading:!1}),[w,k]=i.useState({list:[],loading:!1}),o=t=>{se(a).then(s=>{let l=s.data;l.list.splice(0,l.list.length-10),E({list:l}),t&&t()})};i.useEffect(()=>{I().then(t=>{k({list:t.data.list})}),te({}).then(t=>{T({list:t.data}),n(s=>({...s,deptCode:t.data[0].deptCode})),S(t.data[0].deptName)}),o(()=>{})},[]);const M=t=>{I().then(s=>{k({list:s.data}),f(!0),b(t)})},O=t=>{le({id:t}).then(s=>{K({list:s.data}),m({PoliceAddVisible:!0,moduletype:"edit",moduletitle:"详情"}),b(t)})},$=(t,s)=>{ie({id:t,status:s}).then(l=>{c.success(l.msg),o(()=>{})})},B=t=>{if(sessionStorage.getItem("userid")===t){c.warning("自己不能删除自己");return}const s=d.list;let l=a.pageNo;ae({deptcode:a.deptCode,id:t}).then(u=>{c.success(u.msg),s.totalPage>1&&s.totalCount%10===1&&(l-=1),n(j=>({...j,pageNo:l})),o(()=>{})})},G=[{title:"姓名",dataIndex:"chineseName",key:"chineseName",width:"15%"},{title:"职务",dataIndex:"post",key:"post",width:"15%",render:t=>e.jsx("span",{children:"员工"})},{title:"帐号",dataIndex:"username",key:"username",width:"15%"},{title:"帐号状态",dataIndex:"statusLabel",key:"statusLabel",width:"15%",render:(t,s,l)=>e.jsx("span",{children:s.status?"已冻结":"正常"})},{title:"角色",dataIndex:"roles",key:"roles",width:"20%",render:(t,s,l)=>{const u=[];(t||[]).map(Q=>{u.push(Q.role_name)});let j=u.length===0?"":u.join(",");return e.jsx(g,{type:"default",onClick:()=>{M(s.id)},children:j||"普通用户"})}},{title:"操作",key:"operate",render:(t,s,l)=>e.jsxs("span",{children:[p.view?e.jsxs("span",{children:[e.jsx("a",{onClick:()=>O(s.id),children:"详情"}),e.jsx("span",{className:"ant-divider"})]}):null,p.freeze?e.jsx("span",{children:e.jsx(z,{title:`确认${s.status?"解冻":"冻结"}账户?`,placement:"left",onConfirm:()=>$(s.id,`${s.status}`),children:e.jsx("a",{children:s.status?"解冻账户":"冻结账户"})})}):null,e.jsx("span",{className:"ant-divider"}),p.delete?e.jsx(z,{title:"删除用户?",placement:"left",onConfirm:()=>B(s.id),children:e.jsx("a",{children:"删除"})}):null]})}],H=(t=[],s)=>{h(!0),S(s),n(l=>({...l,deptCode:t[0],pageNo:1,keyword:""})),o(()=>{h(!1)})},W=()=>{const t=C.getFieldsValue();h(!0),n(s=>({...s,keyword:t,pageNo:1})),o(()=>{h(!1)})},X=t=>{n({pageNo:t}),o(()=>{})},Y=(t,s)=>{n(l=>({...l,pageNo:1,pageSize:s}))},_=()=>{a.deptCode?(v.info({message:`deptId是${a.deptCode}`}),m({PoliceAddVisible:!0,moduletype:"add",moduletitle:"新增"})):v.error({message:"错误",description:"请先选择部门"})},q=()=>{c.info("用户数据同步中"),L(!0),setTimeout(()=>{c.success("用户数据同步完成"),L(!1),o(()=>{})},2500)},J=()=>{const t=d.list;let s=a.pageNo;r.moduletype==="add"&&t&&t.totalCount>0&&t.totalCount%10===0&&(s+=1),m({PoliceAddVisible:!1,moduletype:"",moduletitle:""}),n(l=>({...l,pageNo:s})),o(()=>{})};return e.jsxs("div",{className:"page page-scrollfix page-usermanage",children:[e.jsx(y,{children:e.jsxs(y,{className:"page-body",children:[e.jsx(ue,{width:240,children:e.jsxs(Z,{spinning:!1,children:[e.jsx("h3",{className:"page-title",children:"城市"}),e.jsx("div",{className:"treeside",children:e.jsx(oe,{trees:F.list,curDeptCode:a.deptCode,onSelect:H})})]})}),e.jsxs(pe,{children:[e.jsxs("h3",{className:"page-title",children:[U,e.jsxs("span",{className:"error",children:[" ",d.list.totalCount?d.list.totalCount:0]}),"人"]}),e.jsx("div",{className:"page-header",children:e.jsxs(x,{layout:"inline",className:"flexrow",form:C,onFinish:W,children:[e.jsx(ce,{labelCol:{span:6},children:e.jsx(ee,{className:"input-base-width",placeholder:"请输入关键字进行搜索"})}),e.jsx(g,{type:"primary",size:"middle",htmlType:"submit",children:"搜索"})]})}),e.jsx("div",{className:"page-content has-pagination table-flex table-scrollfix",children:e.jsx(ne,{size:"small",style:{maxHeight:800},rowKey:"id",columns:G,currentPage:a.pageNo,pageSize:a.pageSize,dataSource:d.list.list,loading:D,totalCount:d.list.totalCount,onChange:X,onShowSizeChange:Y,border:!0})}),e.jsx("div",{className:"page-footer",children:e.jsxs("div",{className:"page-footer-buttons",children:[p.add?e.jsxs(g,{type:"primary",style:{marginRight:"10px"},onClick:_,children:[" ","新增人员"]}):null,p.add?e.jsxs(g,{type:"primary",loading:V,onClick:q,children:[" ","同步人员"]}):null]})})]})]})}),r.PoliceAddVisible?e.jsx(re,{form:A,visible:r.PoliceAddVisible,type:r.moduletype,title:r.moduletitle,handleOk:J,values:r.moduletype==="add"?"":P.list,deptId:a.deptCode,currPeopleId:N,onCancel:()=>{m({PoliceAddVisible:!1,moduletype:"",moduletitle:""})},roleList:w.list.list||[]}):null,R?e.jsx(de,{visible:R,handleOkRole:()=>{f(!1),o(()=>{})},values:P,currPeopleId:N,select:w.list.list,onCancel:()=>{c.info("取消成功"),f(!1)}}):null]})};export{He as default};
//# sourceMappingURL=index-770e60cc.js.map
