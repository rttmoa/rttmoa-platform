{"version":3,"file":"detail-71ed31eb.js","sources":["../../../src/views/module/product/detail.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Form, Card, Input, Button, message, Upload, UploadFile, FormInstance } from 'antd';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { UploadChangeParam } from 'antd/es/upload';\r\nimport defaultImg from '@/assets/images/defaultImg.jpg';\r\nimport { productList } from '@/api/modules/module/product';\r\n// import BraftEditorText from './component/braftEditorText'\r\n// import RichBraftEditor from \"./component/rich-text-editor\";\r\nimport PicturesWall from './component/pictures-wall';\r\n\r\nconst serverUrl = 'http://localhost:3009';\r\n\r\nconst Edit = () => {\r\n\tconst navigate = useNavigate();\r\n\tconst location = useLocation();\r\n\tconst id = location.search.split('=')[1];\r\n\r\n\t// const [id, setId] = useState(\"\")\r\n\tconst [product, setproduct] = useState<any>({}); // 产品信息\r\n\tconst [imageUrl, setImageUrl] = useState<any>([]);\r\n\tconst [loading, setLoading] = useState(false);\r\n\r\n\t// 初始化的时候执行\r\n\tuseEffect(() => {\r\n\t\tif (id) {\r\n\t\t\tproductList(1, 5).then((res: any) => {\r\n\t\t\t\tconst result = res.data.list.filter((value: any) => value._id === id);\r\n\t\t\t\tconsole.log(result);\r\n\t\t\t\tsetproduct(result[0]);\r\n\t\t\t\tsetImageUrl([result[0].coverImg]);\r\n\t\t\t});\r\n\t\t}\r\n\t}, []);\r\n\tconsole.log(imageUrl);\r\n\t// 图片上传\r\n\tconst handleChange = (info: UploadChangeParam<UploadFile<any>>) => {\r\n\t\t// console.log(info);return;\r\n\t\tif (info.file.status === 'uploading') {\r\n\t\t\tsetLoading(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (info.file.status === 'done') {\r\n\t\t\t// 上传成功\r\n\t\t\t// Get this url from response in real world.\r\n\t\t\tsetLoading(false);\r\n\t\t\t// console.log(info);\r\n\t\t\tsetImageUrl(info.file.response.info);\r\n\t\t}\r\n\t};\r\n\r\n\tconst onFinish = (values: any) => {\r\n\t\t// editorState.toHTML()获取当前富文本的内容\r\n\t\t// console.log(editorState.toHTML());\r\n\t\tconsole.log(values); // {name: 'zhangsan', price: '444'}\r\n\r\n\t\t// e.preventDefault()\r\n\t\t// props.form.validateFieldsAndScroll((err, values) => {}\r\n\r\n\t\t// ? 判断是编辑 还是新建，做对应的操作\r\n\t\t// if (id) {\r\n\t\t//   modifyOne(id, {\r\n\t\t//     ...values,\r\n\t\t//     coverImg: imageUrl,\r\n\t\t//     content: editorState.toHTML()\r\n\t\t//   });\r\n\t\t// } else {\r\n\t\t//   createApi({\r\n\t\t//     ...values,\r\n\t\t//     coverImg: imageUrl,\r\n\t\t//     content: editorState.toHTML()\r\n\t\t//   })\r\n\t\t//     .then(res => {\r\n\t\t//       navigate(\"/list/curd/product\");\r\n\t\t//       setCurrentData({});\r\n\t\t//       setImageUrl(\"\");\r\n\t\t//       setLoading(false);\r\n\t\t//       setEditorState(\"\");\r\n\t\t//     })\r\n\t\t//     .catch(err => { console.log(err); });\r\n\t\t// }\r\n\t};\r\n\r\n\tif (id) {\r\n\t\tif (JSON.stringify(product) === '{}') return;\r\n\t}\r\n\tconst layout = {\r\n\t\tlabelCol: { span: 2 },\r\n\t\twrapperCol: { span: 12 },\r\n\t};\r\n\treturn (\r\n\t\t<Card\r\n\t\t\ttitle={id ? '商品编辑' : '商品添加'}\r\n\t\t\textra={\r\n\t\t\t\t<Button\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tnavigate('/module/product');\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t返回\r\n\t\t\t\t</Button>\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t<Form\r\n\t\t\t\t{...layout}\r\n\t\t\t\tname='control-hooks'\r\n\t\t\t\tonFinish={onFinish}\r\n\t\t\t\tinitialValues={{\r\n\t\t\t\t\tname: product.name,\r\n\t\t\t\t\tprice: product.price,\r\n\t\t\t\t\tdesc: product.desc,\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Form.Item name='name' label='商品名字' rules={[{ required: true, message: '请输入商品名字' }]}>\r\n\t\t\t\t\t<Input placeholder='请输入商品名字' />\r\n\t\t\t\t</Form.Item>\r\n\t\t\t\t<Form.Item name='desc' label='商品描述' rules={[{ required: true, message: '请输入商品描述信息' }]}>\r\n\t\t\t\t\t<Input.TextArea placeholder='请输入商品描述信息' />\r\n\t\t\t\t</Form.Item>\r\n\t\t\t\t<Form.Item\r\n\t\t\t\t\tname='price'\r\n\t\t\t\t\tlabel='商品价格'\r\n\t\t\t\t\trules={[\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\t\tmessage: '请输入商品价格',\r\n\t\t\t\t\t\t\tvalidator(rule: any, value: any, callback: any) {\r\n\t\t\t\t\t\t\t\tconsole.log(value, typeof value);\r\n\t\t\t\t\t\t\t\tvalue * 1 > 0 ? callback() : callback('商品价格必须大于 0');\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t]}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Input placeholder='请输入商品价格' addonAfter='元' />\r\n\t\t\t\t</Form.Item>\r\n\r\n\t\t\t\t<Form.Item label='商品图片'>\r\n\t\t\t\t\t<PicturesWall images={imageUrl} ref={null} />\r\n\t\t\t\t</Form.Item>\r\n\r\n\t\t\t\t<Form.Item label='商品详情: ' name='detail'>\r\n\t\t\t\t\t{/* <BraftEditorText /> */}\r\n\t\t\t\t\t{/* <RichBraftEditor detail=\"初值\" ref={null} /> */}\r\n\t\t\t\t</Form.Item>\r\n\t\t\t\t<Form.Item wrapperCol={{ offset: 2 }}>\r\n\t\t\t\t\t<Button htmlType='submit' type='primary'>\r\n\t\t\t\t\t\t保存\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</Form.Item>\r\n\t\t\t</Form>\r\n\t\t</Card>\r\n\t);\r\n};\r\nexport default Edit;\r\n"],"names":["Edit","navigate","useNavigate","id","useLocation","product","setproduct","useState","imageUrl","setImageUrl","useEffect","productList","res","result","value","onFinish","values","layout","jsx","Card","Button","jsxs","Form","Input","rule","callback","PicturesWall"],"mappings":"kNAYA,MAAMA,EAAO,IAAM,CAClB,MAAMC,EAAWC,IAEXC,EADWC,IACG,OAAO,MAAM,GAAG,EAAE,CAAC,EAGjC,CAACC,EAASC,CAAU,EAAIC,EAAA,SAAc,CAAE,CAAA,EACxC,CAACC,EAAUC,CAAW,EAAIF,EAAA,SAAc,CAAE,CAAA,EAClBA,EAAAA,SAAS,EAAK,EAG5CG,EAAAA,UAAU,IAAM,CACXP,GACHQ,EAAY,EAAG,CAAC,EAAE,KAAMC,GAAa,CAC9B,MAAAC,EAASD,EAAI,KAAK,KAAK,OAAQE,GAAeA,EAAM,MAAQX,CAAE,EAEzDG,EAAAO,EAAO,CAAC,CAAC,EACpBJ,EAAY,CAACI,EAAO,CAAC,EAAE,QAAQ,CAAC,CAAA,CAChC,CAEH,EAAG,CAAE,CAAA,EAkBC,MAAAE,EAAYC,GAAgB,CAGf,EA6BnB,GAAIb,GACC,KAAK,UAAUE,CAAO,IAAM,KAAM,OAEvC,MAAMY,EAAS,CACd,SAAU,CAAE,KAAM,CAAE,EACpB,WAAY,CAAE,KAAM,EAAG,CAAA,EAGvB,OAAAC,EAAA,IAACC,EAAA,CACA,MAAOhB,EAAK,OAAS,OACrB,MACCe,EAAA,IAACE,EAAA,CACA,QAAS,IAAM,CACdnB,EAAS,iBAAiB,CAC3B,EACA,SAAA,IAAA,CAED,EAGD,SAAAoB,EAAA,KAACC,EAAA,CACC,GAAGL,EACJ,KAAK,gBACL,SAAAF,EACA,cAAe,CACd,KAAMV,EAAQ,KACd,MAAOA,EAAQ,MACf,KAAMA,EAAQ,IACf,EAEA,SAAA,CAACa,MAAAI,EAAK,KAAL,CAAU,KAAK,OAAO,MAAM,OAAO,MAAO,CAAC,CAAE,SAAU,GAAM,QAAS,UAAW,EACjF,eAACC,EAAM,CAAA,YAAY,SAAU,CAAA,EAC9B,EACAL,EAAAA,IAACI,EAAK,KAAL,CAAU,KAAK,OAAO,MAAM,OAAO,MAAO,CAAC,CAAE,SAAU,GAAM,QAAS,WAAa,CAAA,EACnF,SAAAJ,MAACK,EAAM,SAAN,CAAe,YAAY,WAAY,CAAA,EACzC,EACAL,EAAA,IAACI,EAAK,KAAL,CACA,KAAK,QACL,MAAM,OACN,MAAO,CACN,CACC,SAAU,GACV,QAAS,UACT,UAAUE,EAAWV,EAAYW,EAAe,CAE/CX,EAAQ,EAAI,EAAIW,EAAS,EAAIA,EAAS,YAAY,CACnD,CACD,CACD,EAEA,SAACP,EAAA,IAAAK,EAAA,CAAM,YAAY,UAAU,WAAW,IAAI,CAAA,CAC7C,EAECL,EAAA,IAAAI,EAAK,KAAL,CAAU,MAAM,OAChB,SAACJ,EAAAA,IAAAQ,EAAA,CAAa,OAAQlB,EAAU,IAAK,IAAA,CAAM,CAC5C,CAAA,QAECc,EAAK,KAAL,CAAU,MAAM,SAAS,KAAK,SAG/B,QACCA,EAAK,KAAL,CAAU,WAAY,CAAE,OAAQ,CAChC,EAAA,SAAAJ,EAAAA,IAACE,GAAO,SAAS,SAAS,KAAK,UAAU,aAEzC,CAAA,EACD,CAAA,CAAA,CACD,CAAA,CAAA,CAGH"}