import{aD as a,bj as ee,aC as ue,bY as ve,d as oe,r as l,bZ as de,aE as Z,aF as me,cu as pe,j as p,cm as he,aT as $e,G as ge,br as le,bs as G,z as Fe,cv as Se,a3 as Pe}from"./index-4c9f8422.js";import{o as ke,e as Ce,F as ze,f as Me}from"./index-588ff08e.js";import{u as Te,B as ce}from"./BaseForm-e35f517b.js";import{i as je}from"./index-8a0f6792.js";import{a as be,u as Ie}from"./index-83355eff.js";var We=function(n){return ee({},n.componentCls,{"&-sidebar-dragger":{width:"5px",cursor:"ew-resize",padding:"4px 0 0",borderTop:"1px solid transparent",position:"absolute",top:0,left:0,bottom:0,zIndex:100,backgroundColor:"transparent","&-min-disabled":{cursor:"w-resize"},"&-max-disabled":{cursor:"e-resize"}}})};function Oe(e){return be("DrawerForm",function(n){var R=a(a({},n),{},{componentCls:".".concat(e)});return[We(R)]})}var Ve=["children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","resize","onOpenChange","visible","open"];function Ye(e){var n,R,ne=e.children,S=e.trigger,y=e.onVisibleChange,s=e.drawerProps,t=e.onFinish,W=e.submitTimeout,H=e.title,M=e.width,w=e.resize,O=e.onOpenChange,U=e.visible,c=e.open,g=ue(e,Ve);ve(!g.footer||!(s!=null&&s.footer),"DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var i=oe.useMemo(function(){var m,r,o,v={onResize:function(){},maxWidth:je()?window.innerWidth*.8:void 0,minWidth:300};return typeof w=="boolean"?w?v:{}:ke({onResize:(m=w==null?void 0:w.onResize)!==null&&m!==void 0?m:v.onResize,maxWidth:(r=w==null?void 0:w.maxWidth)!==null&&r!==void 0?r:v.maxWidth,minWidth:(o=w==null?void 0:w.minWidth)!==null&&o!==void 0?o:v.minWidth})},[w]),P=l.useContext(de.ConfigContext),J=P.getPrefixCls("pro-form-drawer"),L=Oe(J),Q=L.wrapSSR,V=L.hashId,b=function(r){return"".concat(J,"-").concat(r," ").concat(V)},k=l.useState([]),N=Z(k,2),B=N[1],z=l.useState(!1),X=Z(z,2),re=X[0],Y=X[1],f=l.useState(!1),T=Z(f,2),j=T[0],D=T[1],_=l.useState(M||(w?i==null?void 0:i.minWidth:800)),K=Z(_,2),C=K[0],u=K[1],d=me(!!U,{value:c||U,onChange:O||y}),x=Z(d,2),$=x[0],h=x[1],q=l.useRef(null),A=l.useCallback(function(m){q.current===null&&m&&B([]),q.current=m},[]),te=l.useRef(),ie=l.useCallback(function(){var m,r,o,v=(m=(r=(o=g.formRef)===null||o===void 0?void 0:o.current)!==null&&r!==void 0?r:g.form)!==null&&m!==void 0?m:te.current;v&&s!==null&&s!==void 0&&s.destroyOnClose&&v.resetFields()},[s==null?void 0:s.destroyOnClose,g.form,g.formRef]);l.useEffect(function(){$&&(c||U)&&(O==null||O(!0),y==null||y(!0)),j&&u(i==null?void 0:i.minWidth)},[U,$,j]),l.useImperativeHandle(g.formRef,function(){return te.current},[te.current]);var xe=l.useMemo(function(){return S?oe.cloneElement(S,a(a({key:"trigger"},S.props),{},{onClick:function(){var m=le(G().mark(function o(v){var I,F;return G().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:h(!$),D(!Object.keys(i)),(I=S.props)===null||I===void 0||(F=I.onClick)===null||F===void 0||F.call(I,v);case 3:case"end":return E.stop()}},o)}));function r(o){return m.apply(this,arguments)}return r}()})):null},[h,S,$,D,j]),Re=l.useMemo(function(){var m,r,o,v,I;return g.submitter===!1?!1:pe({searchConfig:{submitText:(m=(r=P.locale)===null||r===void 0||(r=r.Modal)===null||r===void 0?void 0:r.okText)!==null&&m!==void 0?m:"确认",resetText:(o=(v=P.locale)===null||v===void 0||(v=v.Modal)===null||v===void 0?void 0:v.cancelText)!==null&&o!==void 0?o:"取消"},resetButtonProps:{preventDefault:!0,disabled:W?re:void 0,onClick:function(se){var E;h(!1),s==null||(E=s.onClose)===null||E===void 0||E.call(s,se)}}},(I=g.submitter)!==null&&I!==void 0?I:{})},[g.submitter,(n=P.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.okText,(R=P.locale)===null||R===void 0||(R=R.Modal)===null||R===void 0?void 0:R.cancelText,W,re,h,s]),we=l.useCallback(function(m,r){return p.jsxs(p.Fragment,{children:[m,q.current&&r?p.jsx(oe.Fragment,{children:he.createPortal(r,q.current)},"submitter"):r]})},[]),_e=Te(function(){var m=le(G().mark(function r(o){var v,I,F;return G().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return v=t==null?void 0:t(o),W&&v instanceof Promise&&(Y(!0),I=setTimeout(function(){return Y(!1)},W),v.finally(function(){clearTimeout(I),Y(!1)})),E.next=4,v;case 4:return F=E.sent,F&&h(!1),E.abrupt("return",F);case 7:case"end":return E.stop()}},r)}));return function(r){return m.apply(this,arguments)}}()),ye=Ce($,y),ae=l.useCallback(function(m){var r,o,v=(document.body.offsetWidth||1e3)-(m.clientX-document.body.offsetLeft),I=(r=i==null?void 0:i.minWidth)!==null&&r!==void 0?r:M||800,F=(o=i==null?void 0:i.maxWidth)!==null&&o!==void 0?o:window.innerWidth*.8;if(v<I){u(I);return}if(v>F){u(F);return}u(v)},[i==null?void 0:i.maxWidth,i==null?void 0:i.minWidth,M]),fe=l.useCallback(function(){document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",fe)},[ae]);return Q(p.jsxs(p.Fragment,{children:[p.jsxs($e,a(a(a({title:H,width:C},s),ye),{},{afterOpenChange:function(r){var o;r||ie(),s==null||(o=s.afterOpenChange)===null||o===void 0||o.call(s,r)},onClose:function(r){var o;W&&re||(h(!1),s==null||(o=s.onClose)===null||o===void 0||o.call(s,r))},footer:g.submitter!==!1&&p.jsx("div",{ref:A,style:{display:"flex",justifyContent:"flex-end"}}),children:[w?p.jsx("div",{className:ge(b("sidebar-dragger"),V,ee(ee({},b("sidebar-dragger-min-disabled"),C===(i==null?void 0:i.minWidth)),b("sidebar-dragger-max-disabled"),C===(i==null?void 0:i.maxWidth))),onMouseDown:function(r){var o;i==null||(o=i.onResize)===null||o===void 0||o.call(i),r.stopPropagation(),r.preventDefault(),document.addEventListener("mousemove",ae),document.addEventListener("mouseup",fe),D(!0)}}):null,p.jsx(p.Fragment,{children:p.jsx(ce,a(a({formComponentType:"DrawerForm",layout:"vertical"},g),{},{formRef:te,onInit:function(r,o){var v;g.formRef&&(g.formRef.current=o),g==null||(v=g.onInit)===null||v===void 0||v.call(g,r,o),te.current=o},submitter:Re,onFinish:function(){var m=le(G().mark(function r(o){var v;return G().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,_e(o);case 2:return v=F.sent,F.abrupt("return",v);case 4:case"end":return F.stop()}},r)}));return function(r){return m.apply(this,arguments)}}(),contentRender:we,children:ne}))})]})),xe]}))}var De=function(n){return ee({},n.componentCls,{lineHeight:"30px","&::before":{display:"block",height:0,visibility:"hidden",content:"'.'"},"&-small":{lineHeight:n.lineHeight},"&-container":{display:"flex",flexWrap:"wrap",gap:n.marginXS},"&-item":ee({whiteSpace:"nowrap"},"".concat(n.antCls,"-form-item"),{marginBlock:0}),"&-line":{minWidth:"198px"},"&-line:not(:first-child)":{marginBlockStart:"16px",marginBlockEnd:8},"&-collapse-icon":{width:n.controlHeight,height:n.controlHeight,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},"&-effective":ee({},"".concat(n.componentCls,"-collapse-icon"),{backgroundColor:n.colorBgTextHover})})};function Le(e){return be("LightFilter",function(n){var R=a(a({},n),{},{componentCls:".".concat(e)});return[De(R)]})}var Ee=["size","collapse","collapseLabel","initialValues","onValuesChange","form","placement","formRef","bordered","ignoreRules","footerRender"],He=function(n){var R=n.items,ne=n.prefixCls,S=n.size,y=S===void 0?"middle":S,s=n.collapse,t=n.collapseLabel,W=n.onValuesChange,H=n.bordered,M=n.values,w=n.footerRender,O=n.placement,U=Ie(),c="".concat(ne,"-light-filter"),g=Le(c),i=g.wrapSSR,P=g.hashId,J=l.useState(!1),L=Z(J,2),Q=L[0],V=L[1],b=l.useState(function(){return a({},M)}),k=Z(b,2),N=k[0],B=k[1];l.useEffect(function(){B(a({},M))},[M]);var z=l.useMemo(function(){var f=[],T=[];return R.forEach(function(j){var D=j.props||{},_=D.secondary;_||s?f.push(j):T.push(j)}),{collapseItems:f,outsideItems:T}},[n.items]),X=z.collapseItems,re=z.outsideItems,Y=function(){return t||(s?p.jsx(Se,{className:"".concat(c,"-collapse-icon ").concat(P).trim()}):p.jsx(Me,{size:y,label:U.getMessage("form.lightFilter.more","更多筛选")}))};return i(p.jsx("div",{className:ge(c,P,"".concat(c,"-").concat(y),ee({},"".concat(c,"-effective"),Object.keys(M).some(function(f){return Array.isArray(M[f])?M[f].length>0:M[f]}))),children:p.jsxs("div",{className:"".concat(c,"-container ").concat(P).trim(),children:[re.map(function(f,T){if(!(f!=null&&f.props))return f;var j=f.key,D=(f==null?void 0:f.props)||{},_=D.fieldProps,K=_!=null&&_.placement?_==null?void 0:_.placement:O;return p.jsx("div",{className:"".concat(c,"-item ").concat(P).trim(),children:oe.cloneElement(f,{fieldProps:a(a({},f.props.fieldProps),{},{placement:K}),proFieldProps:a(a({},f.props.proFieldProps),{},{light:!0,label:f.props.label,bordered:H}),bordered:H})},j||T)}),X.length?p.jsx("div",{className:"".concat(c,"-item ").concat(P).trim(),children:p.jsx(ze,{padding:24,open:Q,onOpenChange:function(T){V(T)},placement:O,label:Y(),footerRender:w,footer:{onConfirm:function(){W(a({},N)),V(!1)},onClear:function(){var T={};X.forEach(function(j){var D=j.props.name;T[D]=void 0}),W(T)}},children:X.map(function(f){var T=f.key,j=f.props,D=j.name,_=j.fieldProps,K=a(a({},_),{},{onChange:function(d){return B(a(a({},N),{},ee({},D,d!=null&&d.target?d.target.value:d))),!1}});N.hasOwnProperty(D)&&(K[f.props.valuePropName||"value"]=N[D]);var C=_!=null&&_.placement?_==null?void 0:_.placement:O;return p.jsx("div",{className:"".concat(c,"-line ").concat(P).trim(),children:oe.cloneElement(f,{fieldProps:a(a({},K),{},{placement:C})})},T)})})},"more"):null]})}))};function Ze(e){var n=e.size,R=e.collapse,ne=e.collapseLabel,S=e.initialValues,y=e.onValuesChange,s=e.form,t=e.placement,W=e.formRef,H=e.bordered;e.ignoreRules;var M=e.footerRender,w=ue(e,Ee),O=l.useContext(de.ConfigContext),U=O.getPrefixCls,c=U("pro-form"),g=l.useState(function(){return a({},S)}),i=Z(g,2),P=i[0],J=i[1],L=l.useRef();return l.useImperativeHandle(W,function(){return L.current},[L.current]),p.jsx(ce,a(a({size:n,initialValues:S,form:s,contentRender:function(V){return p.jsx(He,{prefixCls:c,items:V==null?void 0:V.flatMap(function(b){var k;return!b||!(b!=null&&b.type)?b:(b==null||(k=b.type)===null||k===void 0?void 0:k.displayName)==="ProForm-Group"?b.props.children:b}),size:n,bordered:H,collapse:R,collapseLabel:ne,placement:t,values:P||{},footerRender:M,onValuesChange:function(k){var N,B,z=a(a({},P),k);J(z),(N=L.current)===null||N===void 0||N.setFieldsValue(z),(B=L.current)===null||B===void 0||B.submit(),y&&y(k,z)}})},formRef:L,formItemProps:{colon:!1,labelAlign:"left"},fieldProps:{style:{width:void 0}}},Fe(w,["labelWidth"])),{},{onValuesChange:function(V,b){var k;J(b),y==null||y(V,b),(k=L.current)===null||k===void 0||k.submit()}}))}var Ne=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function qe(e){var n,R,ne=e.children,S=e.trigger,y=e.onVisibleChange,s=e.onOpenChange,t=e.modalProps,W=e.onFinish,H=e.submitTimeout,M=e.title,w=e.width,O=e.visible,U=e.open,c=ue(e,Ne);ve(!c.footer||!(t!=null&&t.footer),"ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var g=l.useContext(de.ConfigContext),i=l.useState([]),P=Z(i,2),J=P[1],L=l.useState(!1),Q=Z(L,2),V=Q[0],b=Q[1],k=me(!!O,{value:U||O,onChange:s||y}),N=Z(k,2),B=N[0],z=N[1],X=l.useRef(null),re=l.useCallback(function(C){X.current===null&&C&&J([]),X.current=C},[]),Y=l.useRef(),f=l.useCallback(function(){var C,u,d,x=(C=(u=c.form)!==null&&u!==void 0?u:(d=c.formRef)===null||d===void 0?void 0:d.current)!==null&&C!==void 0?C:Y.current;x&&t!==null&&t!==void 0&&t.destroyOnClose&&x.resetFields()},[t==null?void 0:t.destroyOnClose,c.form,c.formRef]);l.useImperativeHandle(c.formRef,function(){return Y.current},[Y.current]),l.useEffect(function(){(U||O)&&(s==null||s(!0),y==null||y(!0))},[O,U]);var T=l.useMemo(function(){return S?oe.cloneElement(S,a(a({key:"trigger"},S.props),{},{onClick:function(){var C=le(G().mark(function d(x){var $,h;return G().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:z(!B),($=S.props)===null||$===void 0||(h=$.onClick)===null||h===void 0||h.call($,x);case 2:case"end":return A.stop()}},d)}));function u(d){return C.apply(this,arguments)}return u}()})):null},[z,S,B]),j=l.useMemo(function(){var C,u,d,x,$,h,q;return c.submitter===!1?!1:pe({searchConfig:{submitText:(C=(u=t==null?void 0:t.okText)!==null&&u!==void 0?u:(d=g.locale)===null||d===void 0||(d=d.Modal)===null||d===void 0?void 0:d.okText)!==null&&C!==void 0?C:"确认",resetText:(x=($=t==null?void 0:t.cancelText)!==null&&$!==void 0?$:(h=g.locale)===null||h===void 0||(h=h.Modal)===null||h===void 0?void 0:h.cancelText)!==null&&x!==void 0?x:"取消"},resetButtonProps:{preventDefault:!0,disabled:H?V:void 0,onClick:function(te){var ie;z(!1),t==null||(ie=t.onCancel)===null||ie===void 0||ie.call(t,te)}}},(q=c.submitter)!==null&&q!==void 0?q:{})},[(n=g.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.cancelText,(R=g.locale)===null||R===void 0||(R=R.Modal)===null||R===void 0?void 0:R.okText,t,c.submitter,z,V,H]),D=l.useCallback(function(C,u){return p.jsxs(p.Fragment,{children:[C,X.current&&u?p.jsx(oe.Fragment,{children:he.createPortal(u,X.current)},"submitter"):u]})},[]),_=l.useCallback(function(){var C=le(G().mark(function u(d){var x,$,h;return G().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return x=W==null?void 0:W(d),H&&x instanceof Promise&&(b(!0),$=setTimeout(function(){return b(!1)},H),x.finally(function(){clearTimeout($),b(!1)})),A.next=4,x;case 4:return h=A.sent,h&&z(!1),A.abrupt("return",h);case 7:case"end":return A.stop()}},u)}));return function(u){return C.apply(this,arguments)}}(),[W,z,H]),K=Ce(B);return p.jsxs(p.Fragment,{children:[p.jsx(Pe,a(a(a({title:M,width:w||800},t),K),{},{onCancel:function(u){var d;H&&V||(z(!1),t==null||(d=t.onCancel)===null||d===void 0||d.call(t,u))},afterClose:function(){var u;f(),B&&z(!1),t==null||(u=t.afterClose)===null||u===void 0||u.call(t)},footer:c.submitter!==!1?p.jsx("div",{ref:re,style:{display:"flex",justifyContent:"flex-end"}}):null,children:p.jsx(ce,a(a({formComponentType:"ModalForm",layout:"vertical"},c),{},{onInit:function(u,d){var x;c.formRef&&(c.formRef.current=d),c==null||(x=c.onInit)===null||x===void 0||x.call(c,u,d),Y.current=d},formRef:Y,submitter:j,onFinish:function(){var C=le(G().mark(function u(d){var x;return G().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,_(d);case 2:return x=h.sent,h.abrupt("return",x);case 4:case"end":return h.stop()}},u)}));return function(u){return C.apply(this,arguments)}}(),contentRender:D,children:ne}))})),T]})}export{Ye as D,Ze as L,qe as M};
//# sourceMappingURL=index-3fa95038.js.map
