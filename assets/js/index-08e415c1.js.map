{"version":3,"file":"index-08e415c1.js","sources":["../../../src/api/modules/module/category.ts","../../../src/views/module/category/index.tsx"],"sourcesContent":["import http from '@/api'\r\nimport { PORT1 } from '@/api/config/servicePort'\r\n\r\n// 功能模块 > 获取分类列表\r\nexport const categoryList = (parentId: string) => {\r\n\treturn http.get(PORT1 + `/category/list?parentId=${parentId}`)\r\n\t// return http.get(PORT1 + `/category/list`, {parentId});\r\n}\r\n\r\n// 添加分类\r\nexport const categoryAdd = (parentId: string, categoryName: string) => {\r\n\treturn http.post(PORT1 + `/category/add`, { parentId, categoryName })\r\n}\r\n\r\n// 更新分类\r\nexport const categoryUpdate = (parentId: string, categoryName: string) => {\r\n\treturn http.post(PORT1 + `/category/update`, { parentId, categoryName })\r\n}\r\n","import { categoryAdd, categoryList, categoryUpdate } from '@/api/modules/module/category'\r\nimport { Icon } from '@/components/Icon'\r\nimport { Button, Card, Form, Input, Modal, Select, Table, message } from 'antd'\r\nimport React, { useEffect, useState } from 'react'\r\n\r\nconst Category = () => {\r\n\tconst [loading, setLoading] = useState(false)\r\n\tconst [parentID, setparentID] = useState<string>('0')\r\n\tconst [parentName, setparentName] = useState('')\r\n\tconst [categoryObj, setcategoryObj] = useState<any>({})\r\n\tconst [categorys, setcategorys] = useState([])\r\n\tconst [subCategorys, setsubCategorys] = useState([])\r\n\tconst [showStatus, setshowStatus] = useState(0)\r\n\r\n\tconst [form_ins] = Form.useForm()\r\n\tconst [form_up] = Form.useForm()\r\n\r\n\t// ! 异步获取一级/二级分类列表显示\r\n\tconst getCategorys = async (parentId: string) => {\r\n\t\tsetLoading(true)\r\n\t\tparentId = parentId || parentID\r\n\t\tconst res: any = await categoryList(parentId)\r\n\t\tsetLoading(false)\r\n\t\tconsole.log('结果：', res)\r\n\t\tif (res.code === 200) {\r\n\t\t\tlet categorys: any = res.data.map((item: any, idn: any) => ({ ...item, key: idn }))\r\n\t\t\tconsole.log(parentId)\r\n\t\t\tif (parentId == '0') {\r\n\t\t\t\tsetcategorys(categorys)\r\n\t\t\t} else {\r\n\t\t\t\tsetsubCategorys(categorys)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tmessage.error('获取分类列表失败')\r\n\t\t}\r\n\t}\r\n\tuseEffect(() => {\r\n\t\tgetCategorys('')\r\n\t}, [])\r\n\r\n\tconst column = [\r\n\t\t{\r\n\t\t\ttitle: parentID === '0' ? '一级分类名称' : '二级分类名称',\r\n\t\t\tdataIndex: 'name', // 显示数据对应的属性名\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: '操作',\r\n\t\t\twidth: 300,\r\n\t\t\trender: (category: any) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<span>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tstyle={{ color: '#fe8281' }}\r\n\t\t\t\t\t\t\ttype=\"link\"\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tshowUpdate(category)\r\n\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t{parentID === '0' ? '修改一级分类' : '修改二级分类'}\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t{parentID === '0' ? (\r\n\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\ttype=\"link\"\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tshowSubCategorys(category)\r\n\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t查看子分类\r\n\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t},\r\n\t]\r\n\r\n\t// 修改分类按钮 > 开启弹窗\r\n\tconst showUpdate = (category: any) => {\r\n\t\tsetcategoryObj(category)\r\n\t\tsetshowStatus(2)\r\n\t}\r\n\t// 查看子分类按钮 > 显示子分类列表\r\n\tconst showSubCategorys = (category: any) => {\r\n\t\tsetparentID(category._id)\r\n\t\tsetparentName(category.name)\r\n\t\t// console.log(category.name, category._id);\r\n\t\tgetCategorys(category._id)\r\n\t}\r\n\r\n\t// 显示指定一级分类列表\r\n\tconst shwoCategorys = () => {\r\n\t\tsetparentID('0')\r\n\t\tsetparentName('')\r\n\t\tsetsubCategorys([])\r\n\t}\r\n\r\n\t// 添加分类\r\n\tconst addCategory = async () => {\r\n\t\tconst { parentId, categoryName } = form_ins.getFieldsValue()\r\n\t\tconsole.log(parentId, categoryName) // 5e130ec7e31bb727e4b0e34c Vivo\r\n\t\tconst res = await categoryAdd(parentId, categoryName)\r\n\t\tsetshowStatus(0)\r\n\t\tif (res.code === 200) {\r\n\t\t\t// 添加的分类就是当前分类列表下的分类\r\n\t\t\tif (parentId === parentID) {\r\n\t\t\t\t// 重新获取当前分类列表显示\r\n\t\t\t\tgetCategorys(parentId)\r\n\t\t\t} else if (parentId === '0') {\r\n\t\t\t\t// 在二级分类列表下添加一级分类, 重新获取一级分类列表, 但不需要显示一级列表\r\n\t\t\t\tgetCategorys('0')\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 更新分类\r\n\tconst updateCategory = async () => {\r\n\t\t// 1. 隐藏确定框\r\n\t\tsetshowStatus(0)\r\n\r\n\t\t// 2.准备数据\r\n\t\tconst categoryId = categoryObj._id\r\n\t\tconst { categoryName } = form_up.getFieldsValue()\r\n\r\n\t\t// 3. 发请求更新分类\r\n\t\tconst res = await categoryUpdate(categoryId, categoryName)\r\n\t\tif (res.code === 200) {\r\n\t\t\t// 4. 重新显示列表\r\n\t\t\tgetCategorys('')\r\n\t\t}\r\n\t}\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Card\r\n\t\t\t\ttitle={\r\n\t\t\t\t\tparentID === '0' ? (\r\n\t\t\t\t\t\t'一级分类列表'\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t<Button onClick={shwoCategorys} type=\"link\">\r\n\t\t\t\t\t\t\t\t<b>一级分类列表</b>\r\n\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t{/* <Icon name=\"arrow-right\" /> */}\r\n\t\t\t\t\t\t\t{'->'}&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t\t<span className=\"font-normal font-serif\">{parentName}</span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t\textra={\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tsetshowStatus(1)\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t{/* <Icon name=\"plus\" /> */}\r\n\t\t\t\t\t\t添加分类\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}>\r\n\t\t\t\t<Table loading={loading} columns={column} dataSource={parentID === '0' ? categorys : subCategorys} />\r\n\t\t\t</Card>\r\n\t\t\t<Modal\r\n\t\t\t\ttitle=\"添加分类\"\r\n\t\t\t\topen={showStatus === 1}\r\n\t\t\t\tonOk={addCategory}\r\n\t\t\t\tonCancel={() => {\r\n\t\t\t\t\tsetshowStatus(0)\r\n\t\t\t\t}}>\r\n\t\t\t\t<AddForm categorys={categorys} parentId={parentID} form={form_ins} />\r\n\t\t\t</Modal>\r\n\t\t\t<Modal\r\n\t\t\t\ttitle=\"修改分类\"\r\n\t\t\t\topen={showStatus === 2}\r\n\t\t\t\tonOk={updateCategory}\r\n\t\t\t\tonCancel={() => {\r\n\t\t\t\t\tsetshowStatus(0)\r\n\t\t\t\t}}>\r\n\t\t\t\t<UpdateForm categoryName={categoryObj.name} form={form_up} />\r\n\t\t\t</Modal>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nfunction AddForm({ categorys, parentId, form }: any) {\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tform.resetFields()\r\n\t\t}\r\n\t})\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Form form={form} initialValues={{ parentId: parentId }}>\r\n\t\t\t\t<Form.Item name=\"parentId\">\r\n\t\t\t\t\t<Select>\r\n\t\t\t\t\t\t<Select.Option value={'0'}>一级分类</Select.Option>\r\n\t\t\t\t\t\t{categorys.map((item: any) => {\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Select.Option key={item._id} value={item._id}>\r\n\t\t\t\t\t\t\t\t\t{item.name}\r\n\t\t\t\t\t\t\t\t</Select.Option>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Select>\r\n\t\t\t\t</Form.Item>\r\n\t\t\t\t<Form.Item name=\"categoryName\">\r\n\t\t\t\t\t<Input placeholder=\"请输入分类名称\" />\r\n\t\t\t\t</Form.Item>\r\n\t\t\t</Form>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nfunction UpdateForm({ categoryName, form }: any) {\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tform.resetFields()\r\n\t\t}\r\n\t})\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<Form form={form} initialValues={{ categoryName: categoryName }}>\r\n\t\t\t\t<Form.Item name=\"categoryName\">\r\n\t\t\t\t\t<Input placeholder=\"请输入分类名称\" />\r\n\t\t\t\t</Form.Item>\r\n\t\t\t</Form>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nexport default Category\r\n"],"names":["categoryList","parentId","http","get","PORT1","categoryAdd","categoryName","post","categoryUpdate","Category","loading","setLoading","useState","parentID","setparentID","parentName","setparentName","categoryObj","setcategoryObj","categorys","setcategorys","subCategorys","setsubCategorys","showStatus","setshowStatus","form_ins","Form","form_up","getCategorys","res","item","idn","message","useEffect","column","category","jsx","Button","showUpdate","showSubCategorys","shwoCategorys","addCategory","updateCategory","categoryId","jsxs","Fragment","Card","Table","Modal","AddForm","UpdateForm","form","Select","Input"],"mappings":"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"}