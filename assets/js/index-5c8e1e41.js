import{r as F,W as N,X as O,$ as r,by as Q,m as _,bA as L,bB as q,c3 as V,V as Y,co as de,j as b,ae as Z,d as H,a as z,c2 as ue,cp as U,bi as se,bh as ce}from"./index-113fc74b.js";import"./index-2558b860.js";import{r as A,d as ve,E as fe,g as me,a as K,I as ge}from"./index-ab20dc43.js";import{L as W,P as ee}from"./index-eb3d29dd.js";import{c as ae}from"./BaseForm-d64f7000.js";import{s as ye,P as B}from"./index-2087a3c7.js";import{u as he,p as G}from"./index-a6a1d57f.js";import{a as be}from"./index-e3c30206.js";import{D as X}from"./index-ed073ed4.js";var pe=function(e){return(_.warn||_.warning)(e)};function Se(t){var e=t.data,l=t.row;return r(r({},e),l)}function xe(t){var e=F.useRef(null),l=t.type||"single",c=he(),g=N([],{value:t.editableKeys,onChange:t.onChange?function(v){var d;t==null||(d=t.onChange)===null||d===void 0||d.call(t,v,t.dataSource)}:void 0}),R=O(g,2),m=R[0],C=R[1],D=F.useMemo(function(){var v=l==="single"?m==null?void 0:m.slice(0,1):m;return new Set(v)},[(m||[]).join(","),l]),k=F.useCallback(function(v){return!!(m!=null&&m.includes(A(v)))},[(m||[]).join(",")]),u=function(d,a){var i;return D.size>0&&l==="single"?(pe(t.onlyOneLineEditorAlertMessage||c.getMessage("editableTable.onlyOneLineEditor","只能同时编辑一行")),!1):(e.current=(i=a??Q(t.dataSource,Array.isArray(d)?d:[d]))!==null&&i!==void 0?i:null,D.add(A(d)),C(Array.from(D)),!0)},h=function(d){return D.delete(A(d)),C(Array.from(D)),!0},I=function(){var v=L(q().mark(function d(a,i,E,T){var p,P;return q().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,t==null||(p=t.onCancel)===null||p===void 0?void 0:p.call(t,a,i,E,T);case 2:if(P=f.sent,P!==!1){f.next=5;break}return f.abrupt("return",!1);case 5:return f.abrupt("return",!0);case 6:case"end":return f.stop()}},d)}));return function(a,i,E,T){return v.apply(this,arguments)}}(),S=function(){var v=L(q().mark(function d(a,i,E){var T,p,P;return q().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,t==null||(T=t.onSave)===null||T===void 0?void 0:T.call(t,a,i,E);case 2:if(p=f.sent,p!==!1){f.next=5;break}return f.abrupt("return",!1);case 5:return f.next=7,h(a);case 7:return P={data:t.dataSource,row:i,key:a,childrenColumnName:t.childrenColumnName||"children"},t.setDataSource(Se(P)),f.abrupt("return",!0);case 10:case"end":return f.stop()}},d)}));return function(a,i,E){return v.apply(this,arguments)}}(),w=c.getMessage("editableTable.action.save","保存"),o=c.getMessage("editableTable.action.delete","删除"),j=c.getMessage("editableTable.action.cancel","取消"),x=F.useCallback(function(v,d){var a=r({recordKey:v,cancelEditable:h,onCancel:I,onSave:S,editableKeys:m,setEditableRowKeys:C,saveText:w,cancelText:j,preEditRowRef:e,deleteText:o,deletePopconfirmMessage:"".concat(c.getMessage("deleteThisLine","删除此项"),"?"),editorType:"Map"},d),i=ve(t.dataSource,a);return t.actionRender?t.actionRender(t.dataSource,a,{save:i.save,delete:i.delete,cancel:i.cancel}):[i.save,i.delete,i.cancel]},[m&&m.join(","),t.dataSource]);return{editableKeys:m,setEditableRowKeys:C,isEditable:k,actionRender:x,startEditable:u,cancelEditable:h}}var Ee=function(e,l){var c=l||{},g=c.onRequestError,R=c.effects,m=c.manual,C=c.dataSource,D=c.defaultDataSource,k=c.onDataSourceChange,u=N(D,{value:C,onChange:k}),h=O(u,2),I=h[0],S=h[1],w=N(l==null?void 0:l.loading,{value:l==null?void 0:l.loading,onChange:l==null?void 0:l.onLoadingChange}),o=O(w,2),j=o[0],x=o[1],v=function(i){S(i),x(!1)},d=function(){var a=L(q().mark(function i(){var E,T,p;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!j){n.next=2;break}return n.abrupt("return");case 2:return x(!0),n.prev=3,n.next=6,e();case 6:if(n.t0=n.sent,n.t0){n.next=9;break}n.t0={};case 9:E=n.t0,T=E.data,p=E.success,p!==!1&&v(T),n.next=23;break;case 15:if(n.prev=15,n.t1=n.catch(3),g!==void 0){n.next=21;break}throw new Error(n.t1);case 21:g(n.t1);case 22:x(!1);case 23:return n.prev=23,x(!1),n.finish(23);case 26:case"end":return n.stop()}},i,null,[[3,15,23,26]])}));return function(){return a.apply(this,arguments)}}();return F.useEffect(function(){m||d()},[].concat(V(R||[]),[m])),{dataSource:I,setDataSource:S,loading:j,reload:function(){return d()}}};const Te=Ee;var Ce=["valueEnum","render","renderText","mode","plain","dataIndex","request","params","editable"],De=["request","columns","params","dataSource","onDataSourceChange","formProps","editable","loading","onLoadingChange","actionRef","onRequestError","emptyText","contentStyle"],Ie=function(e,l){var c=e.dataIndex;if(c){var g=Array.isArray(c)?Q(l,c):l[c];if(g!==void 0||g!==null)return g}return e.children},J=function(e){var l,c=e.valueEnum,g=e.action,R=e.index,m=e.text,C=e.entity,D=e.mode,k=e.render,u=e.editableUtils,h=e.valueType,I=e.plain,S=e.dataIndex,w=e.request,o=e.renderFormItem,j=e.params,x=e.emptyText,v=ee.useFormInstance(),d=(l=G.useToken)===null||l===void 0?void 0:l.call(G),a=d.token,i={text:m,valueEnum:c,mode:D||"read",proFieldProps:{emptyText:x,render:k?function(p){return k==null?void 0:k(p,C,R,g,r(r({},e),{},{type:"descriptions"}))}:void 0},ignoreFormItem:!0,valueType:h,request:w,params:j,plain:I};if(D==="read"||!D||h==="option"){var E=K(e.fieldProps,void 0,r(r({},e),{},{rowKey:S,isEditable:!1}));return b.jsx(B,r(r({name:S},i),{},{fieldProps:E}))}var T=function(){var P,n=K(e.formItemProps,v,r(r({},e),{},{rowKey:S,isEditable:!0})),f=K(e.fieldProps,v,r(r({},e),{},{rowKey:S,isEditable:!0}));return b.jsxs("div",{style:{display:"flex",gap:a.marginXS,alignItems:"baseline"},children:[b.jsx(ge,r(r({name:S},n),{},{style:r({margin:0},(n==null?void 0:n.style)||{}),initialValue:m||(n==null?void 0:n.initialValue),children:b.jsx(B,r(r({},i),{},{proFieldProps:r({},i.proFieldProps),renderFormItem:o?function(){return o==null?void 0:o(r(r({},e),{},{type:"descriptions"}),{isEditable:!0,recordKey:S,record:v.getFieldValue([S].flat(1)),defaultRender:function(){return b.jsx(B,r(r({},i),{},{fieldProps:f}))},type:"descriptions"},v)}:void 0,fieldProps:f}))})),b.jsx("div",{style:{display:"flex",maxHeight:a.controlHeight,alignItems:"center",gap:a.marginXS},children:u==null||(P=u.actionRender)===null||P===void 0?void 0:P.call(u,S||R,{cancelText:b.jsx(se,{}),saveText:b.jsx(ce,{}),deleteText:!1})})]})};return b.jsx("div",{style:{marginTop:-5,marginBottom:-5,marginLeft:0,marginRight:0},children:T()})},Pe=function(e,l,c,g,R){var m,C=[],D=ae(U,"5.8.0")>=0,k=e==null||(m=e.map)===null||m===void 0?void 0:m.call(e,function(u,h){var I,S,w;if(H.isValidElement(u))return D?{children:u}:u;var o=u;o.valueEnum,o.render;var j=o.renderText,x=o.mode;o.plain;var v=o.dataIndex;o.request,o.params;var d=o.editable,a=Y(o,Ce),i=(I=Ie(u,l))!==null&&I!==void 0?I:a.children,E=j?j(i,l,h,c):i,T=typeof a.title=="function"?a.title(u,"descriptions",null):a.title,p=typeof a.valueType=="function"?a.valueType(l||{},"descriptions"):a.valueType,P=g==null?void 0:g.isEditable(v||h),n=x||P?"edit":"read",f=g&&n==="read"&&d!==!1&&(d==null?void 0:d(E,l,h))!==!1,M=f?Z:H.Fragment,s=n==="edit"?E:me(E,u,E),y=D&&p!=="option"?r(r({},a),{},{key:a.key||((S=a.label)===null||S===void 0?void 0:S.toString())||h,label:(T||a.label||a.tooltip)&&b.jsx(W,{label:T||a.label,tooltip:a.tooltip,ellipsis:u.ellipsis}),children:b.jsxs(M,{children:[F.createElement(J,r(r({},u),{},{key:u==null?void 0:u.key,dataIndex:u.dataIndex||h,mode:n,text:s,valueType:p,entity:l,index:h,emptyText:R,action:c,editableUtils:g})),f&&b.jsx(z,{onClick:function(){g==null||g.startEditable(v||h)}})]})}):F.createElement(X.Item,r(r({},a),{},{key:a.key||((w=a.label)===null||w===void 0?void 0:w.toString())||h,label:(T||a.label||a.tooltip)&&b.jsx(W,{label:T||a.label,tooltip:a.tooltip,ellipsis:u.ellipsis})}),b.jsxs(M,{children:[b.jsx(J,r(r({},u),{},{dataIndex:u.dataIndex||h,mode:n,text:s,valueType:p,entity:l,index:h,action:c,editableUtils:g})),f&&p!=="option"&&b.jsx(z,{onClick:function(){g==null||g.startEditable(v||h)}})]}));return p==="option"?(C.push(y),null):y}).filter(function(u){return u});return{options:C!=null&&C.length?C:null,children:k}},re=function(e){return b.jsx(X.Item,r(r({},e),{},{children:e.children}))};re.displayName="ProDescriptionsItem";var ke=function(e){return e.children},Re=function(e){var l,c=e.request,g=e.columns,R=e.params,m=e.dataSource,C=e.onDataSourceChange,D=e.formProps,k=e.editable,u=e.loading,h=e.onLoadingChange,I=e.actionRef,S=e.onRequestError;e.emptyText;var w=e.contentStyle,o=Y(e,De),j=F.useContext(de.ConfigContext),x=Te(L(q().mark(function f(){var M;return q().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!c){y.next=6;break}return y.next=3,c(R||{});case 3:y.t0=y.sent,y.next=7;break;case 6:y.t0={data:{}};case 7:return M=y.t0,y.abrupt("return",M);case 9:case"end":return y.stop()}},f)})),{onRequestError:S,effects:[ye(R)],manual:!c,dataSource:m,loading:u,onLoadingChange:h,onDataSourceChange:C}),v=xe(r(r({},e.editable),{},{childrenColumnName:void 0,dataSource:x.dataSource,setDataSource:x.setDataSource}));if(F.useEffect(function(){I&&(I.current=r({reload:x.reload},v))},[x,I,v]),x.loading||x.loading===void 0&&c)return b.jsx(be,{type:"descriptions",list:!1,pageHeader:!1});var d=function(){var M=ue(e.children).filter(Boolean).map(function(s){if(!H.isValidElement(s))return s;var y=s==null?void 0:s.props,$=y.valueEnum,ne=y.valueType,te=y.dataIndex,le=y.ellipsis,ie=y.copyable,oe=y.request;return!ne&&!$&&!te&&!oe&&!le&&!ie&&s.type.displayName!=="ProDescriptionsItem"?s:r(r({},s==null?void 0:s.props),{},{entity:m})});return[].concat(V(g||[]),V(M)).filter(function(s){return!s||s!=null&&s.valueType&&["index","indexBorder"].includes(s==null?void 0:s.valueType)?!1:!(s!=null&&s.hideInDescriptions)}).sort(function(s,y){return y.order||s.order?(y.order||0)-(s.order||0):(y.index||0)-(s.index||0)})},a=Pe(d(),x.dataSource||{},(I==null?void 0:I.current)||x,k?v:void 0,e.emptyText),i=a.options,E=a.children,T=k?ee:ke,p=null;(o.title||o.tooltip||o.tip)&&(p=b.jsx(W,{label:o.title,tooltip:o.tooltip||o.tip}));var P=j.getPrefixCls("pro-descriptions"),n=ae(U,"5.8.0")>=0;return b.jsx(fe,{children:b.jsx(T,r(r({form:(l=e.editable)===null||l===void 0?void 0:l.form,component:!1,submitter:!1},D),{},{onFinish:void 0,children:b.jsx(X,r(r({className:P},o),{},{contentStyle:r({minWidth:0},w||{}),extra:o.extra?b.jsxs(Z,{children:[i,o.extra]}):i,title:p,items:n?E:void 0,children:n?null:E}))}),"form")})};Re.Item=re;export{Re as P};
//# sourceMappingURL=index-5c8e1e41.js.map
