import{j as u,Z as o,aw as ne,bw as I,r as g,d as k,S as N,V as ie,W as oe,bx as M,X as le,B as de,aA as ue,by as ce,bz as O}from"./index-f751f953.js";import"./index-4af888df.js";import{u as se}from"./index-a2ff02e6.js";import{u as A,r as L,i as me}from"./BaseForm-db9919a0.js";import{s as ve,a as fe}from"./index-da3cafad.js";import{P as he}from"./Table-4317ea87.js";import{P as ge}from"./index-a08b551a.js";import"./zh_CN-f51ae7db.js";import"./createForOfIteratorHelper-bf7ef3ef.js";import"./merge-3556e90e.js";import"./index-d5c7de5c.js";import"./Select-8ced64f0.js";import"./List-f96a4af3.js";import"./useShowArrow-041c890e.js";import"./useIcons-2d7ebba2.js";import"./index-f51ee0d4.js";import"./Cascader-f50bb6f8.js";import"./conductUtil-242f4494.js";import"./index-faeef1e6.js";import"./index-ebc51cb7.js";import"./index-72ce5474.js";import"./useBubbleLock-76e3efc3.js";import"./_baseAssignValue-7ebdb767.js";import"./_baseClone-8fe8163c.js";import"./ColorPicker-dea281ba.js";import"./ColorPicker-34de79e3.js";import"./index-d30caffb.js";import"./index-35702838.js";import"./customParseFormat-3d9a6dd4.js";import"./SinglePicker-a6c4fdda.js";import"./index-667aca58.js";import"./index-0d712198.js";import"./Image-d22de7ce.js";import"./addEventListener-5725c09d.js";import"./index-938cd4fc.js";import"./index-83c2646d.js";import"./Rate-2c8956ca.js";import"./index-2c90010a.js";import"./index-3f11afe2.js";import"./TreeSelect-dbafa631.js";import"./Tree-0072d5c0.js";import"./iconUtil-d0cad765.js";import"./isoWeek-c98defb4.js";import"./index-cdfb681e.js";import"./index-f6188615.js";import"./styleChecker-073f601d.js";import"./index-134fcbaa.js";import"./useLazyKVMap-e5061ebc.js";import"./index-1bae9e8a.js";import"./isEmpty-5a08f441.js";import"./_baseIsEqual-ebd38edf.js";import"./Table-edb7e357.js";import"./index-703dcce4.js";import"./useMultipleSelect-e72ee447.js";import"./Pagination-3b2f15f4.js";import"./index-0592541c.js";import"./index-1a4fbd83.js";import"./index-8a0f6792.js";import"./index-d0a33357.js";import"./index-adb7364a.js";import"./index-62986a5a.js";import"./Steps-af513cd4.js";var be=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],ye=["record","position","creatorButtonText","newRecordType","parentKey","style"],U=k.createContext(void 0);function W(e){var f=e.children,b=e.record,w=e.position,C=e.newRecordType,s=e.parentKey,c=g.useContext(U);return k.cloneElement(f,o(o({},f.props),{},{onClick:function(){var h=ce(O().mark(function x(j){var R,_,m,S;return O().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(R=(_=f.props).onClick)===null||R===void 0?void 0:R.call(_,j);case 2:if(S=t.sent,S!==!1){t.next=5;break}return t.abrupt("return");case 5:c==null||(m=c.current)===null||m===void 0||m.addEditRecord(b,{position:w,newRecordType:C,parentKey:s});case 6:case"end":return t.stop()}},x)}));function y(x){return h.apply(this,arguments)}return y}()}))}function q(e){var f,b,w=se(),C=e.onTableChange,s=e.maxLength;e.formItemProps;var c=e.recordCreatorProps,h=e.rowKey;e.controlled;var y=e.defaultValue;e.onChange;var x=e.editableFormRef,j=N(e,be),R=g.useRef(void 0),_=g.useRef(),m=g.useRef();g.useImperativeHandle(j.actionRef,function(){return _.current},[_.current]);var S=ie(function(){return e.value||y||[]},{value:e.value,onChange:e.onChange}),E=oe(S,2),t=E[0],J=E[1],V=k.useMemo(function(){return typeof h=="function"?h:function(r,d){return r[h]||d}},[h]),D=A(function(r){if(typeof r=="number"&&!e.name){if(r>=t.length)return r;var d=t&&t[r];return V==null?void 0:V(d,r)}if((typeof r=="string"||r>=t.length)&&e.name){var a=t.findIndex(function(n,i){var l;return(V==null||(l=V(n,i))===null||l===void 0?void 0:l.toString())===(r==null?void 0:r.toString())});if(a!==-1)return a}return r});g.useImperativeHandle(x,function(){var r=function(n){var i,l;if(n==null)throw new Error("rowIndex is required");var v=D(n),p=[e.name,(i=v==null?void 0:v.toString())!==null&&i!==void 0?i:""].flat(1).filter(Boolean);return(l=m.current)===null||l===void 0?void 0:l.getFieldValue(p)},d=function(){var n,i=[e.name].flat(1).filter(Boolean);if(Array.isArray(i)&&i.length===0){var l,v=(l=m.current)===null||l===void 0?void 0:l.getFieldsValue();return Array.isArray(v)?v:Object.keys(v).map(function(p){return v[p]})}return(n=m.current)===null||n===void 0?void 0:n.getFieldValue(i)};return o(o({},m.current),{},{getRowData:r,getRowsData:d,setRowData:function(n,i){var l,v;if(n==null)throw new Error("rowIndex is required");var p=D(n),F=[e.name,(l=p==null?void 0:p.toString())!==null&&l!==void 0?l:""].flat(1).filter(Boolean),re=Object.assign({},o(o({},r(n)),i||{})),ae=M({},F,re);return(v=m.current)===null||v===void 0||v.setFieldsValue(ae),!0}})},[D,e.name,m.current]),g.useEffect(function(){e.controlled&&(t||[]).forEach(function(r,d){var a;(a=m.current)===null||a===void 0||a.setFieldsValue(le({},"".concat(V(r,d)),r))},{})},[ve(t),e.controlled]),g.useEffect(function(){if(e.name){var r;m.current=e==null||(r=e.editable)===null||r===void 0?void 0:r.form}},[(f=e.editable)===null||f===void 0?void 0:f.form,e.name]);var T=c||{},z=T.record,$=T.position,G=T.creatorButtonText,X=T.newRecordType,Z=T.parentKey,Q=T.style,Y=N(T,ye),B=$==="top",P=g.useMemo(function(){return typeof s=="number"&&s<=(t==null?void 0:t.length)?!1:c!==!1&&u.jsx(W,{record:L(z,t==null?void 0:t.length,t)||{},position:$,parentKey:L(Z,t==null?void 0:t.length,t),newRecordType:X,children:u.jsx(de,o(o({type:"dashed",style:o({display:"block",margin:"10px 0",width:"100%"},Q),icon:u.jsx(ue,{})},Y),{},{children:G||w.getMessage("editableTable.action.add","添加一行数据")}))})},[c,s,t==null?void 0:t.length]),ee=g.useMemo(function(){return P?B?{components:{header:{wrapper:function(d){var a,n=d.className,i=d.children;return u.jsxs("thead",{className:n,children:[i,u.jsxs("tr",{style:{position:"relative"},children:[u.jsx("td",{colSpan:0,style:{visibility:"hidden"},children:P}),u.jsx("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(a=j.columns)===null||a===void 0?void 0:a.length,children:P})]})]})}}}}:{tableViewRender:function(d,a){var n,i;return u.jsxs(u.Fragment,{children:[(n=(i=e.tableViewRender)===null||i===void 0?void 0:i.call(e,d,a))!==null&&n!==void 0?n:a,P]})}}:{}},[B,P]),K=o({},e.editable),te=A(function(r,d){var a,n,i;if((a=e.editable)===null||a===void 0||(n=a.onValuesChange)===null||n===void 0||n.call(a,r,d),(i=e.onValuesChange)===null||i===void 0||i.call(e,d,r),e.controlled){var l;e==null||(l=e.onChange)===null||l===void 0||l.call(e,d)}});return(e!=null&&e.onValuesChange||(b=e.editable)!==null&&b!==void 0&&b.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(K.onValuesChange=te),u.jsxs(u.Fragment,{children:[u.jsx(U.Provider,{value:_,children:u.jsx(he,o(o(o({search:!1,options:!1,pagination:!1,rowKey:h,revalidateOnFocus:!1},j),ee),{},{tableLayout:"fixed",actionRef:_,onChange:C,editable:o(o({},K),{},{formProps:o({formRef:m},K.formProps)}),dataSource:t,onDataSourceChange:function(d){if(J(d),e.name&&$==="top"){var a,n=M({},[e.name].flat(1).filter(Boolean),d);(a=m.current)===null||a===void 0||a.setFieldsValue(n)}}}))}),e.name?u.jsx(fe,{name:[e.name],children:function(d){var a,n;if(!R.current)return R.current=t,null;var i=I(d,[e.name].flat(1)),l=i==null?void 0:i.find(function(v,p){var F;return!me(v,(F=R.current)===null||F===void 0?void 0:F[p])});return R.current=t,l&&(e==null||(a=e.editable)===null||a===void 0||(n=a.onValuesChange)===null||n===void 0||n.call(a,l,i)),null}}):null]})}function H(e){var f=ge.useFormInstance();return e.name?u.jsx(ne.Item,o(o({style:{maxWidth:"100%"},shouldUpdate:function(w,C){var s=[e.name].flat(1);try{return JSON.stringify(I(w,s))!==JSON.stringify(I(C,s))}catch{return!0}}},e==null?void 0:e.formItemProps),{},{name:e.name,children:u.jsx(q,o(o({tableLayout:"fixed",scroll:{x:"max-content"}},e),{},{editable:o(o({},e.editable),{},{form:f})}))})):u.jsx(q,o({tableLayout:"fixed",scroll:{x:"max-content"}},e))}H.RecordCreator=W;const xe=(e=100)=>new Promise(f=>{setTimeout(()=>{f(!0)},e)}),pe=[{id:624748504,title:"活动名称一",readonly:"活动名称一",decs:"这个活动真好玩",state:"open",created_at:"1590486176000",update_at:"1590486176000"},{id:624691228,title:"活动名称二",readonly:"活动名称二",decs:"这个活动真好玩",state:"closed",created_at:"1590481162000",update_at:"1590481162000"},{id:624691229,title:"活动名称二",readonly:"活动名称二",decs:"这个活动真好玩",state:"closed",created_at:"1590481162000",update_at:"1590481162000"},{id:624691230,title:"活动名称二",readonly:"活动名称二",decs:"这个活动真好玩",state:"closed",created_at:"1590481162000",update_at:"1590481162000"}],Ft=()=>{const[e,f]=g.useState([]),[b,w]=g.useState([]),C=[{title:"活动名称",dataIndex:"title",tooltip:"只读，使用form.getFieldValue获取不到值",formItemProps:(s,{rowIndex:c})=>({rules:c>1?[{required:!0,message:"此项为必填项"}]:[]}),editable:(s,c,h)=>h!==0,width:"15%"},{title:"活动名称二",dataIndex:"readonly",tooltip:"只读，使用form.getFieldValue可以获取到值",width:"15%"},{title:"状态",key:"state",dataIndex:"state",valueType:"select",valueEnum:{all:{text:"全部",status:"Default"},open:{text:"未解决",status:"Error"},closed:{text:"已解决",status:"Success"}}},{title:"描述",dataIndex:"decs",fieldProps:(s,{rowKey:c,rowIndex:h})=>s.getFieldValue([c||"","title"])==="不好玩"?{disabled:!0}:h>9?{disabled:!0}:{}},{title:"活动时间",dataIndex:"created_at",valueType:"date"},{title:"操作",valueType:"option",width:200,render:(s,c,h,y)=>[u.jsx("a",{onClick:()=>{var x;(x=y==null?void 0:y.startEditable)==null||x.call(y,c.id)},children:"编辑"},"editable"),u.jsx("a",{onClick:()=>{w(b.filter(x=>x.id!==c.id))},children:"删除"},"delete")]}];return u.jsx(H,{rowKey:"id",headerTitle:"使用 EditTable",className:"ant-pro-table-scroll",scroll:{x:1e3,y:"100%"},bordered:!0,cardBordered:!0,pagination:!1,recordCreatorProps:{position:"bottom",record:()=>({id:(Math.random()*1e6).toFixed(0)})},loading:!1,columns:C,request:async()=>({data:pe,total:5,success:!0}),value:b,onChange:w,editable:{type:"multiple",editableKeys:e,onSave:async(s,c,h)=>{await xe(2e3)},onChange:f}})};export{Ft as default};
//# sourceMappingURL=index-2b6a07f2.js.map
