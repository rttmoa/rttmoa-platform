import{an as f,r as a,j as e,bU as y,bV as Z,I as ee,B as g,aO as k}from"./.pnpm-e6eae8df.js";import{r as v}from"./roleManage-ea36f73b.js";import{c as te,d as se,e as le,g as ae,h as ie}from"./userManage2-7edbb902.js";import ne from"./treeList-758a120f.js";import oe from"./tableList-b1bac714.js";import{m as c,n as z}from"./index-479552fe.js";import de from"./addPolice-45a34c66.js";import re from"./selectRole-d14f2bbc.js";const ce=f.Item,{Content:ue,Sider:pe}=y,Ne=()=>{const[C]=f.useForm(),[A]=f.useForm(),[U,S]=a.useState(""),[d,h]=a.useState({PoliceAddVisible:!1,moduletype:"",moduletitle:""}),[N,b]=a.useState(""),[R,x]=a.useState(!1),[D,m]=a.useState(!1),[V,L]=a.useState(!1),[u,he]=a.useState({view:!0,freeze:!0,delete:!0,edit:!0,add:!0}),[i,o]=a.useState({keyword:"",pageSize:10,pageNo:1,deptCode:""}),[F,O]=a.useState({list:[],loading:!1}),[r,T]=a.useState({list:[],loading:!1}),[w,E]=a.useState({list:[],loading:!1}),[P,I]=a.useState({list:[],loading:!1}),n=t=>{se(i).then(s=>{let l=s.data;l.list.splice(0,l.list.length-10),T({list:l}),t&&t()})};a.useEffect(()=>{v().then(t=>{I({list:t.data.list})}),te({}).then(t=>{O({list:t.data}),o(s=>({...s,deptCode:t.data[0].deptCode})),S(t.data[0].deptName)}),n(()=>{})},[]);const K=t=>{v().then(s=>{I({list:s.data}),x(!0),b(t)})},M=t=>{le({id:t}).then(s=>{E({list:s.data}),h({PoliceAddVisible:!0,moduletype:"edit",moduletitle:"详情"}),b(t)})},$=(t,s)=>{ae({id:t,status:s}).then(l=>{c.success(l.msg),n(()=>{})})},B=t=>{if(sessionStorage.getItem("userid")===t){c.warning("自己不能删除自己");return}const s=r.list;let l=i.pageNo;ie({deptcode:i.deptCode,id:t}).then(p=>{c.success(p.msg),s.totalPage>1&&s.totalCount%10===1&&(l-=1),o(j=>({...j,pageNo:l})),n(()=>{})})},G=[{title:"姓名",dataIndex:"chineseName",key:"chineseName",width:"15%"},{title:"职务",dataIndex:"post",key:"post",width:"15%",render:t=>e.jsx("span",{children:"员工"})},{title:"帐号",dataIndex:"username",key:"username",width:"15%"},{title:"帐号状态",dataIndex:"statusLabel",key:"statusLabel",width:"15%",render:(t,s,l)=>e.jsx("span",{children:s.status?"已冻结":"正常"})},{title:"角色",dataIndex:"roles",key:"roles",width:"20%",render:(t,s,l)=>{const p=[];(t||[]).map(Y=>{p.push(Y.role_name)});let j=p.length===0?"":p.join(",");return e.jsx(g,{type:"default",onClick:()=>{K(s.id)},children:j||"普通用户"})}},{title:"操作",key:"operate",render:(t,s,l)=>e.jsxs("span",{children:[u.view?e.jsxs("span",{children:[e.jsx("a",{onClick:()=>M(s.id),children:"详情"}),e.jsx("span",{className:"ant-divider"})]}):null,u.freeze?e.jsx("span",{children:e.jsx(k,{title:`确认${s.status?"解冻":"冻结"}账户?`,placement:"left",onConfirm:()=>$(s.id,`${s.status}`),children:e.jsx("a",{children:s.status?"解冻账户":"冻结账户"})})}):null,e.jsx("span",{className:"ant-divider"}),u.delete?e.jsx(k,{title:"删除用户?",placement:"left",onConfirm:()=>B(s.id),children:e.jsx("a",{children:"删除"})}):null]})}],H=(t=[],s)=>{m(!0),S(s),o(l=>({...l,deptCode:t[0],pageNo:1,keyword:""})),n(()=>{m(!1)})},_=()=>{const t=C.getFieldsValue();m(!0),o(s=>({...s,keyword:t,pageNo:1})),n(()=>{m(!1)})},q=t=>{o({pageNo:t}),n(()=>{})},J=(t,s)=>{o(l=>({...l,pageNo:1,pageSize:s}))},Q=()=>{i.deptCode?(z.info({message:`deptId是${i.deptCode}`}),h({PoliceAddVisible:!0,moduletype:"add",moduletitle:"新增"})):z.error({message:"错误",description:"请先选择部门"})},W=()=>{c.info("用户数据同步中"),L(!0),setTimeout(()=>{c.success("用户数据同步完成"),L(!1),n(()=>{})},2500)},X=()=>{const t=r.list;let s=i.pageNo;d.moduletype==="add"&&t&&t.totalCount>0&&t.totalCount%10===0&&(s+=1),h({PoliceAddVisible:!1,moduletype:"",moduletitle:""}),o(l=>({...l,pageNo:s})),n(()=>{})};return e.jsxs("div",{className:"page page-scrollfix page-usermanage",children:[e.jsx(y,{children:e.jsxs(y,{className:"page-body",children:[e.jsx(pe,{width:240,children:e.jsxs(Z,{spinning:!1,children:[e.jsx("h3",{className:"page-title",children:"城市"}),e.jsx("div",{className:"treeside",children:e.jsx(ne,{trees:F.list,curDeptCode:i.deptCode,onSelect:H})})]})}),e.jsxs(ue,{children:[e.jsxs("h3",{className:"page-title",children:[U,e.jsxs("span",{className:"error",children:[" ",r.list.totalCount?r.list.totalCount:0]}),"人"]}),e.jsx("div",{className:"page-header",children:e.jsxs(f,{layout:"inline",className:"flexrow",form:C,onFinish:_,children:[e.jsx(ce,{labelCol:{span:6},children:e.jsx(ee,{className:"input-base-width",placeholder:"请输入关键字进行搜索"})}),e.jsx(g,{type:"primary",size:"middle",htmlType:"submit",children:"搜索"})]})}),e.jsx("div",{className:"page-content has-pagination table-flex table-scrollfix",children:e.jsx(oe,{size:"small",style:{maxHeight:800},rowKey:"id",columns:G,currentPage:i.pageNo,pageSize:i.pageSize,dataSource:r.list.list,loading:D,totalCount:r.list.totalCount,onChange:q,onShowSizeChange:J,border:!0})}),e.jsx("div",{className:"page-footer",children:e.jsxs("div",{className:"page-footer-buttons",children:[u.add?e.jsxs(g,{type:"primary",style:{marginRight:"10px"},onClick:Q,children:[" ","新增人员"]}):null,u.add?e.jsxs(g,{type:"primary",loading:V,onClick:W,children:[" ","同步人员"]}):null]})})]})]})}),d.PoliceAddVisible?e.jsx(de,{form:A,visible:d.PoliceAddVisible,type:d.moduletype,title:d.moduletitle,handleOk:X,values:d.moduletype==="add"?"":w.list,deptId:i.deptCode,currPeopleId:N,onCancel:()=>{h({PoliceAddVisible:!1,moduletype:"",moduletitle:""})},roleList:P.list.list||[]}):null,R?e.jsx(re,{visible:R,handleOkRole:()=>{x(!1),n(()=>{})},values:w,currPeopleId:N,select:P.list.list,onCancel:()=>{c.info("取消成功"),x(!1)}}):null]})};export{Ne as default};
