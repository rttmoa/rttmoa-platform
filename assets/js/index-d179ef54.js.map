{"version":3,"file":"index-d179ef54.js","sources":["../../../src/views/module/product/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Button, Card, Popconfirm, Table, TableColumnsType, message, Image } from \"antd\";\nimport { useNavigate } from \"react-router-dom\";\nimport defaultImg from \"@/assets/images/defaultImg.jpg\";\nimport { productList } from \"@/api/modules/module/product\";\n\nexport interface listProps {\n  list?: any;\n  total?: number;\n  page?: number;\n  pageSize?: number;\n}\n\n// coverImg: \"http://localhost:3009/uploads/20230406/1680794476636.jpg\"\nexport const serverUrl = \"http://localhost:3009\";\n\nconst List = () => {\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(false);\n  const [searchName, setsearchName] = useState(\"\");\n  const [searchType, setsearchType] = useState(\"productName\");\n  const [data, setData] = useState<listProps>({ list: [], total: 0, page: 1, pageSize: 5 });\n  const { list, total, page, pageSize } = data;\n\n  // 发送请求 | 通过redux去处理\n  const loadData = async (page: number, pageSize: number) => {\n    setData({ page: page });\n    setLoading(true);\n    let result: any;\n    if (searchName) {\n      result = await productList(page, pageSize, searchName, searchType);\n    } else {\n      result = await productList(page, pageSize);\n    }\n    if (result.code == 200) {\n      setLoading(false);\n      setData(result.data);\n    }\n  };\n\n  useEffect(() => {\n    loadData(page!, pageSize!);\n  }, []);\n\n  const columns: TableColumnsType = [\n    {\n      title: \"序号\",\n      key: \"_id\",\n      width: 80,\n      align: \"center\",\n      render: (text: any, record: any, index: number): any => index + 1\n    },\n    {\n      title: \"商品名称\",\n      dataIndex: \"name\"\n    },\n    {\n      title: \"主图\",\n      dataIndex: \"coverImg\",\n      render: (txt: any, record: any) => (\n        // <Image src={record.coverImg ? serverUrl + record.coverImg : defaultImg} alt={record.name} style={{ width: 60 }} />\n        <Image src={record.coverImg} alt={record.name} style={{ width: 60 }} />\n      )\n    },\n    {\n      title: \"价格\",\n      dataIndex: \"price\",\n      render(price) {\n        return `￥${price}`;\n      }\n    },\n    {\n      title: \"是否在售\",\n      dataIndex: \"onSale\",\n      render: (txt: any, record: any) => (record.onSale ? \"在售\" : \"已下架\")\n    },\n    {\n      title: \"商品描述\",\n      dataIndex: \"desc\"\n    },\n    {\n      title: \"操作\",\n      render: (txt: any, record: any, index: any) => {\n        return (\n          <div>\n            <Button\n              type=\"primary\"\n              size=\"small\"\n              onClick={() => {\n                navigate(`/module/product/detail?id=${record._id}`);\n              }}\n            >\n              修改\n            </Button>\n            <Popconfirm\n              title=\"确定删除此项\"\n              onCancel={() => {\n                console.log(\"用户取消删除\");\n              }}\n              onConfirm={() => {\n                // todo 此处调用api接口进行删除\n                // delOne(record._id).then(res => {\n                //   loadData();\n                // });\n                message.info(`删除： _id=${record._id}`);\n              }}\n            >\n              <Button type=\"dashed\" size=\"small\" style={{ margin: \"0 1rem\" }}>\n                删除\n              </Button>\n            </Popconfirm>\n            <Button\n              size=\"small\"\n              onClick={() => {\n                // modifyOne(record._id, { onSale: !record.onSale }).then(res => {\n                //   重新拿参数去请求：页码，请求参数，信息去请求\n                //   loadData(page!, pageSize!);\n                // });\n                message.info(`修改在售： _id=${record._id}`);\n              }}\n            >\n              {record.onSale ? \"下架\" : \"上架\"}\n            </Button>\n          </div>\n        );\n      }\n    }\n  ];\n\n  return (\n    <div>\n      <Card\n        title=\"商品列表\"\n        extra={\n          <Button\n            type=\"primary\"\n            size=\"small\"\n            onClick={() => {\n              navigate(\"/module/product/detail\");\n            }}\n          >\n            新增\n          </Button>\n        }\n      >\n        <Table\n          bordered\n          rowKey=\"_id\"\n          loading={loading}\n          rowClassName={(record: any) => (record?.onSale ? \"\" : \"bg-red\")}\n          columns={columns}\n          dataSource={list}\n          pagination={{\n            current: page, // 当前页数\n            total, // 数据总数\n            defaultPageSize: pageSize, // 默认的每页条数\n            showSizeChanger: true,\n            pageSizeOptions: [\"3\", \"5\", \"10\", \"15\"],\n            showQuickJumper: true,\n            onChange: loadData, // 页码改变的回调，参数是改变后的页码及每页条数\n            onShowSizeChange: (current, size) => {\n              // console.log('pageSize 变化的回调', current, size);\n              setData({ pageSize: size });\n              loadData(page!, size);\n            }\n          }}\n        />\n      </Card>\n    </div>\n  );\n};\n\nexport default List;\n"],"names":["serverUrl","List","navigate","useNavigate","loading","setLoading","useState","searchName","setsearchName","searchType","setsearchType","data","setData","list","total","page","pageSize","loadData","result","productList","useEffect","columns","text","record","index","txt","jsx","Image","price","Button","Popconfirm","message","Card","Table","current","size"],"mappings":"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"}