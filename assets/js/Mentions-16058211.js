import{r as s,o as h,cf as ot,cg as Ee,ch as lt,_ as Me,n as Pe,a as x,ci as it,t as Te,v as W,ba as st,p as ut,cj as ct,K as y}from"./index-2f82beb8.js";function ft(){var e=s.useState({id:0,callback:null}),t=h(e,2),i=t[0],u=t[1],o=s.useCallback(function(c){u(function(r){var f=r.id;return{id:f+1,callback:c}})},[]);return s.useEffect(function(){var c;(c=i.callback)===null||c===void 0||c.call(i)},[i]),o}var Re=s.createContext(null);function dt(e){var t=s.useContext(Re),i=t.notFoundContent,u=t.activeIndex,o=t.setActiveIndex,c=t.selectOption,r=t.onFocus,f=t.onBlur,m=e.prefixCls,d=e.options,S=d[u]||{};return s.createElement(ot,{prefixCls:"".concat(m,"-menu"),activeKey:S.key,onSelect:function(w){var C=w.key,p=d.find(function(b){var N=b.key;return N===C});c(p)},onFocus:r,onBlur:f},d.map(function(g,w){var C=g.key,p=g.disabled,b=g.className,N=g.style,I=g.label;return s.createElement(Ee,{key:C,disabled:p,className:b,style:N,onMouseEnter:function(){o(w)}},I)}),!d.length&&s.createElement(Ee,{disabled:!0},i))}var vt={bottomRight:{points:["tl","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomLeft:{points:["tr","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topRight:{points:["bl","tr"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["br","tl"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}}},mt=function(t){var i=t.prefixCls,u=t.options,o=t.children,c=t.visible,r=t.transitionName,f=t.getPopupContainer,m=t.dropdownClassName,d=t.direction,S=t.placement,g="".concat(i,"-dropdown"),w=s.createElement(dt,{prefixCls:g,options:u}),C=s.useMemo(function(){var p;return d==="rtl"?p=S==="top"?"topLeft":"bottomLeft":p=S==="top"?"topRight":"bottomRight",p},[d,S]);return s.createElement(lt,{prefixCls:g,popupVisible:c,popup:w,popupPlacement:C,popupTransitionName:r,builtinPlacements:vt,getPopupContainer:f,popupClassName:m},o)},pt=function(){return null};function gt(e){var t=e.selectionStart;return e.value.slice(0,t)}function xt(e,t){return t.reduce(function(i,u){var o=e.lastIndexOf(u);return o>i.location?{location:o,prefix:u}:i},{location:-1,prefix:""})}function Ie(e){return(e||"").toLowerCase()}function Ct(e,t,i){var u=e[0];if(!u||u===i)return e;for(var o=e,c=t.length,r=0;r<c;r+=1)if(Ie(o[r])!==Ie(t[r])){o=o.slice(r);break}else r===c-1&&(o=o.slice(c));return o}function ht(e,t){var i=t.measureLocation,u=t.prefix,o=t.targetText,c=t.selectionStart,r=t.split,f=e.slice(0,i);f[f.length-r.length]===r&&(f=f.slice(0,f.length-r.length)),f&&(f="".concat(f).concat(r));var m=Ct(e.slice(c),o.slice(c-i-u.length),r);m.slice(0,r.length)===r&&(m=m.slice(r.length));var d="".concat(f).concat(u).concat(o).concat(r);return{text:"".concat(d).concat(m),selectionLocation:d.length}}function St(e,t){e.setSelectionRange(t,t),e.blur(),e.focus()}function wt(e,t){return!t||e.indexOf(t)===-1}function yt(e,t){var i=t.value,u=i===void 0?"":i,o=e.toLowerCase();return u.toLowerCase().indexOf(o)!==-1}var bt=["prefixCls","className","style","prefix","split","notFoundContent","value","defaultValue","children","options","open","allowClear","validateSearch","filterOption","onChange","onKeyDown","onKeyUp","onPressEnter","onSearch","onSelect","onFocus","onBlur","transitionName","placement","direction","getPopupContainer","dropdownClassName","rows"],Nt=["suffix","prefixCls","defaultValue","value","allowClear","onChange","classNames","className","disabled"],_t=s.forwardRef(function(e,t){var i=e.prefixCls,u=e.className,o=e.style,c=e.prefix,r=c===void 0?"@":c,f=e.split,m=f===void 0?" ":f,d=e.notFoundContent,S=d===void 0?"Not Found":d,g=e.value,w=e.defaultValue,C=e.children,p=e.options,b=e.open;e.allowClear;var N=e.validateSearch,I=N===void 0?wt:N,k=e.filterOption,F=k===void 0?yt:k,M=e.onChange,X=e.onKeyDown,Y=e.onKeyUp,ne=e.onPressEnter,ae=e.onSearch,z=e.onSelect,re=e.onFocus,H=e.onBlur,Oe=e.transitionName,ke=e.placement,Fe=e.direction,Le=e.getPopupContainer,$e=e.dropdownClassName,oe=e.rows,Ke=oe===void 0?1:oe,Ae=Me(e,bt),A=s.useMemo(function(){return Array.isArray(r)?r:[r]},[r]),L=s.useRef(null),q=s.useRef(null),G=function(){var n;return(n=L.current)===null||n===void 0||(n=n.resizableTextArea)===null||n===void 0?void 0:n.textArea};x.useImperativeHandle(t,function(){var l;return{focus:function(){var a;return(a=L.current)===null||a===void 0?void 0:a.focus()},blur:function(){var a;return(a=L.current)===null||a===void 0?void 0:a.blur()},textarea:(l=L.current)===null||l===void 0||(l=l.resizableTextArea)===null||l===void 0?void 0:l.textArea}});var Be=s.useState(!1),le=h(Be,2),B=le[0],ie=le[1],De=s.useState(""),se=h(De,2),ue=se[0],ce=se[1],Ve=s.useState(""),fe=h(Ve,2),de=fe[0],je=fe[1],Ue=s.useState(0),ve=h(Ue,2),me=ve[0],pe=ve[1],We=s.useState(0),ge=h(We,2),J=ge[0],Q=ge[1],Xe=s.useState(!1),xe=h(Xe,2),Ye=xe[0],Ce=xe[1],ze=Pe("",{defaultValue:w,value:g}),he=h(ze,2),P=he[0],He=he[1];s.useEffect(function(){B&&q.current&&(q.current.scrollTop=G().scrollTop)},[B]);var qe=x.useMemo(function(){if(b)for(var l=0;l<A.length;l+=1){var n=A[l],a=P.lastIndexOf(n);if(a>=0)return[!0,"",n,a]}return[B,ue,de,me]},[b,B,A,P,ue,de,me]),D=h(qe,4),T=D[0],Z=D[1],V=D[2],ee=D[3],te=x.useCallback(function(l){var n;return p&&p.length>0?n=p.map(function(a){var v;return W(W({},a),{},{key:(v=a==null?void 0:a.key)!==null&&v!==void 0?v:a.value})}):n=st(C).map(function(a){var v=a.props,_=a.key;return W(W({},v),{},{label:v.children,key:_||v.value})}),n.filter(function(a){return F===!1?!0:F(l,a)})},[C,p,F]),j=x.useMemo(function(){return te(Z)},[te,Z]),Ge=ft(),Je=function(n,a,v){ie(!0),ce(n),je(a),pe(v),Q(0)},R=function(n){ie(!1),pe(0),ce(""),Ge(n)},Se=function(n){He(n),M==null||M(n)},Qe=function(n){var a=n.target.value;Se(a)},we=function(n){var a,v=n.value,_=v===void 0?"":v,E=ht(P,{measureLocation:ee,targetText:_,prefix:V,selectionStart:(a=G())===null||a===void 0?void 0:a.selectionStart,split:m}),O=E.text,$=E.selectionLocation;Se(O),R(function(){St(G(),$)}),z==null||z(n,V)},Ze=function(n){var a=n.which;if(X==null||X(n),!!T){if(a===y.UP||a===y.DOWN){var v=j.length,_=a===y.UP?-1:1,E=(J+_+v)%v;Q(E),n.preventDefault()}else if(a===y.ESC)R();else if(a===y.ENTER){if(n.preventDefault(),!j.length){R();return}var O=j[J];we(O)}}},et=function(n){var a=n.key,v=n.which,_=n.target,E=gt(_),O=xt(E,A),$=O.location,U=O.prefix;if(Y==null||Y(n),[y.ESC,y.UP,y.DOWN,y.ENTER].indexOf(v)===-1)if($!==-1){var K=E.slice($+U.length),_e=I(K,m),rt=!!te(K).length;_e?(a===U||a==="Shift"||T||K!==Z&&rt)&&Je(K,U,$):T&&R(),ae&&_e&&ae(K,U)}else T&&R()},tt=function(n){!T&&ne&&ne(n)},ye=s.useRef(),be=function(n){window.clearTimeout(ye.current),!Ye&&n&&re&&re(n),Ce(!0)},Ne=function(n){ye.current=window.setTimeout(function(){Ce(!1),R(),H==null||H(n)},0)},nt=function(){be()},at=function(){Ne()};return x.createElement("div",{className:ut(i,u),style:o},x.createElement(ct,Te({ref:L,value:P},Ae,{rows:Ke,onChange:Qe,onKeyDown:Ze,onKeyUp:et,onPressEnter:tt,onFocus:be,onBlur:Ne})),T&&x.createElement("div",{ref:q,className:"".concat(i,"-measure")},P.slice(0,ee),x.createElement(Re.Provider,{value:{notFoundContent:S,activeIndex:J,setActiveIndex:Q,selectOption:we,onFocus:nt,onBlur:at}},x.createElement(mt,{prefixCls:i,transitionName:Oe,placement:ke,direction:Fe,options:j,visible:!0,getPopupContainer:Le,dropdownClassName:$e},x.createElement("span",null,V))),P.slice(ee+V.length)))}),Et=s.forwardRef(function(e,t){var i=e.suffix,u=e.prefixCls,o=u===void 0?"rc-mentions":u,c=e.defaultValue,r=e.value,f=e.allowClear,m=e.onChange,d=e.classNames,S=e.className,g=e.disabled,w=Me(e,Nt),C=Pe("",{defaultValue:c,value:r}),p=h(C,2),b=p[0],N=p[1],I=function(M){N(M),m==null||m(M)},k=function(){I("")};return x.createElement(it,{suffix:i,prefixCls:o,value:b,allowClear:f,handleReset:k,className:S,classNames:d,disabled:g},x.createElement(_t,Te({className:d==null?void 0:d.mentions,prefixCls:o,ref:t,onChange:I},w)))});Et.Option=pt;export{Et as M};
