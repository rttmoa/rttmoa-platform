import{r as t,j as e,ax as U,C as W,ae as se,B as G,aR as oe,R as ne,ak as ae,aa as le,dr as re,m as O,bE as ie,bF as ce}from"./index-113fc74b.js";import{T as de}from"./Table-8c30211f.js";import me from"./UserFormModal-d714a85e.js";import{newFormList as ue}from"./Form_Config-b1dba7b9.js";import{u as fe,w as he}from"./xlsx-964ea548.js";import{columnConfig as pe}from"./Table_Column_Config-93865f87.js";import ge from"./TableHeader-7ca8b6be.js";import{C as xe}from"./index-7df010ed.js";import{D as we}from"./index-9887eeaf.js";import{C as Se}from"./index-0e665a55.js";import{S as be}from"./index-b494d425.js";import{P as je}from"./useMultipleSelect-ebde533a.js";import"./index-9b1d98d0.js";import"./styleChecker-ab7f2164.js";import"./addEventListener-96eadba0.js";import"./List-8daded26.js";import"./Tree-3563fbcf.js";import"./conductUtil-ec1c0eb4.js";import"./index-f62b1770.js";import"./index-c0237b1c.js";import"./useBubbleLock-1d80bc36.js";import"./useShowArrow-13591fe1.js";import"./useIcons-e7e876d7.js";import"./index-e9919bb2.js";import"./iconUtil-1cf5f036.js";import"./index-b96fcc2a.js";import"./useLazyKVMap-e86d9680.js";import"./Select-8f23d9ed.js";import"./SinglePicker-bd710a65.js";import"./index-2995b242.js";import"./Image-4cda65d6.js";import"./index-bda54c8e.js";import"./Pagination-b9ef814f.js";import"./zh_CN-f51ae7db.js";function ye(x){const{id:E,xScroll:I=!1,yScroll:c=!1,scroll:l,dataSource:r,columns:f,pagination:M,selectedRowKeys:h,rowSelection:b,updatePage:m,updateSelectedItem:j}=x,[T,k]=t.useState({});r==null||r.length;const[D,K]=t.useState(l==null?void 0:l.x);t.useEffect(()=>{if(I&&E){const i=document.getElementById(E);if(i){const d=x.columns.filter(p=>p.width).map(p=>Number(p.width)).reduce((p,F)=>p+F,0),S=x.columns.filter(p=>!p.width).map(p=>p.title.toString().length),y=(Math.max(...S)+1)*12+8*2+2,C=S.length*y;K(Math.max(i.getBoundingClientRect().width,d+C))}}},[I,E]);const w=t.useCallback((i,d)=>{if(b==="checkbox")x.selectedRowKeys,x.selectedIds,x.selectedItem;else{let S=[d];const y=x.selectedRowKeys;if(y&&y[0]===d)return;j&&j(S,i||{})}},[]),H=t.useCallback((i,d)=>{let S=b,y=[];S==="checkbox"&&(d.forEach(C=>{y.push(C._id)}),k({selectedRowKeys:i,selectedIds:y,selectedItem:d[0]})),j&&j(i,d[0],y)},[]),v={type:"radio",selectedRowKeys:h,onChange:H,onSelect:(i,d,S)=>{}};let o=b;[!1,null].includes(o)?o=!1:o==="checkbox"?v.type="checkbox":o="radio";let s=l==null?void 0:l.y;return s&&(s=s-38-32),e.jsx(de,{className:"MultiTable",...x,bordered:!0,columns:f,dataSource:r,scroll:{x:D,y:s},rowSelection:o?v:void 0,onRow:(i,d)=>({onClick(){o&&w(i,d)}}),pagination:!1})}const Ce=()=>{const x=(c,l,r)=>{const f=l.map(h=>Object.keys(h).reduce((b,m)=>{const j=c[m]||m;return b[j]=h[m],b},{})),M=fe.json_to_sheet(f);E(I(M,void 0),`${r}.xlsx`)},E=(c,l)=>{typeof c=="object"&&c instanceof Blob&&(c=URL.createObjectURL(c));var r=document.createElement("a");r.href=c,r.download=l||"";var f;window.MouseEvent?f=new MouseEvent("click"):(f=document.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null)),r.dispatchEvent(f)},I=(c,l)=>{l=l||"sheet1";var r={SheetNames:[l],Sheets:{}};r.Sheets[l]=c;var f={bookType:"xlsx",bookSST:!1,type:"binary"},M=he(r,f),h=new Blob([b(M)],{type:"application/octet-stream"});function b(m){for(var j=new ArrayBuffer(m.length),T=new Uint8Array(j),k=0;k!=m.length;++k)T[k]=m.charCodeAt(k)&255;return j}return h};return{handleExportAll:x}};const Ee=x=>{const{formRef:E,name:I="advanced_search",loading:c,FormListConfig:l=[],rowCount:r=3,FormOnFinish:f,SetIsExpand:M}=x,h=l,[b]=U.useForm(),[m,j]=t.useState(!1),[T,k]=t.useState(!0);function D(o){if(!o)return"";const s=new Date(o),i=s.getMonth()<9?`0${s.getMonth()+1}`:s.getMonth()+1,d=s.getDate()<10?`0${s.getDate()}`:s.getDate();return`${s.getFullYear()}-${i}-${d}`}const K=o=>{const s=b.getFieldsValue();s.startTime&&(s.startTime=D(s.startTime)),s.endTime&&(s.endTime=D(s.endTime)),f&&f(s)},w=o=>{},H=()=>{j(!m),M(!m)},v=t.useMemo(()=>{const o=r||3,s=24/o,i=o===1?1:h.length>=o?o-1:h.length,d=m?h:h.slice(0,i),S=d.map((C,p)=>{const{type:F,label:L,field:N,placeholder:z,list:X,component:A}=C;let R=null;if(A)R=A;else switch(F){case"INPUT":R=e.jsx(ae,{placeholder:z});break;case"SELECT":R=e.jsx(be,{placeholder:z});break;case"CHECKBOX":R=e.jsx(Se,{children:L});break;case"TIME_START":case"TIME_END":R=e.jsx(we,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:z});break;default:return null}return e.jsx(W,{span:s,children:e.jsx(U.Item,{name:N,label:L,children:R})},p)});let y=[];if(T){const C=d.length%o,p=C===0?o-1:o-C-1,F=Array.from({length:p},(N,z)=>e.jsx(W,{span:s},`blank-${z}`)),L=e.jsx(W,{span:s,style:{textAlign:"right"},children:e.jsx(U.Item,{children:e.jsxs(se,{size:"small",children:[e.jsx(G,{type:"primary",htmlType:"submit",children:"查询"}),e.jsx(G,{onClick:()=>b.resetFields(),children:"重置"}),h.length<o?null:e.jsxs(G,{type:"link",className:"text-[12px]",onClick:H,children:[m?"关闭":"展开"," ",e.jsx(oe,{})]})]})})},"actions");y=[...F,L]}return[...S,...y]},[m,h,r,T]);return e.jsx(xe,{id:"AdvancedSearchForm",size:"small",hoverable:!0,ref:E,children:e.jsx(U,{size:"middle",layout:"horizontal",disabled:c,name:I,form:b,variant:"outlined",onFinish:K,onFinishFailed:w,children:e.jsx(ne,{gutter:24,children:v})})})},lt=()=>{var J,Q;const{handleExportAll:x}=Ce(),[E]=U.useForm();U.useForm();const I=t.useRef(null),c=t.useRef(null),l=t.useRef(null),r=t.useRef(null),[f,M]=t.useState({}),[h,b]=t.useState([]),[m,j]=t.useState({});t.useState({state:"1",type:["1","3"]});const[T,k]=t.useState(!1),[D,K]=t.useState([]),[w,H]=t.useState({page:1,pageSize:10,totalCount:0}),[v,o]=t.useState({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),[s,i]=t.useState(!1),[d,S]=t.useState(""),[y,C]=t.useState(""),[p,F]=t.useState({}),[L,N]=t.useState(0),[z,X]=t.useState(!1);t.useEffect(()=>{const n=()=>{var B,_,Y,q;const g=((B=c.current)==null?void 0:B.clientHeight)||0,u=((_=I.current)==null?void 0:_.clientHeight)||0,a=((Y=r.current)==null?void 0:Y.clientHeight)||0,V=((q=l.current)==null?void 0:q.clientHeight)||0,$=g-u-a-V;let P=$>200?$:200;N(P)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[z]);async function A(){var $,P,B;k(!0);let{page:n,pageSize:g}=w,u={page:n,pageSize:g,...m};const a=await re(u),V=(P=($=a==null?void 0:a.data)==null?void 0:$.list)==null?void 0:P.map((_,Y)=>({..._,key:Y+1}));K(V||[]),H({page:n||1,pageSize:g||10,totalCount:((B=a==null?void 0:a.data)==null?void 0:B.total)||0}),k(!1)}t.useEffect(()=>{A()},[w.page,w.pageSize,m]);const R=async(n,g)=>{if(n==="create")i(!0),S("新建用户"),C(n),F({});else if(["edit","detail"].includes(n))i(!0),S(n==="edit"?"编辑用户":"查看详情"),C(n),F(g);else if(n==="delete"){const u=O.loading("正在删除");try{const a=await ie(g._id);a&&(u(),A(),O.success(a.data.message))}catch{u(),O.error("删除失败、请再试一次！")}}else if(n==="moreDelete"){const u=O.loading("正在删除");try{const a=await ce(v.selectedIds||[]);a&&(u(),o({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),A(),O.success(a.data.message))}catch{u(),O.error("删除失败、请再试一次！")}}},Z=()=>{E.getFieldsValue(),S(""),C(""),i(!1),F({}),O.info("待实现")};let ee={selectRowItem:v,header:{address:"地址",birthday:"生日",email:"邮箱",id:"id",interest:"爱好",isMarried:"婚姻状态"},userList:D,handleOperator:R,handleExportAll:x};const te=!0;return(J=c==null?void 0:c.current)==null||J.clientHeight,(Q=I.current)==null||Q.clientHeight,e.jsxs("div",{className:"h-full flex flex-col overflow-hidden",ref:c,children:[e.jsx(Ee,{formRef:I,loading:T,rowCount:3,FormListConfig:ue,FormOnFinish:(n={})=>{const g=Object.fromEntries(Object.entries(n).filter(([u,a])=>a!=null&&!(typeof a=="string"&&a.trim()==="")));j(g||{})},SetIsExpand:X}),e.jsxs("div",{className:"h-full flex-1  mt-[12px] rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between px-[18px] py-[10px]",ref:r,children:[e.jsx("span",{className:"text-[14px] font-mono",children:e.jsx("b",{children:"用户列表"})}),e.jsx(ge,{...ee})]}),e.jsx(ye,{id:"cart-scrollTable",size:"small",loading:T,xScroll:!0,scroll:{x:"max-content",y:L},sticky:{offsetHeader:0},rowSelection:"checkbox",columns:pe(te,f,R),updateSelectedItem:(n,g,u)=>{o({selectedRowKeys:n,selectedIds:u&&u.length>0?u:[],selectedRows:g})},updatePage:(n,g)=>{H(u=>({...u,page:n,pageSize:g}))},dataSource:D,pagination:w,selectedRowKeys:v.selectedRowKeys,selectedIds:v.selectedIds,selectedItem:v.selectedItem})]}),e.jsx("div",{className:"flex justify-end rounded-lg px-[20px] pb-[12px] bg-white",ref:l,children:e.jsx(je,{size:"default",showQuickJumper:!0,showSizeChanger:!0,onChange:(n,g)=>{H({...w,page:n,pageSize:g})},current:w.page,pageSize:w.pageSize,pageSizeOptions:[5,10,15,20,50,100,500,1e3],total:w.totalCount,showTotal:()=>`第${w.page}页， 共 ${w.totalCount} 条`})}),e.jsx(le,{width:800,height:800,title:d,open:s,onOk:Z,onCancel:()=>{S(""),C(""),i(!1),F({})},children:e.jsx(me,{form:E,roles:h,userInfo:p,type:y})})]})};export{lt as default};
//# sourceMappingURL=index-f7dbea9e.js.map
