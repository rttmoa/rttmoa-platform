import{av as L,aw as F,r as c,j as e,a9 as j,R as te,B as g,C as T,X as se,ak as le,N as R,aq as ie,F as re,ax as M,M as ae,z as $,ah as E}from"./index-952d55a3.js";import{C as ne}from"./index-7b228e55.js";import{S as A}from"./index-9fce96e5.js";import{D as O}from"./index-9d53bf38.js";import{T as oe}from"./index-86bc5d34.js";import{r as de}from"./roleManage-59d3a2a5.js";import ce from"./UserFormModal-b1bbb0ca.js";import{u as me,w as ue}from"./xlsx-964ea548.js";import{C as P}from"./index-1422a09e.js";import{P as xe}from"./index-7854931c.js";import"./index-655f6623.js";import"./index-a9a7f31b.js";import"./Select-302db8a7.js";import"./List-9b24b629.js";import"./useIcons-076ca0e8.js";import"./SinglePicker-518dc5df.js";import"./customParseFormat-4c3853a8.js";import"./___vite-browser-external_commonjs-proxy-bc08cf7c.js";import"./Table-c877057a.js";import"./index-d7191096.js";import"./zh_CN-cd44445e.js";import"./styleChecker-63cb9fb9.js";import"./Tree-104571c4.js";import"./conductUtil-72ff0482.js";import"./index-d3c069a8.js";import"./index-3164f2a2.js";import"./iconUtil-e541c585.js";import"./Skeleton-85ae58c1.js";const he=r=>L.get(F+"/user/manage/list",r),pe=r=>L.post(F+"/user/manage/create",r),fe=r=>L.post(F+"/user/manage/edit",r);function ge(r=[]){if(!r)return[];let l=[];return r.forEach(i=>{l.push(e.jsx(A.Option,{value:i.id,children:i.name},i.id))}),l}function V(r){if(!r)return"";const l=new Date(r),i=l.getMonth()<9?`0${l.getMonth()+1}`:l.getMonth()+1,n=l.getDate()<10?`0${l.getDate()}`:l.getDate();return`${l.getFullYear()}-${i}-${n}`}function Y(r){const{label:l,field:i,type:n,placeholder:o,width:d,list:m,style:h}=r;switch(n){case"TIME":return[e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:"startTime",label:"开始时间",children:e.jsx(O,{style:d,showTime:!0,placeholder:o,format:"YYYY-MM-DD hh:mm:ss"})},"startTime")}),e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:"endTime",label:"结束时间",children:e.jsx(O,{style:d,showTime:!0,placeholder:o,format:"YYYY-MM-DD hh:mm:ss"})},"endTime")})];case"INPUT":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:i,label:l,style:h,children:e.jsx(se,{type:"text",placeholder:o,style:{width:d}})},i)});case"SELECT":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:i,label:l,style:h,children:e.jsx(A,{style:{width:d},placeholder:o,children:ge(m)})},i)});case"CHECKBOX":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:i,label:l,children:e.jsx(ne,{children:l})},i)});default:return null}}function je(r){var u;const{filterSubmit:l,multiForm:i}=r,[n,o]=c.useState(!1),d=c.useCallback(()=>{let s=i.getFieldsValue();s.startTime&&(s.startTime=V(s.startTime)),s.endTime&&(s.endTime=V(s.endTime)),l&&l(s)},[l,i]),m=c.useCallback(()=>{i.resetFields()},[i]),h=()=>{const{formList:s,extendFormList:y}=r;let f=[];if(s&&s.length>0&&(f=s.map(Y)),y&&y.length>0){const I=n?y.map(Y):[];f=[...f,...I]}return f},b=c.useCallback(()=>{o(s=>!s)},[]),p=h();return e.jsx("div",{children:e.jsx(j,{layout:"horizontal",form:i,children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx(te,{style:{width:"calc(100% - 250px)"},children:p.map((s,y)=>s)}),e.jsx("div",{style:{width:200},children:e.jsxs(j.Item,{children:[e.jsx(g,{type:"primary",onClick:d,children:"查询"}),e.jsx(g,{className:"mx-3",onClick:m,children:"重置"}),((u=r.extendFormList)==null?void 0:u.length)>0&&e.jsx("button",{type:"button",onClick:b,children:n?"收起":"展开"})]})})]})})})}const be=[{type:"INPUT",label:"用户名",field:"user_name",placeholder:"请输入用户名",initialValue:"",width:200},{type:"INPUT",label:"联系地址",field:"address",placeholder:"请输入联系地址",initialValue:"",width:200},{type:"SELECT",label:"婚姻状态",field:"isMarried",placeholder:"全部",initialValue:"0",width:200,list:[{id:"0",name:"全部"},{id:"1",name:"未婚"},{id:"2",name:"已婚"}]},{type:"SELECT",label:"性别",field:"sex",placeholder:"全部",initialValue:3,width:200,list:[{id:3,name:"全部"},{id:0,name:"女"},{id:1,name:"男"}]}],ye=[{type:"TIME",width:200},{type:"INPUT",placeholder:"请输入电影名",width:200,label:"电影",field:"movies"},{type:"SELECT",placeholder:"请选择电影",width:200,label:"选择种类",field:"kinds1",name:"key",list:[{id:1,key:"泰坦尼克号"},{id:2,key:"阿凡达"},{id:3,key:"蜘蛛侠"}]}],we=()=>{const r=(n,o,d)=>{const m=o.map(b=>Object.keys(b).reduce((p,u)=>{const s=n[u]||u;return p[s]=b[u],p},{})),h=me.json_to_sheet(m);l(i(h,void 0),`${d}.xlsx`)},l=(n,o)=>{typeof n=="object"&&n instanceof Blob&&(n=URL.createObjectURL(n));var d=document.createElement("a");d.href=n,d.download=o||"";var m;window.MouseEvent?m=new MouseEvent("click"):(m=document.createEvent("MouseEvents"),m.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null)),d.dispatchEvent(m)},i=(n,o)=>{o=o||"sheet1";var d={SheetNames:[o],Sheets:{}};d.Sheets[o]=n;var m={bookType:"xlsx",bookSST:!1,type:"binary"},h=ue(d,m),b=new Blob([p(h)],{type:"application/octet-stream"});function p(u){for(var s=new ArrayBuffer(u.length),y=new Uint8Array(s),f=0;f!=u.length;++f)y[f]=u.charCodeAt(f)&255;return s}return b};return{handleExportAll:r}},Ge=()=>{const{handleExportAll:r}=we(),[l,i]=c.useState({}),[n,o]=c.useState([]),[d,m]=c.useState(!1),[h,b]=c.useState([]),[p,u]=c.useState({page:1,pageSize:10,totalCount:0}),[s,y]=c.useState({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),[f,I]=c.useState(!1),[N,C]=c.useState(""),[D,v]=c.useState(""),[B,U]=c.useState({}),[K,_]=c.useState({});c.useState({state:"1",type:["1","3"]});const[z]=j.useForm(),[X]=j.useForm(),q=()=>{m(!0),setTimeout(()=>{const{page:t,pageSize:a}=p;let x={page:t,pageSize:a,...K};he(x).then(w=>{m(!1);const k=w.data.list.map((Z,ee)=>({...Z,key:ee}));b(k.splice(0,a)),u({page:w.data.page,pageSize:w.data.page_size,totalCount:w.data.total_count})})},500)},H=()=>{de().then(t=>{let a=t.data.list;const x=a.reduce((w,k)=>(w[k.id]=k.role_name,w),{});i(x||[]),o(a)})};c.useEffect(()=>{q(),H()},[p.page,p.pageSize]);const J=[{title:"id",dataIndex:"id",width:80,fixed:"left"},{title:"用户名",dataIndex:"username",width:80,fixed:"left"},{title:"性别",dataIndex:"sex",render:t=>t===1?"男":"女"},{title:"状态",dataIndex:"state",render:t=>({1:e.jsx(E,{color:"green",children:"痛苦"}),2:e.jsx(E,{color:"blue",children:"委屈"}),3:e.jsx(E,{color:"orange",children:"迷茫"}),4:e.jsx(E,{color:"red",children:"平淡"}),5:e.jsx(E,{color:"purple",children:"开心"})})[t]},{title:"爱好",dataIndex:"interest",render:t=>({1:"游泳",2:"打篮球",3:"踢足球",4:"跑步",5:"爬山",6:"骑行",7:"桌球",8:"麦霸"})[t]},{title:"婚姻状态",dataIndex:"isMarried",render(t){return t?e.jsx($,{status:"success",text:"已婚"}):e.jsx($,{status:"error",text:"未婚"})}},{title:"所属角色",dataIndex:"role_id",render:t=>l[t]},{title:"手机号",render(){let x=(15303663375+"").replace(/(\d{3})\d*(\d{4})/g,"$1***$2");return e.jsx("span",{children:x})}},{title:"身份证号",render(){let x=(231085199811011415n+"").replace(/(\d{3})\d*(\d{4})/g,"$1***********$2");return e.jsx("span",{children:x})}},{title:"联系地址",dataIndex:"address"},{title:"邮箱",dataIndex:"email"},{title:"生日",dataIndex:"birthday"},{title:"早起时间",dataIndex:"time"},{title:"操作",fixed:"right",width:200,render(t){return e.jsxs(R,{children:[e.jsx(g,{size:"small",onClick:()=>{S("detail",t)},children:"详情"}),e.jsx(g,{size:"small",onClick:()=>{S("edit",t)},children:"编辑"}),e.jsx(g,{size:"small",onClick:()=>{S("delete",t)},children:"删除"})]})}}],S=(t,a)=>{t==="create"?(I(!0),C("新建用户"),v(t)):["edit","detail"].includes(t)?(C(t==="edit"?"编辑用户":"查看详情"),v(t),U(a),I(!0)):t==="delete"?M.success(`删除用户成功！ id：${a.id}`):t==="moreDelete"&&M.success(`删除更多用户成功！ id：${JSON.stringify(s.selectedIds)}`)},G=()=>{let t=D,a=z.getFieldsValue();t==="create"?pe(a):fe(a)},Q={address:"地址",birthday:"生日",email:"邮箱",id:"id",interest:"爱好",isMarried:"婚姻状态"},W=e.jsxs("div",{children:[e.jsx(P,{className:"mb20",style:{},children:e.jsx(le,{defaultActiveKey:"1",items:[{label:"输入框查询",key:"1",children:e.jsx(je,{multiForm:X,formList:be,extendFormList:ye,filterSubmit:(t={})=>{_(t)}})}]})}),e.jsx(P,{className:"mb30",title:"用户列表",extra:e.jsxs(R,{size:"large",children:[e.jsx(g,{size:"middle",onClick:()=>{S("create",null)},children:"新建"}),e.jsx(xe,{title:"批量删除",description:"你确定要删除吗？",okText:"确定",cancelText:"取消",onConfirm:()=>{S("moreDelete",null)},children:e.jsx(g,{size:"middle",disabled:s.selectedRowKeys.length<=1,icon:e.jsx(ie,{}),children:"批量删除"})}),e.jsx(g,{size:"middle",onClick:()=>{r(Q,h,"用户列表")},children:"导出Excel"}),e.jsx(re,{beforeUpload:t=>(/\.(xlsx|xls)$/.test(t.name.toLowerCase())||M.error("请上传Excel文件（.xlsx 或 .xls）"),!1),children:e.jsx(g,{children:"上传Excel"})})]}),style:{width:"100%"},children:e.jsx(oe,{rowSelection:"checkbox",columns:J,dataSource:h,pagination:p,selectedRowKeys:s.selectedRowKeys,selectedIds:s.selectedIds,selectedItem:s.selectedItem,updateSelectedItem:(t,a,x)=>{y({selectedRowKeys:t,selectedIds:x&&x.length>0?x:[],selectedRows:a})},updatePage:(t,a)=>{u(x=>({...x,page:t,pageSize:a}))},loading:d,id:"cart-scrollTable",xScroll:!0})}),e.jsx(ae,{width:800,title:N,open:f,onOk:G,onCancel:()=>{C(""),I(!1),v(""),U({})},children:e.jsx(ce,{roles:n,userInfo:B,type:D,form:z})})]});return e.jsx(e.Fragment,{children:W})};export{Ge as default};
