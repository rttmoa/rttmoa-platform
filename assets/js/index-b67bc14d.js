import{r as i,j as t}from"./react-12b51ca5.js";import{T as rt}from"./index-4f14ea2b.js";import{r as ot,a as it}from"./roleManage-9a162c5b.js";import{u as st}from"./react-redux-814b67d1.js";import{F as a,Y as O,S as nt,B as w,H as g,I as R,g as j,N as x,a3 as at}from"./antd-e2492052.js";import"./@ant-design-63539318.js";import"./rc-util-8976b5fa.js";import"./react-dom-e71a48dd.js";import"./@babel-c46ce09a.js";import"./classnames-3ded05b8.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-5c9960e4.js";import"./@umijs-02c6bdf5.js";import"./swr-1237c4b3.js";import"./use-sync-external-store-ad55a9d4.js";import"./@dnd-kit-908a095e.js";import"./dayjs-6d610299.js";import"./@ctrl-bad846bd.js";import"./omit.js-929edb61.js";import"./lodash.merge-9922d51b.js";import"./safe-stable-stringify-023075f7.js";import"./@chenshuai2144-5a33ccd2.js";import"./reactcss-f166c0a9.js";import"./lodash-40f09dbd.js";import"./tinycolor2-ea5bcbb6.js";import"./lodash.tonumber-b59040d8.js";import"./rc-field-form-e46b50c8.js";import"./async-validator-dee29e8b.js";import"./@emotion-70f0a3ab.js";import"./stylis-d04dd720.js";import"./mathjs-5ee3c32f.js";import"./typed-function-de33f2d8.js";import"./tiny-emitter-8a086d5b.js";import"./decimal.js-d133ee8e.js";import"./complex.js-357570ec.js";import"./fraction.js-56a7d603.js";import"./seedrandom-8945c5a8.js";import"./crypto-js-31e0a020.js";import"./javascript-natural-sort-a3c448fd.js";import"./escape-latex-29d85c0d.js";import"./index-5960db8a.js";import"./@reduxjs-1e85e38e.js";import"./immer-41fd5235.js";import"./redux-9b50431e.js";import"./redux-thunk-5e43a849.js";import"./redux-persist-0e7c8dbe.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./react-router-dom-6ebba419.js";import"./react-router-0b469a74.js";import"./@remix-run-26f48157.js";import"./@react-three-892cc760.js";import"./three-61b4c2af.js";import"./react-use-measure-3cc199c6.js";import"./debounce-3dd95b19.js";import"./its-fine-c588097f.js";import"./react-reconciler-70247064.js";import"./scheduler-765c72db.js";import"./react-merge-refs-239dbb3c.js";import"./zustand-942b6941.js";import"./react-i18next-172d1bb0.js";import"./axios-a342f982.js";import"./nprogress-ac7b4ba8.js";import"./antd-img-crop-c6426bab.js";import"./tslib-9305e412.js";import"./react-easy-crop-57e783c5.js";import"./normalize-wheel-e63deb77.js";import"./compare-versions-d85a82c7.js";import"./ahooks-2e5c1fd5.js";import"./screenfull-d32598f8.js";import"./react-transition-group-7a2d7ec0.js";import"./dom-helpers-9a525042.js";import"./react-colorful-c5c19197.js";import"./qs-7f9cc4dd.js";import"./side-channel-fd57f060.js";import"./get-intrinsic-369a924f.js";import"./es-errors-82fd953f.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-f7d0b240.js";import"./function-bind-61637ca6.js";import"./hasown-bc561cf0.js";import"./call-bind-ebb1c907.js";import"./set-function-length-e011fe34.js";import"./define-data-property-10275fa5.js";import"./es-define-property-d670c2ca.js";import"./gopd-7cdb7e9d.js";import"./has-property-descriptors-3e3c0959.js";import"./object-inspect-17338ea2.js";import"./md5-1d85d820.js";import"./crypt-5ea4a8e1.js";import"./charenc-bfd911d6.js";import"./is-buffer-793dba8c.js";import"./i18next-5484cd5c.js";import"./rc-motion-25d44171.js";import"./rc-notification-3ca02e51.js";import"./rc-overflow-7fc9dc70.js";import"./rc-picker-d202c760.js";import"./@rc-component-60bdd203.js";import"./rc-tabs-f080ce12.js";import"./rc-dropdown-1fd4539e.js";import"./rc-menu-c99c3faa.js";import"./rc-cascader-238c5b8d.js";import"./rc-select-8e380119.js";import"./rc-virtual-list-5b0902fa.js";import"./rc-tree-898f7873.js";import"./rc-input-number-f64f90f1.js";import"./rc-input-3682369a.js";import"./rc-collapse-3e02f0e2.js";import"./rc-drawer-9ef263c4.js";import"./scroll-into-view-if-needed-582d6ca4.js";import"./compute-scroll-into-view-e3f0ecc2.js";import"./rc-image-3cfe7923.js";import"./rc-dialog-8eb1683d.js";import"./rc-mentions-9823f19c.js";import"./rc-textarea-b098f88a.js";import"./rc-tooltip-01b6b839.js";import"./qrcode.react-e22f0a27.js";import"./rc-rate-2d3465a8.js";import"./rc-segmented-6536d122.js";import"./rc-slider-e91f05e6.js";import"./rc-steps-f39c48c2.js";import"./rc-switch-8d316ace.js";import"./rc-table-a211065a.js";import"./rc-checkbox-ae7b2d99.js";import"./throttle-debounce-87e7e444.js";import"./rc-pagination-334fefa5.js";import"./rc-tree-select-5a273e06.js";import"./copy-to-clipboard-47a2b094.js";import"./toggle-selection-93f4ad84.js";import"./rc-upload-71d17dfe.js";import"./rc-progress-a416f280.js";function z(m){if(!m)return"";let s=new Date(Number(m));return s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds()}const Dr=()=>{const[m,s]=i.useState([]),[I,u]=i.useState([]),[S,b]=i.useState([]),[r,c]=i.useState({}),l=st(e=>e.auth.authMenuList),[p]=a.useForm(),[o]=a.useForm(),[n]=a.useForm(),[C,d]=i.useState(!1),[F,_]=i.useState(!1),[B,E]=i.useState({}),[L,D]=i.useState([]),[M,N]=i.useState(!1),[U,v]=i.useState([]),[K,P]=i.useState([]),[A,H]=i.useState(null),[J,Y]=i.useState({}),q=i.useRef();i.useEffect(()=>{(async function(){ot().then(e=>{const h=e.data.list.map((f,y)=>({...f,key:y}));s(h)})})()},[]);const G=[{title:"角色名称",dataIndex:"role_name"},{title:"使用状态",dataIndex:"status",render:e=>e===1?"启用":"停用"},{title:"授权人",dataIndex:"authorize_user_name"},{title:"创建时间",dataIndex:"create_time",render:z,width:150},{title:"授权时间",dataIndex:"authorize_time",render:z,width:150}],Q=(e,h,f)=>{f?(u(e),b(f),c(h)):(u(e),c(h))},W=()=>{d(!0)},X=()=>{p.getFieldsValue(),p.resetFields(),d(!1)},Z=()=>{if(JSON.stringify(r)=="{}"){g.info({title:"信息",content:"请选择一个角色"});return}_(!0),E(r),D(r.menus)},$=()=>{let e=o.getFieldsValue();e.role_id=r.id,e.menus=L,e.authorize_time=Date.now(),o.resetFields(),_(!1)},tt=async()=>{if(JSON.stringify(r)=="{}"){g.info({title:"信息",content:"未选中任何项目"});return}const e=await it(r.id),h=[],f=[];if(e.data.length>0){const y=e.data;for(let k=0;k<y.length;k++){const T=y[k],V={key:T.user_id,title:T.user_name,status:T.status};V.status===1&&f.push(V.key),h.push(V)}}v(h),P(f),Y(r),H(!1),N(!0)},et=()=>{r.id,n.resetFields(),N(!1)};return t.jsxs(t.Fragment,{children:[t.jsx(O,{extra:t.jsxs(nt,{size:"middle",children:[t.jsx(w,{type:"primary",onClick:W,children:"创建角色"}),t.jsx(w,{type:r.id?"primary":"default",onClick:Z,disabled:!r.id,children:"设置权限"}),t.jsx(w,{type:r.id?"primary":"default",onClick:tt,disabled:!r.id,children:"用户授权"})]}),children:t.jsx(rt,{columns:G,dataSource:m,selectedRowKeys:I,selectedIds:S,selectedItem:r,pagination:{},updateSelectedItem:Q})}),t.jsx(g,{title:"创建角色",open:C,onOk:X,onCancel:()=>{p.resetFields(),d(!1)},children:t.jsx(mt,{form:p})}),t.jsx(g,{width:600,title:"权限设置",open:F,onOk:$,onCancel:()=>{o.resetFields(),_(!1)},children:t.jsx(lt,{form:o,detailInfo:B,menuInfo:L||[],patchMenuInfo:e=>{D(e)},menuConfig:l})}),t.jsx(g,{title:"用户授权",width:800,open:M,onOk:et,onCancel:()=>{n.resetFields(),N(!1)},children:t.jsx(pt,{form:n,isClose:A,detailUserInfo:J,targetKeys:K,transferData:U,patchUserInfo:e=>{P(e)},ref:q})})]})};function mt({form:m}){const s={labelCol:{span:5},wrapperCol:{span:16}};return t.jsx(t.Fragment,{children:t.jsx(O,{children:t.jsxs(a,{form:m,...s,initialValues:{status:1},children:[t.jsx(a.Item,{label:"角色名称",name:"role_name",children:t.jsx(R,{type:"text",placeholder:"请输入角色名称"})}),t.jsx(a.Item,{label:"状态",name:"status",children:t.jsxs(j,{children:[t.jsx(j.Option,{value:1,children:"开启"}),t.jsx(j.Option,{value:0,children:"关闭"})]})})]})})})}function lt({form:m,detailInfo:s,menuInfo:I,patchMenuInfo:u,menuConfig:S}){const b=(l,p="")=>{const o=[];return l.btnList.forEach(n=>{o.push(t.jsx(x.TreeNode,{title:n.meta.title,className:"op-role-tree"},p+"-btn-"+n.path))}),o},r=(l,p)=>l.map(o=>{let n=o.path;return o.children?t.jsx(x.TreeNode,{title:o.meta.title,className:"op-role-tree",children:r(o.children)},n):o.btnList?t.jsx(x.TreeNode,{title:o.meta.title,className:"op-role-tree",children:b(o,n)},n):t.jsx(x.TreeNode,{title:o.meta.title},n)}),c={labelCol:{span:4},wrapperCol:{span:16}};return t.jsx(a,{form:m,layout:"horizontal",...c,initialValues:{status2:1,role_name2:s.role_name},children:t.jsxs(O,{children:[t.jsx(a.Item,{label:"角色名称",name:"role_name2",children:t.jsx(R,{disabled:!0,maxLength:8,placeholder:s.role_name})}),t.jsx(a.Item,{label:"状态",name:"status2",children:t.jsxs(j,{children:[t.jsx(j.Option,{value:1,children:"启用"}),t.jsx(j.Option,{value:0,children:"停用"})]})}),t.jsx(a.Item,{label:"菜单",name:"menu",children:t.jsx(x,{checkable:!0,defaultExpandAll:!0,onCheck:l=>{u(l)},checkedKeys:I||[],children:t.jsx(x.TreeNode,{title:"平台权限",children:r(S)},"platform_all")})})]})})}function pt({form:m,isClose:s,detailUserInfo:I,targetKeys:u,transferData:S,patchUserInfo:b,ref:r}){const[c,l]=i.useState(11),p=()=>(l(c+1),c);i.useImperativeHandle(r,()=>({status:c,statusValue:p}));const o=(d,F)=>F.title.indexOf(d)>-1,n=d=>{b(d)},C={labelCol:{span:5},wrapperCol:{span:18}};return t.jsxs(a,{form:m,layout:"horizontal",...C,initialValues:{transfer:u},children:[t.jsx(a.Item,{name:"role_name3",label:"角色名称",children:t.jsx(R,{disabled:!0,maxLength:8,placeholder:I.role_name})}),t.jsx(a.Item,{name:"transfer",label:"选择用户：",children:t.jsx(at,{listStyle:{width:200,height:400},dataSource:S,showSearch:!0,titles:["待选用户","已选用户"],filterOption:o,targetKeys:u,onChange:n,render:d=>d.title})})]})}export{Dr as default};
