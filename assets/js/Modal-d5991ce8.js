import{r as b,b6 as O,j as e,aa as P,B as F,ax as o,R as z,C as c,ak as K,ay as E,aA as D,b4 as U}from"./index-3957a516.js";import{C as g}from"./index-8679876f.js";import{T as G}from"./index-ae7ffe7f.js";import"./index-a77b8328.js";import"./index-a50f25cb.js";import"./useBubbleLock-e13a7356.js";import"./Tree-db5072ad.js";import"./List-0e1ae3e6.js";import"./conductUtil-f43807c6.js";import"./iconUtil-68c18442.js";const re=S=>{const{form:p,modalIsVisible:T,setModalIsVisible:A,modalTitle:q,modalType:a,modalUserInfo:l,handleModalSubmit:C}=S,[x,L]=b.useState([]),[M,u]=b.useState([]),[k,m]=b.useState([]);function w(s){return s.map(r=>{var i,t;const n={title:((i=r.meta)==null?void 0:i.title)||"",key:((t=r.meta)==null?void 0:t.key)||""};return Array.isArray(r.children)&&r.children.length>0&&(n.children=w(r.children)),n})}b.useEffect(()=>{O({}).then(s=>{L(w(s.data||[])),u([]),m(a=="create"?"":l.permission_menu),p.setFieldsValue({role_name:a=="create"?"":l.role_name,permission_str:a=="create"?"":l.permission_str,level:a=="create"?1:l.level,sort:a=="create"?1:l.sort,status:a=="create"?!1:l.status,desc:a=="create"?"":l.desc})})},[a,l]);const I=()=>{u([]),m([]),A(!1)},N=()=>{function s(t,f,j=[]){for(const d of t){const h=d.key,y=[...j,h];if(h===f)return y;if(d.children&&d.children.length>0){const v=s(d.children,f,y);if(v)return v}}return null}function r(t,f){const j=new Set;return f.forEach(d=>{const h=s(t,d);h&&h.forEach(y=>j.add(y))}),Array.from(j)}const n=r(x,k),i=p.getFieldsValue();a=="edit"&&(i._id=l._id),i.permission_menu=k,i.menuList=n,C&&C(a,i)},_=s=>{const r=[],n=i=>{i.forEach(t=>{r.push(t.key),t.children&&n(t.children)})};return n(s),r},V=s=>{if(s.target.checked){const n=_(x);u(n)}else u([])},R=s=>{if(s.target.checked){const n=_(x);m(n)}else m([])},B=()=>{p.submit()};return e.jsx(P,{title:q,width:600,open:T,onCancel:I,footer:[e.jsx(F,{danger:!0,loading:!1,onClick:I,children:"取消"}),e.jsx(F,{type:"primary",loading:!1,onClick:B,children:"提交"},"link")],children:e.jsx(o,{className:"mt-[40px] mb-[100px] px-[20px] max-h-[500px] overflow-auto",layout:"horizontal",form:p,labelCol:{span:4},wrapperCol:{span:18},onFinish:N,children:e.jsxs(z,{gutter:16,children:[e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色名称",name:"role_name",rules:[{required:!0,message:"必填：角色名称"}],children:e.jsx(K,{placeholder:"请输入角色名称"})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"权限字符",name:"permission_str",rules:[{required:!0,message:"必填：权限字符"}],children:e.jsx(K,{placeholder:"请输入权限字符"})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色级别",name:"level",rules:[{required:!0,message:"必填：角色级别"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色顺序",name:"sort",rules:[{required:!0,message:"必填：角色顺序"}],children:e.jsx(E,{defaultValue:1,className:"always-show-handler",keyboard:!1})})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"状态",name:"status",rules:[{required:!1}],children:e.jsx(D,{})})}),e.jsx(c,{span:24,children:e.jsxs(o.Item,{label:"菜单分配",name:"permission_menu",rules:[{required:!1,message:"必填：菜单权限"}],children:[e.jsxs("div",{className:"mt-[6px] px-3 w-full flex justify-between",children:[e.jsx("div",{children:e.jsx(g,{onChange:V,children:"展开/折叠"})}),e.jsx("div",{children:e.jsx(g,{onChange:R,children:"全选/全不选"})}),e.jsx("div",{children:e.jsx(g,{defaultChecked:!0,onChange:()=>{},children:"父子联动"})})]}),e.jsx("div",{className:"mt-3 w-full p-3  border-[1px] rounded-lg",children:e.jsx(G,{checkStrictly:!1,showLine:!0,checkable:!0,treeData:x,checkedKeys:k,expandedKeys:M,onExpand:s=>{u(s)},onCheck:s=>{m(s)}})})]})}),e.jsx(c,{span:24,children:e.jsx(o.Item,{label:"角色描述",name:"desc",rules:[{required:!1}],children:e.jsx(U,{rows:3,placeholder:"请输入内容",maxLength:60})})})]})})})};export{re as default};
//# sourceMappingURL=Modal-d5991ce8.js.map
