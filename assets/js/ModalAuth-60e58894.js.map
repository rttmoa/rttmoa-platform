{"version":3,"file":"ModalAuth-60e58894.js","sources":["../../../src/views/system/role/component/ModalAuth.tsx"],"sourcesContent":["import { roleTransferList } from '@/api/modules/system/roleManage';\r\nimport { Form, Input, Modal, Transfer } from 'antd';\r\nimport { useEffect, useImperativeHandle, useRef, useState } from 'react';\r\n\r\nconst ModalAuth = (Props: any) => {\r\n\tconst { modalIsOpenAuth, setModalIsOpenAuth } = Props;\r\n\r\n\tconst [formUser] = Form.useForm();\r\n\r\n\tconst getStatusV = useRef<any>();\r\n\r\n\tconst [transferData, settransferData] = useState([]);\r\n\tconst [targetKeys, settargetKeys] = useState([]);\r\n\tconst [isAuthClosed, setIsAuthClosed] = useState<any>(null);\r\n\tconst [detailUserInfo, setdetailUserInfo] = useState({}); // 单选用户信息\r\n\r\n\tuseEffect(() => {\r\n\t\tif (modalIsOpenAuth) {\r\n\t\t\tGetData();\r\n\t\t} else {\r\n\t\t\tsettransferData([]);\r\n\t\t\tsettargetKeys([]);\r\n\t\t\tsetdetailUserInfo({}); // 设置弹窗、权限、用户信息\r\n\t\t\tsetIsAuthClosed(false);\r\n\t\t}\r\n\t}, [modalIsOpenAuth]);\r\n\r\n\tlet selectedItem = {\r\n\t\tauthorize_time: '91919950866',\r\n\t\tauthorize_user_name: '汤杰',\r\n\t\tcreate_time: '1678994140970',\r\n\t\tid: 2,\r\n\t\tkey: 2,\r\n\t\tmenus: '/home/index',\r\n\t\trole_name: '前端开发',\r\n\t\tstatus: 2,\r\n\t};\r\n\r\n\tconst GetData = async () => {\r\n\t\t// 获取角色用户列表 > 筛选目标用户\r\n\t\tconst results: any = await roleTransferList(selectedItem.id); // 根据iD获取该角色原有用户\r\n\t\tconst transferData: any = [];\r\n\t\tconst targetKeys: any = [];\r\n\t\tif (results.data.length > 0) {\r\n\t\t\tconst dataSource = results.data;\r\n\t\t\tfor (let index = 0; index < dataSource.length; index++) {\r\n\t\t\t\tconst element = dataSource[index];\r\n\t\t\t\tconst data = {\r\n\t\t\t\t\tkey: element.user_id,\r\n\t\t\t\t\ttitle: element.user_name,\r\n\t\t\t\t\tstatus: element.status,\r\n\t\t\t\t};\r\n\t\t\t\tif (data.status === 1) {\r\n\t\t\t\t\ttargetKeys.push(data.key);\r\n\t\t\t\t}\r\n\t\t\t\ttransferData.push(data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsettransferData(transferData);\r\n\t\tsettargetKeys(targetKeys);\r\n\r\n\t\t// 设置弹窗、权限、用户信息\r\n\t\tsetdetailUserInfo(selectedItem);\r\n\t\tsetIsAuthClosed(false);\r\n\t\t// setModalIsOpenAuth(true);\r\n\t};\r\n\r\n\t// 弹窗：用户授权 提交\r\n\tconst userPermSubmit = () => {\r\n\t\tlet data: any = {};\r\n\t\tdata.user_ids = targetKeys || [];\r\n\t\tdata.role_id = selectedItem.id;\r\n\t\tdata.authorize_time = Date.now();\r\n\t\t// 将 data 传递到服务端\r\n\t\t// 重置表单值\r\n\t\tformUser.resetFields();\r\n\t\t// 关闭弹窗\r\n\t\tsetModalIsOpenAuth(false);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Modal\r\n\t\t\ttitle='用户授权'\r\n\t\t\twidth={800}\r\n\t\t\topen={modalIsOpenAuth}\r\n\t\t\tonOk={userPermSubmit}\r\n\t\t\tonCancel={() => {\r\n\t\t\t\tformUser.resetFields();\r\n\t\t\t\tsetModalIsOpenAuth(false);\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<RoleAuthForm\r\n\t\t\t\tform={formUser}\r\n\t\t\t\tisClose={isAuthClosed}\r\n\t\t\t\tdetailUserInfo={detailUserInfo}\r\n\t\t\t\ttargetKeys={targetKeys}\r\n\t\t\t\ttransferData={transferData}\r\n\t\t\t\tpatchUserInfo={(targetKeys: any) => {\r\n\t\t\t\t\tsettargetKeys(targetKeys);\r\n\t\t\t\t}}\r\n\t\t\t\tref={getStatusV}\r\n\t\t\t/>\r\n\t\t</Modal>\r\n\t);\r\n};\r\nfunction RoleAuthForm({ form, isClose, detailUserInfo, targetKeys, transferData, patchUserInfo, ref }: any): React.ReactNode {\r\n\tconst [status, setstatus] = useState(11);\r\n\tconst statusValue = () => {\r\n\t\tsetstatus(status + 1);\r\n\t\treturn status;\r\n\t};\r\n\tuseImperativeHandle(ref, () => ({ status, statusValue }));\r\n\r\n\tconst filterOption = (inputValue: any, option: any) => {\r\n\t\treturn option.title.indexOf(inputValue) > -1;\r\n\t};\r\n\tconst handleChange = (targetKeys: any): void => {\r\n\t\tpatchUserInfo(targetKeys);\r\n\t};\r\n\tconst formItemLayout = {\r\n\t\tlabelCol: { span: 5 },\r\n\t\twrapperCol: { span: 18 },\r\n\t};\r\n\treturn (\r\n\t\t<Form form={form} layout='horizontal' {...formItemLayout} initialValues={{ transfer: targetKeys }}>\r\n\t\t\t<Form.Item name='role_name3' label='角色名称'>\r\n\t\t\t\t<Input disabled maxLength={8} placeholder={detailUserInfo.role_name} />\r\n\t\t\t</Form.Item>\r\n\t\t\t<Form.Item name='transfer' label='选择用户：'>\r\n\t\t\t\t<Transfer\r\n\t\t\t\t\tlistStyle={{ width: 200, height: 400 }}\r\n\t\t\t\t\tdataSource={transferData}\r\n\t\t\t\t\tshowSearch\r\n\t\t\t\t\ttitles={['待选用户', '已选用户']}\r\n\t\t\t\t\tfilterOption={filterOption}\r\n\t\t\t\t\ttargetKeys={targetKeys}\r\n\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\trender={(item: any) => item.title}\r\n\t\t\t\t/>\r\n\t\t\t</Form.Item>\r\n\t\t</Form>\r\n\t);\r\n}\r\nexport default ModalAuth;\r\n"],"names":["ModalAuth","Props","modalIsOpenAuth","setModalIsOpenAuth","formUser","Form","getStatusV","useRef","transferData","settransferData","useState","targetKeys","settargetKeys","isAuthClosed","setIsAuthClosed","detailUserInfo","setdetailUserInfo","useEffect","GetData","selectedItem","results","roleTransferList","dataSource","index","element","data","userPermSubmit","jsx","Modal","RoleAuthForm","form","isClose","patchUserInfo","ref","status","setstatus","statusValue","useImperativeHandle","filterOption","inputValue","option","handleChange","formItemLayout","jsxs","Input","Transfer","item"],"mappings":"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"}