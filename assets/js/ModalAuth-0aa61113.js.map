{"version":3,"file":"ModalAuth-0aa61113.js","sources":["../../../src/views/system/role/component/ModalAuth.tsx"],"sourcesContent":["import { roleTransferList } from '@/api/modules/system/roleManage';\nimport { Form, Input, Modal, Transfer } from 'antd';\nimport { useEffect, useImperativeHandle, useRef, useState } from 'react';\n\nconst ModalAuth = (Props: any) => {\n\tconst { modalIsOpenAuth, setModalIsOpenAuth } = Props;\n\n\tconst [formUser] = Form.useForm();\n\n\tconst getStatusV = useRef<any>();\n\n\tconst [transferData, settransferData] = useState([]);\n\tconst [targetKeys, settargetKeys] = useState([]);\n\tconst [isAuthClosed, setIsAuthClosed] = useState<any>(null);\n\tconst [detailUserInfo, setdetailUserInfo] = useState({}); // 单选用户信息\n\n\tuseEffect(() => {\n\t\tif (modalIsOpenAuth) {\n\t\t\tGetData();\n\t\t} else {\n\t\t\tsettransferData([]);\n\t\t\tsettargetKeys([]);\n\t\t\tsetdetailUserInfo({}); // 设置弹窗、权限、用户信息\n\t\t\tsetIsAuthClosed(false);\n\t\t}\n\t}, [modalIsOpenAuth]);\n\n\tlet selectedItem = {\n\t\tauthorize_time: '91919950866',\n\t\tauthorize_user_name: '汤杰',\n\t\tcreate_time: '1678994140970',\n\t\tid: 2,\n\t\tkey: 2,\n\t\tmenus: '/home/index',\n\t\trole_name: '前端开发',\n\t\tstatus: 2,\n\t};\n\n\tconst GetData = async () => {\n\t\t// 获取角色用户列表 > 筛选目标用户\n\t\tconst results: any = await roleTransferList(selectedItem.id); // 根据iD获取该角色原有用户\n\t\tconst transferData: any = [];\n\t\tconst targetKeys: any = [];\n\t\tif (results.data.length > 0) {\n\t\t\tconst dataSource = results.data;\n\t\t\tfor (let index = 0; index < dataSource.length; index++) {\n\t\t\t\tconst element = dataSource[index];\n\t\t\t\tconst data = {\n\t\t\t\t\tkey: element.user_id,\n\t\t\t\t\ttitle: element.user_name,\n\t\t\t\t\tstatus: element.status,\n\t\t\t\t};\n\t\t\t\tif (data.status === 1) {\n\t\t\t\t\ttargetKeys.push(data.key);\n\t\t\t\t}\n\t\t\t\ttransferData.push(data);\n\t\t\t}\n\t\t}\n\t\tsettransferData(transferData);\n\t\tsettargetKeys(targetKeys);\n\n\t\t// 设置弹窗、权限、用户信息\n\t\tsetdetailUserInfo(selectedItem);\n\t\tsetIsAuthClosed(false);\n\t\t// setModalIsOpenAuth(true);\n\t};\n\n\t// 弹窗：用户授权 提交\n\tconst userPermSubmit = () => {\n\t\tlet data: any = {};\n\t\tdata.user_ids = targetKeys || [];\n\t\tdata.role_id = selectedItem.id;\n\t\tdata.authorize_time = Date.now();\n\t\t// 将 data 传递到服务端\n\t\t// 重置表单值\n\t\tformUser.resetFields();\n\t\t// 关闭弹窗\n\t\tsetModalIsOpenAuth(false);\n\t};\n\n\treturn (\n\t\t<Modal\n\t\t\ttitle='用户授权'\n\t\t\twidth={800}\n\t\t\topen={modalIsOpenAuth}\n\t\t\tonOk={userPermSubmit}\n\t\t\tonCancel={() => {\n\t\t\t\tformUser.resetFields();\n\t\t\t\tsetModalIsOpenAuth(false);\n\t\t\t}}\n\t\t>\n\t\t\t<RoleAuthForm\n\t\t\t\tform={formUser}\n\t\t\t\tisClose={isAuthClosed}\n\t\t\t\tdetailUserInfo={detailUserInfo}\n\t\t\t\ttargetKeys={targetKeys}\n\t\t\t\ttransferData={transferData}\n\t\t\t\tpatchUserInfo={(targetKeys: any) => {\n\t\t\t\t\tsettargetKeys(targetKeys);\n\t\t\t\t}}\n\t\t\t\tref={getStatusV}\n\t\t\t/>\n\t\t</Modal>\n\t);\n};\nfunction RoleAuthForm({ form, isClose, detailUserInfo, targetKeys, transferData, patchUserInfo, ref }: any): React.ReactNode {\n\tconst [status, setstatus] = useState(11);\n\tconst statusValue = () => {\n\t\tsetstatus(status + 1);\n\t\treturn status;\n\t};\n\tuseImperativeHandle(ref, () => ({ status, statusValue }));\n\n\tconst filterOption = (inputValue: any, option: any) => {\n\t\treturn option.title.indexOf(inputValue) > -1;\n\t};\n\tconst handleChange = (targetKeys: any): void => {\n\t\tpatchUserInfo(targetKeys);\n\t};\n\tconst formItemLayout = {\n\t\tlabelCol: { span: 5 },\n\t\twrapperCol: { span: 18 },\n\t};\n\treturn (\n\t\t<Form form={form} layout='horizontal' {...formItemLayout} initialValues={{ transfer: targetKeys }}>\n\t\t\t<Form.Item name='role_name3' label='角色名称'>\n\t\t\t\t<Input disabled maxLength={8} placeholder={detailUserInfo.role_name} />\n\t\t\t</Form.Item>\n\t\t\t<Form.Item name='transfer' label='选择用户：'>\n\t\t\t\t<Transfer\n\t\t\t\t\tlistStyle={{ width: 200, height: 400 }}\n\t\t\t\t\tdataSource={transferData}\n\t\t\t\t\tshowSearch\n\t\t\t\t\ttitles={['待选用户', '已选用户']}\n\t\t\t\t\tfilterOption={filterOption}\n\t\t\t\t\ttargetKeys={targetKeys}\n\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\trender={(item: any) => item.title}\n\t\t\t\t/>\n\t\t\t</Form.Item>\n\t\t</Form>\n\t);\n}\nexport default ModalAuth;\n"],"names":["ModalAuth","Props","modalIsOpenAuth","setModalIsOpenAuth","formUser","Form","getStatusV","useRef","transferData","settransferData","useState","targetKeys","settargetKeys","isAuthClosed","setIsAuthClosed","detailUserInfo","setdetailUserInfo","useEffect","GetData","selectedItem","results","roleTransferList","dataSource","index","element","data","userPermSubmit","jsx","Modal","RoleAuthForm","form","isClose","patchUserInfo","ref","status","setstatus","statusValue","useImperativeHandle","filterOption","inputValue","option","handleChange","formItemLayout","jsxs","Input","Transfer","item"],"mappings":"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"}