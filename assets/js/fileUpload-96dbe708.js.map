{"version":3,"file":"fileUpload-96dbe708.js","sources":["../../../src/views/feat/demo/components/fileUpload.tsx"],"sourcesContent":["/* eslint-disable prettier/prettier */\nimport { message } from \"@/hooks/useMessage\";\nimport { LoadingOutlined, StarOutlined, UploadOutlined } from \"@ant-design/icons\";\nimport { Button, Card, Modal, Upload } from \"antd\";\nimport type { RcFile, UploadFile, UploadProps } from \"antd/es/upload/interface\";\nimport React, { useState } from \"react\";\n\nlet defaultFileList: any = [\n  {\n    uid: \"1\",\n    name: \"xxx.png\",\n    status: \"uploading\",\n    url: \"http://www.baidu.com/xxx.png\",\n    percent: 33\n  },\n  {\n    uid: \"2\",\n    name: \"yyy.png\",\n    status: \"done\",\n    url: \"\thttps://designer.mocky.io/static/media/chi-hang-leong-hehYcAGhbmY-unsplash.6914f9ac.jpg\"\n  },\n  {\n    uid: \"3\",\n    name: \"zzz.png\",\n    status: \"error\",\n    response: \"Server Error 500\", // custom error message to show\n    url: \"\thttps://designer.mocky.io/static/media/chi-hang-leong-hehYcAGhbmY-unsplash.6914f9ac.jpg\"\n  }\n];\nlet getBase64 = (file: RcFile): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result as string);\n    reader.onerror = error => reject(error);\n  });\n};\nconst FileUpload: React.FC = () => {\n  const [previewOpen, setPreviewOpen] = useState(false);\n  const [previewImage, setPreviewImage] = useState(\"\");\n  const [previewTitle, setPreviewTitle] = useState(\"\");\n  const [fileList, setFileList] = useState<UploadFile[]>(defaultFileList);\n  const [loading, setLoading] = useState<boolean>(false);\n  // upload: https://ant.design/components/upload-cn\n  const uploadProps: UploadProps = {\n    fileList: fileList,\n    name: \"file\",\n    action: \"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188\",\n    headers: {\n      authorization: \"authorization-text\"\n    },\n    onChange(info) {\n      setFileList(info.fileList);\n      if (info.file.status == \"uploading\") {\n        setLoading(true);\n        // console.log(\"a\", info.file, info.fileList);\n        return;\n      }\n      if (info.file.status === \"done\") {\n        setLoading(false);\n        message.success(`${info.file.name} file uploaded successfully`);\n      } else if (info.file.status === \"error\") {\n        setLoading(false);\n        message.error(`${info.file.name} file upload failed.`);\n      }\n    },\n    onRemove(file) {\n      const index = fileList.indexOf(file);\n      const newFileList = fileList.slice(index);\n      newFileList.splice(index, 1);\n      setFileList(newFileList);\n    },\n    // 上传前校验 & 上传前转换文件\n    beforeUpload(file: RcFile, FileList) {\n      const isJpgOrPng = file.type === \"image/jpg\" || file.type === \"image/png\";\n      if (!isJpgOrPng) {\n        console.log(\"仅接收传递的 jpg|png\");\n      }\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      if (!isLt2M) {\n        console.log(\"上传的文件必须小于 2M\");\n        return;\n      }\n      if (file.type.includes(\"image\")) {\n        return new Promise((resolve: any) => {\n          const reader = new FileReader();\n          reader.readAsDataURL(file);\n          reader.onload = () => {\n            const img = document.createElement(\"img\");\n            img.src = reader.result as string;\n            img.onload = () => {\n              const canvas = document.createElement(\"canvas\");\n              canvas.width = img.naturalWidth;\n              canvas.height = img.naturalHeight;\n              const ctx = canvas.getContext(\"2d\")!;\n              ctx.drawImage(img, 0, 0);\n              ctx.fillStyle = \"red\";\n              ctx.textBaseline = \"middle\";\n              ctx.font = \"33px Arial\";\n              ctx.fillText(\"Watermark\", 20, 20);\n              canvas.toBlob(result => resolve(result as any));\n            };\n          };\n        });\n      }\n      return true; // 任何都可以\n      // return isJpgOrPng && isLt2M; // 为图片&文件大小\n    },\n    progress: {\n      strokeColor: {\n        \"0%\": \"#108ee9\",\n        \"100%\": \"#87d068\"\n      },\n      size: 3,\n      format: (percent: number | undefined): any => percent && `${parseFloat(percent.toFixed(2))}%`\n    },\n    multiple: true,\n    maxCount: 15,\n    listType: \"picture-card\" || \"picture-circle\",\n    // 自定义交互图标, 使用 showUploadList 设置列表交互图标。\n    showUploadList: {\n      // showDownloadIcon: true,\n      // downloadIcon: \"Download\",\n      showRemoveIcon: true,\n      removeIcon: <StarOutlined onClick={e => console.log(e, \"custom removeIcon event\")} />\n    },\n    onPreview: async function (file: UploadFile) {\n      if (!file.url && !file.preview) {\n        file.preview = await getBase64(file.originFileObj as RcFile);\n      }\n      setPreviewImage(file.url || (file.preview as string));\n      setPreviewOpen(true);\n      setPreviewTitle(file.name || file.url!.substring(file.url!.lastIndexOf(\"/\") + 1));\n    }\n  };\n  const handleCancel = () => setPreviewOpen(false);\n  return (\n    <>\n      <div>\n        <h3>\n          <b>文件上传</b>\n        </h3>\n        <Upload {...uploadProps}>\n          <Button icon={loading ? <LoadingOutlined /> : <UploadOutlined />}></Button>\n        </Upload>\n        <Modal open={previewOpen} title={previewTitle} footer={null} onCancel={handleCancel}>\n          <img alt=\"example\" style={{ width: \"100%\" }} src={previewImage} />\n        </Modal>\n      </div>\n    </>\n  );\n};\n\nexport default FileUpload;\n"],"names":["defaultFileList","getBase64","file","resolve","reject","reader","error","FileUpload","previewOpen","setPreviewOpen","useState","previewImage","setPreviewImage","previewTitle","setPreviewTitle","fileList","setFileList","loading","setLoading","uploadProps","info","message","index","newFileList","FileList","img","canvas","ctx","result","percent","StarOutlined","handleCancel","jsx","Fragment","Upload","Button","LoadingOutlined","UploadOutlined","Modal"],"mappings":"gGAOA,IAAIA,EAAuB,CACzB,CACE,IAAK,IACL,KAAM,UACN,OAAQ,YACR,IAAK,+BACL,QAAS,EACX,EACA,CACE,IAAK,IACL,KAAM,UACN,OAAQ,OACR,IAAK,0FACP,EACA,CACE,IAAK,IACL,KAAM,UACN,OAAQ,QACR,SAAU,mBACV,IAAK,0FACP,CACF,EACIC,EAAaC,GACR,IAAI,QAAQ,CAACC,EAASC,IAAW,CAChC,MAAAC,EAAS,IAAI,WACnBA,EAAO,cAAcH,CAAI,EACzBG,EAAO,OAAS,IAAMF,EAAQE,EAAO,MAAgB,EAC9CA,EAAA,QAAmBC,GAAAF,EAAOE,CAAK,CAAA,CACvC,EAEH,MAAMC,EAAuB,IAAM,CACjC,KAAM,CAACC,EAAaC,CAAc,EAAIC,WAAS,EAAK,EAC9C,CAACC,EAAcC,CAAe,EAAIF,WAAS,EAAE,EAC7C,CAACG,EAAcC,CAAe,EAAIJ,WAAS,EAAE,EAC7C,CAACK,EAAUC,CAAW,EAAIN,WAAuBV,CAAe,EAChE,CAACiB,EAASC,CAAU,EAAIR,WAAkB,EAAK,EAE/CS,EAA2B,CAC/B,SAAAJ,EACA,KAAM,OACN,OAAQ,+DACR,QAAS,CACP,cAAe,oBACjB,EACA,SAASK,EAAM,CAET,GADJJ,EAAYI,EAAK,QAAQ,EACrBA,EAAK,KAAK,QAAU,YAAa,CACnCF,EAAW,EAAI,EAEf,MACF,CACIE,EAAK,KAAK,SAAW,QACvBF,EAAW,EAAK,EAChBG,EAAQ,QAAQ,GAAGD,EAAK,KAAK,IAAI,6BAA6B,GACrDA,EAAK,KAAK,SAAW,UAC9BF,EAAW,EAAK,EAChBG,EAAQ,MAAM,GAAGD,EAAK,KAAK,IAAI,sBAAsB,EAEzD,EACA,SAASlB,EAAM,CACP,MAAAoB,EAAQP,EAAS,QAAQb,CAAI,EAC7BqB,EAAcR,EAAS,MAAMO,CAAK,EAC5BC,EAAA,OAAOD,EAAO,CAAC,EAC3BN,EAAYO,CAAW,CACzB,EAEA,aAAarB,EAAcsB,EAAU,CAMnC,GALmBtB,EAAK,OAAS,aAAeA,EAAK,KAItCA,EAAK,KAAO,KAAO,KAAO,EAKzC,OAAIA,EAAK,KAAK,SAAS,OAAO,EACrB,IAAI,QAASC,GAAiB,CAC7B,MAAAE,EAAS,IAAI,WACnBA,EAAO,cAAcH,CAAI,EACzBG,EAAO,OAAS,IAAM,CACd,MAAAoB,EAAM,SAAS,cAAc,KAAK,EACxCA,EAAI,IAAMpB,EAAO,OACjBoB,EAAI,OAAS,IAAM,CACX,MAAAC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQD,EAAI,aACnBC,EAAO,OAASD,EAAI,cACd,MAAAE,EAAMD,EAAO,WAAW,IAAI,EAC9BC,EAAA,UAAUF,EAAK,EAAG,CAAC,EACvBE,EAAI,UAAY,MAChBA,EAAI,aAAe,SACnBA,EAAI,KAAO,aACPA,EAAA,SAAS,YAAa,GAAI,EAAE,EAChCD,EAAO,OAAOE,GAAUzB,EAAQyB,CAAa,CAAC,CAAA,CAChD,CACF,CACD,EAEI,EAET,EACA,SAAU,CACR,YAAa,CACX,KAAM,UACN,OAAQ,SACV,EACA,KAAM,EACN,OAASC,GAAqCA,GAAW,GAAG,WAAWA,EAAQ,QAAQ,CAAC,CAAC,CAAC,GAC5F,EACA,SAAU,GACV,SAAU,GACV,SAAU,eAEV,eAAgB,CAGd,eAAgB,GAChB,iBAAaC,EAAa,CAAA,WAAsB,QAAA,IAAI,EAAG,yBAAyB,CAAG,CAAA,CACrF,EACA,UAAW,eAAgB5B,EAAkB,CACvC,CAACA,EAAK,KAAO,CAACA,EAAK,UACrBA,EAAK,QAAU,MAAMD,EAAUC,EAAK,aAAuB,GAE7CU,EAAAV,EAAK,KAAQA,EAAK,OAAkB,EACpDO,EAAe,EAAI,EACHK,EAAAZ,EAAK,MAAQA,EAAK,IAAK,UAAUA,EAAK,IAAK,YAAY,GAAG,EAAI,CAAC,CAAC,CAClF,CAAA,EAEI6B,EAAe,IAAMtB,EAAe,EAAK,EAE7C,OAAAuB,EAAAA,IAAAC,EAAAA,SAAA,CACE,gBAAC,MACC,CAAA,SAAA,CAAAD,MAAC,KACC,CAAA,SAAAA,EAAA,IAAC,IAAE,CAAA,SAAA,MAAI,CAAA,EACT,EACCA,EAAA,IAAAE,EAAA,CAAQ,GAAGf,EACV,eAACgB,EAAO,CAAA,KAAMlB,EAAUe,MAACI,EAAgB,CAAA,CAAA,EAAMJ,EAAAA,IAAAK,EAAA,CAAe,CAAA,CAAI,CAAA,EACpE,EACAL,EAAAA,IAACM,GAAM,KAAM9B,EAAa,MAAOK,EAAc,OAAQ,KAAM,SAAUkB,EACrE,eAAC,MAAI,CAAA,IAAI,UAAU,MAAO,CAAE,MAAO,QAAU,IAAKpB,CAAA,CAAc,CAClE,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAEJ"}