import{r,Z as A,c0 as te,bt as Pt,S as yt,b$ as ze,X as Ot,bm as Ct,dQ as vt,W as B,dA as Ht,bq as me,Y as St,V as ht}from"./index-423f46ac.js";import{u as At,b as Rt,B as Ft}from"./Select-a5967449.js";import{h as it,c as $t}from"./conductUtil-2d30a3cb.js";import{_ as Wt}from"./createForOfIteratorHelper-adf5964d.js";import{U as jt,T as Ut}from"./Tree-2442eb40.js";const Bt=function(e){var t=r.useRef({valueLabels:new Map});return r.useMemo(function(){var l=t.current.valueLabels,i=new Map,o=e.map(function(c){var n=c.value,a=c.label,u=a??l.get(n);return i.set(n,u),A(A({},c),{},{label:u})});return t.current.valueLabels=i,[o]},[e])};var Gt=function(t,l,i,o){return r.useMemo(function(){var c=function(w){return w.map(function(N){var M=N.value;return M})},n=c(t),a=c(l),u=n.filter(function(T){return!o[T]}),g=n,v=a;if(i){var _=it(n,!0,o);g=_.checkedKeys,v=_.halfCheckedKeys}return[Array.from(new Set([].concat(te(u),te(g)))),v]},[t,l,i,o])},Yt=function(t){return Array.isArray(t)?t:t!==void 0?[t]:[]},qt=function(t){var l=t||{},i=l.label,o=l.value,c=l.children;return{_title:i?[i]:["title","label"],value:o||"value",key:o||"value",children:c||"children"}},ut=function(t){return!t||t.disabled||t.disableCheckbox||t.checkable===!1},Jt=function(t,l){var i=[],o=function c(n){n.forEach(function(a){var u=a[l.children];u&&(i.push(a[l.value]),c(u))})};return o(t),i},pt=function(t){return t==null};const Qt=function(e,t){return r.useMemo(function(){var l=$t(e,{fieldNames:t,initWrapper:function(o){return A(A({},o),{},{valueEntities:new Map})},processEntity:function(o,c){var n=o.node[t.value];c.valueEntities.set(n,o)}});return l},[e,t])};var bt=function(){return null},Xt=["children","value"];function xt(e){return Pt(e).map(function(t){if(!r.isValidElement(t)||!t.type)return null;var l=t,i=l.key,o=l.props,c=o.children,n=o.value,a=yt(o,Xt),u=A({key:i,value:n},a),g=xt(c);return g.length&&(u.children=g),u}).filter(function(t){return t})}function ot(e){if(!e)return e;var t=A({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return ze(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function Zt(e,t,l,i,o,c){var n=null,a=null;function u(){function g(v){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v.map(function(w,N){var M="".concat(_,"-").concat(N),I=w[c.value],j=l.includes(I),re=g(w[c.children]||[],M,j),Q=r.createElement(bt,w,re.map(function(R){return R.node}));if(t===I&&(n=Q),j){var ce={pos:M,node:Q,children:re};return T||a.push(ce),ce}return null}).filter(function(w){return w})}a||(a=[],g(i),a.sort(function(v,_){var T=v.node.props.value,w=_.node.props.value,N=l.indexOf(T),M=l.indexOf(w);return N-M}))}Object.defineProperty(e,"triggerNode",{get:function(){return ze(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),u(),n}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return ze(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),u(),o?a:a.map(function(v){var _=v.node;return _})}})}var zt=function(t,l,i){var o=i.fieldNames,c=i.treeNodeFilterProp,n=i.filterTreeNode,a=o.children;return r.useMemo(function(){if(!l||n===!1)return t;var u=typeof n=="function"?n:function(v,_){return String(_[c]).toUpperCase().includes(l.toUpperCase())},g=function v(_){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return _.reduce(function(w,N){var M=N[a],I=T||u(l,ot(N)),j=v(M||[],I);return(I||j.length)&&w.push(A(A({},N),{},Ot({isLeaf:void 0},a,j))),w},[])};return g(t)},[t,l,a,c,n])};function gt(e){var t=r.useRef();t.current=e;var l=r.useCallback(function(){return t.current.apply(t,arguments)},[]);return l}function er(e,t){var l=t.id,i=t.pId,o=t.rootPId,c=new Map,n=[];return e.forEach(function(a){var u=a[l],g=A(A({},a),{},{key:a.key||u});c.set(u,g)}),c.forEach(function(a){var u=a[i],g=c.get(u);g?(g.children=g.children||[],g.children.push(a)):(u===o||o===null)&&n.push(a)}),n}function tr(e,t,l){return r.useMemo(function(){if(e){if(l){var i=A({id:"id",pId:"pId",rootPId:null},Ct(l)==="object"?l:{});return er(e,i)}return e}return xt(t)},[t,l,e])}var Et=r.createContext(null),kt=r.createContext(null),rr={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},nr=function(t,l){var i=At(),o=i.prefixCls,c=i.multiple,n=i.searchValue,a=i.toggleOpen,u=i.open,g=i.notFoundContent,v=r.useContext(kt),_=v.virtual,T=v.listHeight,w=v.listItemHeight,N=v.listItemScrollOffset,M=v.treeData,I=v.fieldNames,j=v.onSelect,re=v.dropdownMatchSelectWidth,Q=v.treeExpandAction,ce=v.treeTitleRender,R=v.onPopupScroll,K=v.leftMaxCount,Ie=v.leafCountOnly,X=v.valueEntities,b=r.useContext(Et),ne=b.checkable,V=b.checkedKeys,_e=b.halfCheckedKeys,ae=b.treeExpandedKeys,Ke=b.treeDefaultExpandAll,Te=b.treeDefaultExpandedKeys,ye=b.onTreeExpand,Me=b.treeIcon,Le=b.showTreeIcon,Ne=b.switcherIcon,Ve=b.treeLine,Pe=b.treeNodeFilterProp,Oe=b.loadData,Ce=b.treeLoadedKeys,He=b.treeMotion,Ae=b.onTreeLoad,Re=b.keyEntities,le=r.useRef(),ie=vt(function(){return M},[u,M],function(h,s){return s[0]&&h[1]!==s[1]}),Fe=r.useMemo(function(){return ne?{checked:V,halfChecked:_e}:null},[ne,V,_e]);r.useEffect(function(){if(u&&!c&&V.length){var h;(h=le.current)===null||h===void 0||h.scrollTo({key:V[0]})}},[u]);var de=function(s){s.preventDefault()},se=function(s,D){var S=D.node;ne&&ut(S)||(j(S.key,{selected:!V.includes(S.key)}),c||a(!1))},$e=r.useState(Te),Se=B($e,2),fe=Se[0],We=Se[1],q=r.useState(null),be=B(q,2),je=be[0],Ue=be[1],ue=r.useMemo(function(){return ae?te(ae):n?je:fe},[fe,je,ae,n]),ve=function(s){We(s),Ue(s),ye&&ye(s)},xe=String(n).toLowerCase(),F=function(s){return xe?String(s[Pe]).toLowerCase().includes(xe):!1};r.useEffect(function(){n&&Ue(Jt(M,I))},[n]);var tt=r.useState(function(){return new Map}),Ee=B(tt,2),G=Ee[0],rt=Ee[1];r.useEffect(function(){K&&rt(new Map)},[K]);function J(h){var s=h[I.value];if(!G.has(s)){var D=X.get(s),S=(D.children||[]).length===0;if(S)G.set(s,!1);else{var x=D.children.filter(function(O){return!O.node.disabled&&!O.node.disableCheckbox&&!V.includes(O.node[I.value])}),W=x.length;G.set(s,W>K)}}return G.get(s)}var k=Ht(function(h){var s=h[I.value];return V.includes(s)||K===null?!1:K<=0?!0:Ie&&K?J(h):!1}),nt=function h(s){var D=Wt(s),S;try{for(D.s();!(S=D.n()).done;){var x=S.value;if(!(x.disabled||x.selectable===!1)){if(n){if(F(x))return x}else return x;if(x[I.children]){var W=h(x[I.children]);if(W)return W}}}}catch(O){D.e(O)}finally{D.f()}return null},Be=r.useState(null),ke=B(Be,2),he=ke[0],Ge=ke[1],$=Re[he];r.useEffect(function(){if(u){var h=null,s=function(){var S=nt(ie);return S?S[I.value]:null};!c&&V.length&&!n?h=V[0]:h=s(),Ge(h)}},[u,n]),r.useImperativeHandle(l,function(){var h;return{scrollTo:(h=le.current)===null||h===void 0?void 0:h.scrollTo,onKeyDown:function(D){var S,x=D.which;switch(x){case me.UP:case me.DOWN:case me.LEFT:case me.RIGHT:(S=le.current)===null||S===void 0||S.onKeyDown(D);break;case me.ENTER:{if($){var W=k($.node),O=($==null?void 0:$.node)||{},qe=O.selectable,Z=O.value,Je=O.disabled;qe!==!1&&!Je&&!W&&se(null,{node:{key:he},selected:!V.includes(Z)})}break}case me.ESC:a(!1)}},onKeyUp:function(){}}});var Ye=vt(function(){return!n},[n,ae||fe],function(h,s){var D=B(h,1),S=D[0],x=B(s,2),W=x[0],O=x[1];return S!==W&&!!(W||O)}),L=Ye?Oe:null;if(ie.length===0)return r.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:de},g);var P={fieldNames:I};return Ce&&(P.loadedKeys=Ce),ue&&(P.expandedKeys=ue),r.createElement("div",{onMouseDown:de},$&&u&&r.createElement("span",{style:rr,"aria-live":"assertive"},$.node.value),r.createElement(jt.Provider,{value:{nodeDisabled:k}},r.createElement(Ut,St({ref:le,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:ie,height:T,itemHeight:w,itemScrollOffset:N,virtual:_!==!1&&re!==!1,multiple:c,icon:Me,showIcon:Le,switcherIcon:Ne,showLine:Ve,loadData:L,motion:He,activeKey:he,checkable:ne,checkStrictly:!0,checkedKeys:Fe,selectedKeys:ne?[]:V,defaultExpandAll:Ke,titleRender:ce},P,{onActiveChange:Ge,onSelect:se,onCheck:se,onExpand:ve,onLoad:Ae,filterTreeNode:F,expandAction:Q,onScroll:R}))))},ar=r.forwardRef(nr),Dt="SHOW_ALL",wt="SHOW_PARENT",ct="SHOW_CHILD";function mt(e,t,l,i){var o=new Set(e);return t===ct?e.filter(function(c){var n=l[c];return!n||!n.children||!n.children.some(function(a){var u=a.node;return o.has(u[i.value])})||!n.children.every(function(a){var u=a.node;return ut(u)||o.has(u[i.value])})}):t===wt?e.filter(function(c){var n=l[c],a=n?n.parent:null;return!a||ut(a.node)||!o.has(a.key)}):e}var lr=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];function ir(e){return!e||Ct(e)!=="object"}var ur=r.forwardRef(function(e,t){var l=e.id,i=e.prefixCls,o=i===void 0?"rc-tree-select":i,c=e.value,n=e.defaultValue,a=e.onChange,u=e.onSelect,g=e.onDeselect,v=e.searchValue,_=e.inputValue,T=e.onSearch,w=e.autoClearSearchValue,N=w===void 0?!0:w,M=e.filterTreeNode,I=e.treeNodeFilterProp,j=I===void 0?"value":I,re=e.showCheckedStrategy,Q=e.treeNodeLabelProp,ce=e.multiple,R=e.treeCheckable,K=e.treeCheckStrictly,Ie=e.labelInValue,X=e.maxCount,b=e.fieldNames,ne=e.treeDataSimpleMode,V=e.treeData,_e=e.children,ae=e.loadData,Ke=e.treeLoadedKeys,Te=e.onTreeLoad,ye=e.treeDefaultExpandAll,Me=e.treeExpandedKeys,Le=e.treeDefaultExpandedKeys,Ne=e.onTreeExpand,Ve=e.treeExpandAction,Pe=e.virtual,Oe=e.listHeight,Ce=Oe===void 0?200:Oe,He=e.listItemHeight,Ae=He===void 0?20:He,Re=e.listItemScrollOffset,le=Re===void 0?0:Re,ie=e.onDropdownVisibleChange,Fe=e.dropdownMatchSelectWidth,de=Fe===void 0?!0:Fe,se=e.treeLine,$e=e.treeIcon,Se=e.showTreeIcon,fe=e.switcherIcon,We=e.treeMotion,q=e.treeTitleRender,be=e.onPopupScroll,je=yt(e,lr),Ue=Rt(l),ue=R&&!K,ve=R||K,xe=K||Ie,F=ve||ce,tt=ht(n,{value:c}),Ee=B(tt,2),G=Ee[0],rt=Ee[1],J=r.useMemo(function(){return R?re||ct:Dt},[re,R]),k=r.useMemo(function(){return qt(b)},[JSON.stringify(b)]),nt=ht("",{value:v!==void 0?v:_,postState:function(d){return d||""}}),Be=B(nt,2),ke=Be[0],he=Be[1],Ge=function(d){he(d),T==null||T(d)},$=tr(V,_e,ne),Ye=Qt($,k),L=Ye.keyEntities,P=Ye.valueEntities,h=r.useCallback(function(f){var d=[],p=[];return f.forEach(function(m){P.has(m)?p.push(m):d.push(m)}),{missingRawValues:d,existRawValues:p}},[P]),s=zt($,ke,{fieldNames:k,treeNodeFilterProp:j,filterTreeNode:M}),D=r.useCallback(function(f){if(f){if(Q)return f[Q];for(var d=k._title,p=0;p<d.length;p+=1){var m=f[d[p]];if(m!==void 0)return m}}},[k,Q]),S=r.useCallback(function(f){var d=Yt(f);return d.map(function(p){return ir(p)?{value:p}:p})},[]),x=r.useCallback(function(f){var d=S(f);return d.map(function(p){var m=p.label,U=p.value,E=p.halfChecked,y,C=P.get(U);if(C){var H;m=q?q(C.node):(H=m)!==null&&H!==void 0?H:D(C.node),y=C.node.disabled}else if(m===void 0){var z=S(G).find(function(De){return De.value===U});m=z.label}return{label:m,value:U,halfChecked:E,disabled:y}})},[P,D,S,G]),W=r.useMemo(function(){return S(G===null?[]:G)},[S,G]),O=r.useMemo(function(){var f=[],d=[];return W.forEach(function(p){p.halfChecked?d.push(p):f.push(p)}),[f,d]},[W]),qe=B(O,2),Z=qe[0],Je=qe[1],dt=r.useMemo(function(){return Z.map(function(f){return f.value})},[Z]),It=Gt(Z,Je,ue,L),st=B(It,2),pe=st[0],Qe=st[1],_t=r.useMemo(function(){var f=mt(pe,J,L,k),d=f.map(function(E){var y,C;return(y=(C=L[E])===null||C===void 0||(C=C.node)===null||C===void 0?void 0:C[k.value])!==null&&y!==void 0?y:E}),p=d.map(function(E){var y=Z.find(function(H){return H.value===E}),C=Ie?y==null?void 0:y.label:q==null?void 0:q(y);return{value:E,label:C}}),m=x(p),U=m[0];return!F&&U&&pt(U.value)&&pt(U.label)?[]:m.map(function(E){var y;return A(A({},E),{},{label:(y=E.label)!==null&&y!==void 0?y:E.value})})},[k,F,pe,Z,x,J,L]),Kt=Bt(_t),Tt=B(Kt,1),at=Tt[0],ft=r.useMemo(function(){return F&&(J==="SHOW_CHILD"||K||!R)?X:null},[X,F,K,J,R]),Xe=gt(function(f,d,p){var m=mt(f,J,L,k);if(!(ft&&m.length>ft)){var U=x(f);if(rt(U),N&&he(""),a){var E=f;ue&&(E=m.map(function(Y){var ee=P.get(Y);return ee?ee.node[k.value]:Y}));var y=d||{triggerValue:void 0,selected:void 0},C=y.triggerValue,H=y.selected,z=E;if(K){var De=Je.filter(function(Y){return!E.includes(Y.value)});z=[].concat(te(z),te(De))}var we=x(z),oe={preValue:Z,triggerValue:C},ge=!0;(K||p==="selection"&&!H)&&(ge=!1),Zt(oe,C,f,$,ge,k),ve?oe.checked=H:oe.selected=H;var Ze=xe?we:we.map(function(Y){return Y.value});a(F?Ze:Ze[0],xe?null:we.map(function(Y){return Y.label}),oe)}}}),lt=r.useCallback(function(f,d){var p,m=d.selected,U=d.source,E=L[f],y=E==null?void 0:E.node,C=(p=y==null?void 0:y[k.value])!==null&&p!==void 0?p:f;if(!F)Xe([C],{selected:!0,triggerValue:C},"option");else{var H=m?[].concat(te(dt),[C]):pe.filter(function(ee){return ee!==C});if(ue){var z=h(H),De=z.missingRawValues,we=z.existRawValues,oe=we.map(function(ee){return P.get(ee).key}),ge;if(m){var Ze=it(oe,!0,L);ge=Ze.checkedKeys}else{var Y=it(oe,{checked:!1,halfCheckedKeys:Qe},L);ge=Y.checkedKeys}H=[].concat(te(De),te(ge.map(function(ee){return L[ee].node[k.value]})))}Xe(H,{selected:m,triggerValue:C},U||"option")}m||!F?u==null||u(C,ot(y)):g==null||g(C,ot(y))},[h,P,L,k,F,dt,Xe,ue,u,g,pe,Qe,X]),Mt=r.useCallback(function(f){if(ie){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return ze(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ie(f,d)}},[ie]),Lt=gt(function(f,d){var p=f.map(function(m){return m.value});if(d.type==="clear"){Xe(p,{},"selection");return}d.values.length&&lt(d.values[0].value,{selected:!1,source:"selection"})}),Nt=r.useMemo(function(){return{virtual:Pe,dropdownMatchSelectWidth:de,listHeight:Ce,listItemHeight:Ae,listItemScrollOffset:le,treeData:s,fieldNames:k,onSelect:lt,treeExpandAction:Ve,treeTitleRender:q,onPopupScroll:be,leftMaxCount:X===void 0?null:X-at.length,leafCountOnly:J==="SHOW_CHILD"&&!K&&!!R,valueEntities:P}},[Pe,de,Ce,Ae,le,s,k,lt,Ve,q,be,X,at.length,J,K,R,P]),Vt=r.useMemo(function(){return{checkable:ve,loadData:ae,treeLoadedKeys:Ke,onTreeLoad:Te,checkedKeys:pe,halfCheckedKeys:Qe,treeDefaultExpandAll:ye,treeExpandedKeys:Me,treeDefaultExpandedKeys:Le,onTreeExpand:Ne,treeIcon:$e,treeMotion:We,showTreeIcon:Se,switcherIcon:fe,treeLine:se,treeNodeFilterProp:j,keyEntities:L}},[ve,ae,Ke,Te,pe,Qe,ye,Me,Le,Ne,$e,We,Se,fe,se,j,L]);return r.createElement(kt.Provider,{value:Nt},r.createElement(Et.Provider,{value:Vt},r.createElement(Ft,St({ref:t},je,{id:Ue,prefixCls:o,mode:F?"multiple":void 0,displayValues:at,onDisplayValuesChange:Lt,searchValue:ke,onSearch:Ge,OptionList:ar,emptyOptions:!$.length,onDropdownVisibleChange:Mt,dropdownMatchSelectWidth:de}))))}),et=ur;et.TreeNode=bt;et.SHOW_ALL=Dt;et.SHOW_PARENT=wt;et.SHOW_CHILD=ct;export{et as G,Dt as S,bt as T,wt as a,ct as b};
//# sourceMappingURL=TreeSelect-f84f97a4.js.map
