import{r as w,j as e,D as z,I as L,U as $,B as x,E as O,T as d,Q as p,a as R,b as H,c as r}from"./index-113fc74b.js";import{r as I,u as s,w as k}from"./xlsx-964ea548.js";import{F as g}from"./FileSaver.min-92411466.js";function M(E){const{TableName:h,ExportTableData:m,tableHeaders:u}=E,[Q,l]=w.useState(!1),[q,_]=w.useState(""),S=t=>{if(!/\.(xlsx|xls)$/.test(t==null?void 0:t.name.toLowerCase()))return r.error("请上传Excel文件（.xlsx 或 .xls）"),!1;_(t.name),l(!0);const n=new FileReader;n.onload=a=>{const A=new Uint8Array(a.target.result),b=I(A,{type:"array"}),D=b.Sheets[b.SheetNames[0]],i=s.sheet_to_json(D,{header:1});if(i==0)return r.warning("导入错误：表格无数据"),l(!1),!1;const F=i[0]||[],j=u.filter(c=>!F.includes(c));if(j.length>0)return r.error(`导入失败：缺少字段：${j.join("、")}`),!1;const f=[];if(i.slice(1).forEach((c,C)=>{if(c.length===0)return!1;const y={key:C};i[0].forEach((N,U)=>{y[N]=c[U]}),f.push(y)}),f.length==0)return r.warning("导入错误：表格无数据"),l(!1),!1;l(!1)},n.readAsArrayBuffer(t)},T=()=>{const t=s.aoa_to_sheet([u]),o=s.book_new();s.book_append_sheet(o,t,"Sheet1");const n=k(o,{bookType:"xlsx",type:"array"}),a=new Blob([n],{type:"application/octet-stream"});g.saveAs(a,`${h}模板.xlsx`)},B=()=>{if(!m.length)return r.warning("暂无数据可导出");const t=s.json_to_sheet(m),o=s.book_new();s.book_append_sheet(o,t,"Sheet1");const n=k(o,{bookType:"xlsx",type:"array"}),a=new Blob([n],{type:"application/octet-stream"});g.saveAs(a,`导出${h}数据.xlsx`)},v=[{key:"1",label:e.jsx("div",{children:e.jsx($,{beforeUpload:t=>{S(t)},children:e.jsxs(x,{type:"text",size:"middle",icon:e.jsx(O,{}),children:["导入表格数据",e.jsx(d,{title:"向表格中导入数据、先下载模板并导入！",children:e.jsx("span",{children:e.jsx(p,{})})})]},"view")})})},{key:"2",label:e.jsxs(x,{type:"text",size:"middle",icon:e.jsx(R,{}),onClick:T,children:["导出表格模板",e.jsx(d,{title:"模板格式、按格式去导入！",children:e.jsx("span",{children:e.jsx(p,{})})})]},"edit")},{key:"3",label:e.jsxs(x,{type:"text",size:"middle",icon:e.jsx(H,{}),onClick:B,children:["导出表格数据",e.jsx(d,{title:"导出表格中所有的数据！",children:e.jsx("span",{children:e.jsx(p,{})})})]},"delete")}];return e.jsx(e.Fragment,{children:e.jsx(z,{menu:{items:v},placement:"bottom",arrow:{pointAtCenter:!0},trigger:["click"],children:e.jsx("div",{className:"more-button-item",children:e.jsx(L,{style:{fontSize:22},type:"icon-xiala"})})})})}export{M as default};
//# sourceMappingURL=Excel-b53319d3.js.map
