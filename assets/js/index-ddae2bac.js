import{O as a,M as ee,I as ue,cf as ve,a as oe,r as l,cg as de,K as J,J as me,cX as pe,j as p,cO as he,aU as $e,t as ge,by as le,bz as X,q as Fe,cY as Se,a4 as Pe}from"./index-6ab6cade.js";import{o as ke,e as Ce,F as Me,f as ze}from"./index-9157520c.js";import{u as Te,B as ce}from"./BaseForm-16c08f45.js";import{i as je}from"./index-8a0f6792.js";import{a as be,u as Ie}from"./index-cc70f193.js";var We=function(n){return ee({},n.componentCls,{"&-sidebar-dragger":{width:"5px",cursor:"ew-resize",padding:"4px 0 0",borderTop:"1px solid transparent",position:"absolute",top:0,left:0,bottom:0,zIndex:100,backgroundColor:"transparent","&-min-disabled":{cursor:"w-resize"},"&-max-disabled":{cursor:"e-resize"}}})};function Oe(e){return be("DrawerForm",function(n){var R=a(a({},n),{},{componentCls:".".concat(e)});return[We(R)]})}var Ve=["children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","resize","onOpenChange","visible","open"];function qe(e){var n,R,ne=e.children,S=e.trigger,y=e.onVisibleChange,s=e.drawerProps,t=e.onFinish,W=e.submitTimeout,H=e.title,z=e.width,w=e.resize,O=e.onOpenChange,U=e.visible,c=e.open,g=ue(e,Ve);ve(!g.footer||!(s!=null&&s.footer),"DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var i=oe.useMemo(function(){var m,r,o,v={onResize:function(){},maxWidth:je()?window.innerWidth*.8:void 0,minWidth:300};return typeof w=="boolean"?w?v:{}:ke({onResize:(m=w==null?void 0:w.onResize)!==null&&m!==void 0?m:v.onResize,maxWidth:(r=w==null?void 0:w.maxWidth)!==null&&r!==void 0?r:v.maxWidth,minWidth:(o=w==null?void 0:w.minWidth)!==null&&o!==void 0?o:v.minWidth})},[w]),P=l.useContext(de.ConfigContext),Y=P.getPrefixCls("pro-form-drawer"),D=Oe(Y),Z=D.wrapSSR,V=D.hashId,b=function(r){return"".concat(Y,"-").concat(r," ").concat(V)},k=l.useState([]),N=J(k,2),B=N[1],M=l.useState(!1),G=J(M,2),re=G[0],q=G[1],f=l.useState(!1),T=J(f,2),j=T[0],L=T[1],_=l.useState(z||(w?i==null?void 0:i.minWidth:800)),Q=J(_,2),C=Q[0],u=Q[1],d=me(!!U,{value:c||U,onChange:O||y}),x=J(d,2),$=x[0],h=x[1],K=l.useRef(null),A=l.useCallback(function(m){K.current===null&&m&&B([]),K.current=m},[]),te=l.useRef(),ie=l.useCallback(function(){var m,r,o,v=(m=(r=(o=g.formRef)===null||o===void 0?void 0:o.current)!==null&&r!==void 0?r:g.form)!==null&&m!==void 0?m:te.current;v&&s!==null&&s!==void 0&&s.destroyOnClose&&v.resetFields()},[s==null?void 0:s.destroyOnClose,g.form,g.formRef]);l.useEffect(function(){$&&(c||U)&&(O==null||O(!0),y==null||y(!0)),j&&u(i==null?void 0:i.minWidth)},[U,$,j]),l.useImperativeHandle(g.formRef,function(){return te.current},[te.current]);var xe=l.useMemo(function(){return S?oe.cloneElement(S,a(a({key:"trigger"},S.props),{},{onClick:function(){var m=le(X().mark(function o(v){var I,F;return X().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:h(!$),L(!Object.keys(i)),(I=S.props)===null||I===void 0||(F=I.onClick)===null||F===void 0||F.call(I,v);case 3:case"end":return E.stop()}},o)}));function r(o){return m.apply(this,arguments)}return r}()})):null},[h,S,$,L,j]),Re=l.useMemo(function(){var m,r,o,v,I;return g.submitter===!1?!1:pe({searchConfig:{submitText:(m=(r=P.locale)===null||r===void 0||(r=r.Modal)===null||r===void 0?void 0:r.okText)!==null&&m!==void 0?m:"确认",resetText:(o=(v=P.locale)===null||v===void 0||(v=v.Modal)===null||v===void 0?void 0:v.cancelText)!==null&&o!==void 0?o:"取消"},resetButtonProps:{preventDefault:!0,disabled:W?re:void 0,onClick:function(se){var E;h(!1),s==null||(E=s.onClose)===null||E===void 0||E.call(s,se)}}},(I=g.submitter)!==null&&I!==void 0?I:{})},[g.submitter,(n=P.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.okText,(R=P.locale)===null||R===void 0||(R=R.Modal)===null||R===void 0?void 0:R.cancelText,W,re,h,s]),we=l.useCallback(function(m,r){return p.jsxs(p.Fragment,{children:[m,K.current&&r?p.jsx(oe.Fragment,{children:he.createPortal(r,K.current)},"submitter"):r]})},[]),_e=Te(function(){var m=le(X().mark(function r(o){var v,I,F;return X().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return v=t==null?void 0:t(o),W&&v instanceof Promise&&(q(!0),I=setTimeout(function(){return q(!1)},W),v.finally(function(){clearTimeout(I),q(!1)})),E.next=4,v;case 4:return F=E.sent,F&&h(!1),E.abrupt("return",F);case 7:case"end":return E.stop()}},r)}));return function(r){return m.apply(this,arguments)}}()),ye=Ce($,y),ae=l.useCallback(function(m){var r,o,v=(document.body.offsetWidth||1e3)-(m.clientX-document.body.offsetLeft),I=(r=i==null?void 0:i.minWidth)!==null&&r!==void 0?r:z||800,F=(o=i==null?void 0:i.maxWidth)!==null&&o!==void 0?o:window.innerWidth*.8;if(v<I){u(I);return}if(v>F){u(F);return}u(v)},[i==null?void 0:i.maxWidth,i==null?void 0:i.minWidth,z]),fe=l.useCallback(function(){document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",fe)},[ae]);return Z(p.jsxs(p.Fragment,{children:[p.jsxs($e,a(a(a({title:H,width:C},s),ye),{},{afterOpenChange:function(r){var o;r||ie(),s==null||(o=s.afterOpenChange)===null||o===void 0||o.call(s,r)},onClose:function(r){var o;W&&re||(h(!1),s==null||(o=s.onClose)===null||o===void 0||o.call(s,r))},footer:g.submitter!==!1&&p.jsx("div",{ref:A,style:{display:"flex",justifyContent:"flex-end"}}),children:[w?p.jsx("div",{className:ge(b("sidebar-dragger"),V,ee(ee({},b("sidebar-dragger-min-disabled"),C===(i==null?void 0:i.minWidth)),b("sidebar-dragger-max-disabled"),C===(i==null?void 0:i.maxWidth))),onMouseDown:function(r){var o;i==null||(o=i.onResize)===null||o===void 0||o.call(i),r.stopPropagation(),r.preventDefault(),document.addEventListener("mousemove",ae),document.addEventListener("mouseup",fe),L(!0)}}):null,p.jsx(p.Fragment,{children:p.jsx(ce,a(a({formComponentType:"DrawerForm",layout:"vertical"},g),{},{formRef:te,onInit:function(r,o){var v;g.formRef&&(g.formRef.current=o),g==null||(v=g.onInit)===null||v===void 0||v.call(g,r,o),te.current=o},submitter:Re,onFinish:function(){var m=le(X().mark(function r(o){var v;return X().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,_e(o);case 2:return v=F.sent,F.abrupt("return",v);case 4:case"end":return F.stop()}},r)}));return function(r){return m.apply(this,arguments)}}(),contentRender:we,children:ne}))})]})),xe]}))}var Le=function(n){return ee({},n.componentCls,{lineHeight:"30px","&::before":{display:"block",height:0,visibility:"hidden",content:"'.'"},"&-small":{lineHeight:n.lineHeight},"&-container":{display:"flex",flexWrap:"wrap",gap:n.marginXS},"&-item":ee({whiteSpace:"nowrap"},"".concat(n.antCls,"-form-item"),{marginBlock:0}),"&-line":{minWidth:"198px"},"&-line:not(:first-child)":{marginBlockStart:"16px",marginBlockEnd:8},"&-collapse-icon":{width:n.controlHeight,height:n.controlHeight,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},"&-effective":ee({},"".concat(n.componentCls,"-collapse-icon"),{backgroundColor:n.colorBgTextHover})})};function De(e){return be("LightFilter",function(n){var R=a(a({},n),{},{componentCls:".".concat(e)});return[Le(R)]})}var Ee=["size","collapse","collapseLabel","initialValues","onValuesChange","form","placement","formRef","bordered","ignoreRules","footerRender"],He=function(n){var R=n.items,ne=n.prefixCls,S=n.size,y=S===void 0?"middle":S,s=n.collapse,t=n.collapseLabel,W=n.onValuesChange,H=n.bordered,z=n.values,w=n.footerRender,O=n.placement,U=Ie(),c="".concat(ne,"-light-filter"),g=De(c),i=g.wrapSSR,P=g.hashId,Y=l.useState(!1),D=J(Y,2),Z=D[0],V=D[1],b=l.useState(function(){return a({},z)}),k=J(b,2),N=k[0],B=k[1];l.useEffect(function(){B(a({},z))},[z]);var M=l.useMemo(function(){var f=[],T=[];return R.forEach(function(j){var L=j.props||{},_=L.secondary;_||s?f.push(j):T.push(j)}),{collapseItems:f,outsideItems:T}},[n.items]),G=M.collapseItems,re=M.outsideItems,q=function(){return t||(s?p.jsx(Se,{className:"".concat(c,"-collapse-icon ").concat(P).trim()}):p.jsx(ze,{size:y,label:U.getMessage("form.lightFilter.more","更多筛选")}))};return i(p.jsx("div",{className:ge(c,P,"".concat(c,"-").concat(y),ee({},"".concat(c,"-effective"),Object.keys(z).some(function(f){return Array.isArray(z[f])?z[f].length>0:z[f]}))),children:p.jsxs("div",{className:"".concat(c,"-container ").concat(P).trim(),children:[re.map(function(f,T){if(!(f!=null&&f.props))return f;var j=f.key,L=(f==null?void 0:f.props)||{},_=L.fieldProps,Q=_!=null&&_.placement?_==null?void 0:_.placement:O;return p.jsx("div",{className:"".concat(c,"-item ").concat(P).trim(),children:oe.cloneElement(f,{fieldProps:a(a({},f.props.fieldProps),{},{placement:Q}),proFieldProps:a(a({},f.props.proFieldProps),{},{light:!0,label:f.props.label,bordered:H}),bordered:H})},j||T)}),G.length?p.jsx("div",{className:"".concat(c,"-item ").concat(P).trim(),children:p.jsx(Me,{padding:24,open:Z,onOpenChange:function(T){V(T)},placement:O,label:q(),footerRender:w,footer:{onConfirm:function(){W(a({},N)),V(!1)},onClear:function(){var T={};G.forEach(function(j){var L=j.props.name;T[L]=void 0}),W(T)}},children:G.map(function(f){var T=f.key,j=f.props,L=j.name,_=j.fieldProps,Q=a(a({},_),{},{onChange:function(d){return B(a(a({},N),{},ee({},L,d!=null&&d.target?d.target.value:d))),!1}});N.hasOwnProperty(L)&&(Q[f.props.valuePropName||"value"]=N[L]);var C=_!=null&&_.placement?_==null?void 0:_.placement:O;return p.jsx("div",{className:"".concat(c,"-line ").concat(P).trim(),children:oe.cloneElement(f,{fieldProps:a(a({},Q),{},{placement:C})})},T)})})},"more"):null]})}))};function Je(e){var n=e.size,R=e.collapse,ne=e.collapseLabel,S=e.initialValues,y=e.onValuesChange,s=e.form,t=e.placement,W=e.formRef,H=e.bordered;e.ignoreRules;var z=e.footerRender,w=ue(e,Ee),O=l.useContext(de.ConfigContext),U=O.getPrefixCls,c=U("pro-form"),g=l.useState(function(){return a({},S)}),i=J(g,2),P=i[0],Y=i[1],D=l.useRef();return l.useImperativeHandle(W,function(){return D.current},[D.current]),p.jsx(ce,a(a({size:n,initialValues:S,form:s,contentRender:function(V){return p.jsx(He,{prefixCls:c,items:V==null?void 0:V.flatMap(function(b){var k;return!b||!(b!=null&&b.type)?b:(b==null||(k=b.type)===null||k===void 0?void 0:k.displayName)==="ProForm-Group"?b.props.children:b}),size:n,bordered:H,collapse:R,collapseLabel:ne,placement:t,values:P||{},footerRender:z,onValuesChange:function(k){var N,B,M=a(a({},P),k);Y(M),(N=D.current)===null||N===void 0||N.setFieldsValue(M),(B=D.current)===null||B===void 0||B.submit(),y&&y(k,M)}})},formRef:D,formItemProps:{colon:!1,labelAlign:"left"},fieldProps:{style:{width:void 0}}},Fe(w,["labelWidth"])),{},{onValuesChange:function(V,b){var k;Y(b),y==null||y(V,b),(k=D.current)===null||k===void 0||k.submit()}}))}var Ne=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function Ke(e){var n,R,ne=e.children,S=e.trigger,y=e.onVisibleChange,s=e.onOpenChange,t=e.modalProps,W=e.onFinish,H=e.submitTimeout,z=e.title,w=e.width,O=e.visible,U=e.open,c=ue(e,Ne);ve(!c.footer||!(t!=null&&t.footer),"ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var g=l.useContext(de.ConfigContext),i=l.useState([]),P=J(i,2),Y=P[1],D=l.useState(!1),Z=J(D,2),V=Z[0],b=Z[1],k=me(!!O,{value:U||O,onChange:s||y}),N=J(k,2),B=N[0],M=N[1],G=l.useRef(null),re=l.useCallback(function(C){G.current===null&&C&&Y([]),G.current=C},[]),q=l.useRef(),f=l.useCallback(function(){var C,u,d,x=(C=(u=c.form)!==null&&u!==void 0?u:(d=c.formRef)===null||d===void 0?void 0:d.current)!==null&&C!==void 0?C:q.current;x&&t!==null&&t!==void 0&&t.destroyOnClose&&x.resetFields()},[t==null?void 0:t.destroyOnClose,c.form,c.formRef]);l.useImperativeHandle(c.formRef,function(){return q.current},[q.current]),l.useEffect(function(){(U||O)&&(s==null||s(!0),y==null||y(!0))},[O,U]);var T=l.useMemo(function(){return S?oe.cloneElement(S,a(a({key:"trigger"},S.props),{},{onClick:function(){var C=le(X().mark(function d(x){var $,h;return X().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:M(!B),($=S.props)===null||$===void 0||(h=$.onClick)===null||h===void 0||h.call($,x);case 2:case"end":return A.stop()}},d)}));function u(d){return C.apply(this,arguments)}return u}()})):null},[M,S,B]),j=l.useMemo(function(){var C,u,d,x,$,h,K;return c.submitter===!1?!1:pe({searchConfig:{submitText:(C=(u=t==null?void 0:t.okText)!==null&&u!==void 0?u:(d=g.locale)===null||d===void 0||(d=d.Modal)===null||d===void 0?void 0:d.okText)!==null&&C!==void 0?C:"确认",resetText:(x=($=t==null?void 0:t.cancelText)!==null&&$!==void 0?$:(h=g.locale)===null||h===void 0||(h=h.Modal)===null||h===void 0?void 0:h.cancelText)!==null&&x!==void 0?x:"取消"},resetButtonProps:{preventDefault:!0,disabled:H?V:void 0,onClick:function(te){var ie;M(!1),t==null||(ie=t.onCancel)===null||ie===void 0||ie.call(t,te)}}},(K=c.submitter)!==null&&K!==void 0?K:{})},[(n=g.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.cancelText,(R=g.locale)===null||R===void 0||(R=R.Modal)===null||R===void 0?void 0:R.okText,t,c.submitter,M,V,H]),L=l.useCallback(function(C,u){return p.jsxs(p.Fragment,{children:[C,G.current&&u?p.jsx(oe.Fragment,{children:he.createPortal(u,G.current)},"submitter"):u]})},[]),_=l.useCallback(function(){var C=le(X().mark(function u(d){var x,$,h;return X().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return x=W==null?void 0:W(d),H&&x instanceof Promise&&(b(!0),$=setTimeout(function(){return b(!1)},H),x.finally(function(){clearTimeout($),b(!1)})),A.next=4,x;case 4:return h=A.sent,h&&M(!1),A.abrupt("return",h);case 7:case"end":return A.stop()}},u)}));return function(u){return C.apply(this,arguments)}}(),[W,M,H]),Q=Ce(B);return p.jsxs(p.Fragment,{children:[p.jsx(Pe,a(a(a({title:z,width:w||800},t),Q),{},{onCancel:function(u){var d;H&&V||(M(!1),t==null||(d=t.onCancel)===null||d===void 0||d.call(t,u))},afterClose:function(){var u;f(),B&&M(!1),t==null||(u=t.afterClose)===null||u===void 0||u.call(t)},footer:c.submitter!==!1?p.jsx("div",{ref:re,style:{display:"flex",justifyContent:"flex-end"}}):null,children:p.jsx(ce,a(a({formComponentType:"ModalForm",layout:"vertical"},c),{},{onInit:function(u,d){var x;c.formRef&&(c.formRef.current=d),c==null||(x=c.onInit)===null||x===void 0||x.call(c,u,d),q.current=d},formRef:q,submitter:j,onFinish:function(){var C=le(X().mark(function u(d){var x;return X().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,_(d);case 2:return x=h.sent,h.abrupt("return",x);case 4:case"end":return h.stop()}},u)}));return function(u){return C.apply(this,arguments)}}(),contentRender:L,children:ne}))})),T]})}export{qe as D,Je as L,Ke as M};
//# sourceMappingURL=index-ddae2bac.js.map
