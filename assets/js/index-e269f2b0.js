import{aA as L,aB as D,r as c,j as e,ae as j,R as te,B as g,C as T,a1 as se,ap as le,W as O,av as ie,M as ae,aC as M,O as re,I as R,am as E}from"./index-23197e8f.js";import{C as ne}from"./index-53925a26.js";import{S as Y}from"./index-275ec0e9.js";import{D as $}from"./index-4093f2a3.js";import{T as oe}from"./index-71ffa397.js";import{r as de}from"./roleManage-38fb5342.js";import ce from"./UserFormModal-0069d752.js";import{u as me,w as ue}from"./xlsx-964ea548.js";import{C as P}from"./index-13355cfb.js";import{P as xe}from"./index-8d332e71.js";import"./index-526963cf.js";import"./index-1b8cb43c.js";import"./useBubbleLock-53a6bd78.js";import"./Select-f073d5d6.js";import"./List-fae2ed6b.js";import"./useIcons-790dd29c.js";import"./SinglePicker-2785c332.js";import"./customParseFormat-f01bfcc3.js";import"./___vite-browser-external_commonjs-proxy-e484fcab.js";import"./Table-7f64b86f.js";import"./index-66e83467.js";import"./zh_CN-2d11fb9c.js";import"./styleChecker-d86246ff.js";import"./Tree-d7ec55a3.js";import"./conductUtil-a9a07cfe.js";import"./index-438e0556.js";import"./index-01e2a9ec.js";import"./iconUtil-4b9a5d6f.js";const he=a=>L.get(D+"/user/manage/list",a),pe=a=>L.post(D+"/user/manage/create",a),fe=a=>L.post(D+"/user/manage/edit",a);function ge(a=[]){if(!a)return[];let l=[];return a.forEach(i=>{l.push(e.jsx(Y.Option,{value:i.id,children:i.name},i.id))}),l}function A(a){if(!a)return"";const l=new Date(a),i=l.getMonth()<9?`0${l.getMonth()+1}`:l.getMonth()+1,n=l.getDate()<10?`0${l.getDate()}`:l.getDate();return`${l.getFullYear()}-${i}-${n}`}function V(a){const{label:l,field:i,type:n,placeholder:o,width:d,list:m,style:h}=a;switch(n){case"TIME":return[e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:"startTime",label:"开始时间",children:e.jsx($,{style:d,showTime:!0,placeholder:o,format:"YYYY-MM-DD hh:mm:ss"})},"startTime")}),e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:"endTime",label:"结束时间",children:e.jsx($,{style:d,showTime:!0,placeholder:o,format:"YYYY-MM-DD hh:mm:ss"})},"endTime")})];case"INPUT":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:i,label:l,style:h,children:e.jsx(se,{type:"text",placeholder:o,style:{width:d}})},i)});case"SELECT":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:i,label:l,style:h,children:e.jsx(Y,{style:{width:d},placeholder:o,children:ge(m)})},i)});case"CHECKBOX":return e.jsx(T,{xs:24,sm:24,md:24,lg:12,xl:8,children:e.jsx(j.Item,{name:i,label:l,children:e.jsx(ne,{children:l})},i)});default:return null}}function je(a){var u;const{filterSubmit:l,multiForm:i}=a,[n,o]=c.useState(!1),d=c.useCallback(()=>{let s=i.getFieldsValue();s.startTime&&(s.startTime=A(s.startTime)),s.endTime&&(s.endTime=A(s.endTime)),l&&l(s)},[l,i]),m=c.useCallback(()=>{i.resetFields()},[i]),h=()=>{const{formList:s,extendFormList:y}=a;let f=[];if(s&&s.length>0&&(f=s.map(V)),y&&y.length>0){const I=n?y.map(V):[];f=[...f,...I]}return f},b=c.useCallback(()=>{o(s=>!s)},[]),p=h();return e.jsx("div",{children:e.jsx(j,{layout:"horizontal",form:i,children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx(te,{style:{width:"calc(100% - 250px)"},children:p.map((s,y)=>s)}),e.jsx("div",{style:{width:200},children:e.jsxs(j.Item,{children:[e.jsx(g,{type:"primary",onClick:d,children:"查询"}),e.jsx(g,{className:"mx-3",onClick:m,children:"重置"}),((u=a.extendFormList)==null?void 0:u.length)>0&&e.jsx("button",{type:"button",onClick:b,children:n?"收起":"展开"})]})})]})})})}const be=[{type:"INPUT",label:"用户名",field:"user_name",placeholder:"请输入用户名",initialValue:"",width:200},{type:"INPUT",label:"联系地址",field:"address",placeholder:"请输入联系地址",initialValue:"",width:200},{type:"SELECT",label:"婚姻状态",field:"isMarried",placeholder:"全部",initialValue:"0",width:200,list:[{id:"0",name:"全部"},{id:"1",name:"未婚"},{id:"2",name:"已婚"}]},{type:"SELECT",label:"性别",field:"sex",placeholder:"全部",initialValue:3,width:200,list:[{id:3,name:"全部"},{id:0,name:"女"},{id:1,name:"男"}]}],ye=[{type:"TIME",width:200},{type:"INPUT",placeholder:"请输入电影名",width:200,label:"电影",field:"movies"},{type:"SELECT",placeholder:"请选择电影",width:200,label:"选择种类",field:"kinds1",name:"key",list:[{id:1,key:"泰坦尼克号"},{id:2,key:"阿凡达"},{id:3,key:"蜘蛛侠"}]}],we=()=>{const a=(n,o,d)=>{const m=o.map(b=>Object.keys(b).reduce((p,u)=>{const s=n[u]||u;return p[s]=b[u],p},{})),h=me.json_to_sheet(m);l(i(h,void 0),`${d}.xlsx`)},l=(n,o)=>{typeof n=="object"&&n instanceof Blob&&(n=URL.createObjectURL(n));var d=document.createElement("a");d.href=n,d.download=o||"";var m;window.MouseEvent?m=new MouseEvent("click"):(m=document.createEvent("MouseEvents"),m.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null)),d.dispatchEvent(m)},i=(n,o)=>{o=o||"sheet1";var d={SheetNames:[o],Sheets:{}};d.Sheets[o]=n;var m={bookType:"xlsx",bookSST:!1,type:"binary"},h=ue(d,m),b=new Blob([p(h)],{type:"application/octet-stream"});function p(u){for(var s=new ArrayBuffer(u.length),y=new Uint8Array(s),f=0;f!=u.length;++f)y[f]=u.charCodeAt(f)&255;return s}return b};return{handleExportAll:a}},qe=()=>{const{handleExportAll:a}=we(),[l,i]=c.useState({}),[n,o]=c.useState([]),[d,m]=c.useState(!1),[h,b]=c.useState([]),[p,u]=c.useState({page:1,pageSize:10,totalCount:0}),[s,y]=c.useState({selectedRowKeys:[],selectedIds:[],selectedItem:{}}),[f,I]=c.useState(!1),[B,k]=c.useState(""),[F,v]=c.useState(""),[K,U]=c.useState({}),[N,_]=c.useState({});c.useState({state:"1",type:["1","3"]});const[z]=j.useForm(),[H]=j.useForm(),J=()=>{m(!0),setTimeout(()=>{const{page:t,pageSize:r}=p;let x={page:t,pageSize:r,...N};he(x).then(w=>{m(!1);const C=w.data.list.map((Z,ee)=>({...Z,key:ee}));b(C.splice(0,r)),u({page:w.data.page,pageSize:w.data.page_size,totalCount:w.data.total_count})})},500)},W=()=>{de().then(t=>{let r=t.data.list;const x=r.reduce((w,C)=>(w[C.id]=C.role_name,w),{});i(x||[]),o(r)})};c.useEffect(()=>{J(),W()},[p.page,p.pageSize]);const X=[{title:"id",dataIndex:"id",width:80,fixed:"left"},{title:"用户名",dataIndex:"username",width:80,fixed:"left"},{title:"性别",dataIndex:"sex",render:t=>t===1?"男":"女"},{title:"状态",dataIndex:"state",render:t=>({1:e.jsx(E,{color:"green",children:"痛苦"}),2:e.jsx(E,{color:"blue",children:"委屈"}),3:e.jsx(E,{color:"orange",children:"迷茫"}),4:e.jsx(E,{color:"red",children:"平淡"}),5:e.jsx(E,{color:"purple",children:"开心"})})[t]},{title:"爱好",dataIndex:"interest",render:t=>({1:"游泳",2:"打篮球",3:"踢足球",4:"跑步",5:"爬山",6:"骑行",7:"桌球",8:"麦霸"})[t]},{title:"婚姻状态",dataIndex:"isMarried",render(t){return t?e.jsx(R,{status:"success",text:"已婚"}):e.jsx(R,{status:"error",text:"未婚"})}},{title:"所属角色",dataIndex:"role_id",render:t=>l[t]},{title:"手机号",render(){let x=(15303663375+"").replace(/(\d{3})\d*(\d{4})/g,"$1***$2");return e.jsx("span",{children:x})}},{title:"身份证号",render(){let x=(231085199811011415n+"").replace(/(\d{3})\d*(\d{4})/g,"$1***********$2");return e.jsx("span",{children:x})}},{title:"联系地址",dataIndex:"address"},{title:"邮箱",dataIndex:"email"},{title:"生日",dataIndex:"birthday"},{title:"早起时间",dataIndex:"time"},{title:"操作",fixed:"right",width:200,render(t){return e.jsxs(O,{children:[e.jsx(g,{size:"small",onClick:()=>{S("detail",t)},children:"详情"}),e.jsx(g,{size:"small",onClick:()=>{S("edit",t)},children:"编辑"}),e.jsx(g,{size:"small",onClick:()=>{S("delete",t)},children:"删除"})]})}}],S=(t,r)=>{t==="create"?(I(!0),k("新建用户"),v(t)):["edit","detail"].includes(t)?(k(t==="edit"?"编辑用户":"查看详情"),v(t),U(r),I(!0)):t==="delete"?M.success(`删除用户成功！ id：${r.id}`):t==="moreDelete"&&M.success(`删除更多用户成功！ id：${JSON.stringify(s.selectedIds)}`)},q=()=>{let t=F,r=z.getFieldsValue();t==="create"?pe(r):fe(r)},G={address:"地址",birthday:"生日",email:"邮箱",id:"id",interest:"爱好",isMarried:"婚姻状态"},Q=e.jsxs("div",{children:[e.jsx(P,{className:"mb20",style:{},children:e.jsx(le,{defaultActiveKey:"1",items:[{label:"输入框查询",key:"1",children:e.jsx(je,{multiForm:H,formList:be,extendFormList:ye,filterSubmit:(t={})=>{_(t)}})}]})}),e.jsx(P,{className:"mb30",title:"用户列表",extra:e.jsxs(O,{size:"large",children:[e.jsx(g,{size:"middle",onClick:()=>{S("create",null)},children:"新建"}),e.jsx(xe,{title:"批量删除",description:"你确定要删除吗？",okText:"确定",cancelText:"取消",onConfirm:()=>{S("moreDelete",null)},children:e.jsx(g,{size:"middle",disabled:s.selectedRowKeys.length<=1,icon:e.jsx(ie,{}),children:"批量删除"})}),e.jsx(g,{size:"middle",onClick:()=>{a(G,h,"用户列表")},children:"导出Excel"}),e.jsx(ae,{beforeUpload:t=>(/\.(xlsx|xls)$/.test(t.name.toLowerCase())||M.error("请上传Excel文件（.xlsx 或 .xls）"),!1),children:e.jsx(g,{children:"上传Excel"})})]}),style:{width:"100%"},children:e.jsx(oe,{rowSelection:"checkbox",columns:X,dataSource:h,pagination:p,selectedRowKeys:s.selectedRowKeys,selectedIds:s.selectedIds,selectedItem:s.selectedItem,updateSelectedItem:(t,r,x)=>{y({selectedRowKeys:t,selectedIds:x&&x.length>0?x:[],selectedRows:r})},updatePage:(t,r)=>{u(x=>({...x,page:t,pageSize:r}))},loading:d,id:"cart-scrollTable",xScroll:!0})}),e.jsx(re,{width:800,title:B,open:f,onOk:q,onCancel:()=>{k(""),I(!1),v(""),U({})},children:e.jsx(ce,{roles:n,userInfo:K,type:F,form:z})})]});return e.jsx(e.Fragment,{children:Q})};export{qe as default};
