import{r as n,as as se,a9 as o,j as e,Q as re,B as w,M as y,V as O}from"./index-73f2468a.js";import{T as ne}from"./index-e89265b2.js";import{r as ae,a as le}from"./roleManage-4c33a3b6.js";import{C as R}from"./index-8b610198.js";import{S as j}from"./index-1478f1b2.js";import{T as x}from"./index-fbe30eff.js";import{T as oe}from"./index-2b6d6557.js";import"./___vite-browser-external_commonjs-proxy-84b1ab60.js";import"./Table-173482b2.js";import"./styleChecker-1694ee42.js";import"./List-47ac0dfc.js";import"./iconUtil-f1226c8c.js";import"./conductUtil-afc9f381.js";import"./index-4eb84239.js";import"./index-f41169a9.js";import"./index-e4545b9b.js";import"./index-6c454201.js";import"./Skeleton-89022a2b.js";import"./useIcons-c4c7d32f.js";import"./transButton-057d9b55.js";function M(i){if(!i)return"";let a=new Date(Number(i));return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}const Oe=()=>{const[i,a]=n.useState([]),[S,h]=n.useState([]),[I,b]=n.useState([]),[s,m]=n.useState({}),d=se(t=>t.auth.authMenuList),[c]=o.useForm(),[r]=o.useForm(),[l]=o.useForm(),[C,u]=n.useState(!1),[F,_]=n.useState(!1),[z,B]=n.useState({}),[L,D]=n.useState([]),[E,T]=n.useState(!1),[U,v]=n.useState([]),[K,P]=n.useState([]),[A,H]=n.useState(null),[J,Q]=n.useState({}),Y=n.useRef();n.useEffect(()=>{(async function(){ae().then(t=>{const f=t.data.list.map((p,g)=>({...p,key:g}));a(f)})})()},[]);const q=[{title:"角色名称",dataIndex:"role_name"},{title:"使用状态",dataIndex:"status",render:t=>t===1?"启用":"停用"},{title:"授权人",dataIndex:"authorize_user_name"},{title:"创建时间",dataIndex:"create_time",render:M,width:150},{title:"授权时间",dataIndex:"authorize_time",render:M,width:150}],G=(t,f,p)=>{p?(h(t),b(p),m(f)):(h(t),m(f))},W=()=>{u(!0)},X=()=>{c.getFieldsValue(),c.resetFields(),u(!1)},Z=()=>{if(JSON.stringify(s)=="{}"){y.info({title:"信息",content:"请选择一个角色"});return}_(!0),B(s),D(s.menus)},$=()=>{let t=r.getFieldsValue();t.role_id=s.id,t.menus=L,t.authorize_time=Date.now(),r.resetFields(),_(!1)},ee=async()=>{if(JSON.stringify(s)=="{}"){y.info({title:"信息",content:"未选中任何项目"});return}const t=await le(s.id),f=[],p=[];if(t.data.length>0){const g=t.data;for(let N=0;N<g.length;N++){const V=g[N],k={key:V.user_id,title:V.user_name,status:V.status};k.status===1&&p.push(k.key),f.push(k)}}v(f),P(p),Q(s),H(!1),T(!0)},te=()=>{s.id,l.resetFields(),T(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{extra:e.jsxs(re,{size:"middle",children:[e.jsx(w,{type:"primary",onClick:W,children:"创建角色"}),e.jsx(w,{type:s.id?"primary":"default",onClick:Z,disabled:!s.id,children:"设置权限"}),e.jsx(w,{type:s.id?"primary":"default",onClick:ee,disabled:!s.id,children:"用户授权"})]}),children:e.jsx(ne,{columns:q,dataSource:i,selectedRowKeys:S,selectedIds:I,selectedItem:s,pagination:{},updateSelectedItem:G})}),e.jsx(y,{title:"创建角色",open:C,onOk:X,onCancel:()=>{c.resetFields(),u(!1)},children:e.jsx(ie,{form:c})}),e.jsx(y,{width:600,title:"权限设置",open:F,onOk:$,onCancel:()=>{r.resetFields(),_(!1)},children:e.jsx(de,{form:r,detailInfo:z,menuInfo:L||[],patchMenuInfo:t=>{D(t)},menuConfig:d})}),e.jsx(y,{title:"用户授权",width:800,open:E,onOk:te,onCancel:()=>{l.resetFields(),T(!1)},children:e.jsx(ce,{form:l,isClose:A,detailUserInfo:J,targetKeys:K,transferData:U,patchUserInfo:t=>{P(t)},ref:Y})})]})};function ie({form:i}){const a={labelCol:{span:5},wrapperCol:{span:16}};return e.jsx(e.Fragment,{children:e.jsx(R,{children:e.jsxs(o,{form:i,...a,initialValues:{status:1},children:[e.jsx(o.Item,{label:"角色名称",name:"role_name",children:e.jsx(O,{type:"text",placeholder:"请输入角色名称"})}),e.jsx(o.Item,{label:"状态",name:"status",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"开启"}),e.jsx(j.Option,{value:0,children:"关闭"})]})})]})})})}function de({form:i,detailInfo:a,menuInfo:S,patchMenuInfo:h,menuConfig:I}){const b=(d,c="")=>{const r=[];return d.btnList.forEach(l=>{r.push(e.jsx(x.TreeNode,{title:l.meta.title,className:"op-role-tree"},c+"-btn-"+l.path))}),r},s=(d,c)=>d.map(r=>{let l=r.path;return r.children?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:s(r.children)},l):r.btnList?e.jsx(x.TreeNode,{title:r.meta.title,className:"op-role-tree",children:b(r,l)},l):e.jsx(x.TreeNode,{title:r.meta.title},l)}),m={labelCol:{span:4},wrapperCol:{span:16}};return e.jsx(o,{form:i,layout:"horizontal",...m,initialValues:{status2:1,role_name2:a.role_name},children:e.jsxs(R,{children:[e.jsx(o.Item,{label:"角色名称",name:"role_name2",children:e.jsx(O,{disabled:!0,maxLength:8,placeholder:a.role_name})}),e.jsx(o.Item,{label:"状态",name:"status2",children:e.jsxs(j,{children:[e.jsx(j.Option,{value:1,children:"启用"}),e.jsx(j.Option,{value:0,children:"停用"})]})}),e.jsx(o.Item,{label:"菜单",name:"menu",children:e.jsx(x,{checkable:!0,defaultExpandAll:!0,onCheck:d=>{h(d)},checkedKeys:S||[],children:e.jsx(x.TreeNode,{title:"平台权限",children:s(I)},"platform_all")})})]})})}function ce({form:i,isClose:a,detailUserInfo:S,targetKeys:h,transferData:I,patchUserInfo:b,ref:s}){const[m,d]=n.useState(11),c=()=>(d(m+1),m);n.useImperativeHandle(s,()=>({status:m,statusValue:c}));const r=(u,F)=>F.title.indexOf(u)>-1,l=u=>{b(u)},C={labelCol:{span:5},wrapperCol:{span:18}};return e.jsxs(o,{form:i,layout:"horizontal",...C,initialValues:{transfer:h},children:[e.jsx(o.Item,{name:"role_name3",label:"角色名称",children:e.jsx(O,{disabled:!0,maxLength:8,placeholder:S.role_name})}),e.jsx(o.Item,{name:"transfer",label:"选择用户：",children:e.jsx(oe,{listStyle:{width:200,height:400},dataSource:I,showSearch:!0,titles:["待选用户","已选用户"],filterOption:r,targetKeys:h,onChange:l,render:u=>u.title})})]})}export{Oe as default};
