{"version":3,"file":"tableEditCell-a7c15b65.js","sources":["../../../src/views/list/basicTable/components/tableEditCell.tsx"],"sourcesContent":["import React, { useContext, useEffect, useRef, useState } from 'react'\r\nimport type { GetRef } from 'antd'\r\nimport { Button, Form, Input, Popconfirm, Table } from 'antd'\r\n\r\ntype InputRef = GetRef<typeof Input>\r\ntype FormInstance<T> = GetRef<typeof Form<T>>\r\n\r\nconst EditableContext = React.createContext<FormInstance<any> | null>(null)\r\n\r\ninterface Item {\r\n\tkey: string\r\n\tname: string\r\n\tage: string\r\n\taddress: string\r\n}\r\n\r\ninterface EditableRowProps {\r\n\tindex: number\r\n}\r\n\r\nconst EditableRow: React.FC<EditableRowProps> = ({ index, ...props }) => {\r\n\tconst [form] = Form.useForm()\r\n\treturn (\r\n\t\t<Form form={form} component={false}>\r\n\t\t\t<EditableContext.Provider value={form}>\r\n\t\t\t\t<tr {...props} />\r\n\t\t\t</EditableContext.Provider>\r\n\t\t</Form>\r\n\t)\r\n}\r\n\r\ninterface EditableCellProps {\r\n\ttitle: React.ReactNode\r\n\teditable: boolean\r\n\tchildren: React.ReactNode\r\n\tdataIndex: keyof Item\r\n\trecord: Item\r\n\thandleSave: (record: Item) => void\r\n}\r\n\r\nconst EditableCell: React.FC<EditableCellProps> = ({ title, editable, children, dataIndex, record, handleSave, ...restProps }) => {\r\n\tconst [editing, setEditing] = useState(false)\r\n\t// const inputRef = useRef<InputRef>(null);\r\n\tconst inputRef = useRef<any>(null)\r\n\tconst form = useContext(EditableContext)!\r\n\r\n\tuseEffect(() => {\r\n\t\tif (editing) {\r\n\t\t\tinputRef.current!.focus()\r\n\t\t}\r\n\t}, [editing])\r\n\r\n\tconst toggleEdit = () => {\r\n\t\tsetEditing(!editing)\r\n\t\tform.setFieldsValue({ [dataIndex]: record[dataIndex] })\r\n\t}\r\n\r\n\tconst save = async () => {\r\n\t\ttry {\r\n\t\t\tconst values = await form.validateFields()\r\n\r\n\t\t\ttoggleEdit()\r\n\t\t\thandleSave({ ...record, ...values })\r\n\t\t} catch (errInfo) {\r\n\t\t\tconsole.log('Save failed:', errInfo)\r\n\t\t}\r\n\t}\r\n\r\n\tlet childNode = children\r\n\r\n\tif (editable) {\r\n\t\tchildNode = editing ? (\r\n\t\t\t<Form.Item\r\n\t\t\t\tstyle={{ margin: 0 }}\r\n\t\t\t\tname={dataIndex}\r\n\t\t\t\trules={[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: `${title} is required.`,\r\n\t\t\t\t\t},\r\n\t\t\t\t]}>\r\n\t\t\t\t<Input ref={inputRef} onPressEnter={save} onBlur={save} />\r\n\t\t\t</Form.Item>\r\n\t\t) : (\r\n\t\t\t<div className=\"editable-cell-value-wrap\" style={{ paddingRight: 24 }} onClick={toggleEdit}>\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\treturn <td {...restProps}>{childNode}</td>\r\n}\r\n\r\ntype EditableTableProps = Parameters<typeof Table>[0]\r\n\r\ninterface DataType {\r\n\tkey: React.Key\r\n\tname: string\r\n\tage: string\r\n\taddress: string\r\n}\r\n\r\ntype ColumnTypes = Exclude<EditableTableProps['columns'], undefined>\r\n\r\nconst App: any = ({ isShow }: any) => {\r\n\tconst [dataSource, setDataSource] = useState<DataType[]>([\r\n\t\t{\r\n\t\t\tkey: '0',\r\n\t\t\tname: 'Edward King 0',\r\n\t\t\tage: '32',\r\n\t\t\taddress: 'London, Park Lane no. 0',\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: '1',\r\n\t\t\tname: 'Edward King 1',\r\n\t\t\tage: '32',\r\n\t\t\taddress: 'London, Park Lane no. 1',\r\n\t\t},\r\n\t])\r\n\r\n\tconst [count, setCount] = useState(2)\r\n\r\n\tconst handleDelete = (key: React.Key) => {\r\n\t\tconst newData = dataSource.filter(item => item.key !== key)\r\n\t\tsetDataSource(newData)\r\n\t}\r\n\r\n\tconst defaultColumns: (ColumnTypes[number] & { editable?: boolean; dataIndex: string })[] = [\r\n\t\t{\r\n\t\t\ttitle: 'name',\r\n\t\t\tdataIndex: 'name',\r\n\t\t\twidth: '30%',\r\n\t\t\teditable: true,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'age',\r\n\t\t\tdataIndex: 'age',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'address',\r\n\t\t\tdataIndex: 'address',\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'operation',\r\n\t\t\tdataIndex: 'operation',\r\n\t\t\trender: (_, record: any) =>\r\n\t\t\t\tdataSource.length >= 1 ? (\r\n\t\t\t\t\t<Popconfirm title=\"Sure to delete?\" onConfirm={() => handleDelete(record.key)}>\r\n\t\t\t\t\t\t<a>Delete</a>\r\n\t\t\t\t\t</Popconfirm>\r\n\t\t\t\t) : null,\r\n\t\t},\r\n\t]\r\n\r\n\tconst handleAdd = () => {\r\n\t\tconst newData: DataType = {\r\n\t\t\tkey: count,\r\n\t\t\tname: `Edward King ${count}`,\r\n\t\t\tage: '32',\r\n\t\t\taddress: `London, Park Lane no. ${count}`,\r\n\t\t}\r\n\t\tsetDataSource([...dataSource, newData])\r\n\t\tsetCount(count + 1)\r\n\t}\r\n\r\n\tconst handleSave = (row: DataType) => {\r\n\t\tconst newData = [...dataSource]\r\n\t\tconst index = newData.findIndex(item => row.key === item.key)\r\n\t\tconst item = newData[index]\r\n\t\tnewData.splice(index, 1, {\r\n\t\t\t...item,\r\n\t\t\t...row,\r\n\t\t})\r\n\t\tsetDataSource(newData)\r\n\t}\r\n\r\n\tconst components = {\r\n\t\tbody: {\r\n\t\t\trow: EditableRow,\r\n\t\t\tcell: EditableCell,\r\n\t\t},\r\n\t}\r\n\r\n\tconst columns = defaultColumns.map(col => {\r\n\t\tif (!col.editable) {\r\n\t\t\treturn col\r\n\t\t}\r\n\t\treturn {\r\n\t\t\t...col,\r\n\t\t\tonCell: (record: DataType) => ({\r\n\t\t\t\trecord,\r\n\t\t\t\teditable: col.editable,\r\n\t\t\t\tdataIndex: col.dataIndex,\r\n\t\t\t\ttitle: col.title,\r\n\t\t\t\thandleSave,\r\n\t\t\t}),\r\n\t\t}\r\n\t})\r\n\r\n\treturn (\r\n\t\tisShow && (\r\n\t\t\t<div>\r\n\t\t\t\t<Button onClick={handleAdd} type=\"primary\" style={{ marginBottom: 16 }}>\r\n\t\t\t\t\tAdd a row\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Table components={components} rowClassName={() => 'editable-row'} bordered dataSource={dataSource} columns={columns as ColumnTypes} />\r\n\t\t\t</div>\r\n\t\t)\r\n\t)\r\n}\r\n\r\nexport default App\r\n"],"names":["EditableContext","React","EditableRow","index","props","form","Form","jsx","EditableCell","title","editable","children","dataIndex","record","handleSave","restProps","editing","setEditing","useState","inputRef","useRef","useContext","useEffect","toggleEdit","save","values","childNode","Input","App","isShow","dataSource","setDataSource","count","setCount","handleDelete","key","newData","item","defaultColumns","_","Popconfirm","handleAdd","row","components","columns","col","Button","Table"],"mappings":"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"}