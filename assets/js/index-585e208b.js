import{r as s,$ as a,V as le,cl as Me,j as i,z as ke,by as ce,bz as E,Y as U,ax as me,d as L,cm as De,X as q,W as we,c1 as ie,B as J,c0 as Ae,G as ae,ae as $e,R as K,C as W,cn as Ie}from"./index-83fc08b5.js";import{a as _e,P as Be,u as We}from"./index-65d8de54.js";import{B as Ee,c as Le,u as Q,m as Ne}from"./BaseForm-98436974.js";import{S as ue}from"./index-1dac6d84.js";var ze=["onFinish","step","formRef","title","stepProps"];function Te(o){var c=s.useRef(),r=s.useContext(fe),f=s.useContext(de),p=a(a({},o),f),P=p.onFinish,x=p.step,n=p.formRef;p.title,p.stepProps;var d=le(p,ze);return Me(!d.submitter,"StepForm 不包含提交按钮，请在 StepsForm 上"),s.useImperativeHandle(n,function(){return c.current},[n==null?void 0:n.current]),s.useEffect(function(){if(p.name||p.step){var R=(p.name||p.step).toString();return r==null||r.regForm(R,p),function(){r==null||r.unRegForm(R)}}},[]),r&&r!==null&&r!==void 0&&r.formArrayRef&&(r.formArrayRef.current[x||0]=c),i.jsx(Ee,a({formRef:c,onFinish:function(){var R=ce(E().mark(function C(h){var S;return E().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(d.name&&(r==null||r.onFormFinish(d.name,h)),!P){F.next=9;break}return r==null||r.setLoading(!0),F.next=5,P==null?void 0:P(h);case 5:return S=F.sent,S&&(r==null||r.next()),r==null||r.setLoading(!1),F.abrupt("return");case 9:r!=null&&r.lastStep||r==null||r.next();case 10:case"end":return F.stop()}},C)}));return function(C){return R.apply(this,arguments)}}(),onInit:function(C,h){var S;c.current=h,r&&r!==null&&r!==void 0&&r.formArrayRef&&(r.formArrayRef.current[x||0]=c),d==null||(S=d.onInit)===null||S===void 0||S.call(d,C,h)},layout:"vertical"},ke(d,["layoutType","columns"])))}var He=function(c){return U({},c.componentCls,{"&-container":{width:"max-content",minWidth:"420px",maxWidth:"100%",margin:"auto"},"&-steps-container":U({maxWidth:"1160px",margin:"auto"},"".concat(c.antCls,"-steps-vertical"),{height:"100%"}),"&-step":{display:"none",marginBlockStart:"32px","&-active":{display:"block"},"> form":{maxWidth:"100%"}}})};function Ve(o){return _e("StepsForm",function(c){var r=a(a({},c),{},{componentCls:".".concat(o)});return[He(r)]})}var Ge=["current","onCurrentChange","submitter","stepsFormRender","stepsRender","stepFormRender","stepsProps","onFinish","formProps","containerStyle","formRef","formMapRef","layoutRender"],fe=L.createContext(void 0),Oe={horizontal:function(c){var r=c.stepsDom,f=c.formDom;return i.jsxs(i.Fragment,{children:[i.jsx(K,{gutter:{xs:8,sm:16,md:24},children:i.jsx(W,{span:24,children:r})}),i.jsx(K,{gutter:{xs:8,sm:16,md:24},children:i.jsx(W,{span:24,children:f})})]})},vertical:function(c){var r=c.stepsDom,f=c.formDom;return i.jsxs(K,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24},children:[i.jsx(W,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12,children:L.cloneElement(r,{style:{height:"100%"}})}),i.jsx(W,{children:i.jsx("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"},children:f})})]})}},de=L.createContext(null);function Xe(o){var c=s.useContext(De.ConfigContext),r=c.getPrefixCls,f=r("pro-steps-form"),p=Ve(f),P=p.wrapSSR,x=p.hashId;o.current,o.onCurrentChange;var n=o.submitter,d=o.stepsFormRender,R=o.stepsRender,C=o.stepFormRender,h=o.stepsProps,S=o.onFinish,N=o.formProps,F=o.containerStyle,pe=o.formRef,he=o.formMapRef,k=o.layoutRender,ge=le(o,Ge),z=s.useRef(new Map),b=s.useRef(new Map),y=s.useRef([]),xe=s.useState([]),Z=q(xe,2),g=Z[0],ee=Z[1],Se=s.useState(!1),re=q(Se,2),D=re[0],$=re[1],j=We(),Fe=we(0,{value:o.current,onChange:o.onCurrentChange}),ne=q(Fe,2),m=ne[0],I=ne[1],T=s.useMemo(function(){return Oe[(h==null?void 0:h.direction)||"horizontal"]},[h==null?void 0:h.direction]),H=s.useMemo(function(){return m===g.length-1},[g.length,m]),Re=s.useCallback(function(e,t){b.current.has(e)||ee(function(l){return[].concat(ie(l),[e])}),b.current.set(e,t)},[]),ye=s.useCallback(function(e){ee(function(t){return t.filter(function(l){return l!==e})}),b.current.delete(e),z.current.delete(e)},[]);s.useImperativeHandle(he,function(){return y.current},[y.current]),s.useImperativeHandle(pe,function(){var e;return(e=y.current[m||0])===null||e===void 0?void 0:e.current},[m,y.current]);var Ce=s.useCallback(function(){var e=ce(E().mark(function t(l,u){var A,B;return E().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(z.current.set(l,u),!(!H||!S)){v.next=3;break}return v.abrupt("return");case 3:return $(!0),A=Ne.apply(void 0,[{}].concat(ie(Array.from(z.current.values())))),v.prev=5,v.next=8,S(A);case 8:B=v.sent,B&&(I(0),y.current.forEach(function(je){var Y;return(Y=je.current)===null||Y===void 0?void 0:Y.resetFields()})),v.next=15;break;case 12:v.prev=12,v.t0=v.catch(5),v.t0;case 15:return v.prev=15,$(!1),v.finish(15);case 18:case"end":return v.stop()}},t,null,[[5,12,15,18]])}));return function(t,l){return e.apply(this,arguments)}}(),[H,S,$,I]),V=s.useMemo(function(){var e=Le(Ie,"4.24.0")>-1,t=e?{items:g.map(function(l){var u=b.current.get(l);return a({key:l,title:u==null?void 0:u.title},u==null?void 0:u.stepProps)})}:{};return i.jsx("div",{className:"".concat(f,"-steps-container ").concat(x).trim(),style:{maxWidth:Math.min(g.length*320,1160)},children:i.jsx(ue,a(a(a({},h),t),{},{current:m,onChange:void 0,children:!e&&g.map(function(l){var u=b.current.get(l);return i.jsx(ue.Step,a({title:u==null?void 0:u.title},u==null?void 0:u.stepProps),l)})}))})},[g,x,f,m,h]),M=Q(function(){var e,t=y.current[m];(e=t.current)===null||e===void 0||e.submit()}),_=Q(function(){m<1||I(m-1)}),G=s.useMemo(function(){return n!==!1&&i.jsx(J,a(a({type:"primary",loading:D},n==null?void 0:n.submitButtonProps),{},{onClick:function(){var t;n==null||(t=n.onSubmit)===null||t===void 0||t.call(n),M()},children:j.getMessage("stepsForm.next","下一步")}),"next")},[j,D,M,n]),O=s.useMemo(function(){return n!==!1&&i.jsx(J,a(a({},n==null?void 0:n.resetButtonProps),{},{onClick:function(){var t;_(),n==null||(t=n.onReset)===null||t===void 0||t.call(n)},children:j.getMessage("stepsForm.prev","上一步")}),"pre")},[j,_,n]),X=s.useMemo(function(){return n!==!1&&i.jsx(J,a(a({type:"primary",loading:D},n==null?void 0:n.submitButtonProps),{},{onClick:function(){var t;n==null||(t=n.onSubmit)===null||t===void 0||t.call(n),M()},children:j.getMessage("stepsForm.submit","提交")}),"submit")},[j,D,M,n]),be=Q(function(){m>g.length-2||I(m+1)}),w=s.useMemo(function(){var e=[],t=m||0;if(t<1?g.length===1?e.push(X):e.push(G):t+1===g.length?e.push(O,X):e.push(O,G),e=e.filter(L.isValidElement),n&&n.render){var l,u={form:(l=y.current[m])===null||l===void 0?void 0:l.current,onSubmit:M,step:m,onPre:_};return n.render(u,e)}return n&&(n==null?void 0:n.render)===!1?null:e},[g.length,G,M,O,_,m,X,n]),te=s.useMemo(function(){return Ae(o.children).map(function(e,t){var l=e.props,u=l.name||"".concat(t),A=m===t,B=A?{contentRender:C,submitter:!1}:{};return i.jsx("div",{className:ae("".concat(f,"-step"),x,U({},"".concat(f,"-step-active"),A)),children:i.jsx(de.Provider,{value:a(a(a(a({},B),N),l),{},{name:u,step:t}),children:e})},u)})},[N,x,f,o.children,m,C]),oe=s.useMemo(function(){return R?R(g.map(function(e){var t;return{key:e,title:(t=b.current.get(e))===null||t===void 0?void 0:t.title}}),V):V},[g,V,R]),se=s.useMemo(function(){return i.jsxs("div",{className:"".concat(f,"-container ").concat(x).trim(),style:F,children:[te,d?null:i.jsx($e,{children:w})]})},[F,te,x,f,d,w]),Pe=s.useMemo(function(){var e={stepsDom:oe,formDom:se};return d?d(k?k(e):T(e),w):k?k(e):T(e)},[oe,se,T,d,w,k]);return P(i.jsx("div",{className:ae(f,x),children:i.jsx(me.Provider,a(a({},ge),{},{children:i.jsx(fe.Provider,{value:{loading:D,setLoading:$,regForm:Re,keyArray:g,next:be,formArrayRef:y,formMapRef:b,lastStep:H,unRegForm:ye,onFormFinish:Ce},children:Pe})}))}))}function ve(o){return i.jsx(Be,{needDeps:!0,children:i.jsx(Xe,a({},o))})}ve.StepForm=Te;ve.useForm=me.useForm;export{ve as S};
//# sourceMappingURL=index-585e208b.js.map
